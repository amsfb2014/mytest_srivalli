/*! Contacts */
(function(){AMA.namespace("model");var b=AMA.model.Contacts=AMA.model.UserData.extend();b.RESOURCE="contacts";b.OFFSET=0;b.PAGE_SIZE=30;b.IMPORT={ENDPOINT:"formattedContacts",SOURCE:{CSV:"csv",GOOGLE:"google"}};b.MODEL=AMA.model.UserData.MODEL.extend({});b.FieldFormats=AMA.enums("REGULAR","PHONE","PICTURE","EMAIL","IM","URL","ADDRESS_STREET","ADDRESS_STREET_EXTRA","ADDRESS_NEIGHBORHOOD","ADDRESS_CITY","ADDRESS_STATE","ADDRESS_COUNTRY","ADDRESS_COUNTRYCODE","ADDRESS_ZIPCODE","ADDRESS_FORMATTED","SMART_CONTACT_ASSOCIATION","COMPANY_NAME","DEPARTMENT","JOB_TITLE","CONTACT_SOURCE");var a=AMA.model.FieldTypes,c=b.FieldFormats;b.MODEL_DESCRIPTOR={fields:{firstName:{type:a.STRING,val:"",format:c.REGULAR},fullName:{type:a.STRING,val:"",format:c.REGULAR},mobilePhone1:{type:a.STRING,val:"",format:c.PHONE},mobilePhone2:{type:a.STRING,val:"",format:c.PHONE},mobilePhone3:{type:a.STRING,val:"",format:c.PHONE},notes:{type:a.STRING,val:"",format:c.REGULAR},middleName:{type:a.STRING,val:"",format:c.REGULAR},lastName:{type:a.STRING,val:"",format:c.REGULAR},suffix:{type:a.STRING,val:"",format:c.REGULAR},prefix:{type:a.STRING,val:"",format:c.REGULAR},firstPhonetic:{type:a.STRING,val:"",format:c.REGULAR},middlePhonetic:{type:a.STRING,val:"",format:c.REGULAR},lastPhonetic:{type:a.STRING,val:"",format:c.REGULAR},fax:{type:a.STRING,val:"",format:c.PHONE},homefax:{type:a.STRING,val:"",format:c.PHONE},workfax:{type:a.STRING,val:"",format:c.PHONE},phone:{type:a.STRING,val:"",format:c.PHONE},workPhone1:{type:a.STRING,val:"",format:c.PHONE},workPhone2:{type:a.STRING,val:"",format:c.PHONE},workPhone3:{type:a.STRING,val:"",format:c.PHONE},homePhone1:{type:a.STRING,val:"",format:c.PHONE},homePhone2:{type:a.STRING,val:"",format:c.PHONE},otherPhone:{type:a.STRING,val:"",format:c.PHONE},localPhone:{type:a.STRING,val:"",format:c.PHONE},iphone:{type:a.STRING,val:"",format:c.PHONE},pager:{type:a.STRING,val:"",format:c.PHONE},preferredPhone:{type:a.STRING,val:"",format:c.PHONE},localDate:{type:a.DATE,val:"",format:c.REGULAR},birthday:{type:a.DATE,val:"",format:c.REGULAR},anniversary:{type:a.DATE,val:"",format:c.REGULAR},nickName:{type:a.STRING,val:"",format:c.REGULAR},email1:{type:a.STRING,val:"",format:c.EMAIL},email2:{type:a.STRING,val:"",format:c.EMAIL},email3:{type:a.STRING,val:"",format:c.EMAIL},homeEmail:{type:a.STRING,val:"",format:c.EMAIL},workEmail:{type:a.STRING,val:"",format:c.EMAIL},otherEmail:{type:a.STRING,val:"",format:c.EMAIL},localEmail:{type:a.STRING,val:"",format:c.EMAIL},addressStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET},addressStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA},addressCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY},addressState:{type:a.STRING,val:"",format:c.ADDRESS_STATE},addressCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY},addressCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE},addressZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE},addressNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD},addressFormatted:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED},companyName:{type:a.STRING,val:"",format:c.COMPANY_NAME},department:{type:a.STRING,val:"",format:c.DEPARTMENT},position:{type:a.STRING,val:"",format:c.JOB_TITLE},workCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME},workDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT},workJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE},otherCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME},otherDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT},otherJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE},localCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME},localDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT},localJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE},localStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET},localStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA},localCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY},localState:{type:a.STRING,val:"",format:c.ADDRESS_STATE},localZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE},localCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY},localNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD},formattedLocalAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED},workStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET},workStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA},workCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY},workState:{type:a.STRING,val:"",format:c.ADDRESS_STATE},workZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE},workCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY},workCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE},workNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD},formattedWorkAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED},homeStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET},homeStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA},homeCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY},homeState:{type:a.STRING,val:"",format:c.ADDRESS_STATE},homeZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE},homeCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY},homeCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE},homeNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD},formattedHomeAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED},otherStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET},otherStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA},otherCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY},otherState:{type:a.STRING,val:"",format:c.ADDRESS_STATE},otherZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE},otherCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY},otherCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE},otherNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD},formattedOtherAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED},category:{type:a.STRING,val:"",format:c.REGULAR},gender:{type:a.STRING,val:"",format:c.REGULAR},webSiteUrl:{type:a.STRING,val:"",format:c.URL},homeWebSiteUrl:{type:a.STRING,val:"",format:c.URL},workWebSiteUrl:{type:a.STRING,val:"",format:c.URL},otherWebSiteUrl:{type:a.STRING,val:"",format:c.URL},preferredWebSiteUrl:{type:a.STRING,val:"",format:c.URL},im1:{type:a.STRING,val:"",format:c.IM},im2:{type:a.STRING,val:"",format:c.IM},im3:{type:a.STRING,val:"",format:c.IM},imOther:{type:a.STRING,val:"",format:c.IM},picture:{type:a.STRING,val:"",format:c.PICTURE},resourceName:{type:a.STRING,val:"",format:c.REGULAR},resourceTimestamp:{type:a.STRING,val:"",format:c.REGULAR},resourceVersion:{type:a.STRING,val:"",format:c.REGULAR},imAIM:{type:a.STRING,val:"",format:c.IM},imGTalk:{type:a.STRING,val:"",format:c.IM},imICQ:{type:a.STRING,val:"",format:c.IM},imJabber:{type:a.STRING,val:"",format:c.IM},imQQ:{type:a.STRING,val:"",format:c.IM},imSkype:{type:a.STRING,val:"",format:c.IM},imWindowsLive:{type:a.STRING,val:"",format:c.IM},imYahoo:{type:a.STRING,val:"",format:c.IM},usernameFacebook:{type:a.STRING,val:"",format:c.REGULAR},usernameTwitter:{type:a.STRING,val:"",format:c.REGULAR},usernameFlickr:{type:a.STRING,val:"",format:c.REGULAR},usernameYoutube:{type:a.STRING,val:"",format:c.REGULAR},usernameAmazonWishlist:{type:a.STRING,val:"",format:c.REGULAR},usernameSkype:{type:a.STRING,val:"",format:c.REGULAR},usernameChess:{type:a.STRING,val:"",format:c.REGULAR},contactEnabledMixin:{type:a.STRING,val:"",format:c.REGULAR},mixinMimeType:{type:a.STRING,val:"",format:c.REGULAR},mixinIdentifier:{type:a.STRING,val:"",format:c.REGULAR},mixinDisplayIdentifier:{type:a.STRING,val:"",format:c.REGULAR},assistant:{type:a.STRING,val:"",format:c.REGULAR},manager:{type:a.STRING,val:"",format:c.REGULAR},governmentID:{type:a.STRING,val:"",format:c.REGULAR},account:{type:a.STRING,val:"",format:c.REGULAR},customerID:{type:a.STRING,val:"",format:c.REGULAR},spouse:{type:a.STRING,val:"",format:c.REGULAR},children:{type:a.STRING,val:"",format:c.REGULAR},localGroupName:{type:a.STRING,val:"",format:c.REGULAR},exchangeName:{type:a.STRING,val:"",format:c.REGULAR},accountName:{type:a.STRING,val:"",format:c.REGULAR},accountType:{type:a.STRING,val:"",format:c.CONTACT_SOURCE},kind:{type:a.STRING,val:"",format:c.REGULAR},relationship:{type:a.STRING,val:"",format:c.REGULAR},internetCall:{type:a.STRING,val:"",format:c.REGULAR}}};b.isPhoneType=function(d){return b.MODEL_DESCRIPTOR.fields[d].format==b.FieldFormats.PHONE};b.getFieldType=function(d){return b.MODEL_DESCRIPTOR.fields[d].type};_.extend(b.prototype,{initialize:function(){b.__super__.initialize.apply(this,arguments);this.offset=b.OFFSET;this.pageSize=b.PAGE_SIZE},_configureUrl:function(d){b.__super__._configureUrl.call(this,d);if(d){this.offset=d.offset||this.offset;this.pageSize=d.pageSize||this.pageSize}this.url+="&"+$.param({offset:this.offset||b.OFFSET,limit:this.pageSize||b.PAGE_SIZE})},comparator:function(d){return d.get("fullName")},csvImport:function(e){if(!e){AMA.error("Import Contacts: One or more required function arguments is missing. Aborting");return}var d=AMA.config.apiHostUrl+"/"+b.IMPORT.ENDPOINT+"?"+$.param({source:b.IMPORT.SOURCE.CSV,devId:AMA.config.devId,authToken:AMA.config.authToken,endpointId:AMA.config.endpointId});e.prop("action",d);e.submit()},gmailFastImport:function(f,g){if(!f||!g){AMA.error("Import Contacts: One or more required function arguments is missing. Aborting");return}var d=AMA.config.apiHostUrl+"/"+b.IMPORT.ENDPOINT+"?"+$.param({source:b.IMPORT.SOURCE.GOOGLE,devId:AMA.config.devId,authToken:AMA.config.authToken,endpointId:AMA.config.endpointId}),e=AMA.Util.createCORSRequest("POST",d);if(e){e.onload=function(){try{var h=JSON.parse(this.responseText);g(h)}catch(j){AMA.error("POST /"+b.IMPORT.ENDPOINT+" - Import Contacts - response not JSON: "+this.responseText);g()}};e.onerror=function(){AMA.error("Import Contacts: Request returned an error");g()};e.send(JSON.stringify(f))}}})})();
/*! ContactDetails */
(function(){AMA.namespace("model");var b=AMA.model.ContactDetails=AMA.model.UserData.extend();b.RESOURCE="contacts";b.MODEL=AMA.model.UserData.MODEL.extend({});b.FieldFormats=AMA.enums("REGULAR","PHONE","PICTURE","EMAIL","IM","URL","ADDRESS_STREET","ADDRESS_STREET_EXTRA","ADDRESS_NEIGHBORHOOD","ADDRESS_CITY","ADDRESS_STATE","ADDRESS_COUNTRY","ADDRESS_COUNTRYCODE","ADDRESS_ZIPCODE","ADDRESS_FORMATTED","SMART_CONTACT_ASSOCIATION","COMPANY_NAME","DEPARTMENT","JOB_TITLE","CONTACT_SOURCE");var a=AMA.model.FieldTypes,c=b.FieldFormats;b.MODEL_DESCRIPTOR={fields:{firstName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"First Name"},fullName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Name"},mobilePhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Mobile Phone(s)"},mobilePhone1:{type:a.STRING,val:"",format:c.PHONE,displayText:"Mobile Phone 1"},mobilePhone2:{type:a.STRING,val:"",format:c.PHONE,displayText:"Mobile Phone 2"},mobilePhone3:{type:a.STRING,val:"",format:c.PHONE,displayText:"Mobile Phone 3"},notes:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Notes"},middleName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Middle Name"},lastName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Last Name"},suffix:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Suffix"},prefix:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Prefix"},firstPhonetic:{type:a.STRING,val:"",format:c.REGULAR,displayText:"First Phonetic"},middlePhonetic:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Middle Phonetic"},lastPhonetic:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Last Phonetic"},fax:{type:a.STRING,val:"",format:c.PHONE,displayText:"Fax"},homefax:{type:a.STRING,val:"",format:c.PHONE,displayText:"Home Fax"},workfax:{type:a.STRING,val:"",format:c.PHONE,displayText:"Work Fax"},phone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Phone"},workPhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Work Phone(s)"},workPhone1:{type:a.STRING,val:"",format:c.PHONE,displayText:"Work Phone 1"},workPhone2:{type:a.STRING,val:"",format:c.PHONE,displayText:"Work Phone 2"},workPhone3:{type:a.STRING,val:"",format:c.PHONE,displayText:"Work Phone 3"},homePhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Home Phone(s)"},homePhone1:{type:a.STRING,val:"",format:c.PHONE,displayText:"Home Phone 1"},homePhone2:{type:a.STRING,val:"",format:c.PHONE,displayText:"Home Phone 2"},otherPhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Other Phone"},localPhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Local Phone"},iphone:{type:a.STRING,val:"",format:c.PHONE,displayText:"iPhone"},pager:{type:a.STRING,val:"",format:c.PHONE,displayText:"Pager"},preferredPhone:{type:a.STRING,val:"",format:c.PHONE,displayText:"Preferred Phone"},localDate:{type:a.DATE,val:"",format:c.REGULAR,displayText:"Local Date"},birthday:{type:a.DATE,val:"",format:c.REGULAR,displayText:"Birthday"},anniversary:{type:a.DATE,val:"",format:c.REGULAR,displayText:"Anniversary"},nickName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Nick Name"},email:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Email(s)"},email1:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Email 1"},email2:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Email 2"},email3:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Email 3"},homeEmail:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Home Email"},workEmail:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Work Email"},otherEmail:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Other Email"},localEmail:{type:a.STRING,val:"",format:c.EMAIL,displayText:"Local Email"},addressStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET,displayText:"Street Line 1"},addressStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA,displayText:"Street Line 2"},addressCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY,displayText:"City"},addressState:{type:a.STRING,val:"",format:c.ADDRESS_STATE,displayText:"State"},addressCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY,displayText:"Country"},addressCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE,displayText:"Country Code"},addressZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE,displayText:"Zip Code"},addressNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD,displayText:"Neighborhood"},addressFormatted:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED,displayText:"Address"},companyName:{type:a.STRING,val:"",format:c.COMPANY_NAME,displayText:"Company Name"},department:{type:a.STRING,val:"",format:c.DEPARTMENT,displayText:"Department"},position:{type:a.STRING,val:"",format:c.JOB_TITLE,displayText:"Position"},workCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME,displayText:"Work Company"},workDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT,displayText:"Work Department"},workJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE,displayText:"Work Job Title"},otherCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME,displayText:"Other Company"},otherDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT,displayText:"Other Department"},otherJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE,displayText:"Other Job Title"},localCompany:{type:a.STRING,val:"",format:c.COMPANY_NAME,displayText:"Local Company"},localDepartment:{type:a.STRING,val:"",format:c.DEPARTMENT,displayText:"Local Department"},localJobTitle:{type:a.STRING,val:"",format:c.JOB_TITLE,displayText:"Local Job Title"},localStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET,displayText:"Local Street Line 1"},localStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA,displayText:"Local Street Line 2"},localCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY,displayText:"Local City"},localState:{type:a.STRING,val:"",format:c.ADDRESS_STATE,displayText:"Local State"},localZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE,displayText:"Local Zip Code"},localCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY,displayText:"Local Country"},localNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD,displayText:"Local Neighborhood"},formattedLocalAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED,displayText:"Local Address"},workStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET,displayText:"Work Street Line 1"},workStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA,displayText:"Work Street Line 2"},workCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY,displayText:"Work City"},workState:{type:a.STRING,val:"",format:c.ADDRESS_STATE,displayText:"Work State"},workZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE,displayText:"Work Zip Code"},workCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY,displayText:"Work Country"},workCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE,displayText:"Work Country Code"},workNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD,displayText:"Work Neighbordhood"},formattedWorkAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED,displayText:"Work Address"},homeStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET,displayText:"Home Street Line 1"},homeStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA,displayText:"Home Street Line 2"},homeCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY,displayText:"Home City"},homeState:{type:a.STRING,val:"",format:c.ADDRESS_STATE,displayText:"Home State"},homeZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE,displayText:"Home Zip Code"},homeCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY,displayText:"Home Country"},homeCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE,displayText:"Home Country Code"},homeNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD,displayText:"Home Neighborhood"},formattedHomeAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED,displayText:"Home Address"},otherStreet:{type:a.STRING,val:"",format:c.ADDRESS_STREET,displayText:"Other Street Line 1"},otherStreetExtra:{type:a.STRING,val:"",format:c.ADDRESS_STREET_EXTRA,displayText:"Other Line 2"},otherCity:{type:a.STRING,val:"",format:c.ADDRESS_CITY,displayText:"Other City"},otherState:{type:a.STRING,val:"",format:c.ADDRESS_STATE,displayText:"Other State"},otherZipCode:{type:a.STRING,val:"",format:c.ADDRESS_ZIPCODE,displayText:"Other Zip Code"},otherCountry:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRY,displayText:"Other Country"},otherCountryCode:{type:a.STRING,val:"",format:c.ADDRESS_COUNTRYCODE,displayText:"Other Country Code"},otherNeighborhood:{type:a.STRING,val:"",format:c.ADDRESS_NEIGHBORHOOD,displayText:"Other Neighborhood"},formattedOtherAddress:{type:a.STRING,val:"",format:c.ADDRESS_FORMATTED,displayText:"Other Address"},category:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Category"},gender:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Gender"},webSiteUrl:{type:a.STRING,val:"",format:c.URL,displayText:"Web Site URL"},homeWebSiteUrl:{type:a.STRING,val:"",format:c.URL,displayText:"Home Web Site URL"},workWebSiteUrl:{type:a.STRING,val:"",format:c.URL,displayText:"Work Web Site URL"},otherWebSiteUrl:{type:a.STRING,val:"",format:c.URL,displayText:"Other Web Site URL"},preferredWebSiteUrl:{type:a.STRING,val:"",format:c.URL,displayText:"Preferred Web Site URL"},im:{type:a.STRING,val:"",format:c.IM,displayText:"IM"},im2:{type:a.STRING,val:"",format:c.IM,displayText:"IM 2"},im3:{type:a.STRING,val:"",format:c.IM,displayText:"IM 3"},imOther:{type:a.STRING,val:"",format:c.IM,displayText:"Other IM"},picture:{type:a.STRING,val:"",format:c.PICTURE,displayText:"Picture"},resourceName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Resource Name"},resourceTimestamp:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Resource Timestamp"},resourceVersion:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Resource Version"},imAIM:{type:a.STRING,val:"",format:c.IM,displayText:"AIM"},imGTalk:{type:a.STRING,val:"",format:c.IM,displayText:"GTalk"},imICQ:{type:a.STRING,val:"",format:c.IM,displayText:"ICQ"},imJabber:{type:a.STRING,val:"",format:c.IM,displayText:"Jabber"},imQQ:{type:a.STRING,val:"",format:c.IM,displayText:"QQ"},imSkype:{type:a.STRING,val:"",format:c.IM,displayText:"Skype"},imWindowsLive:{type:a.STRING,val:"",format:c.IM,displayText:"Windows Live"},imYahoo:{type:a.STRING,val:"",format:c.IM,displayText:"Yahoo"},usernameFacebook:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Facebook Username"},usernameTwitter:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Twitter Username"},usernameFlickr:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Flickr Username"},usernameYoutube:{type:a.STRING,val:"",format:c.REGULAR,displayText:"YouTube Username"},usernameAmazonWishlist:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Amazon Wishlist Username"},usernameSkype:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Skype Username"},usernameChess:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Chess Username"},contactEnabledMixin:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Contact Enabled Mixin"},mixinMimeType:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Mixin MIME Type"},mixinIdentifier:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Mixin Identifier"},mixinDisplayIdentifier:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Mixin Display Identifier"},assistant:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Assistant"},manager:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Manager"},governmentID:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Government ID"},account:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Account"},customerID:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Customer ID"},spouse:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Spouse"},children:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Children"},localGroupName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Local Group Name"},exchangeName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Exchange Name"},accountName:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Account Name"},accountType:{type:a.STRING,val:"",format:c.CONTACT_SOURCE,displayText:"Account Type"},kind:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Kind"},relationship:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Relationship"},internetCall:{type:a.STRING,val:"",format:c.REGULAR,displayText:"Internet Call"}}};b.isPhoneType=function(d){return b.MODEL_DESCRIPTOR.fields[d].format==b.FieldFormats.PHONE};b.getFieldType=function(d){return b.MODEL_DESCRIPTOR.fields[d].type};_.extend(b.prototype,{comparator:function(d){return d.get("fullName")}});_.extend(b.prototype,{_configureFetchOptions:function(d){this.url=AMA.config.apiHostUrl+"/contacts/"+d.contactId+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&status="+AMA.model.UserData.Status.ENABLED},fetch:function(e){var d=this,f=null;if(e.contactId){this._configureFetchOptions(e);if(AMA.Util.useXdr()){f=AMA.Util.createCORSRequest("get",this.url);f.onload=function(){var g=null;try{g=JSON.parse(this.responseText)}catch(h){AMA.error("GET "+this.url+" - Contact Details - response not JSON: "+this.responseText)}if(g){d.isLoaded=true;d.isFetching=false;e.callback(true,g)}};f.onerror=function(){AMA.error("Request failed: GET "+this.url);e.callback(false)};f.onprogress=function(){};f.ontimeout=function(){};f.timeout=100000;f.send()}else{$.ajax({url:this.url}).done(function(g){d.isLoaded=true;d.isFetching=false;e.callback(true,g)})}}else{return}},getDetails:function(f,g){var d={};d.contactId=f;d.callback=g;var e=this.fetch(d)}})})();
/*! Files */
(function(){AMA.namespace("model");var a=AMA.model.Files=AMA.model.UserData.extend();a.RESOURCE="files";a.FILETYPE="";a.MODEL=AMA.model.UserData.MODEL.extend({});_.extend(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/"+a.RESOURCE+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,fileType:this.constructor.FILETYPE,authToken:AMA.config.authToken,status:AMA.model.UserData.Status.ENABLED})},_checkSyncPrivileges:function(){var c=a.RESOURCE,b=AMA.models.capabilities;this.syncPrivileges={create:b.canCreate(c),read:b.canRead(c),update:b.canUpdate(c),"delete":b.canDelete(c)}}})})();
/*! Photos */
(function(){AMA.namespace("model");var a=AMA.model.Photos=AMA.model.Files.extend();a.FILETYPE="image";a.OFFSET=0;a.PAGE_SIZE=9;a.PENDING_TRANSMIT=false;a.MODEL=AMA.model.Files.MODEL.extend({});_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.offset=a.OFFSET;this.pageSize=a.PAGE_SIZE;this.pendingTransmit=a.PENDING_TRANSMIT},_configureUrl:function(b){a.__super__._configureUrl.call(this,b);this.url+="&"+$.param({offset:this.offset||a.OFFSET,limit:this.pageSize||a.PAGE_SIZE,pendingTransmit:this.pendingTransmit||a.PENDING_TRANSMIT})}})})();
/*! Videos */
(function(){AMA.namespace("model");var a=AMA.model.Videos=AMA.model.Files.extend();a.FILETYPE="video";a.OFFSET=0;a.PAGE_SIZE=9;a.PENDING_TRANSMIT=false;a.MODEL=AMA.model.Files.MODEL.extend({});_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.offset=a.OFFSET;this.pageSize=a.PAGE_SIZE;this.pendingTransmit=a.PENDING_TRANSMIT},_configureUrl:function(b){a.__super__._configureUrl.call(this,b);this.url+="&"+$.param({offset:this.offset||a.OFFSET,limit:this.pageSize||a.PAGE_SIZE,pendingTransmit:this.pendingTransmit||a.PENDING_TRANSMIT})}})})();
/*! Trash */
(function(){AMA.namespace("model");var a=AMA.model.Trash=AMA.model.UserData.extend();a.OFFSET=0;a.LIMIT=9999;a.MODEL=AMA.model.UserData.MODEL.extend({});AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this);this.syncPrivileges={create:true,read:true,update:true,"delete":true};this.resetTrash()},resetTrash:function(){this.trashedItems=[];this._isTrashedContactsLoaded=false;this._isTrashedContactsFetching=false;this._isTrashedPhotosLoaded=false;this._isTrashedPhotosFetching=false;this._isTrashedVideosLoaded=false;this._isTrashedVideosFetching=false;this._isDropdownTrash=false},_configureFetchOptions:function(b){if(b.contacts){this.url=AMA.config.apiHostUrl+"/contacts?"}else{if(b.photos){this.url=AMA.config.apiHostUrl+"/files?fileType=image&"}else{if(b.videos){this.url=AMA.config.apiHostUrl+"/files?fileType=video&"}}}this.url+=$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken,status:AMA.model.UserData.Status.TRASHED,offset:a.OFFSET,limit:a.LIMIT});if(b&&b.params&&b.params.keyword){this.url+="&"+$.param({keyword:b.params.keyword})}},fetch:function(d){if(this._isTrashedContactsFetching&&this._isTrashedPhotosFetching&&this._isTrashedVideosFetching){return}var c=this;if(AMA.models.capabilities.isFetching){AMA.models.capabilities.on(AMA.model.BaseData.EVENT.LOADED,function(){c.fetch(c.options)});return}d=d||{};d.reset=true;if(!this._isTrashedContactsLoaded&&!this._isTrashedContactsFetching){this._isTrashedContactsFetching=true;d.contacts=true}else{if(!this._isTrashedPhotosLoaded&&!this._isTrashedPhotosFetching){this._isTrashedPhotosFetching=true;d.contacts=false;d.photos=true}else{if(!this._isTrashedVideosLoaded&&!this._isTrashedVideosFetching){this._isTrashedVideosFetching=true;d.contacts=false;d.photos=false;d.videos=true}}}this._configureFetchOptions(d);var b=d.complete;if(AMA.Util.useXdr()){d.success=function(){if(arguments[0].url.indexOf("contacts")>-1&&arguments[0].isLoaded&&c._isTrashedContactsFetching){c._isTrashedContactsLoaded=true;c._isTrashedContactsFetching=false}else{if(arguments[0].url.indexOf("image")>-1&&arguments[0].isLoaded&&c._isTrashedPhotosFetching){c._isTrashedPhotosLoaded=true;c._isTrashedPhotosFetching=false}else{if(arguments[0].url.indexOf("video")>-1&&arguments[0].isLoaded&&c._isTrashedVideosFetching){c._isTrashedVideosLoaded=true;c._isTrashedVideosFetching=false}}}if(c._isTrashedContactsLoaded&&c._isTrashedPhotosLoaded&&c._isTrashedVideosLoaded){c.unbind("add");_.each(c.trashedItems,function(e){c.add(e)});c.isLoaded=true;c.isFetching=false;c.trigger(AMA.model.BaseData.EVENT.LOADED)}else{c.fetch(d)}}}else{d.complete=_.bind(function(){if(arguments[1]==="success"&&this._isTrashedContactsFetching){this._isTrashedContactsLoaded=true;this._isTrashedContactsFetching=false}else{if(arguments[1]==="success"&&this._isTrashedPhotosFetching){this._isTrashedPhotosLoaded=true;this._isTrashedPhotosFetching=false}else{if(arguments[1]==="success"&&this._isTrashedVideosFetching){this._isTrashedVideosLoaded=true;this._isTrashedVideosFetching=false}}}if(this._isTrashedContactsLoaded&&this._isTrashedPhotosLoaded&&this._isTrashedVideosLoaded){c.unbind("add");_.each(this.trashedItems,function(e){c.add(e)});this.isLoaded=true;this.isFetching=false;this.trigger(AMA.model.BaseData.EVENT.LOADED)}else{this.fetch(d)}},this)}Backbone.Collection.prototype.fetch.call(this,d)},invalidate:function(b){this.resetTrash();a.__super__.invalidate.call(this,b)},parse:function(c){if(this.trashedItems.length==0){this.trashedItems=c.list}else{var b=this.trashedItems;for(i=0;i<c.list.length;i++){b.push(c.list[i])}}},trash:function(f,p){if(f.length<1){AMA.debug("No item IDs specified. Cancelling call to trash items.");p(false)}var r=false,n=false,d=false;var c,g={};var j={id:AMA.config.endpointId,list:[],total:0,totalPendingSync:0,totalSynced:0},e={id:AMA.config.endpointId,list:[],total:0,totalPendingSync:0,totalSynced:0,keyword:""},m={id:AMA.config.endpointId,list:[],total:0,totalPendingSync:0,totalSynced:0,keyword:""},q=this,b=this.models,l=null,k=null,h=null;_.each(b,function(t){for(var s in f){if(f[s]===t.attributes.id){t.attributes.visibility=AMA.model.UserData.Status.PURGED;if(t.attributes.fullName){j.list.push(t.attributes);r=true}else{if(t.attributes.fileType&&t.attributes.fileType.indexOf("image")>-1){e.list.push(t.attributes);d=true}else{if(t.attributes.fileType&&t.attributes.fileType.indexOf("video")>-1){m.list.push(t.attributes);n=true}}}}}});if(AMA.config.enableReporting){if(this._isDropdownTrash){if(this._isDropdownTrash){if(n===true){g.ActionPerformed="Permanant Delete Videos - Action Performed Dropdown";AMA.debug("Reporting: logging event for video deleted permanantly");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdeletevideotrash,g)}if(r===true){g.ActionPerformed="Permanant Delete Contacts - Action Performed Dropdown";AMA.debug("Reporting: logging event for contact deleted permanantly");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdeletecontacttrash,g)}if(d===true){g.ActionPerformed="Permanant Delete Images - Action Performed Dropdown";AMA.debug("Reporting: logging event for photo deleted permanantly");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdeleteimagetrash,g)}}}}if(j.list.length<1&&e.list.length<1&&m.list.length<1){AMA.debug("Specified items not found in Trash. Aborting command.");p(false)}else{if(AMA.Util.useXdr()){this.invalidateContacts=false;this.invalidatePhotos=false;this.invalidateVideos=false;this.waitingContacts=true;this.waitingPhotos=true;this.waitingVideos=true;if(j.list.length>0){l=AMA.Util.createCORSRequest("POST",AMA.config.apiHostUrl+"/contacts?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&_method=PUT");l.onload=function(){try{var s=JSON.parse(this.responseText)}catch(t){AMA.error("POST /contacts - Trash - response not JSON: "+this.responseText)}if(s){q.invalidateContacts=true;q.waitingContacts=false;q.checkWaiting(p)}};l.onerror=function(){AMA.error("Request failed: POST /contacts")};l.onprogress=function(){};l.ontimeout=function(){};l.timeout=100000;l.send(JSON.stringify(j))}else{this.waitingContacts=false}if(e.list.length>0){k=AMA.Util.createCORSRequest("POST",AMA.config.apiHostUrl+"/files?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&fileType=image&_method=PUT");k.onload=function(){try{var s=JSON.parse(this.responseText)}catch(t){AMA.error("POST /files - Trash - response not JSON: "+this.responseText)}if(s){q.invalidatePhotos=true;q.waitingPhotos=false;q.checkWaiting(p)}};k.onerror=function(){AMA.error("Request failed: POST /files")};k.onprogress=function(){};k.ontimeout=function(){};k.timeout=100000;k.send(JSON.stringify(e))}else{this.waitingPhotos=false}if(m.list.length>0){h=AMA.Util.createCORSRequest("POST",AMA.config.apiHostUrl+"/files?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&fileType=video&_method=PUT");h.onload=function(){try{var s=JSON.parse(this.responseText)}catch(t){AMA.error("POST /files - Trash - response not JSON: "+this.responseText)}if(s){q.invalidateVideos=true;q.waitingVideos=false;q.checkWaiting(p)}};h.onerror=function(){AMA.error("Request failed: POST /files")};h.onprogress=function(){};h.ontimeout=function(){};h.timeout=100000;h.send(JSON.stringify(m))}else{this.waitingVideos=false}}else{$.when($.ajax({type:"PUT",url:AMA.config.apiHostUrl+"/contacts?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,data:JSON.stringify(j),contentType:"application/json"}),$.ajax({type:"PUT",url:AMA.config.apiHostUrl+"/files?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&fileType=image",data:JSON.stringify(e),contentType:"application/json"}),$.ajax({type:"PUT",url:AMA.config.apiHostUrl+"/files?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&fileType=video",data:JSON.stringify(m),contentType:"application/json"})).done(function(y,v,u){var w=y[1]==="success"?true:false,s=v[1]==="success"?true:false,t=u[1]==="success"?true:false;p(w,s,t)})}}},restore:function(b,j){if(b.length<1){AMA.debug("No item IDs specified. Cancelling call to restore items.");j(false)}var d=this,h=[],g=[],c=[],f=this.models,e={};this.invalidateContacts=false;this.invalidatePhotos=false;this.invalidateVideos=false;this.waitingContacts=true;this.waitingPhotos=true;this.waitingVideos=true;_.each(f,function(l){var k;k=_.find(b,function(m){return m===l.attributes.id});if(k&&l.attributes.fullName){h.push(l.attributes)}else{if(k&&l.attributes.fileType&&l.attributes.fileType.indexOf("image")>-1){g.push(l.attributes)}else{if(k&&l.attributes.fileType&&l.attributes.fileType.indexOf("video")>-1){c.push(l.attributes)}}}});if(h.length<1&&g.length<1&&c.length<1){AMA.debug("Specified items not found in Trash. Aborting command.");j(false)}else{_.each(h,function(l,k){l.visibility=AMA.model.UserData.Status.ENABLED});_.each(g,function(l,k){l.visibility=AMA.model.UserData.Status.ENABLED});_.each(c,function(l,k){l.visibility=AMA.model.UserData.Status.ENABLED});if(h.length>0){a.__super__.restore.call(this,"contacts",h,function(k){if(k){d.invalidateContacts=true}d.waitingContacts=false;d.checkWaiting(j)})}else{this.waitingContacts=false}if(g.length>0){a.__super__.restore.call(this,"photos",g,function(k){if(k){d.invalidatePhotos=true}d.waitingPhotos=false;d.checkWaiting(j)})}else{this.waitingPhotos=false}if(c.length>0){a.__super__.restore.call(this,"videos",c,function(k){if(k){d.invalidateVideos=true}d.waitingVideos=false;d.checkWaiting(j)})}else{this.waitingVideos=false}}},checkWaiting:function(b){if(this.waitingContacts||this.waitingPhotos||this.waitingVideos){return}else{b(this.invalidateContacts,this.invalidatePhotos,this.invalidateVideos)}},setDropdownTrash:function(b){this._isDropdownTrash=b}})})();
/*! Locations */
(function(){AMA.namespace("model");var a=AMA.model.Locations=AMA.model.BaseData.extend();a.RESOURCE="locationHistory";a.URL="/locationHistory";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+a.URL+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken},parse:function(b){b=a.__super__.parse.call(this,b);_.each(b,function(d,c){d.id=c;d.coordinates=[d.latitude,d.longitude].join();d.time=d.eventTime;d.accuracy=d.precision});return b},prepareLocations:function(){},clearDuplicateLocations:function(){if(this.models.length<AMA.config.locationHistoryLimit){this.numberOfPoints=this.models.length}else{this.numberOfPoints=AMA.config.locationHistoryLimit}}})})();
/*! Threats */
(function(){AMA.namespace("model");var a=AMA.model.Threats=AMA.model.BaseData.extend();a.RESOURCE="appInfectionScanResults_actionId";a.URL="/appInfectionScanResults";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{fetch:function(){this.url=AMA.config.apiHostUrl+this.constructor.URL+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken});a.__super__.fetch.call(this)},_configureUrl:function(){}})})();
/*! Privacy */
(function(){AMA.namespace("model");var a=AMA.model.Privacy=AMA.model.BaseData.extend();a.RESOURCE="appVulnerabilityScanResults";a.URL="/appVulnerabilityScanResults";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this);this.sort_direction="asc";this.sort_key="id"},sortByKey:function(c,b){this.sort_key=c;this.sort_direction=b;this.sort()},comparator:function(d,c){d=d.get(this.sort_key);c=c.get(this.sort_key);d=(typeof d==="string")?d.toLowerCase():d;c=(typeof c==="string")?c.toLowerCase():c;if(this.sort_direction==="desc"){return d>c?-1:d<c?1:0}return d>c?1:d<c?-1:0},_configureFetchOptions:function(b){},_configureUrl:function(){this.url=AMA.config.apiHostUrl+a.URL+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken},fetch:function(){a.__super__.fetch.apply(this)}})})();
/*! SafeBrowsing */
(function(){AMA.namespace("model");var a=AMA.model.SafeBrowsing=AMA.model.BaseData.extend();a.RESOURCE="browserSecuritySettings";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{})})();
/*! DiagnosticResourcedata */
(function(){AMA.namespace("model");var a=AMA.model.DiagnosticScanResourceData=AMA.model.BaseData.extend();a.RESOURCE="apphealthscanresults_id_resources";a.URL="/appHealthScanResults";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+this.constructor.URL+"/"+AMA.config.endpointId+"/resources?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("\n\n Health Scan Resources config URL: "+this.url+"\n\n")}})})();
/*! DiagnosticScanApssData */
(function(){AMA.namespace("model");var a=AMA.model.DiagnosticScanAppsData=AMA.model.BaseData.extend();a.RESOURCE="apphealthscanresults_id_apps";a.URL="/appHealthScanResults";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+this.constructor.URL+"/"+AMA.config.endpointId+"/apps?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken+"&limit=*";AMA.debug("\n\n Health Scan Apps Data config URL: "+this.url+"\n\n")},defaults:{name:"",lastUsed:"lastUsedTEST",batteryRating:"",memoryRating:"",storageRating:""}})})();
/*! DataTab */
(function(){AMA.namespace("view");var a=AMA.view.DataTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="data_tab_template";a.TEMPLATE_SRC="data.tpl";a.TOOLBAR={DEFAULT:["endpoint","storageCapacity","sync","transferData"],IPHONE:["endpoint","storageCapacity"]};_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments)},render:function(){a.__super__.render.apply(this);var e=false,d=null,b=this;function c(g){var f=$(g);f.show();if(!e){if(!b.options.defaultTab){f.addClass("selected")}e=true}}if(AMA.models.capabilities.canRead("contacts")){this.contactsTab=new AMA.view.ContactsView({el:"#data_contacts_tab",parent:this});this.contactsTab.plug(AMA.view.plugin.InputPlaceholder);c("#data_contacts_tab_selector")}if(AMA.models.capabilities.canRead("files_fileType_image")){this.photosTab=new AMA.view.PhotosView({el:"#data_photos_tab",parent:this});c("#data_photos_tab_selector")}if(AMA.models.capabilities.canRead("files_fileType_video")){this.videosTab=new AMA.view.VideosView({el:"#data_videos_tab",parent:this});c("#data_videos_tab_selector")}if(e){this.trashTab=new AMA.view.TrashView({el:"#data_trash_tab",parent:this});$("#data_trash_tab_selector").show()}if(this.options.defaultTab){$("#"+this.options.defaultTab+"_selector").addClass("selected");if(!AMA.config.enableDpTimeTracking){AMA.debug("Reporting: Start DP time spent timer as user is on Data Tab");AMA.config.enableDpTimeTracking=true;AMA.ReportingManager.reportPortalTimeSpent("DP","Start")}}},_setupEvents:function(){a.__super__._setupEvents.apply(this);var d=this,b=d.$el.find(".data-tab-menu"),c=b.parent();this.$el.on("click",".data-tab-menu",function(h){var g=$(this).data("tag"),f=g.split("/")[2];h.preventDefault();window.location.hash=g;d.setSelected(f)});if(this.isRendered){this.setSelected(window.location.hash.split("/")[2])}},events:{"click #sync_settings":"editSyncSettings"},setSelected:function(b){b=b||"contacts";this.$el.find(".tab-"+b).addClass("selected").siblings().removeClass("selected")},editSyncSettings:function(){AMA.page.openSettings("backup")}})})();(function(){AMA.namespace("view");var a=AMA.view.SettingsSummaryView=AMA.view.BaseView.extend();a.TEMPLATE_ID="settings_summary_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{render:function(){a.__super__.render.apply(this,arguments);if(AMA.Util.isIPhone()){this.transferDataWizard=new AMA.view.TransferDataWizard({el:"#transfer_data_instruction_dialog",parent:this})}},_setupEvents:function(){var b=this;$(".transfer_data_view_instruction").on("click",function(){if(b.transferDataWizard.isRendered){b.transferDataWizard.show()}else{b.transferDataWizard._doRender();b.transferDataWizard.show()}})},_afterRender:function(){if(this.backupData){var b=this.$el.find(".iosBackupData .showspan"),c;if(b.size()>1){c=$(b[b.size()-1]).html();$(b[b.size()-1]).html("& "+c)}}},_processData:function(c){var d={},e=0,b="";d.backupData={syncContacts:"hide",syncPhotos:"hide",syncVideos:"hide"};d.frequency={NEVER:"hide",DAILY:"hide",WEEKLY:"hide"};d.day={MONDAY:"hide",TUESDAY:"hide",WEDNESDAY:"hide",THURSDAY:"hide",FRIDAY:"hide",SATURDAY:"hide",SUNDAY:"hide"};d.backupConnection={Wifi:"hide",MobileData:"hide"};d.rangeStart="";d.rangeEnd="";d.frequency[c.autosyncTime]="";if(c.autosyncTime!=="NEVER"){if(c.autosyncDay){b=c.autosyncDay.toUpperCase()}else{b=""}d.day[b]="showspan"}d.batteryLevelThreshold=c.autosyncBatteryThreshold;if(c.syncContactsEnabled){d.backupData.syncContacts="showspan"}if(c.syncPhotosEnabled){d.backupData.syncPhotos="showspan"}if(c.syncVideosEnabled){d.backupData.syncVideos="showspan"}if(c.syncOnWifi){d.backupConnection.Wifi="showspan"}if(c.syncOnMobileData){d.backupConnection.MobileData="showspan"}this.backupData=d.backupData;return d}})})();
/*! ContactsView */
(function(){AMA.namespace("view");var a=AMA.view.ContactsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="data_contacts_template";a.TEMPLATE_SRC="contacts.tpl";a.EXPORT_ENDPOINT="formattedContacts";AMA.augment(a.prototype,{events:{"click .create_contacts_link":"createContacts","click .import_contacts_link":"importContacts","click .batch_perform_button":"processBatchAction","click .less_is_more_link":"showLessIsMoreDialog","click .console.transferdata .transferdetails a.link_text":"transferDialog","click .print_contacts_link":"print","click .export_contacts_link":"exportContacts"},initialize:function(){a.__super__.initialize.apply(this,arguments);this.contactsList=null},print:function(){var b="/web/print.html";if(AMA.models.contacts.length){window.open(b,"cb_print")}else{AMA.page.standardDialogs.error($("#no_contacts_to_print").html())}},exportContacts:function(){if(AMA.models.contacts.length<1){AMA.page.standardDialogs.error($("#no_contacts_to_export").html());return}document.location.href=AMA.config.apiHostUrl+"/"+a.EXPORT_ENDPOINT+"?"+$.param({devId:AMA.config.devId,authToken:AMA.config.authToken,endpointId:AMA.config.endpointId})},render:function(){a.__super__.render.apply(this);this._isIPhone=AMA.Util.isIPhone();if(this._isIPhone){this.$el.find(".console.transferdata").show()}else{this.$el.find(".console.transferdata").hide()}this.contactsImport=new AMA.view.ContactsImportView({el:"#data_contacts_import",parent:this,data:false,hidden:true});this.contactEditor=new AMA.view.ContactEditor({el:"#data_contact_add-edit",parent:this,dataClass:AMA.models.contacts.constructor,hidden:true});this.contactsList=new AMA.view.ContactsListView({el:"#data_contacts_list",parent:this,data:AMA.models.contacts}).plug(AMA.view.plugin.Breakdown,{breakdownContainer:"#data_contacts_breakdown"}).plug(AMA.view.plugin.ApiListScrollLoader,{scrollContainer:"#data_contacts_list",listItemType:"li",listItemClassname:"rt_row",editorElement:"#data_contact_add-edit"}).plug(AMA.view.plugin.ApiSearch,{searchInput:"#data_contacts_searchbar .searchinput"}).plug(AMA.view.plugin.MultiSelector,{selectAll:"#data_contacts_selectall"});this.settingsSummary=new AMA.view.SettingsSummaryView({el:"#contacts_settings_summary_placeholder",data:AMA.models.syncsettings,parent:this});this.contactDetails=new AMA.view.ContactDetailsView({el:"#data_contact_details",parent:this,hidden:true,dataClass:AMA.models.contacts.constructor,listView:this.contactsList});this.lessIsMoreDialog=new AMA.view.LessIsMoreDialog({el:"#lessismoredialog",width:670,parent:this,hidden:true});this.contactsList.once(AMA.view.BaseView.EVENT.RENDERED,function(){if(this.contactsList.selectedItem){this.contactDetails.show()}},this);$(document).ready(function(){})},createContacts:function(){this.contactEditor._mode=AMA.view.ContactEditor.MODE.CREATE;this.contactEditor.setData(false);this.contactEditor.show(AMA.view.ContactEditor.MODE.CREATE);if($("#data_contacts_tab").find(".row-offcanvas-right").hasClass("active")){$("#data_contacts_tab").find("#data_contact_add-edit").addClass("antiActive")}else{$("#data_contacts_tab").find("#data_contact_add-edit").removeClass("antiActive")}},editContact:function(b){this.contactEditor._mode=AMA.view.ContactEditor.MODE.EDIT;this.contactEditor.setData(this.contactDetails.data.at(0));this.contactEditor.show(AMA.view.ContactEditor.MODE.EDIT)},importContacts:function(){this.contactsImport.show()},processBatchAction:function(){var e;var d=$("#data_contacts_multiaction_select").val();if(d==""){e=$("#msg_error_no_action_selected").html();AMA.page.standardDialogs.error(e);return false}var b=this.contactsList.getCheckedItems();if(b.length==0){e=$("#msg_error_no_contact_selected").html();AMA.page.standardDialogs.error(e);return false}function c(){var f={};var g=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(g);switch(d){case"delete":AMA.models.contacts.trash("contacts",b,function(h){AMA.page.standardDialogs.hideloading();if(h){AMA.models.contacts.invalidate();AMA.models.trash.invalidate()}});break;case"addToPhone":AMA.models.contacts.addRemove("add","contacts",b,function(h){AMA.page.standardDialogs.hideloading();if(h){AMA.models.contacts.invalidate()}});break;case"removeFromPhone":AMA.models.contacts.addRemove("remove","contacts",b,function(h){AMA.page.standardDialogs.hideloading();if(h){AMA.models.contacts.invalidate()}});break}if(AMA.config.enableReporting){if(d==="delete"){f.ActionPerformed="Delete Contact from phone & web- ActionPerformed dropdown";AMA.debug("Reporting.logging for contact deleted from phone & web ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdeletecontact,f)}if(d==="addToPhone"){f.ActionPerformed="Add contact to Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for contact added to phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdownaddcontact,f)}if(d==="removeFromPhone"){f.ActionPerformed="Remove contact from Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for contact removed from phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropremovecontact,f)}}}if(d==="delete"){e=$("#msg_confirm_delete_contact"+(b.length>1?"s":"")).html();AMA.page.standardDialogs.confirm(e,c)}else{c()}},transferDialog:function(){Backbone.globalEvent.trigger("showTranferData")},showLessIsMoreDialog:function(){this.lessIsMoreDialog.show()},toggleDetailView:function(b){this.toggleSlideCanvas()},toggleListView:function(){this.toggleSlideCanvas()},toggleSlideCanvas:function(){this.$el.find(".row-offcanvas").toggleClass("active");this.$el.find(".sidebar-offcanvas").toggleClass("active");if(this.$el.find("#records_detailshalf").css("position")=="absolute"){if(this.$el.find(".row-offcanvas").hasClass("active")){AMA.view.ContactsView.bodyScrollTopCurr=$("body").scrollTop();AMA.view.ContactsView.HTMLScrollTopCurr=$("html").scrollTop();$("body,html").scrollTop(0)}else{$("body").scrollTop(AMA.view.ContactsView.bodyScrollTopCurr);$("html").scrollTop(AMA.view.ContactsView.HTMLScrollTopCurr)}}}})})();
/*! ContactsListView */
(function(){AMA.namespace("view");var a=AMA.view.ContactsListView=AMA.view.ListView.extend();a.TEMPLATE_ID="contacts_list_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{render:function(){a.__super__.render.apply(this,arguments);AMA.debug(this._dataset.length+" items rendered in contact list view.")},_setupEvents:function(){AMA.view.ContactsListView.__super__._setupEvents.call(this,arguments);var b=this;this.$el.find("."+AMA.view.ContactsListView.CSS.ITEM).on("click",function(c){c.preventDefault();b.parent.toggleDetailView(this)})},_processData:function(c,b){a.__super__._processData.call(this,c,b);return c}})})();
/*! ContactDetailsView */
(function(){AMA.namespace("view");var e=AMA.view.ContactDetailsView=AMA.view.BaseView.extend();e.TEMPLATE_ID="contact_details_template";e.TEMPLATE_SRC="";e.KEY_ARRAY=["im","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","imOther","imOther2","imOther1","webSiteUrl","otherUrl","preferredUrl","homeUrl","url","workUrl","mobilePhone","workPhone","homePhone","fax","homeFax","workFax","pager","email","homeEmail","localEmail","otherEmail","workEmail","otherPhone","carPhone","radioPhone","localPhone","assistantPhone","iPhone"];e.KEY_ARRAY_PHONE=["mobilePhone","workPhone","homePhone","fax","homeFax","workFax","pager","otherPhone","carPhone","radioPhone","localPhone","assistantPhone","iPhone"];e.KEY_ARRAY_EMAIL=["email","homeEmail","localEmail","otherEmail","workEmail"];e.KEY_ARRAY_IM=["im","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","imOther","imOther2","imOther1"];e.KEY_ARRAY_URL=["webSiteUrl","otherUrl","preferredUrl","homeUrl","workUrl","url"];var b=35;var g=[{title:null,body:"details_toptwo",typePrefixes:["birthday","anniversary","nickName","relationship","notes","webSiteUrl"]},{title:"details_contactinfotitle",body:"details_contactinfo",typePrefixes:["mobilePhone1","mobilePhone2","mobilePhone3","fax","homefax","workfax","phone","workPhone1","workPhone2","workPhone3","homePhone1","homePhone2","otherPhone","localPhone","iphone","pager","preferredPhone","email1","email2","email3","homeEmail","workEmail","otherEmail","localEmail","im1","im2","im3","imOther","picture","resourceName","resourceTimestamp","resourceVersion","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","relationship","formattedHomeAddress"],alwaysOn:true},{title:"details_formattedworkaddresstitle",body:"details_formattedworkaddress",typePrefixes:["companyName","position","department","formattedWorkAddress","workJobTitle","workCompany","workDepartment"],noAttributeDisplay:false},{title:"details_formattedotheraddresstitle",body:"details_formattedotheraddress",typePrefixes:["formattedOtherAddress"],noAttributeDisplay:true},{title:"details_formattedcustomaddresstitle",body:"details_formattedcustomaddress",typePrefixes:["formattedLocalAddress"],noAttributeDisplay:true},{title:"details_othertitle",body:"details_other",typePrefixes:[""]}];var a=["fullName","firstName","middleName","lastName","suffix","prefix","category","contactEnabledMixin","mixinMimeType","mixinIdentifier","mixinDisplayIdentifier","localStreet","localStreetExtra","localNeighborhood","localCity","localState","localCountry","localCountryCode","localZipCode","otherStreet","otherStreetExtra","otherNeighborhood","otherCity","otherState","otherCountry","otherCountryCode","otherZipCode","workStreet","workStreetExtra","workNeighborhood","workCity","workState","workCountry","workCountryCode","workZipCode","homeStreet","homeStreetExtra","homeNeighborhood","homeCity","homeState","homeCountry","homeCountryCode","homeZipCode","localGroupName","exchangeName","kind"];var d={email1:"email",email2:"email",email3:"email",homeEmail:"email",workEmail:"email",otherEmail:"email",localEmail:"email",formattedHomeAddress:"address",formattedWorkAddress:"address",webSiteUrl:"url",birthday:"date",anniversary:"date"};var f=[{type:"Gmail",indicator:"com.google",image:"extres_google"},{type:"Outlook",indicator:"com.android.exchange",image:"extres_microsoft"},{type:"Facebook",indicator:"com.htc.socialnetwork.facebook",image:"extres_facebook"},{type:"Facebook",indicator:"com.facebook.auth.login",image:"extres_facebook"},{type:"Twitter",indicator:"com.htc.htctwitter",image:"extres_twitter"},{type:"Twitter",indicator:"com.sec.android.app.snsaccounttwitter.account_type",image:"extres_twitter"},{type:"Yahoo",indicator:"com.yahoo.mobile.client.share.sync",image:"extres_yahoo"},{type:"Flickr",indicator:"com.htc.socialnetwork.flickr",image:"extres_flickr"},{type:"Hotmail",indicator:"com.hotmail.Z7.eas",image:"extres_hotmail"},{type:"Gmail",indicator:"gmail",image:"extres_google"},{type:"Outlook",indicator:"outlook",image:"extres_microsoft"},{type:"My Contacts Backup",indicator:"My Contacts Backup",image:"extres_default"},{type:"Yahoo",indicator:"yahoo",image:"extres_yahoo"}];var c={normal:function(h){return h},email:function(h){return"<a class='link_text' href='mailto:"+h+"'>"+h+"</a>"},url:function(j){var h=j;if(j.indexOf("http://")!==0){h="http://"+j}return"<a class='link_text' href='"+h+"' target='_blank'>"+j+"</a>"},address:function(j){var h=j.replace(/ /g,"%20");return j+" &nbsp;&nbsp;<a target='_blank' href='http://www.bing.com/maps/default.aspx?v=2&where1="+h+"'>map</a>"},date:function(k){return $.datepicker.formatDate("mm/dd/yy",new Date(parseInt(k)));var j=k;var l="";if(j!=null&&j!=""){var h=new Date(parseInt(j));l=AMA.Util.formatDate(h,AMA.config.dateFormat,true)}return l},phone:function(j){var h=j.replace(/[^\d]/g,"").replace(/[^0-9\.]+/g,"");return"("+h.substring(0,3)+")-"+h.substring(3,6)+"-"+h.substring(6)}};AMA.augment(e.prototype,{initialize:function(h){e.__super__.initialize.apply(this,arguments);this.options.trash=h&&h.trash||false;this.options.listView=h&&h.listView||{};var j=this;if(this.options.listView){if(!this.options.trash){this.options.listView.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(k){j.setData(k);j.show()})}this.options.listView.on(AMA.view.ListView.EVENT.SELECTION_CLEARED,function(){j.hide()})}else{AMA.warning("This instance of ContactDetailsView is not linked to a contacts list. Data switching will not apply.")}},render:function(){var j=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},h="",k=this;AMA.models.contactDetails.getDetails(j.id,function(m,l){if(m){h=_.template(k.template,k._processData(l));k.$el.html(h);k._setupEvents()}})},_setupEvents:function(){var j=this;var h=this.options.listView;var k=h.data;if(AMA.Util.isIPhone()){this.$el.find(".details_buttonholder").hide();this.$el.find(".contact_note").hide()}else{this.$el.find(".details_buttonholder").show();this.$el.find(".contact_note").show()}this.$el.find(".details_editbutton").on("click",function(){j.parent.editContact(j.data)});this.$el.find(".details_removefromdevicebutton").on("click",function(){$("#loading_custom_dialog").addClass("show").removeClass("hide");AMA.models.contacts.addRemove("remove","contacts",[j.data.models[0].id],function(l){$("#loading_custom_dialog").addClass("hide").removeClass("show");if(l){AMA.models.contacts.invalidate()}})});this.$el.find(".details_addtodevicebutton").on("click",function(){$("#loading_custom_dialog").addClass("show").removeClass("hide");AMA.models.contacts.addRemove("add","contacts",[j.data.models[0].id],function(l){$("#loading_custom_dialog").addClass("hide").removeClass("show");if(l){AMA.models.contacts.invalidate()}})});this.$el.find(".details_deletebutton").on("click",function(){var l=this,m=$("#msg_confirm_delete_contact").html();AMA.page.standardDialogs.confirm(m,function(){AMA.page.standardDialogs.confirmDialog.hide();var n=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(n);AMA.models.contacts.trash("contacts",[l.attributes.uid.value],function(p){AMA.page.standardDialogs.hideloading();if(p){AMA.models.contacts.invalidate();AMA.models.trash.invalidate()}});j.parent.toggleListView()})});this.$el.find(".details_undeletebutton").on("click",function(){var l=this,m=$("#msg_confirm_restore_trashitem").html();AMA.page.standardDialogs.confirm(m,function(){AMA.page.standardDialogs.confirmDialog.hide();var n=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(n);AMA.models.trash.restore([l.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[0]){AMA.models.trash.invalidate();AMA.models.contacts.invalidate()}});j.parent.toggleListView()})});this.$el.find(".details_deletefromtrashbutton").on("click",function(){var l=this,m=$("#msg_confirm_permadelete_trashitem").html();AMA.page.standardDialogs.confirm(m,function(){AMA.page.standardDialogs.confirmDialog.hide();var n=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(n);AMA.models.trash.trash([l.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[0]){AMA.models.trash.invalidate()}})});j.parent.toggleListView()});j.$el.find(".close").on("click",function(l){j.parent.toggleListView()})},_processData:function(D){var G={};var l=true;G.deviceName=AMA.models.endpoints.toJSON()[0].platformfriendlyname;if(D==null){G.fullName="";return}var k=b;var q=this._getDisplayName(D);G.fullName=AMA.Util.escapeSpecialCharacters(AMA.Util.truncateString(q,k));G.fullNameTitle=q;var w=D.photoUUID;if(w!=null&&w!=""){G.pictureSrc=AMA.config.legacyApiBaseUrl+"/records.poo?method=retrieveThumbnail&csrfvalue="+AMA.config.csrfToken+"&mediaid="+w+"&max=300"}else{G.pictureSrc=AMA.config.commonImagePath+"silhouette.png"}var s=false;for(var C=0;C<g.length;C++){var y=g[C].title;var n=g[C].alwaysOn;var z=g[C].body;var F=g[C].typePrefixes;var E=true;for(var A=0;A<F.length;A++){var p=F[A];var t=D[p];G[p]={};G[p].value="";G[p].elClass="";G[p].valueClass="";G[p].display="none";var H=AMA.Util.itemExistsInArray(p,a);if(!H){var m=true;if(l||m){if(t!=null&&t!==""){t=AMA.Util.escapeSpecialCharacters(t);var r=d[p];if(!r){t=c.normal(t)}else{t=c[r](t)}E=false;if(AMA.model.Contacts.isPhoneType(p)){}if(p==="accountType"){t=this._parseContactSource(t)}if(AMA.model.Contacts.getFieldType(p)=="date"){t=AMA.Util.dateFormat(value)}var v="details_lineitem",u="details_lineitemvalue shifter_details_lineitemvalue";if(!m){v="details_lineitem details_lineitemunsupported";u="details_lineitemvalue shifter_details_lineitemvalue details_lineitemvalueunsupported"}G[p]={};G[p].value=t;G[p].elClass=v;G[p].valueClass=u;G[p].display="block"}}}}}var h="display:table-cell;";var B="display:none;";G.buttonStyles={edit:B,removeFromDevice:B,addToDevice:B,trash:B,restore:B,permanentDelete:B};G.recordStatusStyle={addToPhone:B,removeFromPhone:B,webOnly:B,onDevice:B};if(this.options.trash){G.buttonStyles.restore=h;G.buttonStyles.permanentDelete=h}else{G.buttonStyles.edit=h;G.buttonStyles.trash=h}if(D.visibility===AMA.model.UserData.Status.ENABLED){if(D.onPhone||D.pendingCreate){G.buttonStyles.removeFromDevice=h}else{G.buttonStyles.addToDevice=h}if(D.pendingCreate){G.recordStatusStyle.addToPhone=h}else{if(D.pendingDelete&&D.onPhone){G.recordStatusStyle.removeFromPhone=h}else{if(D.onPhone){G.recordStatusStyle.onDevice=h}else{G.recordStatusStyle.webOnly=h}}}}G.endpointName="Unknown Device";if(AMA.models.endpoints.isLoaded){G.endpointName=AMA.models.endpoints.toJSON()[0].platformfriendlyname}G.id=D.id;_.each(e.KEY_ARRAY,function(J){if(J in D){var j=[],I=function(){if(_.indexOf(e.KEY_ARRAY_PHONE,J,false)!==-1){_.each(D[J],function(K){j.push(c.phone(K))})}else{if(_.indexOf(e.KEY_ARRAY_IM,J,false)!==-1){_.each(D[J],function(K){j.push(c.normal(K))})}else{if(_.indexOf(e.KEY_ARRAY_EMAIL,J,false)!==-1){_.each(D[J],function(K){j.push(c.email(K))})}else{if(_.indexOf(e.KEY_ARRAY_URL,J,false)!==-1){_.each(D[J],function(K){j.push(c.url(K))})}}}}return j};G[J]={allIn:I().join("<br/>"),myClass:(j.length)?"":"hidden"}}else{G[J]={allIn:"",myClass:"hidden"}}},this);return G},_getDisplayName:function(h){return h.fullName||this._computeFullName(h)||h.companyName||h.email},_computeFullName:function(l){var k=l.firstName,j=l.middleName,h=l.lastName;return k+(k&&j?" ":"")+j+((k||j)&&h?" ":"")+h},_parseContactSource:function(k){var h=AMA.config.skinName;for(var j=0;j<f.length;j++){if(k.toLowerCase()==f[j]["indicator"]){h=f[j]["type"];break}}return h}})})();
/*! ContactsImportView */
(function(){AMA.namespace("view");var a=AMA.view.ContactsImportView=AMA.view.BaseView.extend();a.TEMPLATE_ID="contacts_import_template";a.TEMPLATE_SRC="";a.CSS={CLOSEVIEW:"#cancel_import",FEATURE_UNSUPPORTED:".feature_unsupported_note",GMAILFASTIMPORTDIV:"#ip_fast_method",GMAILFASTIMPORTFORM:"#gmail_fastimport",GMAILFASTIMPORTMETHOD:"#ip_fast_method",IMPORTALL:"#ip_importall_button",IMPORTFROM:"#import_source_dropdown",IMPORTGMAIL:"#ip_importgmail_button",INSTRUCTIONSBODY:".instructions_body",INSTRUCTIONS:"#ip_instructions",INSTRUCTIONSOUTLOOK:"#ip_outlook_instructions",INSTRUCTIONSOUTLOOKEXPRESS:"#ip_outlook_express_instructions",INSTRUCTIONSGMAIL:"#ip_gmail_instructions",INSTRUCTIONSGMAILDETAILED:"#ip_gmail_detailed_instructions",INSTRUCTIONSGMAILFAST:"#ip_gmail_fast_instructions",INSTRUCTIONSOTHER:"#ip_other_instructions",INSTRUCTIONSYAHOO:"#ip_yahoo_instructions",METHODBOX:"#methodbox",METHODSELECT:"#ip_methodselect",PROVIDERSELECT:"#ip_providerselect",UPLOADBOX:"#uploadbox",UPLOADFILE:"#ip_upload_file",IMPORTPANE:"#importpane",RECORDSHIFTERPANE:"#recordshifterpane"};AMA.augment(a.prototype,{events:{"change #ip_providerselect":"_changeSource","change #ip_methodselect":"_changeType","change #ip_upload_file":"_showImportFileOptions","click #cancel_import":"_closeDialog","click #save_selective_import":"_saveSelectiveImport","click #cancel_selective_import":"_cancelSelectiveImport","click #ip_importall_button":"_importAllContacts","click #ip_loadbutton":"_importSelectedContacts","click #ip_importgmail_button":"_importGoogleContacts","click .rs_selectallleft":"_selectAllLeft","click .rs_selectallright":"_selectAllRight","click .arrow.shifter_left":"_shiftLeft","click .arrow.shifter_right":"_shiftRight","focus #import_contacts_searchbar":"_clearSearchInput","blur #import_contacts_searchbar":"_checkSearchInput"},render:function(){a.__super__.render.apply(this);this.importContactsNotList=new AMA.view.ContactsImportListView({el:"#import_contacts_not_list",direction:"right",parent:this,data:null}).plug(AMA.view.plugin.Search,{searchInput:"#import_contacts_searchbar",searchFields:["fullName","lastName","firstName","middleName","nickName","companyName"]}).plug(AMA.view.plugin.Paginator,{pageSelector:"#import_contacts_not_list_pageselector"});this.importContactsList=new AMA.view.ContactsImportListView({el:"#import_contacts_list",direction:"left",parent:this,data:null}).plug(AMA.view.plugin.Search,{searchInput:"#import_contacts_searchbar",searchFields:["fullName","lastName","firstName","middleName","nickName","companyName"]}).plug(AMA.view.plugin.Paginator,{pageSelector:"#import_contacts_list_pageselector"});this.importContactsDetails=new AMA.view.ContactsImportDetailsView({el:"#import_contacts_details",parent:this,dataClass:AMA.models.contacts.constructor,listView:this.importContactsNotList,listView2:this.importContactsList})},_afterRender:function(){var b=this;a.__super__._afterRender.apply(this,arguments);$("#import_form").ajaxForm({success:_.bind(b._afterContactsImport,b)})},showView:function(){if(AMA.Util.useXdr()){this._switchView(a.CSS.INSTRUCTIONSGMAIL,a.CSS.INSTRUCTIONSGMAILFAST)}else{this._switchView(a.CSS.INSTRUCTIONSOUTLOOK)}this.$el.show()},_changeSource:function(){AMA.debug("Import Contacts: Import source changed");this._switchView("#"+this.$el.find(a.CSS.PROVIDERSELECT+" option:selected").attr("value"))},_changeType:function(){AMA.debug("Import Contacts: Import type changed");this._switchView("#"+this.$el.find(a.CSS.PROVIDERSELECT+" option:selected").attr("value"),"#"+this.$el.find(a.CSS.METHODSELECT+" option:selected").attr("value"))},_showImportFileOptions:function(){AMA.debug("Import Contacts: File selected for upload");this.$el.find("#ip_importall_button, #ip_loadbutton").show()},_closeDialog:function(){AMA.debug("Import Contacts: User clicked Cancel button");this.$el.find("#ip_importall_button").hide();this.$el.find("#ip_upload_file").val("");this._hideView()},_switchView:function(d,b){var h=this.$el.find(a.CSS.METHODBOX),f=this.$el.find(a.CSS.UPLOADBOX),c=this.$el.find(a.CSS.GMAILFASTIMPORTDIV),g=this.$el.find(a.CSS.IMPORTFROM),j=this.$el.find(a.CSS.INSTRUCTIONSBODY),e=this.$el.find(a.CSS.FEATURE_UNSUPPORTED);this.$el.find(a.CSS.RECORDSHIFTERPANE).hide();this.$el.find("#cancel_import").show();this.$el.find("#ip_importall_button, #ip_loadbutton, #save_selective_import, #cancel_selective_import").hide();this.$el.find(a.CSS.INSTRUCTIONS+" div").hide();h.hide();f.hide();g.hide();j.hide();c.hide();e.hide();this._importSelected=null;this._totalToBeImported=null;switch(d){case a.CSS.RECORDSHIFTERPANE:this._updateData();this.$el.find(a.CSS.RECORDSHIFTERPANE).show();this.$el.find("#cancel_import").hide();this.$el.find("#save_selective_import, #cancel_selective_import").show();break;case a.CSS.INSTRUCTIONSGMAIL:g.show();h.show();j.show();h.find("select").prop("selectedIndex",0);if(b){switch(b){case a.CSS.INSTRUCTIONSGMAILFAST:h.find("select").prop("selectedIndex",1);c.show();break;case a.CSS.INSTRUCTIONSGMAILDETAILED:h.find("select").prop("selectedIndex",2);f.show()}this.$el.find(b).show();this.$el.find(b+" *").show()}else{this.$el.find(d).show();this.$el.find(d+" *").show()}break;default:g.show();f.show();this.$el.find("#ip_upload_file").val("");j.show();this.$el.find(d).show();this.$el.find(d+" *").show()}if(AMA.Util.useXdr()&&((!b&&d!=a.CSS.INSTRUCTIONSGMAIL)||b==a.CSS.INSTRUCTIONSGMAILDETAILED)){j.hide();e.show();this.$el.find(a.CSS.FEATURE_UNSUPPORTED+" *").show();f.prop("disabled","disabled")}else{e.hide()}},_importAllContacts:function(c){var b=this.$el.find("form#import_form");c.preventDefault();AMA.models.contacts.csvImport(b)},_importSelectedContacts:function(b){this._importSelected=true;this._importAllContacts(b)},_importGoogleContacts:function(){var b={googleUsername:this.$el.find(a.CSS.GMAILFASTIMPORTFORM+" #username").val(),googlePassword:this.$el.find(a.CSS.GMAILFASTIMPORTFORM+" #password").val()};if(!b.googleUsername||!AMA.Util.validateEmail(b.googleUsername)){AMA.error("Supplied Google username is not in the form of an email address");AMA.page.standardDialogs.error($("#import_contacts_invalid_gmail_id").html());return}if(!b.googlePassword){AMA.error("No supplied password");AMA.page.standardDialogs.error($("#import_contacts_invalid_gmail_password").html());return}AMA.page.standardDialogs.loading($("#msg_loadingdialog").html());AMA.models.contacts.gmailFastImport(b,_.bind(this._afterContactsImport,this))},_afterContactsImport:function(c){if(!c||c.failures){AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.status($("#import_contacts_error").html());this._hideView();return}var b=0,e=this,d=function(f){if(f!=e._totalToBeImported){return}AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.status($("#import_contacts_success").html());AMA.models.contacts.invalidate();e._hideView()};if(this._importSelected){_.each(c,function(g,f){g.id="csvContacts"+f;if(!g.fullName){if(g.firstName){g.fullName=g.firstName}if(g.lastName){g.fullName+=" "+g.lastName}}});this.importContactsNotList.data=new AMA.model.Contacts();this.importContactsList.data=new AMA.model.Contacts();this.importContactsNotList.data.add(c);this.importContactsNotList.data.isLoaded=true;this.importContactsList.data.isLoaded=true;this._switchView(a.CSS.RECORDSHIFTERPANE)}else{AMA.page.standardDialogs.loading($("#msg_loadingdialog").html());this._totalToBeImported=c.length;_.each(c,function(f){f.id=null;f.visibility=AMA.model.UserData.Status.ENABLED;AMA.models.contactDetails.create("contacts",f,function(g){if(g){b++;d(b)}else{AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.status($("#import_contacts_error").html())}})})}},show:function(){a.__super__.show.apply(this,arguments);if(AMA.Util.useXdr()){this._switchView(a.CSS.INSTRUCTIONSGMAIL,a.CSS.INSTRUCTIONSGMAILFAST);this.$el.find("#ip_providerselect option").each(function(b){if(b===2){$(this).attr("selected","selected")}else{$(this).removeAttr("selected")}});this.$el.find("#ip_methodselect option").each(function(b){if(b===1){$(this).attr("selected","selected")}else{$(this).removeAttr("selected")}})}else{this._switchView(a.CSS.INSTRUCTIONSOUTLOOK);this.$el.find("#ip_providerselect option").each(function(b){if(b===0){$(this).attr("selected","selected")}else{$(this).removeAttr("selected")}});this.$el.find("#ip_methodselect option").each(function(b){if(b===0){$(this).attr("selected","selected")}else{$(this).removeAttr("selected")}})}},_hideView:function(){AMA.debug("Import Contacts: Hiding pane");this.$el.find("#ip_importall_button").hide();this.$el.find("#ip_upload_file").val("");this.$el.find(a.CSS.GMAILFASTIMPORTFORM).each(function(){this.reset()});this.$el.hide()},_shiftLeft:function(c){var b=AMA.Util.eventTarget(c,window);this.importContactsNotList.data.add(this.importContactsList.data.get(b.attributes.uid.value));this.importContactsList.data.remove(this.importContactsList.data.get(b.attributes.uid.value));this._updateData()},_shiftRight:function(c){var b=AMA.Util.eventTarget(c,window);this.importContactsList.data.add(this.importContactsNotList.data.get(b.attributes.uid.value));this.importContactsNotList.data.remove(this.importContactsNotList.data.get(b.attributes.uid.value));this._updateData()},_selectAllLeft:function(){var b=this;_.each(this.importContactsNotList.data.models,function(c){b.importContactsList.data.add(c)});this.importContactsNotList.data.reset();this._updateData()},_selectAllRight:function(){var b=this;_.each(this.importContactsList.data.models,function(c){b.importContactsNotList.data.add(c)});this.importContactsList.data.reset();this._updateData()},_saveSelectiveImport:function(){var c=this.importContactsList.data.models,b=0,e=this,d=function(f){if(f!=e._totalToBeImported){return}AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.status($("#import_contacts_success").html());AMA.models.contacts.invalidate();e._hideView()};if(c.length==0){AMA.page.standardDialogs.error($("#import_contacts_no_selection").html())}else{AMA.page.standardDialogs.loading($("#msg_loadingdialog").html());this._totalToBeImported=c.length;_.each(c,function(f){f.id=null;f.visibility=AMA.model.UserData.Status.ENABLED;AMA.models.contactDetails.create("contacts",f,function(g){if(g){b++;d(b)}else{AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.status($("#import_contacts_error").html())}})})}},_cancelSelectiveImport:function(){this.importContactsList.data.reset();this.importContactsNotList.data.reset();this._switchView("#ip_outlook_instructions")},clearSelections:function(){this.importContactsNotList._selectItem();this.importContactsList._selectItem()},_clearSearchInput:function(c){var b=AMA.Util.eventTarget(c,window);b.value="";$(b).removeClass("commands_searchfaded")},_checkSearchInput:function(c){var b=AMA.Util.eventTarget(c,window);if(b.value.trim()==""){b.value="Search";$(b).addClass("commands_searchfaded")}},_updateData:function(){this.importContactsList.render();this.importContactsNotList.render();this.importContactsNotList._nonPaginatedDataset=this.importContactsNotList.data;this.importContactsNotList.pageCount=Math.ceil(this.importContactsNotList.data.models.length/this.importContactsNotList.data.pageSize);this.importContactsList._nonPaginatedDataset=this.importContactsList.data;this.importContactsList.pageCount=Math.ceil(this.importContactsList.data.models.length/this.importContactsList.data.pageSize);if(this.importContactsNotList.currentPage>this.importContactsNotList.pageCount){this.importContactsNotList.toPage(this.importContactsNotList.currentPage-1)}this.importContactsNotList._renderPageSelector();if(this.importContactsList.currentPage>this.importContactsList.pageCount){this.importContactsList.toPage(this.importContactsList.currentPage-1)}this.importContactsList._renderPageSelector()}})})();
/*! ContactsImportListView */
(function(){AMA.namespace("view");var a=AMA.view.ContactsImportListView=AMA.view.ListView.extend();a.TEMPLATE_ID="";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{events:{"click .rt_row":"_doSelection"},initialize:function(){this.constructor.TEMPLATE_ID=this.options.direction==="right"?"import_list_arrow_right_template":"import_list_arrow_left_template";a.__super__.initialize.call(this,arguments)},render:function(){this.constructor.TEMPLATE_ID=this.options.direction==="right"?"import_list_arrow_right_template":"import_list_arrow_left_template";this.template=$("#"+this.constructor.TEMPLATE_ID).html();var c="";this._applyFilters();AMA.debug(this.options.el+" has a final dataset of "+this._dataset.length+" items");_.each(this._dataset,function(f,e){c+=_.template(this.template,this._processData(f,e))},this);this.$el.html(c);this._items=this.$el.children("."+this._css.ITEM);AMA.debug(this.options.el+" has rendered "+this._items.length+" items");if(this._items.length>0&&this.options.direction==="right"){var b=this.selectedItem&&this.$el.find("[uid='"+$(this.selectedItem).attr("uid")+"']")||[],d=b.length>0;this.parent.clearSelections();this._selectItem(d?b[0]:this._items[0]);this.parent._itemSelected=true;AMA.debug("Previously selected item is still in list: "+d)}else{if(this._items.length==0&&this.options.direction==="right"){this.trigger(a.EVENT.LIST_EMPTIED);AMA.debug(this.options.el+" has triggered a 'list emptied' event.");this._selectItem();this.parent._itemSelected=false}else{if(!this.parent.importContactsDetails.isRendered){this.trigger(a.EVENT.LIST_EMPTIED);AMA.debug(this.options.el+" has triggered a 'list emptied' event.");this._selectItem();this.parent._itemSelected=false}}}AMA.debug(this._dataset.length+" items rendered in import contacts list view.")},_processData:function(c,b){a.__super__._processData.call(this,c,b);return c},_doSelection:function(c){var b=AMA.Util.eventTarget(c,window);if($(b).hasClass("rt_column")){b=b.parentNode}this.parent.clearSelections();this._selectItem(b)}})})();
/*! ContactsImportDetailsView */
(function(){AMA.namespace("view");var a=AMA.view.ContactsImportDetailsView=AMA.view.ContactDetailsView.extend();a.TEMPLATE_ID="import_contacts_details_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(b){a.__super__.initialize.apply(this,arguments);this.options.listView2=b&&b.listView2||{};var c=this;if(this.options.listView2){this.options.listView2.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(d){c.setData(d);c.show()});this.options.listView2.on(AMA.view.ListView.EVENT.SELECTION_CLEARED,function(){c.hide()})}else{AMA.warning("This instance of ContactsImportDetailsView is not linked to a contacts list. Data switching will not apply.")}},render:function(){var c=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},b="";b=_.template(this.template,this._processData(c));this.$el.html(b)}})})();
/*! ContactEditor */
(function(){AMA.namespace("view");var a=AMA.view.ContactEditor=AMA.view.BaseView.extend();a.CSS={EDITOR_TITLE:"editorTitle",CLOSEVIEW:"rs_cancel",SAVE_ANOTHER:"rs_save_next",SAVE:"rs_save",SAVE_EDIT:"rs_saveEdit",DATES:"ep_dateinput",PHONE_INPUT:"ep_phoneinput"};a.ID={FULLNAME:"ep_name",FIRSTNAME:"ep_firstName",LASTNAME:"ep_lastName",PREFIX:"ep_prefix",MIDDLENAME:"ep_middleName",SUFFIX:"ep_suffix",HOMEADDSTREET:"ep_homeAddressStreet",HOMEADDSTREET2:"ep_homeAddressStreet2",HOMEADDNEIGHBOR:"ep_homeAddressNeighborhood",HOMEADDCITY:"ep_homeAddressCity",HOMEADDSTATE:"ep_homeAddressState",HOMEADDZIP:"ep_homeAddressZip",HOMEADDCOUNTRY:"ep_homeAddressCountry",WORKADDSTREET:"ep_workAddressStreet",WORKADDSTREET2:"ep_workAddressStreet2",WORKADDNEIGHBOR:"ep_workAddressNeighborhood",WORKADDCITY:"ep_workAddressCity",WORKADDSTATE:"ep_workAddressState",WORKADDZIP:"ep_workAddressZip",WORKADDCOUNTRY:"ep_workAddressCountry",FULLHOMEADDRESS:"ep_homeAddressFormatted",FULLWORKADDRESS:"ep_workAddressFormatted"};a.TEMPLATE_ID="contact_add-edit_template";a.TEMPLATE_SRC="";a.KEY_ARRAY=["im","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","imOther","imOther2","imOther1","webSiteUrl","otherUrl","preferredUrl","homeUrl","workUrl","mobilePhone","workPhone","homePhone","fax","homeFax","workFax","pager","email","homeEmail","localEmail","otherEmail","workEmail","otherPhone","carPhone","radioPhone","localPhone","assistantPhone","iPhone"];a.KEY_ARRAY_PHONE=["mobilePhone","workPhone","homePhone","fax","homeFax","workFax","pager","otherPhone","carPhone","radioPhone","localPhone","assistantPhone","iPhone"];a.KEY_ARRAY_EMAIL=["email","homeEmail","localEmail","otherEmail","workEmail"];a.KEY_ARRAY_IM=["im","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","imOther","imOther2","imOther1"];a.KEY_ARRAY_URL=["webSiteUrl","otherUrl","preferredUrl","homeUrl","workUrl"];a.EVENT=AMA.enums("HIDE_VIEW","SAVED_CONTACT","SHOW_EDITOR","BEFORE_SEND","ERROR","COMPLETE");a.MODE=AMA.enums("CREATE","EDIT");AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this._mode=a.MODE.CREATE},events:{"click #clearBirthdayId":"clearBirthdayDate","click #clearAnniversaryId":"clearAnniversaryDate"},clearBirthdayDate:function(){$("#ep_birthday").val("")},clearAnniversaryDate:function(){$("#ep_anniversary").val("")},render:function(){var c=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},b="",d=this;if(this._mode===a.MODE.EDIT){AMA.models.contactDetails.getDetails(c.id,function(f,e){if(f){b=_.template(d.template,d._processData(e));d.$el.html(b);d.show(AMA.view.ContactEditor.MODE.EDIT);d._setupEvents()}})}else{if(this._mode===a.MODE.CREATE){b=_.template(this.template,this._processData(c));this.$el.html(b)}}},_afterRender:function(){var b=this;this.$el.find("."+a.CSS.PHONE_INPUT).each(function(){$(this).val(b.validatePhone(this))})},show:function(f){a.__super__.show.apply(this,arguments);var c=this.$el,e=(f===a.MODE.CREATE)?"Add Contacts":"Edit Contacts",b=c.find("."+a.CSS.SAVE_ANOTHER),d=c.find("."+a.CSS.SAVE),g=c.find("."+a.CSS.SAVE_EDIT);b.show();d.show();g.hide();if(f===a.MODE.EDIT){b.hide();d.hide();g.show()}c.find("."+a.CSS.EDITOR_TITLE).html(e);$("#contactstable").hide()},_processData:function(l){a.__super__._processData(this,arguments);var b=(l.fullName)?this.parse(l.fullName):null,c=this,j=0,d=0,h=0,k=["im","imAIM","imGTalk","imICQ","imJabber","imQQ","imSkype","imWindowsLive","imYahoo","imOther","imOther2","imOther1"],f=["email","homeEmail","localEmail","otherEmail","workEmail"];l.ep_ims="";l.ep_emails="";l.ep_urls="";l.ep_phoneNumbers="";l.birthdayValue=l.birthday||0;l.anniversaryValue=l.anniversary||0;function g(q,p,n){var r=$("#"+p+"_template").html(),m="";if(n||n.length){_.each(n,function(s){m+=AMA.Util.microTemplate(r,{value:s,key:q})},this)}return m}_.each(AMA.model.Contacts.MODEL_DESCRIPTOR.fields,function(m,n){if(typeof l[n]!=="undefined"&&(n==="birthday"||n==="anniversary")){l[n]=(l[n])?$.datepicker.formatDate("mm/dd/yy",new Date(l[n])):""}else{if(n=="pendingCreate"){l[n]=(l[n])?"checked":""}else{if(!l[n]){l[n]=""}}}});if(b){l.firstName=b.firstName;l.initials=b.initials;l.lastName=b.lastName;l.salutation=b.salutation;l.suffix=b.suffix}l.thumbImg="img/silhouette.png";l.pendingCreate=(l.pendingCreate)?"checked":"";l.endpointName="Unknown Device";if(AMA.models.endpoints.isLoaded){l.endpointName=AMA.models.endpoints.toJSON()[0].platformfriendlyname}l.allIm=[];_.each(a.KEY_ARRAY_IM,function(m){l[m]=l[m]||[];j=l[m].length+j;if(m in l){l.allIm.push(g(m,"im",l[m]))}});l.allEmails=[];_.each(a.KEY_ARRAY_EMAIL,function(m){l[m]=l[m]||[];d=l[m].length+d;if(m in l){l.allEmails.push(g(m,"email",l[m]))}});l.allUrl=[];_.each(a.KEY_ARRAY_URL,function(m){l[m]=l[m]||[];h=l[m].length+h;if(m in l){l.allUrl.push(g(m,"email",l[m]))}});l.allMobilePhone=this.processPhoneNumbers("mobilePhone_template",l.mobilePhone,3);l.allWorkPhone=this.processPhoneNumbers("workPhone_template",l.workPhone,3);l.allHomePhone=this.processPhoneNumbers("homePhone_template",l.homePhone,1);l.allfax=this.processPhoneNumbers("fax_template",l.fax,1);l.allHomeFax=this.processPhoneNumbers("homeFax_template",l.homeFax);l.allWorkFax=this.processPhoneNumbers("workFax_template",l.workFax);l.allPager=this.processPhoneNumbers("pager_template",l.pager,1);l.allOtherPhone=this.processPhoneNumbers("otherPhone_template",l.otherPhone,1);l.allCarPhone=this.processPhoneNumbers("carPhone_template",l.carPhone);l.allRadioPhone=this.processPhoneNumbers("radioPhone_template",l.radioPhone);l.allLocalPhone=this.processPhoneNumbers("localPhone_template",l.localPhone);l.allAssistantPhone=this.processPhoneNumbers("assistantPhone_template",l.assistantPhone);l.alliPhone=this.processPhoneNumbers("iPhone_template",l.iPhone);if(j>2){l.allIm=l.allIm.join("");l.ep_ims="hidden"}else{for(var e=0;e<3-j;e++){l.allIm.push(g("im","im",["/null/"]))}l.allIm=l.allIm.join("").replace(/\/null\//g,"")}if(d>2){l.allEmails=l.allEmails.join("");l.ep_emails="hidden"}else{for(var e=0;e<3-d;e++){l.allEmails.push(g("email","email",["/null/"]))}l.allEmails=l.allEmails.join("").replace(/\/null\//g,"")}if(h>1){l.allUrl=l.allUrl.join("")}else{l.allUrl.push(g("webSiteUrl","url",["/null/"]));l.allUrl=l.allUrl.join("").replace(/\/null\//g,"")}return l},processPhoneNumbers:function(g,f){var d=[],e=0;defaultInput=arguments[2]||0;_.each(f,function(j,h){if(!defaultInput){h=""}else{h=h+1}j=AMA.Util.formatPhone(j);d.push(_.template($("#"+g+"").html(),{value:j,index:h}))});if(defaultInput&&defaultInput>d.length){e=d.length;for(var c=0;c<arguments[2]-e;c++){var b=c+e+1;d.push(_.template($("#"+g+"").html(),{value:"",index:b}))}}if(d.length){return{html:d.join(""),count:d.length,hide:"hidden"}}else{return{html:d.join(""),count:d.length,hide:""}}},_setupEvents:function(){var h=this,b=this.$el,f=["#"+a.ID.PREFIX,"#"+a.ID.FIRSTNAME,"#"+a.ID.MIDDLENAME,"#"+a.ID.LASTNAME,"#"+a.ID.SUFFIX],e=["#"+a.ID.HOMEADDSTREET,"#"+a.ID.HOMEADDSTREET2,"#"+a.ID.HOMEADDNEIGHBOR,"#"+a.ID.HOMEADDCITY,"#"+a.ID.HOMEADDSTATE,"#"+a.ID.HOMEADDZIP,"#"+a.ID.HOMEADDCOUNTRY],d=["#"+a.ID.WORKADDSTREET,"#"+a.ID.WORKADDSTREET2,"#"+a.ID.WORKADDNEIGHBOR,"#"+a.ID.WORKADDCITY,"#"+a.ID.WORKADDSTATE,"#"+a.ID.WORKADDZIP,"#"+a.ID.WORKADDCOUNTRY],g={empty:function(){return(_.isEmpty($(f[1]).val())&&_.isEmpty($("#"+a.ID.FULLNAME).val()))}};var c=document.createElement("input");c.setAttribute("type","date");if(c.type==="text"){b.find("."+a.CSS.DATES).datepicker({showOn:"button",buttonImage:"img/calendar.gif",buttonImageOnly:true,changeMonth:true,changeYear:true,yearRange:"1900:2050",onSelect:function(l,k){if(k.input.attr("data-value")!=""){var j=new Date(43200000);j.setUTCFullYear(k.selectedYear,k.selectedMonth,k.selectedDay);k.input.attr("data-value",j.getTime())}else{k.input.attr("data-value","")}return false}})}else{$("#ep_birthday,#ep_anniversary").attr("type","date");$("#ep_birthday,#ep_anniversary").removeAttr("readonly");$("input[type=date]").each(function(){$(this).on("change",function(){$(this).data("value",Date.parse($(this).val()))})});$("#clearBirthdayId,#clearAnniversaryId").hide()}b.find("."+a.CSS.CLOSEVIEW).on("click",function(){h.hideView();h.trigger(a.EVENT.HIDE_VIEW);$("#data_contacts_tab > .toggle-submenu").show()});b.find("."+a.CSS.SAVE).on("click",function(){if(g.empty()){$(f[1]).addClass("error");$("#"+a.ID.FULLNAME).addClass("error");AMA.page.standardDialogs.error("Please enter a name for this contact.");return}h.saveToModel("save");h.hideView();if($("#data_contacts_tab").find(".row-offcanvas").hasClass("active")){h.parent.toggleListView()}h.trigger(a.EVENT.SAVED_CONTACT)});b.find("."+a.CSS.SAVE_EDIT).on("click",function(){if(g.empty()){$(f[1]).addClass("error");$("#"+a.ID.FULLNAME).addClass("error");AMA.page.standardDialogs.error("Please enter a name for this contact.");return}h.saveToModel("edit");h.hideView();h.trigger(a.EVENT.SAVED_CONTACT)});b.find("."+a.CSS.SAVE_ANOTHER).on("click",function(){if(g.empty()){$(f[1]).addClass("error");$("#"+a.ID.FULLNAME).addClass("error");AMA.page.standardDialogs.error("Please enter a name for this contact.");return}h.saveToModel("save");h.clearForm();h.trigger(a.EVENT.SAVED_CONTACT,{addMore:true})});b.on("keyup","#"+a.ID.FULLNAME,function(){var j=h.parse($(this).val());$(f[0]).val(j.salutation);$(f[1]).val(j.firstName);$(f[2]).val(j.initials);$(f[3]).val(j.lastName);$(f[4]).val(j.suffix)});$(f.join(", ")).on("keyup",function(){var j=[$(f[0]).val(),$(f[1]).val(),$(f[2]).val(),$(f[3]).val(),$(f[4]).val()];$("#"+a.ID.FULLNAME).val(j.join(" "))});b.find("."+a.CSS.PHONE_INPUT).on("keyup",function(){h.validatePhone(this)});b.find("#clsDate").on("click",function(){b.find("#ep_birthday").val("")});b.find("#anniversaryDate").on("click",function(){b.find("#ep_anniversary").val("")});$(e.join(", ")).on("keyup",function(){var j=[$(e[0]).val(),$(e[1]).val(),$(e[2]).val(),$(e[3]).val(),$(e[4]).val(),$(e[5]).val(),$(e[6]).val()];$("#"+a.ID.FULLHOMEADDRESS).val(j.join(" "))});$(d.join(", ")).on("keyup",function(){var j=[$(d[0]).val(),$(d[1]).val(),$(d[2]).val(),$(d[3]).val(),$(d[4]).val(),$(d[5]).val(),$(d[6]).val()];$("#"+a.ID.FULLWORKADDRESS).val(j.join(" "))});h.on("CONTACTS"+a.EVENT.BEFORE_SEND,function(){AMA.debug("Ajax started"+a.EVENT.BEFORE_SEND);AMA.page.standardDialogs.loading("")}).on("CONTACTS"+a.EVENT.ERROR,function(){AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.error("Unable To Contact services");AMA.debug("Ajax completed with errors")}).on("CONTACTS"+a.EVENT.COMPLETE,function(){AMA.debug("Ajax Completed"+a.EVENT.COMPLETE);AMA.page.standardDialogs.hideloading()})},setMsecsValue:"",hideView:function(){this.clearForm();$(this.$el).hide();$("#contactstable").show()},clearForm:function(){$("#"+a.ID.FIRSTNAME).removeClass("error");$("#"+a.ID.FULLNAME).removeClass("error");$(this.$el).find("input").val("")},saveToModel:function(d){var g=this,f=$(this.$el).find("form").serializeArray(),e={},b,c={beforeSend:function(){g.trigger("CONTACTS"+a.EVENT.BEFORE_SEND)},error:function(){g.trigger("CONTACTS"+a.EVENT.ERROR)},complete:function(){g.trigger("CONTACTS"+a.EVENT.COMPLETE)}};_.each(f,function(k,h,j){if(k.value!==""){switch(k.name){case"birthday":e[k.name]=$("#ep_birthday").data("value")||"";break;case"anniversary":e[k.name]=$("#ep_anniversary").data("value")||"";break;case"pendingCreate":e[k.name]=k.value==="on"?true:false;break;case"pendingDelete":e[k.name]=k.value==="true"?true:false;break;default:if(_.indexOf(a.KEY_ARRAY_PHONE,k.name,false)!==-1){k.value=k.value.replace(/\D/g,"")}if(_.indexOf(a.KEY_ARRAY,k.name,false)!==-1){if(!e[k.name]){e[k.name]=[]}e[k.name].push(k.value)}else{e[k.name]=k.value}break}}});e.visibility=AMA.model.UserData.Status.ENABLED;if(d==="save"){e.id=null;e.onPhone=false;e.pendingCreate=this.$el.find("form input[name=pendingCreate]:checked").length>0?true:false;e.pendingDelete=false;AMA.models.contactDetails.create("contacts",e,function(j,h){if(j){g.trigger("CONTACTS"+a.EVENT.COMPLETE);AMA.models.contacts.invalidate()}else{g.trigger("CONTACTS"+a.EVENT.ERROR)}})}else{e.onPhone=g.data.models[0].get("onPhone");e.pendingCreate=this.$el.find("form input[name=pendingCreate]:checked").length>0?true:false;AMA.models.contacts.update("contacts",e.id,e,function(j,h){if(j){g.trigger("CONTACTS"+a.EVENT.COMPLETE);AMA.models.contacts.invalidate()}else{g.trigger("CONTACTS"+a.EVENT.ERROR)}})}},in_array:function(b,d){for(var c=0;c<b.length;c++){if(b[c]==d){return true}}return false},implode:function(b,f){var c="",d="";for(var e=0;e<b.length;e++){c+=d+b[e];d=f}return c},trim:function(b){return(b)?b.replace(/^\s+|\s+$|\,$/g,""):b},ucfirst:function(b){return(b)?b.substr(0,1).toUpperCase()+b.substr(1,b.length-1).toLowerCase():b},parse:function(r){r=this.trim(r);var k=r.split(" "),b={},h=[],q="",n="",d="",f=0,g=0;for(g=0;g<k.length;g++){if(k[g].indexOf("(")==-1){h[f++]=k[g]}}var m=h.length,l=this.is_salutation(h[0]),p=this.is_suffix(h[h.length-1]),c=(l)?1:0,e=(p)?m-1:m;for(g=c;g<(e-1);g++){word=h[g];if(this.is_compound_lastName(word)&&g!=c){break}if(this.is_initial(word)){if(g==c){if(this.is_initial(h[g+1])){n+=" "+word.toUpperCase()}else{d+=" "+word.toUpperCase()}}else{d+=" "+word.toUpperCase()}}else{n+=" "+this.fix_case(word)}}if((e-c)>1){for(f=g;f<e;f++){q+=" "+this.fix_case(h[f])}}else{n=this.fix_case(h[g])}b.salutation=(l!=false)?l:"";b.firstName=(n!="")?this.trim(n):"";b.initials=(d!="")?this.trim(d):"";b.lastName=(q!="")?this.trim(q):"";b.suffix=(p!=false)?p:"";return b},is_salutation:function(b){b=b.replace(".","").toLowerCase();if(b=="mr"||b=="master"||b=="mister"){return"Mr."}else{if(b=="mrs"){return"Mrs."}else{if(b=="miss"||b=="ms"){return"Ms."}else{if(b=="dr"){return"Dr."}else{if(b=="rev"){return"Rev."}else{if(b=="fr"){return"Fr."}else{return false}}}}}}},is_suffix:function(d){d=d.replace(/\./g,"").toLowerCase();var c=["I","II","III","IV","V","Senior","Junior","Jr","Sr","PhD","APR","RPh","PE","MD","MA","DMD","CME"];for(var b=0;b<c.length;b++){if(c[b].toLowerCase()==d){return c[b]}}return false},is_compound_lastName:function(b){b=b.toLowerCase();var c=["vere","von","van","de","del","della","di","da","pietro","vanden","du","st.","st","la","lo","ter"];return this.in_array(c,b)},is_initial:function(b){b=b.replace(".","");return(b.length==1)},is_camel_case:function(c){var d=/|[A-Z]+|s/,b=/|[a-z]+|s/;return(c.match(d)!=null&&c.match(b)!=null)},fix_case:function(b){if(b){b=this.safe_ucfirst("-",b);b=this.safe_ucfirst(".",b)}return b},safe_ucfirst:function(c,e){var f=[];parts=e.split(c);for(var b=0;b<parts.length;b++){var d=parts[b];f[b]=(this.is_camel_case(d))?d:this.ucfirst(d).toLowerCase()}return this.implode(f,c)},validatePhone:function(c){var c=$(c),b=c.val().replace(/[^\d]/g,"").replace(/[^0-9\.]+/g,"");if(b.length>9){c.val("("+b.substring(0,3)+")-"+b.substring(3,6)+"-"+b.substring(6))}else{c.val(b)}}})})();
/*! PhotosView */
(function(){AMA.namespace("view");var a=AMA.view.PhotosView=AMA.view.BaseView.extend();a.TEMPLATE_ID="data_photos_template";a.TEMPLATE_SRC="photos.tpl";AMA.augment(a.prototype,{events:{"click #data_photos_multiaction_perform":"processBatchAction","click .learnMore.link_text":"learnMoreDialog","click .console.sync_settings .syncdetails a.link_text":"settingsDialog","click .console.transferdata .transferdetails a.link_text":"transferDialog"},initialize:function(){a.__super__.initialize.apply(this,arguments);this.photosBreakdown=null;this.photosSelectBar=null;this.photosGrid=null},learnMoreDialog:function(){this.LearnMore.show("photos")},settingsDialog:function(){AMA.page.settings.settingsDialog.prevHash=window.location.hash},transferDialog:function(){Backbone.globalEvent.trigger("showTranferData")},render:function(){a.__super__.render.apply(this);this._isIPhone=AMA.Util.isIPhone();if(this._isIPhone){this.$el.find("#records_tablehalf .selectbar .selectall").hide();this.$el.find(".console.transferdata").show()}else{this.$el.find("#records_tablehalf .selectbar .iphoneNote").hide();this.$el.find(".console.transferdata").hide()}this.LearnMore=new AMA.view.LearnMore({el:"#learnMoreDiv",parent:this});this.photosGrid=new AMA.view.PhotosGridView({el:"#data_photos_list",parent:this,data:AMA.models.photos}).plug(AMA.view.plugin.Breakdown,{breakdownContainer:"#data_photos_breakdown"}).plug(AMA.view.plugin.ModalGallery,{galleryTemplateId:"#blueimp-gallery-photos_template",detailsObj:"#photos_details_view",settings:{container:"#blueimp-gallery-photos"}}).plug(AMA.view.plugin.Search,{searchInput:"#commands_searchinput",searchFields:["name"]}).plug(AMA.view.plugin.ApiListScrollLoader,{scrollContainer:"#photos_list_view",listItemType:"a",listItemClassname:"thumb_items col-xs-4 col-md-12 col-sm-12 col-lg-12"});this.photosDetails=new AMA.view.PhotoDetailsView({el:"#photos_details_view",parent:this,listView:this.photosGrid,dataClass:AMA.model.photos});this.settingsSummary=new AMA.view.SettingsSummaryView({el:"#photos_settings_summary_placeholder",data:AMA.models.syncsettings,parent:this})},_setupEvents:function(){var b=this.$el.find(".console.sync_settings .syncdetails a.link_text");b.on("click",function(){AMA.page.settings.settingsDialog.prevHash=window.location.hash})},processBatchAction:function(){var e;var d=$("#data_photos_multiaction_select").val();if(d==""){e=$("#msg_error_no_action_selected").html();AMA.page.standardDialogs.error(e);return false}var b=this.photosGrid.getCheckedItems();if(b.length==0){e=$("#msg_error_no_photo_selected").html();AMA.page.standardDialogs.error(e);return false}function c(){var g={},j=AMA.models.photos,f=new AMA.model.Photos();var h=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(h);switch(d){case"delete":AMA.models.photos.trash("image",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.photos.invalidate();AMA.models.trash.invalidate()}});break;case"addToPhone":AMA.models.photos.addRemove("add","photos",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.photos.invalidate()}});break;case"removeFromPhone":AMA.models.photos.addRemove("remove","photos",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.photos.invalidate()}});break}if(AMA.config.enableReporting){if(d==="delete"){g.ActionPerformed="Delete Photo from phone & web- ActionPerformed dropdown";AMA.debug("Reporting.logging for photo deleted from phone & web ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deletephotoactionperformed,g)}if(d==="addToPhone"){g.ActionPerformed="Add Photo to Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for photo added to phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdownaddphoto,g)}if(d==="removeFromPhone"){g.ActionPerformed="Remove Photo from Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for photo removed from phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropremovephoto,g)}}}if(d==="delete"){e=$("#msg_confirm_delete_photo"+(b.length>1?"s":"")).html();AMA.page.standardDialogs.confirm(e,c)}else{c()}},})})();
/*! PhotosGridView */
(function(){AMA.namespace("view");var a=AMA.view.PhotosGridView=AMA.view.ListView.extend();a.TEMPLATE_ID="photos_list_template";a.TEMPLATE_SRC="";a.FILE_URLS=[];a.FILE_SIZES=[];a.CSS={ITEM:"thumb_items",ITEM_STYLE:["rt_rowlighter","rt_rowdarker"],SELECTED_ITEM:"selected",BTN_CONTAINER:"buttoncontainer",BTN_VIEWFULLSIZE:"btn_viewfullsize",BTN_ADDTOPHONE:"btn_addtophone",BTN_REMOVEFROMPHONE:"btn_removefromphone",BTN_DOWNLOAD:"btn_downloadphoto",BTN_DELETE:"btn_deletephoto"};AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.slideContainer=false;this.addFilter("_includes",this._includes,0);this._isIPhone=AMA.Util.isIPhone(AMA.models.endpoints.models[0].get("platformfriendlyname"))},_includes:function(b){return b.pendingTransmit===false},render:function(){if(!this.data.length){var b=_.template($("#photos_blank_list_template").html(),this._processData(this.dataDetails));this.$el.html(b);this.trigger("PHOTOS:no.data")}else{a.__super__.render.apply(this)}},_processData:function(b){return b},_setupEvents:function(){a.__super__._setupEvents.apply(this,arguments);var d=this,b=d.parent.$el,c=false;fullSizeButtons=d.$el.find("."+d._css.BTN_VIEWFULLSIZE),addToPhoneButtons=d.$el.find("."+d._css.BTN_ADDTOPHONE),removeFromPhoneButtons=d.$el.find("."+d._css.BTN_REMOVEFROMPHONE),downloadButtons=d.$el.find("."+d._css.BTN_DOWNLOAD),deleteButtons=d.$el.find("."+d._css.BTN_DELETE);if(AMA.Util.isIPhone()){addToPhoneButtons.remove()}b.off("click","."+d._css.BTN_DOWNLOAD).on("click","."+d._css.BTN_DOWNLOAD,function(){if(c){return}var e=this.attributes.uid.value;c=true;AMA.models.photos.downloadFile("image",e,function(g){var f=g.mediaUrl.replace("content?","download?")+"&fileName="+g.fileName;AMA.Util.downloadFile(f);c=false})});b.off("click","."+d._css.BTN_REMOVEFROMPHONE).on("click","."+d._css.BTN_REMOVEFROMPHONE,function(){var g=this.attributes.uid.value,f=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(f);if(AMA.config.enableReporting){var e={};e.ActionPerformed="Remove From Phone";AMA.debug("Reporting: Logging event for photo added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removephotofrmphone,e)}AMA.models.photos.addRemove("remove","photos",[g],function(h){d.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(j){d.eventChangesOnGallery(j,this.currentIndex)});AMA.page.standardDialogs.hideloading();if(h){AMA.models.photos.invalidate()}})});this.$el.on("click","."+d._css.ITEM,function(j){var h=this,f=d.$el.find(".thumb_items").index($(h)),g=d.$el.find(".thumb_items")[f];j.preventDefault()});b.off("click",".btn_deletephoto").on("click",".btn_deletephoto",function(){var e=d,g=this.attributes.uid.value;var f=$("#msg_confirm_delete_photo").html();AMA.page.standardDialogs.confirm(f,function(){AMA.page.standardDialogs.confirmDialog.hide();var h=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(h);AMA.models.photos.trash("image",[g],function(j){AMA.page.standardDialogs.hideloading();if(j){AMA.models.photos.invalidate();AMA.models.trash.invalidate()}d.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(k){d.eventChangesOnGallery(k,this.currentIndex)})})})});b.off("click","."+d._css.BTN_ADDTOPHONE).on("click","."+d._css.BTN_ADDTOPHONE,function(){var g=this.attributes.uid.value,f=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(f);if(AMA.config.enableReporting){var e={};e.ActionPerformed="Add From Phone";AMA.debug("Reporting: Logging event for photo added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removephotofrmphone,e)}AMA.models.photos.addRemove("add","photos",[g],function(h){d.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(j){d.eventChangesOnGallery(j,this.currentIndex)});AMA.page.standardDialogs.hideloading();if(h){AMA.models.photos.invalidate()}})})}})})();
/*! PhotosDetailsView */
(function(){AMA.namespace("view");var a=AMA.view.PhotoDetailsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="photo_details_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);var b=this;this.dataDetails=null;if(this.options.listView){this.options.listView.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(c){if(b.data){b.data.isFetching=true}b.dataDetails=false;b._fetchDetails(c.toJSON())});this.options.listView.on(AMA.view.ListView.EVENT.SELECTION_CLEARED,function(){b.hide()})}else{AMA.warning("This instance of ContactDetailsView is not linked to a contacts list. Data switching will not apply.")}},renderBlank:function(){var b=_.template($("#photos_blank_details_template").html());this.$el.html(b)},render:function(){if(!this.dataDetails){return}var b=_.template(this.template,this._processData(this.dataDetails));this.$el.html(b);this.options.listView.trigger(AMA.view.ListView.EVENT.NEW_DATA_LOADED,[b])},_fetchDetails:function(b){var c=this;if(AMA.Util.useXdr()){xhr=AMA.Util.createCORSRequest("GET",AMA.config.apiHostUrl+"/files/"+b.id+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType="+mediaType);xhr.onload=function(){try{var d=JSON.parse(this.responseText)}catch(f){AMA.error("Response not JSON")}};xhr.onerror=function(){AMA.error("Error in request")};xhr.onprogress=function(){};xhr.ontimeout=function(){};xhr.timeout=100000;xhr.send()}else{$.ajax({url:AMA.config.apiHostUrl+"/files/"+b.id+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType=image"}).done(function(d){c.dataDetails=d;c.refresh()})}},_setupEvents:function(){a.__super__._setupEvents.apply(this);var b=this;this.$el.find(".details_undeletebutton").off("click").on("click",function(){var c=this,d=$("#msg_confirm_restore_trashitem").html();AMA.page.standardDialogs.confirm(d,function(){AMA.page.standardDialogs.confirmDialog.hide();var e=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(e);AMA.models.trash.restore([c.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[1]){AMA.models.photos.invalidate();AMA.models.trash.invalidate()}})})});this.$el.find(".details_deletefromtrashbutton").off("click").on("click",function(){var c=this,d=$("#msg_confirm_permadelete_trashitem").html();AMA.page.standardDialogs.confirm(d,function(){AMA.page.standardDialogs.confirmDialog.hide();var e=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(e);AMA.models.trash.trash([c.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[1]){AMA.models.trash.invalidate()}})})});if(!this.parent.photosGrid){return}this.parent.photosGrid.on("PHOTOS:no.data",function(){this.renderBlank()},this)},_processData:function(b){var c=b;c.onTrash=(b.visibility!=="ACTIVE")?"hide":"";c.notOnTrash=(b.visibility==="ACTIVE")?"hide":"";c.fileSizeInBytes=AMA.Util.bytesToSize(b.fileSizeInBytes);c.statueText=this._getStatusText(b);c.statueText.addToPhone=(c.pendingDelete)?"":"hide";c.statueText.removeFromPhone=(c.pendingDelete)?"hide":"";return c},_getStatusText:function(b){data={addSync:"hidden hide",deleteSync:"hidden hide",webOnly:"hidden hide",onDevice:"hidden hide",};switch(true){case (b.pendingCreate):data.addSync="";break;case (b.pendingDelete&&b.onPhone):data.deleteSync="";break;case (b.onPhone):data.onDevice="";break;default:data.webOnly="";break}return data},})})();
/*! VideosView */
(function(){AMA.namespace("view");var a=AMA.view.VideosView=AMA.view.BaseView.extend();a.TEMPLATE_ID="data_videos_template";a.TEMPLATE_SRC="videos.tpl";AMA.augment(a.prototype,{events:{"click #data_videos_multiaction_perform":"processBatchAction","click .learnMore.link_text":"learnMoreDialog","click .console.sync_settings .syncdetails a.link_text":"settingsDialog","click .console.transferdata .transferdetails a.link_text":"transferDialog"},initialize:function(){a.__super__.initialize.apply(this,arguments);this.videosBreakdown=null;this.videosGrid=null;this.videosSelectBar=null},learnMoreDialog:function(){this.LearnMore.show("videos")},settingsDialog:function(){AMA.page.settings.settingsDialog.prevHash=window.location.hash},transferDialog:function(){Backbone.globalEvent.trigger("showTranferData")},render:function(){a.__super__.render.apply(this);this._isIPhone=AMA.Util.isIPhone();if(this._isIPhone){this.$el.find("#records_tablehalf .selectbar .selectall").hide();this.$el.find(".console.transferdata").show()}else{this.$el.find("#records_tablehalf .selectbar .iphoneNote").hide();this.$el.find(".console.transferdata").hide()}this.LearnMore=new AMA.view.LearnMore({el:"#learnMoreDiv",parent:this});this.videosGrid=new AMA.view.VideosGridView({el:"#data_videos_list",parent:this,data:AMA.models.videos}).plug(AMA.view.plugin.ModalGallery,{galleryTemplateId:"#blueimp-gallery-videos_template",detailsObj:"#video_details_view",settings:{container:"#blueimp-gallery-videos"}}).plug(AMA.view.plugin.Breakdown,{breakdownContainer:"#data_videos_breakdown"});this.videoDetails=new AMA.view.VideoDetailsView({el:"#video_details_view",parent:this,listView:this.videosGrid,dataClass:AMA.model.videos});this.settingsSummary=new AMA.view.SettingsSummaryView({el:"#videos_settings_summary_placeholder",data:AMA.models.syncsettings,parent:this})},_setupEvents:function(){var b=this.$el.find(".console.sync_settings .syncdetails a.link_text");b.on("click",function(){AMA.page.settings.settingsDialog.prevHash=window.location.hash})},processBatchAction:function(){var e;var d=$("#data_videos_multiaction_select").val();if(d==""){e=$("#msg_error_no_action_selected").html();AMA.page.standardDialogs.error(e);return false}var b=this.videosGrid.getCheckedItems();if(b.length==0){e=$("#msg_error_no_video_selected").html();AMA.page.standardDialogs.error(e);return false}function c(){var h={},g=AMA.models.videos,f=new AMA.model.Videos();var j=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(j);switch(d){case"delete":AMA.models.videos.trash("video",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.videos.invalidate();AMA.models.trash.invalidate()}});break;case"addToPhone":AMA.models.videos.addRemove("add","videos",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.videos.invalidate()}});break;case"removeFromPhone":AMA.models.videos.addRemove("remove","videos",b,function(k){AMA.page.standardDialogs.hideloading();if(k){AMA.models.videos.invalidate()}});break}if(AMA.config.enableReporting){if(d==="delete"){h.ActionPerformed="Delete Video from phone & web- ActionPerformed dropdown";AMA.debug("Reporting.logging for video deleted from phone & web ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deletevideoactionperformed,h)}if(d==="addToPhone"){h.ActionPerformed="Add video to Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for video added to phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropdownaddvideo,h)}if(d==="removeFromPhone"){h.ActionPerformed="Remove video from Device - ActionPerformed dropdown";AMA.debug("Reporting.logging for video removed from phone ");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.actiondropremovevideo,h)}}}if(d==="delete"){e=$("#msg_confirm_delete_video"+(b.length>1?"s":"")).html();AMA.page.standardDialogs.confirm(e,c)}else{c()}}})})();
/*! VideosGridView */
(function(){AMA.namespace("view");var a=AMA.view.VideosGridView=AMA.view.ListView.extend();a.TEMPLATE_ID="videos_list_template";a.TEMPLATE_SRC="";a.FILE_URLS=[];a.FILE_SIZES=[];a.CSS={ITEM:"thumb_items",ITEM_STYLE:["rt_rowlighter","rt_rowdarker"],SELECTED_ITEM:"selected",BTN_CONTAINER:"buttoncontainer",BTN_VIEWFULLSIZE:"btn_playvideo",BTN_ADDTOPHONE:"btn_addtophone",BTN_REMOVEFROMPHONE:"btn_removefromphone",BTN_DOWNLOAD:"btn_downloadvideo",BTN_DELETE:"btn_deletevideo"};AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.addFilter("_includes",this._includes,0);this._isIPhone=AMA.Util.isIPhone(AMA.models.endpoints.models[0].get("platformfriendlyname"));this.fileIds=[]},_includes:function(b){return b.pendingTransmit===false},render:function(){if(!this.data.length){var b=_.template($("#videos_blank_list_template").html(),this._processData(this.dataDetails));this.$el.html(b);this.trigger("VIDEOS:no.data")}else{a.__super__.render.apply(this)}},_processData:function(b){return b},_setupEvents:function(){a.__super__._setupEvents.apply(this,arguments);var c=this,b=c.parent.$el;fullSizeButtons=c.$el.find("."+c._css.BTN_VIEWFULLSIZE),addToPhoneButtons=c.$el.find("."+c._css.BTN_ADDTOPHONE),removeFromPhoneButtons=c.$el.find("."+c._css.BTN_REMOVEFROMPHONE),downloadButtons=c.$el.find("."+c._css.BTN_DOWNLOAD),deleteButtons=c.$el.find("."+c._css.BTN_DELETE);if(AMA.Util.isIPhone()){addToPhoneButtons.remove()}b.off("click","."+c._css.BTN_DOWNLOAD).on("click","."+c._css.BTN_DOWNLOAD,function(){var d=this.attributes.uid.value;AMA.models.photos.downloadFile("image",d,function(f){var e=f.mediaUrl.replace("content?","download?")+"&fileName="+f.fileName;AMA.Util.downloadFile(e)})});b.off("click","."+c._css.BTN_REMOVEFROMPHONE).on("click","."+c._css.BTN_REMOVEFROMPHONE,function(){var f=this.attributes.uid.value,e=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(e);if(AMA.config.enableReporting){var d={};d.ActionPerformed="Remove From Phone";AMA.debug("Reporting: Logging event for photo added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removephotofrmphone,d)}AMA.models.videos.addRemove("remove","videos",[f],function(g){c.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(h){c.eventChangesOnGallery(h,this.currentIndex)});AMA.page.standardDialogs.hideloading();if(g){AMA.models.videos.invalidate()}})});this.$el.on("click","."+c._css.ITEM,function(h){var g=this,d=c.$el.find(".thumb_items").index($(g)),f=c.$el.find(".thumb_items")[d];h.preventDefault()});b.off("click","."+c._css.BTN_DELETE).on("click","."+c._css.BTN_DELETE,function(){var d=c,f=this.attributes.uid.value;var e=$("#msg_confirm_delete_video").html();AMA.page.standardDialogs.confirm(e,function(){AMA.page.standardDialogs.confirmDialog.hide();var g=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(g);AMA.models.videos.trash("video",[f],function(h){c.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(j){c.eventChangesOnGallery(j,this.currentIndex)});AMA.page.standardDialogs.hideloading();if(h){AMA.models.videos.invalidate();AMA.models.trash.invalidate()}})})});b.off("click","."+c._css.BTN_ADDTOPHONE).on("click","."+c._css.BTN_ADDTOPHONE,function(){var f=this.attributes.uid.value,e=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(e);if(AMA.config.enableReporting){var d={};d.ActionPerformed="Add From Phone";AMA.debug("Reporting: Logging event for photo added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removephotofrmphone,d)}AMA.models.videos.addRemove("add","videos",[f],function(g){c.once(AMA.view.ListView.EVENT.NEW_DATA_LOADED,function(h){c.eventChangesOnGallery(h,this.currentIndex)});AMA.page.standardDialogs.hideloading();if(g){AMA.models.videos.invalidate()}})})}})})();
/*! VideoDetailsView */
(function(){AMA.namespace("view");var a=AMA.view.VideoDetailsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="video_details_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);var b=this;this.dataDetails=null;if(this.options.listView){this.options.listView.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(c){if(b.data){b.data.isFetching=true}b.dataDetails=false;b._fetchDetails(c.toJSON())});this.options.listView.on(AMA.view.ListView.EVENT.SELECTION_CLEARED,function(){b.hide()})}else{AMA.warning("This instance of ContactDetailsView is not linked to a contacts list. Data switching will not apply.")}},renderBlank:function(){var b=_.template($("#videos_blank_details_template").html());this.$el.html(b)},render:function(){if(!this.dataDetails){return}var c=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},b="";var b=_.template(this.template,this._processData(this.dataDetails));this.$el.html(b)},_fetchDetails:function(b){var c=this;if(AMA.Util.useXdr()){xhr=AMA.Util.createCORSRequest("GET",AMA.config.apiHostUrl+"/files/"+b.id+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType="+mediaType);xhr.onload=function(){try{var d=JSON.parse(this.responseText)}catch(f){AMA.error("Response not JSON")}};xhr.onerror=function(){AMA.error("Error in request")};xhr.onprogress=function(){};xhr.ontimeout=function(){};xhr.timeout=100000;xhr.send()}else{$.ajax({url:AMA.config.apiHostUrl+"/files/"+b.id+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType=video"}).done(function(d){c.dataDetails=d;c.refresh()})}},_processData:function(b){var c=b;c.onTrash=(b.visibility!=="ACTIVE")?"hide":"";c.notOnTrash=(b.visibility==="ACTIVE")?"hide":"";c.fileSizeInBytes=AMA.Util.bytesToSize(b.fileSizeInBytes);c.statueText=this._getStatusText(b);c.statueText.addToPhone=(c.pendingDelete)?"":"hide";c.statueText.removeFromPhone=(c.pendingDelete)?"hide":"";return c},_getStatusText:function(b){data={addSync:"hidden",deleteSync:"hidden",webOnly:"hidden",onDevice:"hidden",};switch(true){case (b.pendingCreate):data.addSync="";break;case (b.pendingDelete&&b.onPhone):data.deleteSync="";break;case (b.onPhone):data.webOnly="";break;default:data.onDevice="";break}return data},_setupEvents:function(){this.$el.find(".details_undeletebutton").off("click").on("click",function(){var b=this,c=$("#msg_confirm_restore_trashitem").html();AMA.page.standardDialogs.confirm(c,function(){AMA.page.standardDialogs.confirmDialog.hide();var d=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(d);AMA.models.trash.restore([b.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[2]){AMA.models.videos.invalidate();AMA.models.trash.invalidate()}})})});this.$el.find(".details_deletefromtrashbutton").off("click").on("click",function(){var b=this,c=$("#msg_confirm_permadelete_trashitem").html();AMA.page.standardDialogs.confirm(c,function(){AMA.page.standardDialogs.confirmDialog.hide();var d=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(d);AMA.models.trash.trash([b.attributes.uid.value],function(){AMA.page.standardDialogs.hideloading();if(arguments[2]){AMA.models.trash.invalidate()}})})});if(!this.parent.videosGrid){return}this.parent.videosGrid.on("VIDEOS:no.data",function(){this.renderBlank()},this)}})})();
/*! TrashView */
(function(){AMA.namespace("view");var a=AMA.view.TrashView=AMA.view.BaseView.extend();a.TEMPLATE_ID="data_trash_template";a.TEMPLATE_SRC="trash.tpl";var b={contact:function(c){return c.fullName?true:false},photo:function(c){return(c.fileType&&c.fileType.indexOf("image")>-1)},image:function(c){return(c.fileType&&c.fileType.indexOf("image")>-1)},video:function(c){return(c.fileType&&c.fileType.indexOf("video")>-1)},all:function(){return true}};_.extend(a.prototype,{events:{"click .data_trash_emptytrash":"emptyTrash","change #trashtype":"applyTypeFilter","click #data_trash_multiaction_perform":"processBatchAction"},initialize:function(){a.__super__.initialize.apply(this,arguments)},render:function(){a.__super__.render.apply(this);this.trashList=new AMA.view.TrashedListView({el:"#data_trash_list",parent:this,data:AMA.models.trash}).plug(AMA.view.plugin.ListScrollLoader,{scrollContainer:"#data_trash_list",listItemType:"li",listItemClassname:"rt_row"}).plug(AMA.view.plugin.MultiSelector,{selectAll:"#data_trash_selectall"}).plug(AMA.view.plugin.ApiSearch,{searchInput:"#data_trash_searchbar .searchinput"});this.trashDetails=new AMA.view.TrashDetailsView({el:"#trash_details_view",parent:this})},emptyTrash:function(){if(!this.trashList){return}if(this.trashList.data.length==0){msg=$("#msg_empty_trash_no_items").html();AMA.page.standardDialogs.error(msg);return}var c=[];_.each(this.trashList.data.models,function(d){c.push(d.id)});msg=$("#msg_confirm_empty_trash").html();AMA.page.standardDialogs.confirm(msg,_.bind(function(){var d=$("#msg_trash_loadingdialog").html();AMA.page.standardDialogs.confirmDialog.hide();AMA.page.standardDialogs.loading(d);AMA.models.trash.trash(c,function(){AMA.page.standardDialogs.hideloading();if(arguments[0]||arguments[1]||arguments[2]){AMA.models.trash.invalidate()}})},this))},applyTypeFilter:function(){if(!this.trashList){return}this.trashList.addFilter("_typefilter",b[this.$el.find("#trashtype").val()]);this.trashList.refresh()},processBatchAction:function(){var k,j={};var f=false,d=false,h=false;var g=$("#data_trash_multiaction_select").val();if(g==""){k=$("#msg_error_no_action_selected").html();AMA.page.standardDialogs.error(k);return false}var c=this.trashList.getCheckedItems();if(c.length==0){k=$("#msg_error_no_trashitems_selected").html();AMA.page.standardDialogs.error(k);return false}function e(){var l=$("#msg_trash_loadingdialog").html();AMA.page.standardDialogs.loading(l);switch(g){case"restore":AMA.models.trash.restore(c,function(){AMA.page.standardDialogs.hideloading();if(arguments[0]){AMA.models.contacts.invalidate();f=true}if(arguments[1]){AMA.models.photos.invalidate();h=true}if(arguments[2]){AMA.models.videos.invalidate();d=true}if(arguments[0]||arguments[1]||arguments[2]){AMA.models.trash.invalidate()}if(AMA.config.enableReporting){if(g==="restore"){if(d===true){j.ActionPerformed="Restore Videos - Action Performed Dropdown";AMA.debug("Reporting: logging event for video restored");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.restorevideoactionperformed,j)}if(f===true){j.ActionPerformed="Restore Contacts - Action Performed Dropdown";AMA.debug("Reporting: logging event for contact restored");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.restorecontactactionperformed,j)}if(h===true){j.ActionPerformed="Restore Images - Action Performed Dropdown";AMA.debug("Reporting: logging event for Image restored");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.restoreimageactionperformed,j)}}}});break;case"purge":AMA.models.trash.setDropdownTrash(true);AMA.models.trash.trash(c,function(){AMA.page.standardDialogs.hideloading();if(arguments[0]||arguments[1]||arguments[2]){AMA.models.trash.invalidate()}});break}}if(g==="restore"){k=$("#msg_confirm_restore_trashitem"+(c.length>1?"s":"")).html();AMA.page.standardDialogs.confirm(k,e)}else{if(g==="purge"){k=$("#msg_confirm_permadelete_trashitem"+(c.length>1?"s":"")).html();AMA.page.standardDialogs.confirm(k,e)}else{e()}}},_setupEvents:function(){a.__super__._setupEvents.apply(this);var c=this;this.$el.find(".close_trash_details").on("click",function(){c.toggleSlideCanvas()})},toggleSlideCanvas:function(){var c=this;this.$el.find(".row-offcanvas").toggleClass("active",function(){if($(window).width()<768){if(!$(this).hasClass("active")){$("body").scrollTop($(".rt_rowindicated",this).offset().top)}else{$("body").scrollTop(c.$el.offset().top)}}})}})})();
/*! TrashListView */
(function(){AMA.namespace("view");var a=AMA.view.TrashedListView=AMA.view.ListView.extend();a.TEMPLATE_ID="trash_list_template";a.TEMPLATE_SRC="";var b=35;AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);var c=this;if(!this.listItemEmptyTemplate){this.listItemEmptyTemplate=$("#list_empty_template").html()}this.data.on(AMA.model.BaseData.EVENT.LOADED,function(){if(this._isTrashedContactsLoaded&&this._isTrashedPhotosLoaded&&this._isTrashedVideosLoaded){if(!c._dataset.length){c.$el.html(_.template(c.listItemEmptyTemplate))}}})},render:function(){a.__super__.render.apply(this,arguments);this.$el.closest(".row-offcanvas").removeClass("active");AMA.debug(this._dataset.length+" items rendered in contact list view.")},_processData:function(d,c){var e=b;a.__super__._processData.call(this,d,c);d.typeClass=this._getTypeClass(d);d.fullNameTitle=this._getDisplayName(d);d.fullName=AMA.Util.escapeSpecialCharacters(AMA.Util.truncateString(d.fullNameTitle,e));return d},_getTypeClass:function(c){if(typeof c.fullName!="undefined"){return"contactRecordOff"}else{if(c.fileType&&c.fileType.indexOf("image")>-1){return"imageRecordOff"}else{if(c.fileType&&c.fileType.indexOf("video")>-1){return"videoRecordOff"}}}},_getDisplayName:function(c){return c.fullName||this._computeFullName(c)||c.companyName||c.email||c.fileName||""},_computeFullName:function(f){var e=f.firstName,d=f.middleName,c=f.lastName;if(e||d||c){return e+(e&&d?" ":"")+d+((e||d)&&c?" ":"")+c}},_setupEvents:function(){AMA.view.TrashedListView.__super__._setupEvents.call(this,arguments);var c=this;this.$el.find("."+AMA.view.TrashedListView.CSS.ITEM).on("click",function(d){d.preventDefault();c.parent.toggleSlideCanvas()})},})})();
/*! TrashDetailsView */
(function(){AMA.namespace("view");var a=AMA.view.TrashDetailsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="trash_details_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.plug(AMA.view.plugin.Switcher);this._afterRender=function(){};this._initEvents()},render:function(){a.__super__.render.apply(this);this.detailsView={};this.detailsView.contact=new AMA.view.ContactDetailsView({el:"#trash_details_contact",parent:this,hidden:true,dataClass:AMA.models.contacts.constructor,trash:true,listView:this.parent.trashList});this.detailsView.photo=new AMA.view.PhotoDetailsView({el:"#trash_details_image",parent:this,hidden:true,dataClass:AMA.models.photos.constructor,trash:true,listView:this.parent.trashList});this.detailsView.video=new AMA.view.VideoDetailsView({el:"#trash_details_video",parent:this,hidden:true,dataClass:AMA.models.videos.constructor,trash:true,listView:this.parent.trashList});if(this.parent.trashList){if(this.parent.trashList._items&&this.parent.trashList._items.length>0){this.parent.trashList._selectItem(this.parent.trashList._items[0])}}},_initEvents:function(){var b=this;if(this.parent.trashList){this.parent.trashList.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(c){if(!c||!b.detailsView){return}b.$el.children().hide();if(typeof c.attributes.fullName!="undefined"){b.detailsView.contact.setData(c);b.switchTo(b.detailsView.contact)}else{if(c.attributes.fileType&&c.attributes.fileType.indexOf("image")>-1){b.detailsView.photo.setData(c);b.switchTo(b.detailsView.photo)}else{if(c.attributes.fileType&&c.attributes.fileType.indexOf("video")>-1){b.detailsView.video.setData(c);b.switchTo(b.detailsView.video)}}}})}else{AMA.warn("This instance of ContactDetailsView is not linked to a contacts list. Data switching will not apply.")}this.parent.trashList.data.on(AMA.model.BaseData.EVENT.LOADED,function(){if(this._isTrashedContactsLoaded&&this._isTrashedPhotosLoaded&&this._isTrashedVideosLoaded&&!b.parent.trashList._dataset.length){b.$el.find(".list_details_empty").show().siblings().hide()}})},_setupEvents:function(){a.__super__._setupEvents.apply(this)}})})();(function(){AMA.namespace("view");var a=AMA.view.LessIsMoreDialog=AMA.view.Dialog.extend();a.TEMPLATE_ID="lessismoredialog_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{_setupEvents:function(){var b=this;this.$el.find("div.close").on("click",function(){b.hide()});this.$el.find("a.restore_instructions").on("click",function(){b.hide();AMA.page.header.toolbar.toolsets.transferData.transferDataWizard.show()})}})})();
/*! LocationTabView */
(function(){AMA.namespace("view");var a=AMA.view.LocationTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="location_tab_template";a.TEMPLATE_SRC="location.tpl";a.TOOLBAR={DEFAULT:["endpoint","locate","alarm","lock","wipe"],IPHONE:["endpoint","locate","securePhone"]};AMA.augment(a.prototype,{events:{"click #location_setting":"editLocationSettings","click #tip_link":"showTips"},render:function(){a.__super__.render.apply(this);this.locationHistory=new AMA.view.LocationHistoryListView({el:"#location_history",parent:this,data:AMA.models.locations});this.locationMap=new AMA.view.LocationMapView({el:"#map_container",parent:this,dataClass:AMA.models.locations.constructor});this.locationSummary=new AMA.view.LocationsSettingsSummaryView({el:"#locations_settings_summary_placeholder",data:AMA.models.locatesettings,parent:this});this.TipsToRecover=new AMA.view.TipsToRecover({el:"#tipstorecover",parent:this});if(!AMA.config.enableMrTimeTracking){AMA.debug("Reporting: Start MR time spent timer as user is on Location Tab");AMA.config.enableMrTimeTracking=true;AMA.ReportingManager.reportPortalTimeSpent("MR","Start")}},_setupEvents:function(){a.__super__._setupEvents.apply(this,arguments);this.$el.on("click","#toggleMapLandscape",function(){$("html, body").animate({scrollTop:$(document).height()-$(window).height()})})},showTips:function(){this.TipsToRecover.show()},editLocationSettings:function(){AMA.page.openSettings("location")}})})();
/*! LocationHistoryListView */
(function(){AMA.namespace("view");var a=AMA.view.LocationHistoryListView=AMA.view.ListView.extend();a.TEMPLATE_ID="location_history_item_template";a.TEMPLATE_SRC="";a.CSS={ITEM:"item",ITEM_STYLE:["rt_rowlighter","rt_rowdarker"],SELECTED_ITEM:"selected"};a.EVENT=AMA.enums("ADDRESS_RETRIEVED");AMA.augment(a.prototype,{events:{"click #clear_location_history a.link_text":"clearLocationHistory","click .address a.link_text":"locate","click  #button_locate_history_normal":"locate"},lastRecordedLocation:null,initialize:function(){a.__super__.initialize.apply(this,arguments);this.responsiveListContainer=$("#location-menu-tab-sm-full .menu");if(!this.lastlocationSubmenuTemplate){this.lastlocationSubmenuTemplate=$("#last_location_submenu_item_template").html()}if(!this.previouslocationSubmenuTemplate){this.previouslocationSubmenuTemplate=$("#previous_location_submenu_item_template").html()}var h=this;this.bind(a.EVENT.ADDRESS_RETRIEVED,function(j){h.$el.find("[uid="+j.get("id")+"] .address").html(j.get("address"));h.responsiveListContainer.find("[uid="+j.get("id")+"] .address").html(j.get("address"))});this.bind(AMA.view.ListView.EVENT.LIST_EMPTIED,function(){var j={id:0,elId:"location_history_0",elStyle:"",timeLocated:"",accuracy:""};h.$el.find("#location_last").html(_.template(h.template,j));h.$el.find("#location_history_1_to_4").html("");h.$el.find("#location_previous").toggle(this.data.models.length>1);h.$el.find("#clear_location_history").hide();h.responsiveListContainer.html(_.template(h.lastlocationSubmenuTemplate,j))});var c=AMA.ActionManager,d=AMA.workflow.BaseWorkflow,e=AMA.workflow.LocateWorkflow,g=AMA.workflow.SecurePhoneWorkflow,f=c.getWorkflow("locate"),b=false;if(AMA.models.capabilities.canRead("deviceSecurePhoneAction")){b=c.getWorkflow("secure")}if(f){f.on(d.EVENT.STATE_CHANGED,function(j){switch(j.state){case e.STATE.CONNECTING:h.toggleStateDisplay("connecting");h.selectLocationSubmenuItem();break;case e.STATE.REFINING:h.toggleStateDisplay("refining");break;case d.STATE.FINALIZING:h.toggleStateDisplay((f._result==AMA.workflow.BaseWorkflow.RESULT.FAILED)?"fail":"success");break;default:}AMA.debug("Location History List View is now transitioning to '"+f.getStateName(j.state)+"' state")},this);f.on(d.EVENT.FINISHED,function(j){switch(j.result){case d.RESULT.CANCELLED:h.toggleStateDisplay("cancelled");break}},this)}if(b){b.on(d.EVENT.STATE_CHANGED,function(j){switch(j.state){case g.STATE.CONNECTING:h.selectLocationSubmenuItem();h.toggleStateDisplay("connecting");break;case g.STATE.REFINING:h.toggleStateDisplay("refining");break;case d.STATE.FINALIZING:h.toggleStateDisplay("default");break;default:h.toggleStateDisplay("default")}AMA.debug("Location History List View is now transitioning to '"+b.getStateName(j.state)+"' state")},this)}if(!AMA.models.capabilities.canRead("eventSettings")){h.$el.siblings(".location_settings").children().hide()}else{if(AMA.models.capabilities.canUpdate("eventSettings")){h.$el.siblings(".location_settings").children(".link:not(:has(.Edit_Location_Settings))").hide()}else{if(AMA.models.capabilities.canRead("eventSettings")&&!AMA.models.capabilities.canUpdate("eventSettings")){h.$el.siblings(".location_settings").children(".link:not(:has(.View_Location_Settings))").hide()}}}},_setupEvents:function(){AMA.debug("List view "+this.options.el+" is initializing onclick handler for each item");var b=this;if(this.data&&this.data.models.length>0){this.$el.find("."+b._css.ITEM).on("click",function(){if(!$(this).closest(".location_refining").size()&&!$(this).closest(".location_connecting").size()){AMA.debug("User clicked item #"+$(this).attr("id")+" on list view "+b.options.el);b._selectItem(this)}});$("#location-menu-tab-sm-full li").on("click",function(){if(b.data.models.length>0){var c=$(this).attr("uid");b.selectLocationSubmenuItem(c);b._selectItem(b.$el.find("[uid="+c+"] ."+b._css.ITEM)[0])}})}$("#submenu-locate-refresh").on("click",function(){b.locate()})},toggleStateDisplay:function(c){var b={connecting:".location_connecting",refining:".location_refining","default":".default",success:".default",fail:".default",cancelled:".default"};this.$el.find(b[c]).show().siblings(".location_history").hide();$("#location-toggle-submenu").removeClass("connecting refining").addClass(c);switch(c){case"connecting":AMA.debug("Location History List View is now transitioning to 'connecting' state");break;case"refining":AMA.debug("Location History List View is now transitioning to 'refining' state");break;case"fail":AMA.debug("Location History List View is now transitioning to 'failing' state");this._selectItem();break;case"success":AMA.debug("Location History List View is now transitioning to 'success' state");break;case"cancelled":AMA.debug("Location History List View is now transitioning to 'cancelled' state");this.$el.find(".location_history").hide();this.$el.find(".default").show();break;default:}},render:function(){var g="",d="";firstLoc=null,oldLocation=false;this._applyFilters();AMA.debug(this.options.el+" has a final dataset of "+this._dataset.length+" items");this.data.prepareLocations();this.data.clearDuplicateLocations();this.responsiveListContainer.empty();if(this.data.length>0){var c=this.data.toJSON();for(var f=0;f<this.data.numberOfPoints;f++){var b=c[f];if(b){processedData=this._processData(b,f);templatedContent=_.template(this.template,processedData);g+=templatedContent;d=templatedContent;d=d.replace("id","class");if(f==0){this.$el.find("#location_last").html(g);this.responsiveListContainer.append(_.template(this.lastlocationSubmenuTemplate,processedData));g=""}else{this.responsiveListContainer.append(_.template(this.previouslocationSubmenuTemplate,processedData))}}}}else{this.$el.find("#location_last").html("");this.responsiveListContainer.empty()}this.$el.find("#location_history_1_to_4").html(g);this.$el.find("#location_previous").toggle(this.data.models.length>1);this.$el.find("#clear_location_history").show();this._items=this.$el.find(".default ."+this._css.ITEM);AMA.debug(this.options.el+" has rendered "+this._items.length+" items");firstLoc=(this.data.models.length>0)?this.data.models[0]:null,oldLocation=(firstLoc&&this.lastRecordedLocation&&firstLoc.attributes.eventTime<=this.lastRecordedLocation.attributes.eventTime)?true:false;if(oldLocation===true){AMA.debug("Exiting render of location history. Not updated location.");return}this.lastRecordedLocation=firstLoc;AMA.debug("Saving the last recorded location",this.lastRecordedLocation);if(this._items.length>0){var e=this.selectedItem&&this.$el.find("[uid='"+$(this.selectedItem).attr("uid")+"']")||[],h=e.length>0;this._selectItem(h?e[0]:this._items[0]);AMA.debug("Previously selected item is still in list: "+h)}else{this.trigger(AMA.view.ListView.EVENT.LIST_EMPTIED);AMA.debug(this.options.el+" has triggered a 'list emptied' event.");this._selectItem()}},clearLocationHistory:function(){var c=this;var b=$("#msg_confirm_clear_location_history").html();AMA.page.standardDialogs.confirm(b,function(){d=d||$("#msg_confirm_clear_location_history").html();var d=c.$el.find(".msg_loadingdialog").html();AMA.page.standardDialogs.loading(d);c.data.sync("delete",c.data,{parse:function(){},success:function(){c.data.fetch();AMA.page.standardDialogs.hideloading()},error:function(){c.data.fetch();AMA.page.standardDialogs.hideloading()}});setTimeout(function(){},500)})},locate:function(){AMA.ActionManager.start("locate")},_afterRender:function(){for(var d=0;d<this.data.numberOfPoints;d++){var b=this.data.models[d];if(!b.get("address")){var e="https://dev.virtualearth.net/REST/v1/Locations/"+b.get("coordinates");var g={output:"json",key:AMA.config.getBingMapsKey()};var f=this;var c=function(m,k,j,n){var l=this.data.models[m];if(k&&k.resourceSets&&k.resourceSets.length>0&&k.resourceSets[0].resources&&k.resourceSets[0].resources.length>0){var h=f._getAddress(k.resourceSets[0].resources[0]);l.set("address",h,{silent:true});this.trigger(a.EVENT.ADDRESS_RETRIEVED,l)}else{AMA.debug("Bing was unable to find an address for location: "+l.get("coordinates"));AMA.ReportingManager.remoteLog("Bing was unable to find an address for location: "+l.get("coordinates"),AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT)}};$.getJSON(e+"?jsonp=?",g,_.bind(c,this,d))}}},_selectItem:function(c){var d,b;if(this.selectedItem){$(this.selectedItem).parent().removeClass(this._css.SELECTED_ITEM);this.responsiveListContainer.find("li").removeClass("selected")}this.selectedItem=c;if(this.selectedItem){d=$(this.selectedItem);d.parent().addClass(this._css.SELECTED_ITEM);AMA.debug("Item #"+d.parent().attr("id")+" has been selected on list view "+this.options.el);b=d.parent().attr("uid");this.selectLocationSubmenuItem(b);this.trigger(AMA.view.ListView.EVENT.ITEM_SELECTED,this.data.get(b));AMA.debug(this.options.el+" has triggered an 'item selected' event with uid="+b)}else{this.trigger(AMA.view.ListView.EVENT.SELECTION_CLEARED);this.selectLocationSubmenuItem();AMA.debug("There is no selected item on list view "+this.options.el+"; a 'selection cleared' event has been triggered")}},_processData:function(c,b){c.elId="location_history_"+b;c.elStyle="";c.address=c.address||"";c.timeLocated=this._locationFormat(c.time,c.eventTimeTo);switch(AMA.config.accuracyUnit){case"meters":c.accuracy=Math.floor(c.accuracy);break;case"yards":c.accuracy=Math.floor(AMA.Util.metersToYards(c.accuracy));break;case"miles":c.accuracy=Math.floor(c.accuracy);break;default:c.accuracy=Math.floor(c.accuracy);break}return c},_locationFormat:function(d,b){if(d!=null&&d!=""){var c=new Date(d);if(b!=null){var e=new Date(b);if(c.getDate()==e.getDate()){if(c.getHours()==e.getHours()&&c.getMinutes()==e.getMinutes()){return(AMA.Util.isIPhone()===true)?$.timeago(c):AMA.Util.formatDateAndTime(c,AMA.config.dateAndTimeFormat)}}return(AMA.Util.isIPhone()===true)?$.timeago(e):(AMA.Util.formatDateAndTime(c,AMA.config.dateAndTimeFormat)+" - "+AMA.Util.formatDateAndTime(e,AMA.config.dateAndTimeFormat))}return(AMA.Util.isIPhone()===true)?$.timeago(c):AMA.Util.formatDateAndTime(c,AMA.config.dateAndTimeFormat)}},_getAddress:function(c){var b="";b+=c.address.locality!=null?c.address.locality:"";b+=c.address.adminDistrict!=null?(b!=""?", ":"")+c.address.adminDistrict+" ":"";b+=c.address.postalCode!=null?(b!=""?" ":"")+c.address.postalCode:"";AMA.debug("getAddress: "+b);return b},selectLocationSubmenuItem:function(c){this.responsiveListContainer.children().removeClass("selected");if(c){this.responsiveListContainer.find("[uid="+c+"]").addClass("selected")}c=c||0;var b=this.responsiveListContainer.find("[uid="+c+"] .submenuItemLabel").text();$("#location-toggle-submenu .submenu-title").text(b)}})})();
/*! LocationMapView */
(function(){AMA.namespace("view");var c=AMA.view.LocationMapView=AMA.view.BaseView.extend();c.TEMPLATE_ID="location_map_template";c.TEMPLATE_SRC="";var b={defaultZoom:3,markerZIndex:1000};var a="close_infobox";c.EVENT=AMA.enums("MAP_INITIALIZED");c.CurrentState=null;AMA.augment(c.prototype,{events:{"click .cancel_locate":"cancelLocation"},initialize:function(g){c.__super__.initialize.apply(this,arguments);this.options.viewOnly=g&&g.viewOnly||false;this.options.mapWidth=g&&g.mapWidth||AMA.config.locationPaneRWDMap.width;this.options.mapHeight=g&&g.mapHeight||AMA.config.locationPaneMap.height;this.lastMapWidth=this.options.mapWidth;this.lastMapHeight=this.options.mapHeight;this.CurrentState=null;if(!this.options.viewOnly){var l=this;this.parent.locationHistory.on(AMA.view.LocationHistoryListView.EVENT.ADDRESS_RETRIEVED,function(m){l.reset();if(l.data.get(m.id)){l._doRender()}});this.parent.locationHistory.bind(AMA.view.ListView.EVENT.LIST_EMPTIED,function(){l.reset();l.setData()});this.parent.locationHistory.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(n,m){l.status="";l.setData(n)});this.parent.on(AMA.view.BaseView.EVENT.SHOWN,function(){l._resizeMap()});var e=AMA.ActionManager,f=AMA.workflow.BaseWorkflow,h=AMA.workflow.LocateWorkflow,k=AMA.workflow.SecurePhoneWorkflow,j=e.getWorkflow("locate"),d=false;if(AMA.models.capabilities.canRead("deviceSecurePhoneAction")){d=e.getWorkflow("secure")}if(d){d.on(f.EVENT.STATE_CHANGED,function(m){switch(m.state){case f.STATE.INITIALIZING:break;case k.STATE.CONNECTING:c.CurrentState=k.STATE.CONNECTING;l.toggleState("connecting");l.$el.find("#location_progress_note .time_remaining").hide();l.$el.find("#location_progress_note .time_remaining .countdown").html("03:00");break;case k.STATE.REFINING:c.CurrentState=k.STATE.REFINING;AMA.debug("Contacts successfully erased; proceeding to next action");l.toggleState("refining");break;case f.STATE.FINALIZING:c.CurrentState=f.STATE.FINALIZING;l.toggleState("default");break;default:l.toggleState("default")}})}if(j){j.on(f.EVENT.STATE_CHANGED,function(m){switch(m.state){case h.STATE.CONNECTING:l.toggleState("connecting");break;case h.STATE.REFINING:l.toggleState("refining");break;case f.STATE.FINALIZING:l.status=(AMA.ActionManager.getWorkflow("locate")._result==AMA.workflow.BaseWorkflow.RESULT.FAILED)?"fail":"success";l.toggleState(l.status);break;default:}c.CurrentState=m.state;AMA.debug("Location Map View is now transitioning to '"+j.getStateName(m.state)+"' state")},this);j.on(f.EVENT.COUNTDOWN_TICK,function(m){l.$el.find("#location_progress_note .time_remaining").show();l.$el.find("#location_progress_note .time_remaining .countdown").html(m.remaining);l.infoboxLayer.clear()},this);j.on(f.EVENT.FINISHED,function(m){switch(m.result){case f.RESULT.SUCCESSFUL:break;case f.RESULT.FAILED:break;case f.RESULT.CANCELLED:l.$el.find("#message").hide();l.$el.find("#location_progress_note .time_remaining .countdown").html("03:00");break}AMA.debug("Location Map View finished with result of '"+j.getResultName(m.result)+"'")},this);if(e){e.on(e.EVENT.ACTION_STARTED,function(m){if(m.action==="locate"){l.infoboxLayer.clear()}})}}}},render:function(){if(this.pendingRender){return}if(!this.mapInitialized){if(!this.pendingRender){this.pendingRender=true;var e=this;this.once(c.EVENT.MAP_INITIALIZED,function(){e.pendingRender=false;e.render()});var g=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},k="";k=_.template(this.template,this._processData(g));this.$el.html(k);this._initMap()}return}if(!this.locationHistory){this.locationHistory={}}if(this.data&&this.data.length>0){this.$el.find("#bing_map_dialog").hide();this.$el.find("#message").hide();this.$el.find("#location_failed_note").hide();var f=this.data.models[0],m=true;if(!this.locationHistory[f.id]){this._prepareLocationData(f)}var j=this.locationHistory[f.id];this.pushpinLayer.clear();this.infoboxLayer.clear();this.pushpinLayer.push(j.marker);this.infoboxLayer.push(j.infobox);j.marker.setOptions({visible:true});switch(c.CurrentState){case AMA.workflow.LocateWorkflow.STATE.CONNECTING:case AMA.workflow.LocateWorkflow.STATE.REFINING:m=false;$("#accuracyinfoid").remove();$(".cancel_locate").hide();break;case AMA.workflow.SecurePhoneWorkflow.STATE.CONNECTING:case AMA.workflow.SecurePhoneWorkflow.STATE.REFINING:m=false;$("#accuracyinfoid").remove();break;default:break}j.infobox.setOptions({visible:m});this.$el.find("."+a).on("click",function(){j.infobox.setOptions({visible:false})});this.mapObject.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(j.points)});this.mapObject.setView({zoom:this._getZoomBasedOnAccuracy(f.get("accuracy"))});this.$el.find("#accuracyinfoid").remove();var l=new Microsoft.Maps.Location(f.get("latitude"),f.get("longitude"));var d="<div id='accuracyinfoid' class='markerline accuracyInfo'> -- "+this._getAccuracy(f.get("accuracy"))+" "+AMA.config.accuracyUnit+" -- </div>";var h=new Microsoft.Maps.Pushpin(l,{htmlContent:d,zIndex:1000,visible:true});this.mapObject.entities.push(h);this._afterSetupMap.apply(this)}else{this._defaultMapView();this.$el.find("#location_failed_note").hide();if(this.$el.attr("id")!="dashboard_map"){if(this.status==="fail"){this.$el.find("#bing_map_dialog").hide();this.$el.find("#location_failed_note").show()}else{this.$el.find("#bing_map_dialog").show();this.$el.find("#message").show()}}}if(this.data&&this.data.length>0&&this.status=="fail"){if(this.$el.attr("id")!="dashboard_map"){this._defaultMapView();this.$el.find("#location_failed_note").show();this.$el.find("#bing_map_dialog").hide();this.$el.find("#message").hide()}}},reset:function(){this.locationHistory={}},refresh:function(){if(this.options.viewOnly){if(AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.REFINING||AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.CONNECTING){return}}c.__super__.refresh.apply(this)},_defaultMapView:function(){this.$el.find("#accuracyinfoid").remove();this.pushpinLayer.clear();this.infoboxLayer.clear();this.mapObject.setView({zoom:b.defaultZoom});this.mapObject.setView({bounds:Microsoft.Maps.LocationRect.fromLocations(new Microsoft.Maps.Location(AMA.config.defaultMapCoordinates.lat,AMA.config.defaultMapCoordinates.lon))})},toggleState:function(d){switch(d){case"connecting":this._defaultMapView();this.$el.find("#message").hide();AMA.Util.switchLabel(".location_progress_text",".locating",this.$el);this.$el.find("#location_progress_note").show();this.$el.find("#location_progress_note .time_remaining").removeClass("hidden");this.$el.find("#location_failed_note").hide();this.$el.find("#location_progress_note .cancel_locate").show();break;case"refining":var e=this.data.toJSON()[0].accuracy||"0";AMA.Util.switchLabel(".location_progress_text",".refining",this.$el);this.$el.find("#location_progress_note .time_remaining").addClass("hidden");this.$el.find("#location_progress_note .cancel_locate").hide();break;case"fail":this._defaultMapView();this.$el.find("#location_progress_note").hide();this.$el.find("#location_failed_note").show();this.$el.find("#message").hide();break;case"success":this.$el.find("#location_progress_note").hide();this._doRender();this.render();break;default:this.$el.find("#location_progress_note").hide();this._doRender();this.render();break}},_prepareLocationData:function(e){var j=e.id;if(!this.locationHistory[j]){this.locationHistory[j]={}}var h=e.get("coordinates");this.locationHistory[j]["latLongObject"]=new Microsoft.Maps.Location(h.split(",")[0],h.split(",")[1]);var d=-1;for(var f=0;f<AMA.models.locations.models.length;f++){var e=AMA.models.locations.models[f];if(j==e.id){d=f;break}}var g=this._createAccuracyCircle(this.locationHistory[j]["latLongObject"],e.get("address"),this._locationFormat(e.get("time")),e.get("accuracy"),d+1,true);this.locationHistory[j]["marker"]=g.polygon;this.locationHistory[j]["points"]=g.points;this.locationHistory[j]["infobox"]=g.infobox},_setupEvents:function(){var d=this;Backbone.globalEvent.on("onLocate",function(f){d.status=f.status;d.render()})},_onPageResize:function(){this._resizeMap()},_afterSetupMap:function(){$("#refresh_loc_map").off("click").on("click",function(d){d.stopPropagation();d.preventDefault();AMA.ActionManager.start("locate");return false});this._resizeMap()},_initMap:function(){try{var d={credentials:AMA.config.getBingMapsKey(),center:new Microsoft.Maps.Location(AMA.config.defaultMapCoordinates.lat,AMA.config.defaultMapCoordinates.lon),mapTypeId:Microsoft.Maps.MapTypeId[AMA.config.defaultMapType],zoom:b.defaultZoom,showScalebar:false,enableClickableLogo:false,enableSearchLogo:false,width:this.options.mapWidth,height:this.options.mapHeight};if(this.options.viewOnly){_.extend(d,{disableUserInput:true,showDashboard:false})}this.mapObject=new Microsoft.Maps.Map(this.$el.find("#bing_map")[0],d);Microsoft.Maps.Events.addHandler(this.mapObject,"keydown",function(g){if(g.keyCode===40||g.keyCode===38){g.handled=true}});var f=this;this.mapObject.getCredentials(function(g){if(g===null){AMA.ReportingManager.remoteLog("Bing was unable to validate our key [accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT)}else{f.pushpinLayer=new Microsoft.Maps.EntityCollection({zIndex:b.markerZIndex++});f.infoboxLayer=new Microsoft.Maps.EntityCollection({zIndex:b.markerZIndex++});f.mapObject.entities.push(f.pushpinLayer);if(!f.options.viewOnly){f.mapObject.entities.push(f.infoboxLayer)}f.mapInitialized=true;f.trigger(c.EVENT.MAP_INITIALIZED)}});Microsoft.Maps.Events.addThrottledHandler(this.mapObject,"viewchangeend",this.followMouse,500)}catch(e){return}this._resizeMap()},followMouse:function(){$("a").on("mouseout",function(d){$(".NavBar_modeSelectorControlContainer").find(".NavBar_itemContainer").each(function(e){$(this).attr("href","javascript:")})})},_createAccuracyCircle:function(m,h,A,u,r,s){var j=u;if(u.indexOf(",")!=-1){j=u.substring(0,u.indexOf(","))}if(j<10){j=10}var l=6371;var p=(m.latitude*Math.PI)/180;var g=(m.longitude*Math.PI)/180;var z=parseFloat(j/1000)/l;var y=[];for(x=0;x<=360;x++){var e={};brng=x*Math.PI/180;e.Latitude=Math.asin(Math.sin(p)*Math.cos(z)+Math.cos(p)*Math.sin(z)*Math.cos(brng));e.Longitude=((g+Math.atan2(Math.sin(brng)*Math.sin(z)*Math.cos(p),Math.cos(z)-Math.sin(p)*Math.sin(e.Latitude)))*180)/Math.PI;e.Latitude=(e.Latitude*180)/Math.PI;y.push(new Microsoft.Maps.Location(e.Latitude,e.Longitude))}try{var q={};var n={fillColor:new Microsoft.Maps.Color(AMA.config.mapAccuracyCirleColor[1][3],AMA.config.mapAccuracyCirleColor[1][0],AMA.config.mapAccuracyCirleColor[1][1],AMA.config.mapAccuracyCirleColor[1][2]),strokeColor:new Microsoft.Maps.Color(AMA.config.mapAccuracyCirleColor[2][3],AMA.config.mapAccuracyCirleColor[2][0],AMA.config.mapAccuracyCirleColor[2][1],AMA.config.mapAccuracyCirleColor[2][2]),strokeThickness:2,visible:false};var t=new Microsoft.Maps.Polygon(y,n);if(s){var v=this._createInfoBox(r);var w={htmlContent:v,visible:false};var f=new Microsoft.Maps.Infobox(m,w);q.infobox=f}q.polygon=t;q.points=y;q.infobox=f;return q}catch(k){return null}},_locationFormat:function(e){if(e!=null&&e!=""){var d=new Date(e);return AMA.Util.formatDateAndTime(d,AMA.config.dateAndTimeFormat)}},_getAccuracy:function(d){switch(AMA.config.accuracyUnit){case"yards":return Math.floor(AMA.Util.metersToYards(d));break;case"meters":case"miles":default:return Math.floor(d);break}},_createInfoBox:function(d){if(!this.infoboxTemplate){this.infoboxTemplate=$("#location_map_infobox_template").html()}var e=this.data.toJSON()[0];e.index=d-1;e.locatedClass="";e.historyClass="show";if(d==1){e.locatedClass="show";e.historyClass=""}e.timeLocated=this._locationFormat(e.eventTime);if(!e.address){e.address=""}e.infoboxElClass=a;e.accuracy=this._getAccuracy(e.accuracy);return _.template(this.infoboxTemplate,e)},cancelLocation:function(d){d.stopPropagation();var f=AMA.ActionManager.getWorkflow("locate");f.cancelLocate();this._defaultMapView();this.$el.find("#location_failed_note").show();this.$el.find("#bing_map_dialog").hide();this.$el.find("#message").hide();this.$el.find("#location_progress_note").hide()},_getZoomBasedOnAccuracy:function(d){var e=parseInt(d);if(e<20){return 19}else{if(e<60){return 18}else{if(e<120){return 17}else{if(e<250){return 16}else{if(e<500){return 15}else{if(e<1000){return 14}else{if(e<2000){return 13}else{if(e<4000){return 12}else{if(e<7000){return 11}else{if(e<15000){return 10}else{if(e<28000){return 9}else{if(e<60000){return 8}else{if(e<130000){return 7}else{if(e<250000){return 6}else{if(e<500000){return 5}else{if(e<1000000){return 4}else{return 3}}}}}}}}}}}}}}}}},_resizeMap:function(){var j=$("#bing_map"),e=$("#map_container"),p=e.parent(),l=$("#bing_map_dialog"),m=$("#location_right .note"),d=$("#locate_toolset").outerHeight(),f=parseInt($("#header_link").css("padding-top")),h=d+f,k=parseInt($("#location-toggle-submenu").css("height")),g=document.documentElement.clientHeight,q=parseInt(e.css("min-height")),n=g-h-k;n=q>n?q:n;if(!$("#page_content").hasClass("hidden")){this.lastMapWidth=p.width();this.lastMapHeight=p.height()-m.outerHeight()}if($(window).width()>767){j.width(this.lastMapWidth-((parseInt(j.css("border-width")))*2)).height(this.lastMapHeight-((parseInt(j.css("border-width")))*2));l.width(this.lastMapWidth).height(this.lastMapHeight);j.find(".MicrosoftMap").width(this.lastMapWidth).height(this.lastMapHeight);this.mapObject.setOptions({width:this.lastMapWidth,height:this.lastMapHeight})}else{j.css({width:"100%",height:n+"px"});l.css({width:"100%",height:n+"px"});j.find(".MicrosoftMap").css({width:"100%",height:n+"px"})}}})})();
/*! LocationSettingsSummaryView */
(function(){AMA.namespace("view");var a=AMA.view.LocationsSettingsSummaryView=AMA.view.BaseView.extend();a.TEMPLATE_ID="location_settings_summary_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{_processData:function(b){b.isiOS=false;if(b.locationEnabled&&AMA.models.endpoints.models[0].get("platform").indexOf("iOS")==-1){b.isiOS=true}return b}})})();
/*! BaseWorkflow */
(function(){AMA.namespace("workflow");var a=AMA.workflow.BaseWorkflow=function(b){this.options=b;this.initialize()};a.EVENT=AMA.enums("STARTED","STATE_CHANGED","FINISHED","COUNTDOWN_TICK","TIMEOUT");a.STATE=AMA.enums("INACTIVE","INITIALIZING","FINALIZING");a.RESULT=AMA.enums("SUCCESSFUL","FAILED","TIMEDOUT","CANCELLED");a.extend=Backbone.History.extend;_.extend(a.prototype,Backbone.Events,{initialize:function(){this._state=a.STATE.INACTIVE;this._action="";this._actionId="";this._timeRemaining="00:00"},start:function(b){if(this._state!=a.STATE.INACTIVE){AMA.debug("'"+this._action+"' is being restarted");this.stop(a.RESULT.CANCELLED)}AMA.ActionManager.stopRoutinePolling();this.options=b||{};AMA.debug("'"+this._action+"' has started");this.trigger(a.EVENT.STARTED);var c="";AMA.ReportingManager.remoteLog("Workflow Triggered [type:-"+this._action+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]"+c,AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);this._timedOut=false;this.toState(a.STATE.INITIALIZING)},stop:function(b){this.toState(a.STATE.INACTIVE);if(this._pollingTimer){AMA.debug("Cancelling pending poll for '"+this._action+"'");clearTimeout(this._pollingTimer)}b=b||a.RESULT.SUCCESSFUL;AMA.debug("'"+this._action+"' has finished with result '"+this.getResultName(b)+"'");this._afterFinish(b);this.trigger(a.EVENT.FINISHED,{result:b});var c=b==a.RESULT.SUCCESSFUL?"Successful":"Failed";this._timeRemaining=b==a.RESULT.TIMEDOUT?3:this._timeRemaining;var d="";if(b==a.RESULT.FAILED){d="[details:-Failed]"}else{if(b==a.RESULT.TIMEDOUT){d="[details:-Timeout Failure]"}else{if(b==a.RESULT.CANCELLED){d="[details:-Cancelled]"}}}AMA.ReportingManager.remoteLog("Workflow "+c+" [type:-"+this._action+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"][time remaining:-"+this._timeRemaining+"]"+d,AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);AMA.ReportingManager.remoteLog("Action in device is done. [type:-"+this._action+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);AMA.ActionManager.startRoutinePolling()},getState:function(){return this._state},toState:function(d,c){this._state=d;this.trigger(a.EVENT.STATE_CHANGED,{state:d,data:c});AMA.debug("'"+this._action+"' changed state to '"+this.getStateName(d)+"'");this._onStateChange(d);if(d===a.STATE.FINALIZING){var b=this._result||a.RESULT.SUCCESSFUL;this.stop(b)}},_onStateChange:function(b){switch(b){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this.toState(a.STATE.FINALIZING);break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},getStateName:function(d){var b=this.constructor;while(true){if(b.STATE){for(var c in b.STATE){if(b.STATE[c]===d){return c}}}if(b===a){return d}b=b.__super__.constructor}},getResultName:function(b){for(var c in a.RESULT){if(a.RESULT[c]===b){return c}}return b},_startCountdown:function(b){AMA.debug("'"+this._action+"' has started a countdown for "+b+" seconds");this._countdownTimer=setInterval(_.bind(function(){var e=b%60,d=Math.floor(b/60),c;if(b===0){AMA.debug("'"+this._action+"' countdown timer has expired");this.trigger(a.EVENT.TIMEOUT);this._timedOut=true;clearInterval(this._countdownTimer);this.stop(a.RESULT.TIMEDOUT);return}c=(d<10?"0":"")+d+":"+(e<10?"0":"")+e;this.trigger(a.EVENT.COUNTDOWN_TICK,{remaining:c});b--},this),1000)},_stopCountdown:function(){AMA.debug("'"+this._action+"' has stopped the countdown");clearInterval(this._countdownTimer)},_afterFinish:function(){}})})();
/*! AlarmWorkflow */
(function(){AMA.namespace("workflow");var a=AMA.workflow.AlarmWorkflow=AMA.workflow.BaseWorkflow.extend();a.STATE=AMA.enums("CONNECTING","SOUNDING");a.URL="/actions";a.CONNECT_COUNTDOWN=180;var b=AMA.workflow.BaseWorkflow;_.extend(a.prototype,{_onStateChange:function(c){switch(c){case b.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case a.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case a.STATE.SOUNDING:AMA.debug("'"+this._action+"' is sounding");break;case b.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},_doInitializing:function(){this.trigger(b.EVENT.COUNTDOWN_TICK,{remaining:"03:00"});this._startCountdown(a.CONNECT_COUNTDOWN-1);this.toState(a.STATE.CONNECTING)},_doConnecting:function(){var c={data:{actionType:"soundalert"},callback:_.bind(this._afterSendRequest,this)};this._sendRequest(c)},_sendRequest:function(d){var c=AMA.config.apiHostUrl+a.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;AMA.debug("Sending a create action request to server for '"+d.data.actionType+"'");this._ajax(c,f,e,d&&d.callback)},_ajax:function(c,g,e,h){var f=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("Sending AJAX request: "+f);var d=AMA.Util.createCORSRequest.call(this,"POST",f);if(d){d.onload=function(){var j=typeof d.response==="undefined"?d.responseText:d.response;h(j)};d.onerror=function(k,j,l){AMA.ActionManager._onAjaxError(k,j,l)};d.send(e)}},_afterSendRequest:function(c){AMA.debug("received connecting response: "+c);c=JSON.parse(c);if(typeof c.actionId!="undefined"){AMA.debug("connecting actionid:"+c.actionId);this._actionId=c.actionId;AMA.ReportingManager.reportMRAttempt("alarm",this._actionId);this._startPolling()}else{AMA.debug("connection was not successful")}},_startPolling:function(){if(this._timedOut){AMA.ReportingManager.remoteLog("Alarm Failed.[Status Detail:-alarm=on][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);return}var f=this;var c=AMA.config.apiHostUrl+"/deviceEvents/"+this._actionId;var e=function(j){j=JSON.parse(j);var k=j.list;if(j.total===0){f._pollingTimer=setTimeout(function(){g()},3000);return}if(k[0].status==="success"){var h=k[0].statusDetails.split("=")[1];if(f.getState()===a.STATE.CONNECTING){f._stopCountdown();f.trigger(b.EVENT.COUNTDOWN_TICK,{remaining:"03:00"});f._startCountdown(a.CONNECT_COUNTDOWN-1);f.toState(a.STATE.SOUNDING)}f.result=b.RESULT.SUCCESSFUL;if(h==="on"){f._pollingTimer=setTimeout(function(){g()},3000)}else{AMA.ReportingManager.remoteLog("Alarm Successful.[Status Detail:-"+k[0].statusDetails+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);f._afterRetrieveStatus()}}else{f._pollingTimer=setTimeout(function(){g()},3000);AMA.debug(j.errorMessage)}};var d=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;var g=function(){var h=AMA.Util.createCORSRequest.call(this,"GET",d);if(h){h.onload=function(){var j=typeof h.response==="undefined"?h.responseText:h.response;e(j)};h.onerror=function(k,j,l){AMA.ActionManager._onAjaxError(k,j,l)};h.send()}};g()},_afterRetrieveStatus:function(){AMA.debug("_afterRetrieveStatus");this._stopCountdown();AMA.debug("Received ACK for '"+this._action+"'");this.toState(b.STATE.FINALIZING)},_afterFinish:function(c){var d={};if(c===b.RESULT.SUCCESSFUL){d={SuccessFailureFlag:"S",FailureCode:"N/A"}}else{d={SuccessFailureFlag:"F",FailureCode:"N/A"}}AMA.ReportingManager.reportMRResult("alarm",this._actionId,d)},_startCountdown:function(c){AMA.debug("'"+this._action+"' has started a countdown for "+c+" seconds");this._countdownTimer=setInterval(_.bind(function(){var f=c%60,e=Math.floor(c/60),d;if(c===0){if(this.getState()===a.STATE.SOUNDING){this._afterRetrieveStatus()}else{AMA.debug("'"+this._action+"' countdown timer has expired");this.trigger(b.EVENT.TIMEOUT);this._timedOut=true;this.stop(b.RESULT.TIMEDOUT)}clearInterval(this._countdownTimer);return}d=(e<10?"0":"")+e+":"+(f<10?"0":"")+f;this.trigger(b.EVENT.COUNTDOWN_TICK,{remaining:d});c--},this),1000)}})})();
/*! LocateWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.LocateWorkflow=AMA.workflow.BaseWorkflow.extend();b.STATE=AMA.enums("CONNECTING","REFINING","CANCELLED");b.URL="/actions";b.CONNECT_COUNTDOWN=180;b.ISTIMEOUTCALL=false;var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case b.STATE.REFINING:AMA.debug("'"+this._action+"' is refining");break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");this._doFinalizing();break;default:}},_doInitializing:function(){this._result=a.RESULT.FAILED;var d=this,c={data:{actionType:"gpsrefresh"},callback:_.bind(this._afterRESTRequest,this)};this.reportExecuted=false;this.on(a.EVENT.TIMEOUT,this._onTimeout);this._startCountdown(b.CONNECT_COUNTDOWN);this.sendRequest(c)},_doConnecting:function(){if(this._timedOut){AMA.ReportingManager.remoteLog("Locate Failed.[Status Detail:-failure][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);return}this.breadCrumbShown=false;if(AMA.models.locations.models.length>=1){this.breadCrumbShown=true}var h=this.actionId,d=AMA.config.apiHostUrl+"/locateDeviceEvents/"+h,f=this,e=function(k){if(!f.isPolling){return}if(k.list.length){f._result=a.RESULT.SUCCESSFUL;if(f.getState()!==b.STATE.REFINING&&f.getState()!==a.STATE.INACTIVE){f._doRefining()}else{if(f.getState()===b.STATE.REFINING){var l=parseFloat(AMA.models.locations.models[0].get("accuracy"));var j=parseFloat(k.list[0].precision);if(l>j){f._doRefining()}}}if(k.list[0].status==="success"&&!AMA.Util.isIPhone()){AMA.ReportingManager.remoteLog("Locate Sucessful.[Status Detail:-"+k.list[0].statusDetails||k.list[0].status+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);f.toState(a.STATE.FINALIZING);f._stopCountdown()}else{if(k.list[0].status==="failure"&&AMA.Util.isIPhone()){AMA.ReportingManager.remoteLog("Locate Failed.[Status Detail:-"+k.list[0].statusDetails||k.list[0].status+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);f._result=a.RESULT.FAILED;f.toState(a.STATE.FINALIZING);f._stopCountdown()}}}if(f.getState()===b.STATE.CONNECTING||f.getState()===b.STATE.REFINING){f._pollingTimer=setTimeout(function(){g()},4000)}},c={cache:false,url:d+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,success:_.bind(e,this)},g=function(){if(AMA.Util.useXdr()){var j=AMA.Util.createCORSRequest("GET",c.url);if(j){j.onload=function(){try{var k=JSON.parse(this.responseText)}catch(l){AMA.error("GET /locateDeviceEvents - Locate Workflow - response not JSON: "+this.responseText)}if(k){e(k)}};j.onerror=function(){AMA.error("Request failed: GET /locateDeviceEvents")};j.send()}}else{$.ajax(c)}};this.isPolling=true;g()},sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;this._ajax(c,f,e,d&&d.callback)},cancelLocate:function(){this.stop(a.RESULT.CANCELLED)},_afterRESTRequest:function(c){AMA.debug("received connecting response: "+JSON.stringify(c));if(typeof c.actionId!="undefined"){this.actionId=c.actionId;AMA.ReportingManager.reportMRAttempt("locate",this.actionId);this.toState(b.STATE.CONNECTING)}else{AMA.debug("connection was not successful")}},_ajax:function(d,h,f,j){var g=function(k){if(j){j(k)}};var c={type:"POST",cache:false,url:d+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,data:f,dataType:"json",contentType:"application/json; charset=utf-8",global:false,success:_.bind(g,this)};AMA.debug("Sending AJAX request: "+c.url);if(AMA.Util.useXdr()){var e=AMA.Util.createCORSRequest(c.type,c.url);if(e){e.onload=function(){try{var k=JSON.parse(this.responseText)}catch(l){AMA.error(c.type+" "+d+" - Locate Workflow - response not JSON: "+this.responseText)}if(k){g(k)}};e.onerror=function(){AMA.error("Request failed: "+c.type+" "+d)};e.send(f)}}else{$.ajax(c)}},_startPolling:function(){},_afterRetrieveStatus:function(c){},_doRefining:function(){var d=0,e=this;if(AMA.models.locations.models&&AMA.models.locations.models.length>0){var c=AMA.models.locations.models[0];d=c.get("time");AMA.debug("AMA.workflow.LocationWorkflow - About to retrieve new locations, save the current latest one first.")}AMA.models.locations.fetch({reset:true,silent:true,success:function(g,f){g.trigger("reset");if(e.getState()==b.STATE.CONNECTING){e.toState(b.STATE.REFINING)}},error:function(){AMA.debug("AMA.workflow.LocationWorkflow - Location f")}})},_doFinalizing:function(){if(this._result===a.RESULT.SUCCESSFUL){AMA.models.locations.fetch()}},_afterFinish:function(c){var d={};d.wasBreadCrumbShown=(this.breadCrumbShown)?"1":"0";switch(c){case a.RESULT.SUCCESSFUL:if(AMA.models.locations.isFetching){AMA.models.locations.once("reset",function(){d.SuccessFailureFlag="S";d.FailureCode="N/A";d.AccuracyofFixShown=AMA.models.locations.at(0).get("accuracy");AMA.ReportingManager.reportMRResult("locate",this.actionId,d)})}break;case a.RESULT.CANCELLED:this._stopCountdown();Backbone.globalEvent.trigger("onLocate",{status:"cancelled"});this.toState(a.STATE.FINALIZING);break;default:if(this.reportExecuted==false){d.SuccessFailureFlag="F";d.FailureCode="N/A";d.BreadcrumbAccuracy="N/A";d.BreadcrumbTimestamp="N/A";AMA.ReportingManager.reportMRResult("locate",this.actionId,d)}this.reportExecuted=true;break}},_onTimeout:function(c){if(b.ISTIMEOUTCALL===false&&(this._result===a.EVENT.TIMEOUT||this._result===a.RESULT.FAILED)){var f=function(h){b.ISTIMEOUTCALL=false;AMA.debug("Locate successfully send a timeout call with actionId of "+h.actionId)},e=AMA.config.apiHostUrl+b.URL,d={data:{actionType:"gpsrefreshTimeout",actionId:this.actionId},callback:_.bind(f,this)};var g=d&&d.data&&JSON.stringify(d.data)||null;this._ajax(e,{},g,d&&d.callback);b.ISTIMEOUTCALL=true;this.toState(a.STATE.FINALIZING)}else{if(this._result===a.RESULT.SUCCESSFUL){this.toState(a.STATE.FINALIZING)}}}})})();
/*! LockWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.LockWorkflow=AMA.workflow.BaseWorkflow.extend();b.STATE=AMA.enums("CONNECTING");b.URL="/actions";b.CONNECT_COUNTDOWN=180;var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},_doInitializing:function(){this._result=a.RESULT.FAILED;this.trigger(a.EVENT.COUNTDOWN_TICK,{remaining:"03:00"});this._startCountdown(b.CONNECT_COUNTDOWN);this.toState(b.STATE.CONNECTING)},_doConnecting:function(){var c={data:{actionType:"lock"},callback:_.bind(this._afterSendRequest,this)};this._sendRequest(c)},_sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;AMA.debug("Sending a 'NEW action' request to server for '"+d.data.actionType+"'");this._ajax(c,f,e,d&&d.callback)},_ajax:function(c,g,e,h){var f=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("Sending AJAX request: "+f);var d=AMA.Util.createCORSRequest.call(this,"POST",f);if(d){d.onload=function(){var j=typeof d.response==="undefined"?d.responseText:d.response;h(j)};d.onerror=function(k,j,l){AMA.ActionManager._onAjaxError(k,j,l)};d.send(e)}},_afterSendRequest:function(c){AMA.debug("received connecting response: "+c);c=JSON.parse(c);if(typeof c.actionId!="undefined"){AMA.debug("connecting actionid:"+c.actionId);this._actionId=c.actionId;AMA.ReportingManager.reportMRAttempt("lock",this._actionId);this._startPolling(this._actionId)}else{AMA.debug("connection was not successful")}},_startPolling:function(h){if(this._timedOut){AMA.ReportingManager.remoteLog("Lock Failed.[Status Detail:-LOCKED=OFF][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);return}var f=this;var c=AMA.config.apiHostUrl+"/deviceEvents/"+h;var e=function(k){k=JSON.parse(k);var l=k.list;if(k.total===0){f._pollingTimer=setTimeout(function(){g()},3000);return}if(l[0].status==="success"){var j=l[0].statusDetails.split("=")[1];if(j==="on"){f._result=a.RESULT.SUCCESSFUL;AMA.ReportingManager.remoteLog("Lock Sucessful.[Status Detail:-"+l[0].statusDetails+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);f._afterRetrieveStatus(l[0].actionType)}else{f._pollingTimer=setTimeout(function(){g()},3000)}}else{f._pollingTimer=setTimeout(function(){g()},3000)}};var d=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;var g=function(){var j=AMA.Util.createCORSRequest.call(this,"GET",d);if(j){j.onload=function(){var k=typeof j.response==="undefined"?j.responseText:j.response;e(k)};j.onerror=function(l,k,m){AMA.ActionManager._onAjaxError(l,k,m)};j.send()}};g()},_afterRetrieveStatus:function(c){AMA.debug("_afterRetrieveStatus");this._stopCountdown();AMA.debug("Received ACK for '"+c+"'");this.toState(a.STATE.FINALIZING)},_afterFinish:function(c){var d={};if(c===a.RESULT.SUCCESSFUL){d={SuccessFailureFlag:"S",FailureCode:"N/A"}}else{d={SuccessFailureFlag:"F",FailureCode:"N/A"}}AMA.ReportingManager.reportMRResult("lock",this._actionId,d)}})})();
/*! SyncWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.SyncWorkflow=AMA.workflow.BaseWorkflow.extend();b.URL="/actions";b.STATE=AMA.enums("CONNECTING","SYNCING");b.CONNECT_COUNTDOWN=180;b.CONNECT_INTERVAL=15;var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case b.STATE.SYNCING:AMA.debug("'"+this._action+"' is syncing");break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");this._doFinalizing();break;default:}},stop:function(c){this.toState(a.STATE.INACTIVE);c=c||a.RESULT.SUCCESSFUL;this._stopCountdown();AMA.debug("'"+this._action+"' has finished with result '"+this.getResultName(c)+"'");this.trigger(a.EVENT.FINISHED,{result:c,data:this._resultData})},_doInitializing:function(){this._startCountdown(b.CONNECT_COUNTDOWN);this.syncData={contacts:{},images:{},videos:{}};this._doConnecting()},_doConnecting:function(){var c={data:{actionType:"sync",dataType:this.options.itemsToSync},callback:_.bind(this._afterSendRequest,this)};this.sendRequest(c)},sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f=d&&d.async===false&&{async:false}||{};var e=d&&d.data&&JSON.stringify(d.data)||null;this._ajax(c,"POST",f,e,d&&d.callback)},_ajax:function(e,k,h,f,j){if(AMA.models.capabilities.canCreate("actions")){var c=true;if(h&&h.async===false){c=h.async}var g=function(l){if(j){j(l)}};var d={type:k,cache:false,url:e+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,contentType:"application/json; charset=utf-8",global:false,async:c,error:_.bind(this._onAjaxError,this),success:_.bind(g,this)};if(d.type==="POST"){d.data=f;d.dataType="json"}AMA.debug("Calling REST API:"+k+" - "+d.url);$.ajax(d)}else{AMA.debug("Sync is not supported!")}},_onAjaxError:function(d,c,e){AMA.ActionManager._onAjaxError(d,c,e)},_afterSendRequest:function(c){AMA.debug("Received connecting response: "+JSON.stringify(c));if(c&&typeof c.actionId!="undefined"){AMA.debug("Polling for sync action updates...");this._doPolling(c.actionId)}else{AMA.debug("Connection failed. Attempting to connect again in "+b.CONNECT_INTERVAL+" seconds");this._connectRetry=setTimeout(_.bind(this._doConnecting,this),3000)}},_doPolling:function(h){if(this._timedOut){return}if(AMA.models.capabilities.canRead("syncEvents_actionId")){var d=AMA.config.apiHostUrl+"/syncEvents/"+h,f=this;var e=function(j){if(!j.id){AMA.debug("No sync updates. Checking again in 5 seconds");f._pollingTimer=setTimeout(g,5000)}else{this._afterRetrieveStatus(h,j)}};var c={cache:false,url:d+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,error:_.bind(this._onAjaxError,this),success:_.bind(e,this)};var g=function(){AMA.debug("Calling REST API: GET "+c.url);$.ajax(c)};this._pollingTimer=setTimeout(g,5000)}},_afterRetrieveStatus:function(g,e){var d=this;if(e.list.length==0){AMA.debug("Sync action acknowledged by server, but no update yet. Polling again in 5 sec");this._doPolling(g)}else{var f=e.list[0].status,c=e.list[0].statusDetails==="Sync Successful"?true:false;if(f==="syncing"&&!c){AMA.debug("Sync in progress...");this._resultData=e.list[0];this._retrieveCurrentData();if(this.syncData.updateButtons){this._stopCountdown();this.toState(b.STATE.SYNCING,this.syncData)}this._doPolling(g)}else{if(f==="failed"||f==="failure"){AMA.debug("Sync has failed");this._result=a.RESULT.FAILED;this._resultData=e.list[0];this.toState(a.STATE.FINALIZING)}else{if(c){AMA.debug("Sync has successfully finished");this._result=a.RESULT.SUCCESSFUL;this._resultData=e.list[0];AMA.ReportingManager.remoteLog("Sync Successful [type:-"+this._action+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"][time remaining:-"+this._timeRemaining+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);this.toState(a.STATE.FINALIZING)}}}}},_stopCountdown:function(){AMA.debug("'"+this._action+"' has stopped the countdown");clearInterval(this._countdownTimer);clearTimeout(this._connectRetry)},_retrieveCurrentData:function(){var c=AMA.config.apiHostUrl+"/syncStatusEntries";this._ajax(c,"GET",null,null,_.bind(this._afterFetchSyncSessionInfo,this))},_afterFetchSyncSessionInfo:function(g){if(typeof g!=="object"){g=JSON.parse(g)}var d=this;var h=g.sourceCompleted||{};var c=g.sourcePending||{};var l=false;var k=false;var f=$.isEmptyObject(g);var m={};var j=function(s,p){var n={countTotal:0,completedCount:0,pendingCount:0,syncStatus:"",startNextSync:p};var r=_.where(h,{id:s});var q=_.where(c,{id:s});_.each(r[0],function(u,t){if(t==="id"){return}n.completedCount+=u});_.each(q[0],function(u,t){if(t==="id"){return}n.pendingCount+=u});n.countTotal=n.completedCount+n.pendingCount;if(!n.startNextSync&&n.countTotal&&n.countTotal===n.pendingCount){n.syncStatus="pending"}else{if(n.countTotal){n.syncStatus="syncing"}else{if(f){n.syncStatus="waiting_to_sync"}else{n.syncStatus="no_change"}}}if(n.countTotal){l=true;if(n.completedCount===n.countTotal){n.startNextSync=true}}return n};var e={contacts:"contact",pictures:"image",videos:"video"};_.each(e,function(p,n){if(d.options.itemsToSync.indexOf(n)>=0){m=j(AMA.config.recordTypeIds[p],k);p+="s";d.syncData[p].completed=m.completedCount;d.syncData[p].pending=m.pendingCount;d.syncData[p].total=m.countTotal;d.syncData[p].status=m.syncStatus;k=m.startNextSync}});k=false;if(!l){if(d.options.itemsToSync.indexOf("contacts")!==-1){d.syncData.contacts.status="syncing";if(d.options.itemsToSync.indexOf("pictures")!==-1){d.syncData.images.status="waiting_to_sync"}if(d.options.itemsToSync.indexOf("videos")!==-1){d.syncData.videos.status="waiting_to_sync"}}}d.syncData.itemsBeingSynced=d.options.itemsToSync;d.syncData.updateButtons=true},_doFinalizing:function(){AMA.debug("Invalidating contacts, photos, and videos data");AMA.models.contacts.invalidate();AMA.models.photos.invalidate();AMA.models.videos.invalidate()},_afterFinish:function(c){var d={};d.Type="sync";if(this.getResultName(c)!==a.RESULT.SUCCESSFUL){d.Result="Failed";d.Reason=this.getResultName(c)}else{d.Result="Success"}AMA.ReportingManager.reportSyncEvent(AMA.config.reportingEventTypes.webSyncResult,d)}})})();
/*! WipeWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.WipeWorkflow=AMA.workflow.BaseWorkflow.extend();b.URL="/actions";b.STATE=AMA.enums("CONNECTING","SYNCING","ERASING");b.CONNECT_COUNTDOWN=300;b.CONNECT_INTERVAL=15;b.RESULT=AMA.enums("FACTORY_RESET_SUCCESSFUL");var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting(this._action);break;case b.STATE.SYNCING:AMA.debug("'"+this._action+"' is syncing");break;case b.STATE.ERASING:AMA.debug("'"+this._action+"' is erasing");break;case b.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},stop:function(c){this.toState(a.STATE.INACTIVE);c=c||a.RESULT.SUCCESSFUL;if(c!==a.RESULT.SUCCESSFUL){this._stopCountdown()}AMA.debug("'"+this._action+"' has finished with result '"+this.getResultName(c)+"'");this._afterFinish(c);this.trigger(a.EVENT.FINISHED,{result:c,data:this._resultData})},toState:function(d){this._state=d;this.trigger(a.EVENT.STATE_CHANGED,{state:d,data:this._resultData});AMA.debug("'"+this._action+"' changed state to '"+this.getStateName(d)+"'");this._onStateChange(d);if(d===a.STATE.FINALIZING){if(this._action.indexOf("wipefactoryonly")>-1){var c=b.RESULT.FACTORY_RESET_SUCCESSFUL||this._result}else{var c=this._result||a.RESULT.SUCCESSFUL}this.stop(c)}},_doInitializing:function(){this._startCountdown(b.CONNECT_COUNTDOWN);this.toState(b.STATE.CONNECTING)},_doConnecting:function(){var c={data:{actionType:this._action},callback:_.bind(this._afterSendRequest,this)};this.sendRequest(c)},sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;this._ajax(c,f,e,d&&d.callback)},_ajax:function(d,h,f,j){if(AMA.models.capabilities.canCreate("actions")){var g=function(k){if(j){j(k)}};var c={type:"POST",cache:false,url:d+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,data:f,dataType:"json",contentType:"application/json; charset=utf-8",global:false,error:_.bind(this._onAjaxError,this),success:_.bind(g,this)};AMA.debug("Sending AJAX request: "+c.url);if(AMA.Util.useXdr()){var e=AMA.Util.createCORSRequest(c.type,c.url);if(e){e.onload=function(){try{var k=JSON.parse(this.responseText)}catch(l){AMA.error(c.type+" "+d+" - Wipe Workflow - response not JSON: "+this.responseText)}if(k){g(k)}};e.onerror=function(){AMA.error("Request failed: "+c.type+" "+d)};e.send(f)}}else{$.ajax(c)}}},_onAjaxError:function(d,c,e){AMA.ActionManager._onAjaxError(d,c,e)},_afterSendRequest:function(d){var c=this;AMA.debug("Received connecting response: "+JSON.stringify(d));if(d&&typeof d.actionId!="undefined"){this._actionId=d.actionId;AMA.ReportingManager.reportMRAttempt("wipe",this._actionId);this._doPolling(this._actionId)}else{AMA.debug("Connection failed. Attempting to connect again in "+b.CONNECT_INTERVAL+" seconds");this._connectRetry=setTimeout(_.bind(this._doConnecting,this),b.CONNECT_INTERVAL*1000)}},_doPolling:function(j){if(this._timedOut){return}var c=this,f=null,e=AMA.config.apiHostUrl+"/deviceEvents/"+j;if(AMA.models.capabilities.canRead("deviceEvents_actionId")){var e=AMA.config.apiHostUrl+"/deviceEvents/"+j;var g=function(k){if(!k.id){c._pollingTimer=setTimeout(function(){h()},5000)}else{c._afterRetrieveStatus(k)}};var d={cache:false,url:e+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,data:{actionType:(this._action==="wipe")?"wipeData":"factoryReset"},error:_.bind(this._onAjaxError,this),success:_.bind(g,this)};var h=function(){if(AMA.Util.useXdr()){var k=AMA.Util.createCORSRequest("GET",d.url);if(k){k.onload=function(){try{var l=JSON.parse(this.responseText)}catch(m){AMA.error("GET "+e+" - Wipe Workflow - response not JSON: "+this.responseText)}if(l){g(l)}};k.onerror=function(){AMA.error("Request failed: GET "+e)};setTimeout(function(){k.send(JSON.stringify(d.data))},0)}}else{$.ajax(d)}};this._pollingTimer=setTimeout(h,2000)}},_afterRetrieveStatus:function(d){var c=this;if(d.total==0){this._doPolling(this._actionId)}else{var e=d.list[0].actionType,f=d.list[0].status,g=d.list[0].statusDetails;if((e==="wipe"&&f==="success")||(e==="wipefactoryonly"&&f==="success"&&g==="wipefactory=on")){this._result=a.RESULT.SUCCESSFUL;this._resultData=d.list[0].statusDetails;AMA.ReportingManager.remoteLog("Wipe Successful.[Status Detail:-"+g+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);if(e==="wipefactoryonly"){AMA.ActionManager.stopRoutinePolling();AMA.ActionManager.clearAutoInvalidateData()}this.toState(a.STATE.FINALIZING)}else{if(e==="wipe"&&(f.indexOf("fail")>-1)){this._result=a.RESULT.FAILED;AMA.ReportingManager.remoteLog("Wipe Failed.[Status Detail:-"+g+"[accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);this.toState(a.STATE.FINALIZING)}else{if(e==="wipe"&&f==="ongoing"){if(!g){if(this.state!=b.STATE.SYNCING){this.toState(b.STATE.SYNCING);if(this._action==="wipe"||this._action==="wipeonly"){AMA.models.locksettings.invalidate()}this._stopCountdown()}}else{if(this.state!=b.STATE.ERASING){this.toState(b.STATE.ERASING)}this._resultData=d.list[0].statusDetails;this.trigger(b.STATE.ERASING,{data:this._resultData})}this._doPolling(this._actionId)}else{this._doPolling(this._actionId)}}}}},_stopCountdown:function(){AMA.debug("'"+this._action+"' has stopped the countdown");clearInterval(this._countdownTimer);clearTimeout(this._connectRetry)},_afterFinish:function(c){var d={};if(c===a.RESULT.SUCCESSFUL){d={SuccessFailureFlag:"S",FailureCode:"N/A"}}else{if(c===b.RESULT.FACTORY_RESET_SUCCESSFUL){d={SuccessFailureFlag:"S",FailureCode:"N/A"}}else{d={SuccessFailureFlag:"F",FailureCode:"N/A"}}}if(this._action!=="wipefactoryonly"){AMA.ReportingManager.reportMRResult("lock",this._actionId,d)}AMA.ReportingManager.reportMRResult("wipe",this._actionId,d)}})})();
/*! DiagnosticScanWorkflow */
(function(){AMA.namespace("workflow");var c=AMA.workflow.DiagnosticScanWorkflow=AMA.workflow.BaseWorkflow.extend();var a;c.STATE=AMA.enums("CONNECTING","SCANNING");c.URL="/appRemediationEvents";c.CONNECT_COUNTDOWN=300;var b=AMA.workflow.BaseWorkflow;_.extend(c.prototype,{_onStateChange:function(d){switch(d){case b.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");$(".diagnostic_toolset_countdown.countdown_amount").html("5:00");this._doInitializing();break;case c.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case c.STATE.SCANNING:AMA.debug("'"+this._action+"' is scanning");break;case b.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:AMA.debug("DiagnosticScanWorkflow default state.");break}},_doInitializing:function(){this._startCountdown(c.CONNECT_COUNTDOWN);this._doConnecting()},_doConnecting:function(){var d={data:{actionType:"scanHealthStart"},callback:_.bind(this._afterSendRequest,this)};this.sendRequest(d)},_afterSendRequest:function(d){AMA.debug("received connecting response: "+JSON.stringify(d));d=JSON.parse(d);if(typeof d.actionId!="undefined"){this._doPolling(d.actionId)}else{AMA.debug("connection was not successful")}},_doPolling:function(g){if(this._timedOut){return}var d=this;d.actionId=g;var e=function(h){if(h.total){var j=h.list[0].progress;if(j==="snapshot"){d.toState(c.STATE.SCANNING)}else{if(j==="finished"){AMA.models.diagnosticScanResourceData.healthScanDate=h.list[0].eventTime;d._afterRetrieveStatus();return}}}setTimeout(function(){d._doPolling(d.actionId)},3000)};var f=function(){var j=AMA.config.apiHostUrl+"/appHealthScanEvents/"+g+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,h=AMA.Util.createCORSRequest("GET",j);if(h){h.onload=function(){try{var l=JSON.parse(this.responseText);e(l)}catch(k){AMA.error("GET /appHealthScanEvents - Diagnostic Scan Workflow - response not JSON: "+this.responseText)}};h.onerror=function(l,k,m){AMA.ActionManager._onAjaxError(l,k,m)};h.send()}};f()},_afterRetrieveStatus:function(){AMA.models.diagnosticScanResourceData.invalidate();AMA.models.diagnosticScanAppsData.invalidate();this._stopCountdown();this.toState(b.STATE.FINALIZING)},sendRequest:function(e){var d=AMA.config.apiHostUrl+c.URL,g={};var f=e&&e.data&&JSON.stringify(e.data)||null;this._ajax(d,g,f,e&&e.callback)},_ajax:function(d,h,f,j){var g=d+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("Sending Diagnostic Scan AJAX request: "+g);var e=AMA.Util.createCORSRequest.call(this,"POST",g);if(e){e.onload=function(){var k=typeof e.response==="undefined"?e.responseText:e.response;j(k)};e.onerror=function(l,k,m){AMA.ActionManager._onAjaxError(l,k,m)};e.send(f)}},_onAjaxError:function(e,d,f){AMA.ActionManager._onAjaxError(e,d,f)}})})();
/*! ScanWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.ScanWorkflow=AMA.workflow.BaseWorkflow.extend();b.STATE=AMA.enums("CONNECTING","SCANNING");b.URL="/actions";b.CONNECT_COUNTDOWN=180;var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("'"+this._action+"' is connecting");this._doConnecting();break;case b.STATE.SCANNING:AMA.debug("'"+this._action+"' is scanning");break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},_doInitializing:function(){this._startCountdown(b.CONNECT_COUNTDOWN);this.toState(b.STATE.CONNECTING)},_doConnecting:function(){var c={data:{actionType:"startScan"},callback:_.bind(this._afterSendRequest,this)};this._sendRequest(c)},_sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;AMA.debug("Sending a create action request to server for '"+d.data.actionType+"'");this._ajax(c,f,e,d&&d.callback)},_ajax:function(c,g,e,h){var f=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("Sending AJAX request: "+f);var d=AMA.Util.createCORSRequest.call(this,"POST",f);if(d){d.onload=function(){var j=typeof d.response==="undefined"?d.responseText:d.response;h(j)};d.onerror=function(k,j,l){AMA.ActionManager._onAjaxError(k,j,l)};d.send(e)}},_afterSendRequest:function(c){AMA.debug("received connecting response: "+c);c=JSON.parse(c);if(typeof c.actionId!="undefined"){AMA.debug("connecting actionid:"+c.actionId);this._startPolling(c.actionId)}else{AMA.debug("connection was not successful")}},_startPolling:function(h){if(this._timedOut){return}var f=this;var c=AMA.config.apiHostUrl+"/appInfectionScanResults?actionId="+h;var e=function(j){j=JSON.parse(j);if(j.originTime){f._stopCountdown();if(j&&j.sdCardScan==true){f._afterRetrieveStatus()}else{f.toState(b.STATE.SCANNING);f._pollingTimer=setTimeout(function(){g()},3000)}}else{if(!this._timedOut){f._pollingTimer=setTimeout(function(){g()},3000)}}};var d=c+"&devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;var g=function(){var j=AMA.Util.createCORSRequest.call(this,"GET",d);if(j){j.onload=function(){var k=typeof j.response==="undefined"?j.responseText:j.response;e(k)};j.onerror=function(l,k,m){AMA.ActionManager._onAjaxError(l,k,m)};j.send()}};AMA.ActionManager.stopRoutinePolling();g()},_afterRetrieveStatus:function(c){AMA.debug("_afterRetrieveStatus");AMA.debug("Received ACK for '"+c+"'");this.toState(a.STATE.FINALIZING);AMA.models.threats.invalidate()}})})();
/*! SecurePhoneWorkflow */
(function(){AMA.namespace("workflow");var b=AMA.workflow.SecurePhoneWorkflow=AMA.workflow.BaseWorkflow.extend();b.STATE=AMA.enums("CONNECTING","ANNOUNCE_DISPLAYED","CONTACTS_ERASED","REFINING","RETRYING");b.URL="/actions";b.CONNECT_COUNTDOWN=240;var a=AMA.workflow.BaseWorkflow;_.extend(b.prototype,{_onStateChange:function(c){switch(c){case a.STATE.INITIALIZING:AMA.debug("'"+this._action+"' is initializing");this._doInitializing();break;case b.STATE.CONNECTING:AMA.debug("SecurePhone command sent");this._doConnecting(this._action);break;case b.STATE.ANNOUNCE_DISPLAYED:AMA.debug("Announce message has been viewed on the device by the user");break;case b.STATE.CONTACTS_ERASED:AMA.debug("Contacts successfully erased");AMA.models.contacts.fetch();break;case b.STATE.REFINING:AMA.debug("Location updated");break;case b.STATE.RETRYING:AMA.debug("SecurePhone command sent - retry");break;case a.STATE.FINALIZING:AMA.debug("'"+this._action+"' is finalizing");break;default:}},toState:function(d){this._state=d;this.trigger(a.EVENT.STATE_CHANGED,{state:d,contactsErased:this._contactsErased,retryInformation:this._retryInformation,locateSuccess:this._locateSuccess,announceSuccess:this._announceSuccess,wipeSuccess:this._wipeContactsSuccess});AMA.debug("'"+this._action+"' changed state to '"+this.getStateName(d)+"'");this._onStateChange(d);if(d===a.STATE.FINALIZING){var c=this._result||a.RESULT.SUCCESSFUL;this.stop(c)}},_startCountdown:function(c){AMA.debug("'"+this._action+"' has started a countdown for "+c+" seconds");this._countdownTimer=setInterval(_.bind(function(){var g=c%60,e=Math.floor(c/60),d;if(c===0){AMA.debug("'"+this._action+"' countdown timer has expired");this.trigger(a.EVENT.TIMEOUT);this._timedOut=true;clearInterval(this._countdownTimer);this.stop(a.RESULT.TIMEDOUT);var f=this._locateSuccess||(this._announceSuccess&&this._performAnnounce)||(this._wipeContactsSuccess&&this._performErase);this._result=f?a.RESULT.SUCCESSFUL:a.RESULT.FAILED;this.toState(a.STATE.FINALIZING);return}else{if(c===10){this._isOkayToRetry=true}}d=(e<10?"0":"")+e+":"+(g<10?"0":"")+g;this.trigger(a.EVENT.COUNTDOWN_TICK,{remaining:d});c--},this),1000)},_doInitializing:function(){this.actionsString=this.options.actionsString||"gpsrefresh";this._performAnnounce=this.options.performAnnounce||false;this._announceMessage=this.options.announceMessage||null;this._performErase=this.options.performErase||false;this._contactsErased="";this._wipeContactsSuccess=!this._performErase;this._announceSuccess=!this._performAnnounce;this._locateSuccess=false;this._isOkayToRetry=false;this._retryInformation="";this._locationHistory=AMA.models.locations.toJSON();this._startCountdown(b.CONNECT_COUNTDOWN);this.toState(b.STATE.CONNECTING)},_doConnecting:function(){var c={data:{actionType:"securePhone",actionCmd:this.actionsString,text:this._announceMessage},callback:_.bind(this._afterSendRequest,this)};this._sendRequest(c)},_sendRequest:function(d){var c=AMA.config.apiHostUrl+b.URL,f={};var e=d&&d.data&&JSON.stringify(d.data)||null;AMA.debug("Sending a create action request to server for '"+d.data.actionType+"'");this._ajax(c,"POST",f,e,d&&d.callback)},_ajax:function(c,j,f,h,l,k){var d=this;var e=c+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken;AMA.debug("Sending AJAX request: "+e);var g=AMA.Util.createCORSRequest.call(this,j,e);if(g){g.onerror=function(n,m,p){AMA.ActionManager._onAjaxError(n,m,p)};g.onreadystatechange=function(){if(g.readyState==4&&g.status===200){var m=typeof g.response==="undefined"?g.responseText:g.response;l(m)}else{AMA.debug("AJAX Request to "+c+" returns "+g.status);if(typeof k==="function"){l("error")}}};g.send(h)}},_afterSendRequest:function(c){if(this._timedOut){return}if(!c){AMA.error("Secure Phone: Connection unsuccessful. No response data received.");return}c=JSON.parse(c);if(c.gpsrefresh){AMA.debug("Secure Phone: Received action ID for locate: "+c.gpsrefresh);this._gpsrefreshId=c.gpsrefresh;AMA.ReportingManager.reportMRAttempt("locate",this._gpsrefreshId)}else{if(c.announce||c.wipe){AMA.error("Secure Phone: No action ID received for locate but actionId is received for announce/wipe.");this._result=a.RESULT.FAILED;this.toState(a.STATE.FINALIZING);return}else{AMA.error("Secure Phone: No action ID received for locate.");this._doConnecting();return}}if(this._performAnnounce&&c.announce){AMA.debug("Secure Phone: Received action ID for announce: "+c.announce);this._announceId=c.announce;AMA.ReportingManager.reportMRAttempt("announce",this._announceId)}else{if(this._performAnnounce&&!c.announce){AMA.error("Secure Phone: No action ID received for announce. Secure phone will not be performed.");this._result=a.RESULT.FAILED;this.toState(a.STATE.FINALIZING);return}}if(this._performErase&&c.wipe){AMA.debug("Secure Phone: Received action ID for wipe: "+c.wipe);this._wipeId=c.wipe;AMA.ReportingManager.reportMRAttempt("wipe",this._wipeId)}else{if(this._performErase&&!c.wipe){AMA.error("Secure Phone: No action ID received for wipe. Secure phone will not be performed.");this._result=a.RESULT.FAILED;this.toState(a.STATE.FINALIZING);return}}this._startPolling()},_startPolling:function(){var c="";AMA.ActionManager.stopRoutinePolling();if(!this._locateSuccess){this._locateIsPolling=true;c=AMA.config.apiHostUrl+"/locateDeviceEvents/"+this._gpsrefreshId;this._pollActionResult(c,this._afterRetrieveLocateStatus)}if(!this._announceSuccess){this._announceIsPolling=true;c=AMA.config.apiHostUrl+"/securePhoneEvents/"+this._announceId;this._pollActionResult(c,this._afterRetrieveAnnounceStatus)}if(!this._wipeContactsSuccess){this._wipeIsPolling=true;c=AMA.config.apiHostUrl+"/securePhoneEvents/"+this._wipeId;this._pollActionResult(c,this._afterRetrieveWipeStatus)}},_pollActionResult:function(d,g){var f=this;var e=function(h){if(f._timedOut){if(f._locateIsPolling&&f._announceIsPolling&&f._wipeIsPolling){AMA.debug("Failed getting any of the poll results before timeout.");f._stopCountdown();f._result=a.RESULT.FAILED;f.toState(a.STATE.FINALIZING)}AMA.debug("The following polls are stopped: "+(f._locateIsPolling?"gpsrefresh":"")+", "+(f._announceIsPolling?"announce":"")+", "+(f._wipeIsPolling?"wipe":""));return}if(typeof h!=="object"){h=JSON.parse(h)}if(h&&typeof g==="function"){g.call(f,h)}else{f._pollingTimer=setTimeout(function(){c()},3000)}};var c=function(){f._ajax(d,"GET",{},{},e)};c()},_postMRResult:function(e,f,c){var d={};d.SuccessFailureFlag=c;d.FailureCode="N/A";AMA.ReportingManager.reportMRResult(e,f,d)},_afterRetrieveLocateStatus:function(c){var e=this,d="";this._locateIsPolling=false;if(c==="error"){AMA.ReportingManager.remoteLog("Locate Failed.[Status Detail:-"+list[0].statusDetails||list[0].status+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);this._locateSuccess=false;_postMRResult("locate",e._gpsrefreshId,"F")}else{if(c.list&&c.list.length&&c.list[0].statusDetails==="gps=on"){AMA.debug("Secure Phone: Server returned a response for locate");if(this.getState()!==b.STATE.REFINING&&this.getState()!==a.STATE.INACTIVE){this._doRefining()}if(c.list[0].status==="failure"&&AMA.Util.isIPhone()){AMA.ReportingManager.remoteLog("Locate Failed.[Status Detail:-"+list[0].statusDetails||list[0].status+"][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountId+"]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);_postMRResult("locate",e._gpsrefreshId,"F")}}}this._validatePollStatus()},_doRefining:function(){var c=0;var d=this;AMA.models.locations.fetch({reset:true,silent:true,success:function(j,h){var f=false;var e=false;var g=false;if(!d._locationHistory[0]&&h.list.length){f=true;e=true}else{if(h.list[0].eventTime>d._locationHistory[0].eventTime){f=true}else{if(h.list[0].precision<d._locationHistory[0].precision){e=true}}}if(e||f){j.trigger("reset");AMA.debug("CURRENT STATE AS OF FETCH COMPLETE!"+d.getStateName(d.getState()));if(d.getState()===a.STATE.FINALIZING||d.getState()===b.STATE.REFINING||d.getState()===a.STATE.INACTIVE){g=true}if(!g){d.toState(b.STATE.REFINING)}d._locateSuccess=true}},error:function(){AMA.debug("AMA.workflow.LocationWorkflow - Fetching locations failed")}})},_afterRetrieveAnnounceStatus:function(c){var e=this;var d="";this._announceIsPolling=false;if(c==="error"){this._announceSuccess=false;_postMRResult("announce",e._announceId,"F")}else{if(c.list&&c.list.length&&c.list[0].statusDetails==="announce=displayed"){AMA.debug("Secure Phone: Server returned a response for announce");this._announceSuccess=true;e.toState(b.STATE.ANNOUNCE_DISPLAYED);_postMRResult("announce",e._announceId,"S")}}this._validatePollStatus()},_afterRetrieveWipeStatus:function(c){var e=this;var d="";this._wipeIsPolling=false;if(c==="error"){this._wipeContactsSuccess=false;_postMRResult("wipe",e._wipeId,"F")}else{if(c.list&&c.list.length&&c.list[0].statusDetails==="contacts=0/0"){AMA.debug("Secure Phone: Server returned a response for wipe");this._wipeContactsSuccess=true;e.toState(b.STATE.CONTACTS_ERASED);_postMRResult("wipe",e._wipeId,"S")}}this._validatePollStatus()},_validatePollStatus:function(){var c=this;if(this._locateSuccess&&this._announceSuccess&&this._wipeContactsSuccess){this._stopCountdown();this._result=a.RESULT.SUCCESSFUL;this.toState(a.STATE.FINALIZING);_postMRResult("locate",this._gpsrefreshId,"S")}else{if(!this._isOkayToRetry){if(!this._locateSuccess&&!this._locateIsPolling){this._locateIsPolling=true;this._pollingTimer=setTimeout(function(){c._pollActionResult(AMA.config.apiHostUrl+"/locateDeviceEvents/"+c._gpsrefreshId,c._afterRetrieveLocateStatus)},3000)}if(this._performAnnounce&&!this._announceSuccess&&!this._announceIsPolling){this._announceIsPolling=true;this._pollingTimer=setTimeout(function(){c._pollActionResult(AMA.config.apiHostUrl+"/securePhoneEvents/"+c._announceId,c._afterRetrieveAnnounceStatus)},3000)}if(this._performErase&&!this._wipeContactsSuccess&&!this._wipeIsPolling){this._wipeIsPolling=true;this._pollingTimer=setTimeout(function(){c._pollActionResult(AMA.config.apiHostUrl+"/securePhoneEvents/"+c._wipeId,c._afterRetrieveWipeStatus)},3000)}}else{this._checkNotificationRetryStatus()}}},_checkNotificationRetryStatus:function(){var c=AMA.config.apiHostUrl+"/notificationRetryStatus";AMA.debug("Sending a 'notificationRetryStatus' request to server for '"+this._action+"'");this._ajax(c,"GET",null,null,_.bind(this._afterCheckingRetryStatus,this))},_afterCheckingRetryStatus:function(c){if(typeof c!=="object"){c=JSON.parse(c)}if(parseInt(c.retryAttempt)<parseInt(c.retryTotal)&&!this._timedOut){this._retryInformation=c;this._doRetrying()}else{var d=this._locateSuccess||(this._announceSuccess&&this._performAnnounce)||(this._wipeContactsSuccess&&this._performErase);this._result=d?a.RESULT.SUCCESSFUL:a.RESULT.FAILED;this.toState(a.STATE.FINALIZING)}},_doRetrying:function(){this._stopCountdown();this.toState(b.STATE.RETRYING);this._isOkayToRetry=false;this._startCountdown(parseInt(this._retryInformation.retryTimeRemaining));this._startPolling()},_afterRetrieveStatus:function(){}})})();
/*! ActionManager */
(function(){AMA.ActionManager=function(){var j={};var c=AMA.workflow.BaseWorkflow;var e={};var k=null;var b=null;var a=0;var h=[];var d=function(l){return true};var g=function(l){return j[l]!=null};var f=function(l){if(j[l].getState()!=AMA.workflow.LocateWorkflow.STATE.CANCELLED&&j[l].getState()!=c.STATE.INACTIVE){return true}else{return false}};return{EVENT:AMA.enums("ACTION_STARTED","ACTION_FINISHED","DATA_DIRTY","REQUEST_FAILED","CONNECTION_ERROR"),ACTION_POLLING_INTERVAL:4000,BACKGROUND_UPDATE_INTERVAL:15000,define:function(l,m){AMA.assert(l&&m&&d(m),"[ActionManager.define] Action name and workflow are required");if(g(l)){AMA.warning("Action '"+l+"' is already defined; redefinition will be ignored")}m._action=l;m.on(c.EVENT.FINISHED,function(n){this.trigger(this.EVENT.ACTION_FINISHED,{action:l,result:n.result});AMA.debug("ActionManager has detected that action '"+l+"' has finished")},this);j[l]=m},getWorkflow:function(l){AMA.assert(g(l),"[ActionManager.getWorkflow] '"+l+"' is not a recognized action");return j[l]},start:function(m,l){AMA.assert(g(m),"[ActionManager.start] '"+m+"' is not a recognized action");if(f(m)){AMA.debug("Action '"+m+"' was requested but is already ongoing");return false}this.trigger(this.EVENT.ACTION_STARTED,{action:m,options:l});AMA.debug("ActionManager is starting the '"+m+"' action");j[m].start(l);return true},cancel:function(l){},getState:function(l){AMA.assert(g(l),"[ActionManager.getState] '"+l+"' is not a recognized action.");return j[l].getState()},startBackgroundUpdate:function(){AMA.debug("Background update has started");if(!b){b=new AMA.model.EndpointHistory();b.url=AMA.config.apiHostUrl+"/"+AMA.model.EndpointHistory.RESOURCE+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken,limit:1});b.parse=AMA.model.BaseData.prototype.parse;o=this;b.on(AMA.model.BaseData.EVENT.LOADED,function(){var l=b.at(0),m=l&&parseInt(l.get("eventTime"))||0;if(m>a){AMA.debug("Latest activity timestamp: "+new Date(m));a=m;o.stopBackgroundUpdate();AMA.debug("Invalidating and re-fetching all 'auto-invalidate' data");_.each(h,function(n){n.invalidate()});o.startBackgroundUpdate()}})}this._doBackgroundUpdate()},_doBackgroundUpdate:function(){AMA.debug("Checking for server updates...");b.fetch();clearTimeout(k);k=setTimeout(_.bind(this._doBackgroundUpdate,this),this.BACKGROUND_UPDATE_INTERVAL)},stopBackgroundUpdate:function(){clearTimeout(k);AMA.debug("Background update has stopped")},autoInvalidate:function(l){AMA.assert(l.invalidate,"[ActionManager.autoInvalidate] Data passed is not a valid BaseData-derived object");h.push(l)},clearAutoInvalidateData:function(){h=[]},_onAjaxError:function(m,l,n){AMA.debug("Ajax request error: "+l+" [Error thrown: "+n+", status: "+m.status+", statusText: '"+m.statusText+"', responseText: '"+m.responseText+"'");if(l=="error"&&m.status=="0"){AMA.error("Could not reach the server")}else{if(l=="abort"&&m.status=="0"){AMA.warning("Duplicate request made, aborted first one")}else{AMA.error("An error occurred while communicating with the server")}}this.trigger(this.EVENT.CONNECTION_ERROR,{error:l,errorThrown:n,status:m.status,statusText:m.statusText,responseText:m.responseText})}}}();_.extend(AMA.ActionManager,{startRoutinePolling:AMA.ActionManager.startBackgroundUpdate,stopRoutinePolling:AMA.ActionManager.stopBackgroundUpdate});_.extend(AMA.ActionManager,Backbone.Events)})();
/*! SecurityTab */
(function(){AMA.namespace("view");var a=AMA.view.SecurityTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="security_tab_template";a.TEMPLATE_SRC="security.tpl";a.TOOLBAR={DEFAULT:["endpoint","scan"],IPHONE:["endpoint","scan"]};AMA.augment(a.prototype,{render:function(){a.__super__.render.apply(this);this.lastScan=new AMA.view.ThreatProtectionView({el:"#threat_scan",parent:this,data:AMA.models.threats});this.scanSettings=new AMA.view.ScanSettingsView({el:"#security_settings",parent:this,data:AMA.models.scansettings});this.threatHistory=new AMA.view.ThreatHistoryListView({el:"#security_threats",parent:this,data:AMA.models.threats});this.safeBrowsingTab=new AMA.view.SafeBrowsingView({el:"#safe_browsing",parent:this,data:AMA.models.safeBrowsing})},events:{"click #security_activities_view_more":"viewMoreThreats"},viewMoreThreats:function(b){b.preventDefault();AMA.view.ThreatHistoryListView.MAX_ITEM_LIMIT+=5;this.threatHistory.render();if(AMA.view.ThreatHistoryListView.MAX_ITEM_LIMIT>=AMA.models.threats.length){$(b.currentTarget).hide()}}})})();
/*! ScanSettingsView */
(function(){AMA.namespace("view");var a=AMA.view.ScanSettingsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="scan_settings_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{_processData:function(c,b){c.css={};if(c.autoThreatScanFrequency==="NEVER"){c.css.autoThreatScanEnabledOn="hide";c.css.autoThreatScanEnabledOff="show"}else{c.css.autoThreatScanEnabledOn="show";c.css.autoThreatScanEnabledOff="hide"}if(c.realTimeScanEnabled){c.css.realTimeScanEnabledOn="show";c.css.realTimeScanEnabledOff="hide"}else{c.css.realTimeScanEnabledOn="hide";c.css.realTimeScanEnabledOff="show"}if(c.mediaScanEnabled){c.css.mediaScanEnabledOn="show";c.css.mediaScanEnabledOff="hide"}else{c.css.mediaScanEnabledOn="hide";c.css.mediaScanEnabledOff="show"}if(c.trayNotificationEnabled){c.css.trayNotificationEnabledOn="show";c.css.trayNotificationEnabledOff="hide"}else{c.css.trayNotificationEnabledOn="hide";c.css.trayNotificationEnabledOff="show"}return c},events:{"click #edit_security_settings":"editSecuritySettings"},editSecuritySettings:function(){AMA.page.openSettings("security")}})})();
/*! THreatProtectionView */
(function(){AMA.namespace("view");var a=AMA.view.ThreatProtectionView=AMA.view.BaseView.extend();a.TEMPLATE_ID="threat_protection_template";a.TEMPLATE_SRC="";a.POLLER="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);if(!a.POLLER){a.POLLER=setInterval(function(){AMA.models.threats.invalidate()},30000)}},_processData:function(d,c){var b=this.data.attributes;d.appClass=b.appScan?"":"hidden";d.fileClass=b.sdCardScan?"":"hidden";d.elId=this.$el.attr("id")+"_list";d.fileScanTotal=b.fileScanTotal;d.appScanTotal=b.appScanTotal;d.fileInfectedTotal=b.fileInfectedTotal+b.appInfectedTotal;d.lastScanDate=b.eventTime?AMA.Util.formatDateAndTime(new Date(b.eventTime),AMA.config.dateAndTimeFormat):"Never";return d},events:{"click .scan_for_threats":"scan"},scan:function(){AMA.ActionManager.start("scan")},_setupEvents:function(){}})})();
/*! ThreatHistoryListView */
(function(){AMA.namespace("view");var a=AMA.view.ThreatHistoryListView=AMA.view.ListView.extend();a.TEMPLATE_ID="threat_history_item_template";a.CSS={ITEM:"item"};a.TEMPLATE_SRC="";a.MAX_ITEM_LIMIT=5;AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.call(this);this.on(AMA.view.ListView.EVENT.LIST_EMPTIED,function(){var b=_.template("empty_threat_history_item_template");this.$el.html(b)})},render:function(){a.__super__.render.call(this);var b=this.$el.siblings("#security_activities_view_more");b.hide();if(this.data.length>5){b.show()}},_processData:function(c,b){c.elId=this.$el.attr("id")+"_item_"+b;c.datetimeDetected=AMA.Util.formatDateAndTime(c.timestamp,AMA.config.dateAndTimeFormat);c.fileInfectedTotal=c.fileInfectedTotal+c.appInfectedTotal;return c},_applyFilters:function(){a.__super__._applyFilters.apply(this,arguments);this._dataset=this._dataset.slice(0,a.MAX_ITEM_LIMIT)}})})();
/*! AppAssisttab */
(function(){AMA.namespace("view");var a=AMA.view.AppAssistTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="privacy_template";a.TEMPLATE_SRC="appassist.tpl";a.TOOLBAR={DEFAULT:["endpoint","AppAssist"]};AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.on(AMA.view.BaseView.EVENT.DATA_LOADED,function(){this.data.sortByKey("name","asc")})},events:{"click #app_assist_go":"search"},_processData:function(b){if(!this.data.attributes.total){this.data.attributes.total=this.data.length}return this.data.attributes},_setupEvents:function(){var b=this;$(this.$el).find("#privacy_sort").on("change",function(){var d=$(this),c=d.val().split("-");AMA.debug("======= sorting data =======");$("#privacy").find(".submenu-label").html($("[value="+d.val()+"]").html());AMA.models.privacy.sortByKey(c[0],c[1])});$(this.$el).on("click",".privacy_sort",function(){var d=$(this),c=d.data("value").split("-");AMA.debug("======= sorting data =======");$("#privacy").find(".submenu-label").html($("[data-value="+d.data("value")+"]").html());AMA.models.privacy.sortByKey(c[0],c[1])});$(this.$el).find("#privacy_filter").on("change",function(){var d=$(this),c=$(b.$el);AMA.debug("Clearing search filter on "+b.$el);b.appAssistList.removeFilter("batteryOrMemoryUsageRating");b.appAssistList.removeFilter("personalInfoAccessRating");b.appAssistList.removeFilter("messageAccessRating");b.appAssistList.removeFilter("locationAccessRating");if(d.val()!=="all"){AMA.debug("Applying search filter for "+d.val());b.appAssistList.addFilter(d.val(),function(e){return _.some(d.val(),function(f){var g=e[d.val()];return g!==null})})}$("#privacy").find(".submenu-label").html($("[value="+d.val()+"]").html());b.appAssistList.refresh()});$(this.$el).on("click",".privacy_filter",function(){var d=$(this),c=$(b.$el);AMA.debug("Clearing search filter on "+b.$el);b.appAssistList.removeFilter("batteryOrMemoryUsageRating");b.appAssistList.removeFilter("personalInfoAccessRating");b.appAssistList.removeFilter("messageAccessRating");b.appAssistList.removeFilter("locationAccessRating");if(d.data("value")!=="all"){AMA.debug("Applying search filter for "+d.data("value"));b.appAssistList.addFilter(d.data("value"),function(e){return _.some(d.data("value"),function(f){var g=e[d.data("value")];return g!==null})})}$("#privacy").find(".submenu-label").html($("[data-value="+d.data("value")+"]").html());b.appAssistList.refresh()})},search:function(){this.appAssistList._onSearchKeyUp(true)},render:function(){a.__super__.render.apply(this);this.appAssistList=new AMA.view.AppAssistListView({parent:this,el:"#privacy_rowbox",data:AMA.models.privacy}).plug(AMA.view.plugin.Search,{searchInput:"#privacy_searchinput",searchFields:["name"]});this.appAssistDetails=new AMA.view.AppAssistDetailsView({parent:this,el:"#privacy_details",listView:this.appAssistList,dataClass:AMA.model.Privacy})}})})();
/*! AppAssistListView */
(function(){AMA.namespace("view");var a=AMA.view.AppAssistListView=AMA.view.ListView.extend();a.TEMPLATE_ID="privacy_list_template";a.TEMPLATE_SRC="";a.CSS={ITEM:"rt_rowthreat",ITEM_STYLE:["rt_rowlighter","rt_rowdarker"],SELECTED_ITEM:"rt_rowindicated"};_.extend(a.prototype,{_processData:function(d){var b=$(this.parent.$el);var c={appUrl:"",batteryOrMemoryUsageRating:"",id:"",locationAccessRating:"",messageAccessRating:"",name:"",personalInfoAccessRating:"",vulnerabilityRating:"",vulnerabilityRatingScore:0};d.summary="";d.summary+=(d.personalInfoAccessRating!=null)?b.find(".personalInfoAccessRating").clone().html('<span class="icon webbycons-addressbook"></span> '+d.personalInfoAccessRating)[0].outerHTML:"";d.summary+=(d.locationAccessRating!=null)?b.find(".locationAccessRating").clone().html('<span class="icon webbycons-locate"></span> '+d.locationAccessRating)[0].outerHTML:"";d.summary+=(d.messageAccessRating!=null)?b.find(".messageAccessRating").clone().html('<span class="icon webbycons-mail"></span> '+d.messageAccessRating)[0].outerHTML:"";d.summary+=(d.batteryOrMemoryUsageRating!=null)?b.find(".batteryOrMemoryUsageRating").clone().html('<span class="icon webbycons-battery"></span> '+d.batteryOrMemoryUsageRating)[0].outerHTML:"";d.summary+=(d.summary==="")?b.find(".emptyPrivacyDetails")[0].outerHTML:"";d.hasItem="";d.cleanId="";if(!d.id){d.cleanId=d.id.split("/").join("");d.cleanId=d.cleanId.split("+").join("");d.hasItem="hidden";_.extend(d,c)}return d},_setupEvents:function(){a.__super__._setupEvents.apply(this,arguments);AMA.models.privacy.once("sort",function(){this.refresh()},this)}})})();
/*! AppAssistDetailsview */
(function(){AMA.namespace("view");var a=AMA.view.AppAssistDetailsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="privacy_details_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);var b=this;this.dataDetails=null;if(this.options.listView){this.options.listView.on(AMA.view.ListView.EVENT.ITEM_SELECTED,function(c){if(b.data){b.data.isFetching=true}b.$el.addClass("loading_big").html("");b.setData(c);b.dataDetails=c.get("id");b.show()});this.options.listView.on(AMA.view.ListView.EVENT.SELECTION_CLEARED,function(){b.hide()})}else{AMA.warning("This instance of ContactDetailsView is not linked to a contacts list. Data switching will not apply.")}},_processData:function(d){var b=$(this.parent.$el);var c={appUrl:"",batteryOrMemoryUsageRating:"",id:"",locationAccessRating:"",messageAccessRating:"",name:"",personalInfoAccessRating:"",vulnerabilityRating:"",vulnerabilityRatingScore:0};d.summary="";d.summary+=(d.personalInfoAccessRating!=null)?b.find(".personalInfoAccessRating").clone().html('<span class="icon webbycons-addressbook"></span> '+d.personalInfoAccessRating)[0].outerHTML:"";d.summary+=(d.locationAccessRating!=null)?b.find(".locationAccessRating").clone().html('<span class="icon webbycons-locate"></span> '+d.locationAccessRating)[0].outerHTML:"";d.summary+=(d.messageAccessRating!=null)?b.find(".messageAccessRating").clone().html('<span class="icon webbycons-mail"></span> '+d.messageAccessRating)[0].outerHTML:"";d.summary+=(d.batteryOrMemoryUsageRating!=null)?b.find(".batteryOrMemoryUsageRating").clone().html('<span class="icon webbycons-battery"></span> '+d.batteryOrMemoryUsageRating)[0].outerHTML:"";d.summary+=(d.summary==="")?b.find(".emptyPrivacyDetails")[0].outerHTML:"";d.hasItem="";d.cleanId="";if(!d.id){d.hasItem="hidden";d.cleanId=d.id.split("/").join("");d.cleanId=d.cleanId.split("+").join("");_.extend(d,c)}return d},_beforeRender:function(){this.parent.appAssistList.$el.find(".details-sm").addClass("hidden")},render:function(){a.__super__.render.apply(this,arguments);if(!this.data){return}if(!this.data.toJSON().length){return}var c=this.data.toJSON()[0].id,b=c.split("/").join("");b=b.split("+").join("");$("#set_details"+b).html(_.template(this.template,this._processData(this.data.toJSON()[0]))).removeClass("hidden")},_afterRender:function(){this.$el.removeClass("loading_big")}})})();
/*! SupportTabView */
(function(){AMA.namespace("view");var a=AMA.view.SupportTabView=AMA.view.BaseView.extend();a.TEMPLATE_ID="support_tab_template";a.TEMPLATE_SRC="supportTab.tpl";a.TOOLBAR={DEFAULT:["endpoint","diagnosticScan"],IPHONE:["endpoint","diagnosticScan"]};AMA.augment(a.prototype,{render:function(){a.__super__.render.apply(this);AMA.debug("<br><br>=========== AMA.view.SupportTabView rendered =================<br><br>");this.supportTabResourceView=new AMA.view.SupportTabResourceView({el:"#support_tab",parent:this,data:AMA.models.diagnosticScanResourceData});this.supportTabAppsListView=new AMA.view.SupportTabAppsListView({el:"#hsAppsRowPlaceHolder",parent:this,data:AMA.models.diagnosticScanAppsData})}})})();
/*! SupportTabResourceView */
(function(){AMA.namespace("view");var a=AMA.view.SupportTabResourceView=AMA.view.BaseView.extend();a.TEMPLATE_ID="support_tab_resources_template";a.COLOR={high:"green",medium:"yellow",low:"red"};AMA.augment(a.prototype,{_initializeDataCss:function(b){if(!b.css){b.css={}}b.css.displayDiagnosticsSuccessful="hide";b.css.displayNoData="show";b.css.displayPrePS14Snapshot="hide";b.css.displayPostPS14Snapshot="hide";b.css.batteryRemaining="hide";b.css.batteryRemainingUndefined="show";b.css.batteryStatusCharging="hide";b.css.batteryStatusDischarging="hide";b.css.batteryStatusFull="hide";b.css.batteryStatusNotcharging="hide";b.css.batteryStatusUndefined="show";b.css.batteryStatusUnknown="hide";b.css.batteryStatusUnplugged="hide";b.css.bluetoothFalse="hide";b.css.bluetoothTrue="hide";b.css.bluetoothUndefined="show";b.css.buildVersion="hide";b.css.buildVersionUndefined="show";b.css.deviceStorageAvailable="hide";b.css.deviceStorageAvailableUndefined="show";b.css.downloadedAppNumber="hide";b.css.downloadedAppNumberUndefined="show";b.css.gpsFalse="hide";b.css.gpsTrue="hide";b.css.gpsUndefined="show";b.css.googleLocationServicesFalse="hide";b.css.googleLocationServicesTrue="hide";b.css.googleLocationServicesUndefined="show";b.css.lastBackupDate="hide";b.css.lastBackupDateUndefined="show";b.css.listOfBluetoothConnected="hide";b.css.listOfBluetoothConnectedNone="hide";b.css.listOfBluetoothConnectedUndefined="show";b.css.manufacturer="hide";b.css.manufacturerUndefined="show";b.css.memoryAvailable="hide";b.css.memoryAvailableUndefined="show";b.css.memorySDTotal="hide";b.css.memorySDTotalUndefined="show";b.css.SDStorageAvailable="hide";b.css.SDStorageAvailableUndefined="show";b.css.memoryFree="hide";b.css.memoryFreeUndefined="show";b.css.memoryTotal="hide";b.css.memoryTotalUndefined="show";b.css.model="hide";b.css.modelUndefined="show";b.css.osVersion="hide";b.css.osVersionUndefined="show";b.css.runningAppNumber="hide";b.css.runningAppNumberUndefined="show";b.css.screenBrightness="hide";b.css.screenBrightnessUndefined="show";b.css.syncedAccountList="hide";b.css.syncedAccountListNone="hide";b.css.syncedAccountListUndefined="show";b.css.syncedAccountNumber="hide";b.css.timeStamp="hide";b.css.timeStampUndefined="show-inline";b.css.totalAppNumber="hide";b.css.totalAppNumberUndefined="show";b.css.wifiConnected="hide";b.css.wifiDisabling="hide";b.css.wifiEnabling="hide";b.css.wifiNotConnected="hide";b.css.wifiOff="hide";b.css.wifiUndefined="show";b.css.wifiUnknown="hide";return b},_initializeModelDefaults:function(b){if(!b){b={}}b.memoryFree=0;b.totalAppNumber=0;b.osVersion="";b.deviceStorageAvailable=0;b.memoryTotal=0;b.runningAppNumber=0;b.manufacturer="";b.model="";b.buildVersion="";b.timeStamp="";b.wifi="";b.wifiConnected="";b.bluetooth="";b.totalAppNumber=0;b.listOfBluetoothConnected="";b.gps="";b.googleLocationServices="";b.mobileNetwork="";b.screenBrightness=0;b.batteryRemaining=0;b.batteryStatus="";b.memoryAvailable=0;b.memoryTotal=0;b.memorySDTotal=0;b.memorySDFree=0;b.SDStorageAvailable=0;b.downloadedAppNumber=0;b.lastBackupDate="";b.syncedAccountNumber=0;b.syncedAccountList="";return b},_processData:function(c){AMA.debug("\n=========== process SupportTabResourceView data =================\n");if(c&&this.data.models[0]){var b=this.data.models[0].attributes;this._initializeDataCss(c);if(b.memoryFree){c.css.memoryFreeUndefined="hide";c.css.memoryFree="show";c.memoryFree=this.memoryFreeSizeConverter(b.memoryFree)}else{c.memoryFree=0}if(b.totalAppNumber){c.css.totalAppNumberUndefined="hide";c.css.totalAppNumber="show";c.totalAppNumber=b.totalAppNumber}else{c.totalAppNumber=0}if(b.osVersion){c.css.osVersionUndefined="hide";c.css.osVersion="show";c.osVersion=b.osVersion}else{c.osVersion=""}if(b.memoryTotal){c.css.memoryTotalUndefined="hide";c.css.memoryTotal="show";c.css.deviceStorageAvailableUndefined="hide";c.css.deviceStorageAvailable="show";c.deviceStorageAvailable=Math.floor(100*(b.memoryFree/b.memoryTotal));c.memoryTotal=b.memoryTotal}else{c.deviceStorageAvailable=0;c.memoryTotal=0}if(b.runningAppNumber){c.css.runningAppNumberUndefined="hide";c.css.runningAppNumber="show";c.runningAppNumber=b.runningAppNumber}else{c.runningAppNumber=0}if(b.manufacturer){c.css.manufacturerUndefined="hide";c.css.manufacturer="show";c.manufacturer=b.manufacturer}else{c.manufacturer=""}if(b.model){c.css.modelUndefined="hide";c.css.model="show";c.model=b.model}else{c.model=""}c.css.displayDiagnosticsSuccessful="show";c.css.displayNoData="hide";if(b.buildVersion&&(b.buildVersion.length>1)){c.css.buildVersionUndefined="hide";c.css.buildVersion="show";c.css.displayPrePS14Snapshot="hide";c.css.displayPostPS14Snapshot="settings_tall";c.buildVersion=b.buildVersion}else{c.css.displayPrePS14Snapshot="settings_short";c.css.displayPostPS14Snapshot="hide";c.buildVersion=""}if(b.timeStamp){c.css.timeStampUndefined="hide";c.css.timeStamp="show-inline";c.timeStamp=AMA.Util.formatDate(new Date(b.timeStamp),"MMM dd, yyyy hh:mm a Z",false)}else{c.timeStamp=""}if((b.wifi===null)||(typeof b.wifi==="undefined")||(b.wifi==="UNKNOWN")){c.wifi="";c.wifiConnected=""}else{c.css.wifiUndefined="hide";c.wifi=b.wifi;c.wifiConnected=b.wifiConnected;if(b.wifiConnected){if(b.wifi==="WIFI_STATE_ENABLED"){c.css.wifiConnected="show"}else{c.css.wifiUnknown="show";AMA.warning("SupportTabResourceView: unexpected wifi state:"+b.wifi+" and wifi connected:"+b.wifiConnected)}}else{if(b.wifi==="WIFI_STATE_DISABLED"){c.css.wifiOff="show"}else{if(b.wifi==="WIFI_STATE_DISABLING"){c.css.wifiDisabling="show"}else{if(b.wifi==="WIFI_STATE_ENABLED"){c.css.wifiNotConnected="show"}else{if(b.wifi==="WIFI_STATE_ENABLING"){c.css.wifiEnabling="show"}else{if(b.wifi==="WIFI_STATE_UNKNOWN"){c.css.wifiUnknown="show"}else{c.css.wifiUnknown="show";AMA.warning("SupportTabResourceView: unexpected wifi state:"+b.wifi+" and wifi connected:"+b.wifiConnected)}}}}}}}if((b.bluetooth===null)||(typeof b.bluetooth==="undefined")){c.bluetooth=""}else{c.css.bluetoothUndefined="hide";c.bluetooth=b.bluetooth;if(b.bluetooth){c.css.bluetoothFalse="hide";c.css.bluetoothTrue="show"}else{c.css.bluetoothFalse="show";c.css.bluetoothTrue="hide"}}if(b.totalAppNumber){c.css.totalAppNumberUndefined="hide";c.css.totalAppNumber="show";c.totalAppNumber=b.totalAppNumber}else{c.totalAppNumber=0}if(b.listOfBluetoothConnected){c.css.listOfBluetoothConnectedUndefined="hide";if(b.listOfBluetoothConnected.length===0){c.css.listOfBluetoothConnectedNone="show";c.listOfBluetoothConnected=""}else{c.css.listOfBluetoothConnected="show";c.listOfBluetoothConnected=b.listOfBluetoothConnected.join(", ")}}else{c.listOfBluetoothConnected=""}if((b.gps===null)||(typeof b.gps==="undefined")){c.gps=""}else{c.css.gpsUndefined="hide";c.gps=b.gps;if(b.gps){c.css.gpsFalse="hide";c.css.gpsTrue="show"}else{c.css.gpsFalse="show";c.css.gpsTrue="hide"}}if((b.googleLocationServices===null)||(typeof b.googleLocationServices==="undefined")){c.googleLocationServices=""}else{c.css.googleLocationServicesUndefined="hide";c.googleLocationServices=b.googleLocationServices;if(b.googleLocationServices){c.css.googleLocationServicesFalse="hide";c.css.googleLocationServicesTrue="show"}else{c.css.googleLocationServicesFalse="show";c.css.googleLocationServicesTrue="hide"}}if(b.mobileNetwork){c.css.mobileNetworkUndefined="hide";c.css.mobileNetwork="show";c.mobileNetwork=b.mobileNetwork}else{c.mobileNetwork=""}if(b.screenBrightness){c.css.screenBrightnessUndefined="hide";c.css.screenBrightness="show";c.screenBrightness=b.screenBrightness}else{c.screenBrightness=0}if(b.batteryRemaining){c.css.batteryRemainingUndefined="hide";c.css.batteryRemaining="show";c.batteryRemaining=b.batteryRemaining}else{c.batteryRemaining=0}if(b.batteryStatus){c.css.batteryStatusUndefined="hide";c.batteryStatus=b.batteryStatus;if(b.batteryStatus==="BATTERY_STATUS_UNKNOWN"){c.css.batteryStatusUnknown="show"}else{if(b.batteryStatus==="BATTERY_STATUS_CHARGING"){c.css.batteryStatusCharging="show"}else{if(b.batteryStatus==="BATTERY_STATUS_DISCHARGING"){c.css.batteryStatusDischarging="show"}else{if(b.batteryStatus==="BATTERY_STATUS_FULL"){c.css.batteryStatusFull="show"}else{if(b.batteryStatus==="BATTERY_STATUS_NOTCHARGING"){c.css.batteryStatusNotcharging="show"}else{if(b.batteryStatus==="BATTERY_STATUS_UNPLUGGED"){c.css.batteryStatusUnplugged="show"}else{c.css.batteryStatusUnknown="show"}}}}}}}else{c.batteryStatus=""}if(b.memoryAvailable){c.css.memoryAvailableUndefined="hide";c.css.memoryAvailable="show";c.memoryAvailable=b.memoryAvailable}else{c.memoryAvailable=0}if(b.memorySDTotal){c.css.memorySDTotalUndefined="hide";c.css.SDStorageAvailableUndefined="hide";c.css.memorySDTotal="show";c.css.SDStorageAvailable="show";c.memoryAvailable=b.memoryAvailable;c.SDStorageAvailable=Math.floor(100*(b.memorySDFree/b.memorySDTotal))}else{c.memorySDTotal=0;c.SDStorageAvailable=0}if(b.downloadedAppNumber){c.css.downloadedAppNumberUndefined="hide";c.css.downloadedAppNumber="show";c.downloadedAppNumber=b.downloadedAppNumber}else{c.downloadedAppNumber=0}if(b.lastBackupDate){c.css.lastBackupDateUndefined="hide";c.css.lastBackupDate="show";c.lastBackupDate=AMA.Util.formatDate(new Date(b.lastBackupDate),"MMM dd, yyyy hh:mm a Z",false)}else{c.lastBackupDate=""}if((b.syncedAccountNumber)&&(b.syncedAccountNumber>3)){c.css.syncedAccountNumber="show";c.syncedAccountNumber=b.syncedAccountNumber}else{c.syncedAccountNumber=0}if(b.syncedAccountList){c.css.syncedAccountListUndefined="hide";if(b.syncedAccountList.length===0){c.css.syncedAccountListNone="show";c.syncedAccountList=""}else{c.css.syncedAccountList="show";c.syncedAccountList=b.syncedAccountList.join(", ")}}else{c.syncedAccountList=""}}else{AMA.debug("SupportTabResourceView - _processData: No data model object");c={};this._initializeModelDefaults(c);this._initializeDataCss(c)}return c},render:function(){a.__super__.render.apply(this);if((this.data.attributes.total>0)&&this.data.models[0]){var b=this.data.models[0].attributes;this.memoryFreeSizeConverter(b.memoryFree);this.sdMemoryFreeSizeConverter(b.memorySDFree);this.updateUIBatteryLevel(b.batteryLevel);this.updateUIStorageAvailable(b);this.updateUIDeviceSpeed(b.deviceSpeed);this.updateUIHealthScanDate();this.setHealthScanDetails(b)}AMA.debug("\n=========== AMA.view.SupportTabResourceView rendered =================\n")},memoryFreeSizeConverter:function(e){var c;var d="giga";var b=1024*1024*1024;if(e>=b){c=(e/b).toFixed(1)}else{c=(e/(1024*1024)).toFixed(1);d="mega"}AMA.Util.switchLabel(".device_storage_number","."+d,this.$el);this.$el.find("#device_storage_number").html(c)},sdMemoryFreeSizeConverter:function(e){var b;var d="giga";var c=1024*1024*1024;if(e>=c){b=(e/c).toFixed(1)}else{b=(e/(1024*1024)).toFixed(1);d="mega"}AMA.Util.switchLabel(".storage_available_number","."+d,this.$el);this.$el.find("#sd_storage_available_number").html(b)},updateUIBatteryLevel:function(b){this.$el.find("#hsps_battery_level_icon").attr("src","img/"+a.COLOR[b.toLowerCase()]+"_dot.png");AMA.Util.switchLabel(".battery_value","."+b.toLowerCase(),this.$el)},updateUIStorageAvailable:function(e){var b=e.memoryTotal;var h=e.memoryFree;var d=e.memorySDTotal;var c=e.memorySDFree;var f=Math.round((h+c)/(b+d)*100);var g="medium";if(f<=20){g="low"}else{if(f>60){g="high"}}this.$el.find("#hsps_available_storage_icon").attr("src","img/"+a.COLOR[g.toLowerCase()]+"_dot.png");AMA.Util.switchLabel(".available_storage_value","."+g.toLowerCase(),this.$el)},updateUIDeviceSpeed:function(b){this.$el.find("#hsps_device_performance_icon").attr("src","img/"+a.COLOR[b.toLowerCase()]+"_dot.png");AMA.Util.switchLabel(".device_performance_value","."+b.toLowerCase(),this.$el)},updateUIHealthScanDate:function(){if(AMA.models.diagnosticScanResourceData.healthScanDate){var d=AMA.models.diagnosticScanResourceData.healthScanDate;var b=new Date();d=d-(b.getTimezoneOffset()*60000);var c=AMA.Util.dateFormat(d)+" "+AMA.Util.timeFormat(d);$(".healthscan_date").html(c)}else{$(".healthscan_date").html("")}},setHealthScanDetails:function(b){this.updateUIBatteryLevel(b.batteryLevel);this.updateUIStorageAvailable(b);this.updateUIDeviceSpeed(b.deviceSpeed)},events:{"click #hsap_app_name":"hsap_app_name","click #hsap_last_used":"hsap_last_used","click #hsap_battery":"hsap_battery","click #hsap_memory":"hsap_memory","click #hsap_storage":"hsap_storage"},hsap_app_name:function(){this.handleAppsTableSort("hsap_app_name")},hsap_last_used:function(){this.handleAppsTableSort("hsap_last_used")},hsap_battery:function(){this.handleAppsTableSort("hsap_battery")},hsap_memory:function(){this.handleAppsTableSort("hsap_memory")},hsap_storage:function(){this.handleAppsTableSort("hsap_storage")},handleAppsTableSort:function(c){j_sortColumnId="#"+c;var b=$(j_sortColumnId).attr("class");switch(c){case"hsap_app_name":if((b=="app_performance_app_name_header")||(b=="app_performance_app_name_header_down")){$(j_sortColumnId).attr("class","app_performance_app_name_header_up");appsDisplayDataTable.fnSort([[5,"asc"]])}else{$(j_sortColumnId).attr("class","app_performance_app_name_header_down");appsDisplayDataTable.fnSort([[5,"desc"]])}$("#hsap_last_used").attr("class","app_performance_last_used_header");$("#hsap_battery").attr("class","app_performance_battery_header");$("#hsap_memory").attr("class","app_performance_memory_header");$("#hsap_storage").attr("class","app_performance_storage_header");break;case"hsap_last_used":if(b=="app_performance_last_used_header_down"){$(j_sortColumnId).attr("class","app_performance_last_used_header_up");appsDisplayDataTable.fnSort([[6,"asc"],[5,"asc"]])}else{$(j_sortColumnId).attr("class","app_performance_last_used_header_down");appsDisplayDataTable.fnSort([[6,"desc"],[5,"asc"]])}$("#hsap_app_name").attr("class","app_performance_app_name_header");$("#hsap_battery").attr("class","app_performance_battery_header");$("#hsap_memory").attr("class","app_performance_memory_header");$("#hsap_storage").attr("class","app_performance_storage_header");break;case"hsap_battery":if(b=="app_performance_battery_header_down"){$(j_sortColumnId).attr("class","app_performance_battery_header_up");appsDisplayDataTable.fnSort([[7,"asc"],[5,"asc"]])}else{$(j_sortColumnId).attr("class","app_performance_battery_header_down");appsDisplayDataTable.fnSort([[7,"desc"],[5,"asc"]])}$("#hsap_app_name").attr("class","app_performance_app_name_header");$("#hsap_last_used").attr("class","app_performance_last_used_header");$("#hsap_memory").attr("class","app_performance_memory_header");$("#hsap_storage").attr("class","app_performance_storage_header");break;case"hsap_memory":if(b=="app_performance_memory_header_down"){$(j_sortColumnId).attr("class","app_performance_memory_header_up");appsDisplayDataTable.fnSort([[8,"asc"],[5,"asc"]])}else{$(j_sortColumnId).attr("class","app_performance_memory_header_down");appsDisplayDataTable.fnSort([[8,"desc"],[5,"asc"]])}$("#hsap_app_name").attr("class","app_performance_app_name_header");$("#hsap_last_used").attr("class","app_performance_last_used_header");$("#hsap_battery").attr("class","app_performance_battery_header");$("#hsap_storage").attr("class","app_performance_storage_header");break;case"hsap_storage":if(b=="app_performance_storage_header_down"){$(j_sortColumnId).attr("class","app_performance_storage_header_up");appsDisplayDataTable.fnSort([[9,"asc"],[5,"asc"]])}else{$(j_sortColumnId).attr("class","app_performance_storage_header_down");appsDisplayDataTable.fnSort([[9,"desc"],[5,"asc"]])}$("#hsap_app_name").attr("class","app_performance_app_name_header");$("#hsap_last_used").attr("class","app_performance_last_used_header");$("#hsap_battery").attr("class","app_performance_battery_header");$("#hsap_memory").attr("class","app_performance_memory_header");break}appsDisplayDataTable.fnDraw()}})})();
/*! SupportTabAppsListView */
(function(){AMA.namespace("view");var a=AMA.view.SupportTabAppsListView=AMA.view.BaseView.extend();a.TEMPLATE_ID="appRowTemplate";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments)},render:function(){AMA.debug("\n=========== AMA.view.SupportTabAppsListView rendered =================\n");var b=0;var c=this.data.models;_.each(c,function(f,d){if(c[d].attributes.status=="STATUS_RUNNING"){b++}},this);$("#hsps_total_app_number").html(c.length);$("#hsps_current_app_running").html(b);this.setHealthScanAppPerformance(this.data.models)},_processData:function(b){AMA.debug("\n=========== process SupportTabAppsListView data =================\n");return b},setHealthScanAppPerformance:function(d){var c=[];_.each(d,function(f,k,u){var m=f.toJSON();var t=m.name;var D=$("#appNameCell table").clone();D.find("td:eq(0)").text(t);if(!m.isSystemApp){D.find("td:eq(1)").hide()}var B=D.prop("outerHTML");var l=m.batteryPercentage;var j=m.memoryPercentage;var w=m.storagePercentage?m.storagePercentage:0;var v=(new Date()).getTime();var s=$("#appStatusCell").clone();if(m.status==="STATUS_RUNNING"){appLastUsedHtml=s.find(".running").prop("outerHTML")}else{v=AMA.Util.dateFormat(m.updateDate);appLastUsedHtml=s.find(".notApplicable").prop("outerHTML");if(v){appLastUsedHtml=s.find(".date").text(v).prop("outerHTML")}}var z=$("#appBatteryUsageCell").clone();var h=m.batteryRating==="LOW"?"low":m.batteryRating==="HIGH"?"high":"med";AMA.Util.switchLabel(".batteryLevel","."+h,z);var n=z.prop("outerHTML");var C=$("#appMemoryUsageCell").clone();var A=m.memoryRating?"rated":"none";AMA.Util.switchLabel(".memoryRating","."+A,C);if(m.memoryRating){var q=m.memoryRating==="LOW"?"low":m.memoryRating==="HIGH"?"high":"med";AMA.Util.switchLabel(".memoryRate","."+q,C)}var e=C.prop("outerHTML");var p=$("#appStorageUsageCell").clone();var r=m.storageRating==="LOW"?"low":m.storageRating==="HIGH"?"high":"med";AMA.Util.switchLabel(".storageRating","."+r,p);var y=m.isSystemApp?"device":"card";AMA.Util.switchLabel(".storageType","."+y,p);var g=p.prop("outerHTML");c.push([B,appLastUsedHtml,n,e,g,t,v,l,j,w])});var b=[{sWidth:"229px",sTitle:$("#appColumns #hsap_app_name").prop("outerHTML"),bSortable:false},{sWidth:"120px",sTitle:$("#appColumns #hsap_last_used").prop("outerHTML"),bSortable:false},{sWidth:"98px",sTitle:$("#appColumns #hsap_battery").prop("outerHTML"),bSortable:false},{sWidth:"101px",sTitle:$("#appColumns #hsap_memory").prop("outerHTML"),bSortable:false},{sWidth:"113px",sTitle:$("#appColumns #hsap_storage").prop("outerHTML"),bSortable:false},{bVisible:false},{bVisible:false},{bVisible:false},{bVisible:false},{bVisible:false}];$(document).ready(function(){$("#healthscan_apps_performance_section").html('<table cellpadding="0" cellspacing="0" border="0" class="my_display" id="apps_performance_table" ></table>');appsDisplayDataTable=$("#apps_performance_table").dataTable({sScrollY:"246px",sScrollX:"673px",bPaginate:false,bScrollCollapse:true,bLengthChange:false,bInfo:false,bFilter:false,bAutoWidth:false,bDeferRender:true,aaData:c,aaSorting:[[7,"desc"],[5,"asc"]],aoColumns:b,sDom:'<"top">rt<"bottom"><"clear">'})});$(".dataTables_scrollBody").css("overflow-x","hidden")}})})();
/*! SafeBrowsingView */
(function(){AMA.namespace("view");var a=AMA.view.SafeBrowsingView=AMA.view.BaseView.extend();a.TEMPLATE_ID="safe_browsing_tab_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{render:function(){a.__super__.render.apply(this);AMA.debug("AMA.view.SafeBrowsingView rendered");var c=this.data.models[0];var b=c.get("safeBrowsingEnabled")},_processData:function(c){var e=(!c.safeBrowsingEnabled),b=(c.safeBrowsingEnabled),d={on:e?"active":"",off:b?"active":"",onChecked:e?"checked":"",offChecked:b?"checked":"",};return d},_setupEvents:function(){var b=this;$(this.$el).find(".btnSafeBrowsingSave").on("click",function(){var d=b.data.models[0];var c=""+d.get("safeBrowsingEnabled");if(c!==$(b.$el).find('input[name="safeBrowsing"]:checked').val()){b.saveSetting()}else{$(b.$el).find(".btnSafeBrowsingSaveMsg").html(AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.messages.noChanges);return}});$(this.$el).find(".editSetting").on("click",function(){AMA.page.openSettings("security")})},saveSetting:function(){AMA.page.standardDialogs.loading("");var b=("true"===$(this.el).find('input[name="safeBrowsing"]:checked').val());this.data.models[0].set({safeBrowsingEnabled:b});var c={url:this.data.url,success:this.saveSuccess,error:this.saveError,callback:this.successOrFailure,data:JSON.stringify(this.data.models[0].attributes)};this.data.sync("update",this.data.models[0],c)},saveSuccess:function(){AMA.page.standardDialogs.hideloading();$(".btnSafeBrowsingSaveMsg").html(AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.messages.settingsSaved)},saveError:function(){AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.error("Unable To Contact services");AMA.debug("Ajax completed with errors")},successOrFailure:function(b){AMA.page.standardDialogs.hideloading();if(b){$(".btnSafeBrowsingSaveMsg").html(AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.messages.settingsSaved)}else{AMA.page.standardDialogs.error("Unable To Contact services");AMA.debug("Ajax completed with errors")}}})})();