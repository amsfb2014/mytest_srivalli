/*! jquery.prettyPhoto Version 3.1.5 */
(function(e){e.prettyPhoto={version:"3.1.5"};e.fn.prettyPhoto=function(i){if(AMA.config.useLegacyApi){i=jQuery.extend({hook:"rel",animation_speed:"fast",ajaxcallback:function(){},slideshow:5000,autoplay_slideshow:false,opacity:0.8,show_title:true,allow_resize:true,allow_expand:true,default_width:500,default_height:344,min_width:800,counter_separator_label:"/",theme:"pp_default",horizontal_padding:20,hideflash:false,wmode:"transparent",autoplay:true,modal:false,deeplinking:true,overlay_gallery:true,overlay_gallery_max:30,keyboard_shortcuts:false,changepicturecallback:function(){},callback:function(){},ie6_fallback:true,markup:'<div class="pp_pic_holder"> 									<div class="ppt">&nbsp;</div> 									<div class="pp_content_container"> 										<div class="pp_left"> 										<div class="pp_right"> 											<div class="pp_content"> 												<div class="pp_loaderIcon"></div> 												<div class="pp_fade"> 													<a href="#" class="pp_expand" title="Expand the image">Expand</a> 													<div id="pp_full_res"></div> 													<div class="pp_details"> 							                             <div class="fileInfo"> 							                                <div class="title">File info:</div> 							                                <div class="fileSize">Size: <span></span></div> 							                                <div class="syncStatus"></div> 							                             </div> 							                             <div class="mediaBorder"></div> 							                             <div class="mediaButtons"> 							                                <div class="mediaActionButtons"> 														      <div class="btn_addremove"></div> 							                                   <a href="" target="_blank" class="download_link"><div class="btn_download"></div></a> 							                                   <div class="btn_delete"></div> 							                                   <div class="btn_mediaprev" onclick="$.prettyPhoto.changePage(\'previous\')"></div> 							                                   <div class="btn_medianext" onclick="$.prettyPhoto.changePage(\'next\')"></div> 							                                   <div class="clear"></div> 							                                </div> 							                                <div class="mediaButtonsClose"> 							                                  <div class="btn_mediaclose" onclick="$.prettyPhoto.close()"></div> 							                                </div> 							                             </div> 							                             <div class="clear"></div> 													</div> 												</div> 											</div> 										</div> 										</div> 									</div> 								</div> 								<div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> 									<a href="#" class="pp_arrow_previous">Previous</a> 									<div> 										<ul> 											{gallery} 										</ul> 									</div> 									<a href="#" class="pp_arrow_next">Next</a> 								</div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"/><param name="autoplay" value="{autoplay}"/><param name="type" value="video/quicktime"/><param name="wmode" value="{wmode}" /><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" wmode="{wmode}" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:"",social_tools:'<div class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"><\/script></div><div class="facebook"><iframe src="//www.facebook.com/plugins/like.php?locale=en_US&href={location_href}&amp;layout=button_count&amp;show_faces=true&amp;width=500&amp;action=like&amp;font&amp;colorscheme=light&amp;height=23" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:500px; height:23px;" allowTransparency="true"></iframe></div>'},i)}else{i=jQuery.extend({hook:"rel",animation_speed:"fast",ajaxcallback:function(){},slideshow:5000,autoplay_slideshow:false,opacity:0.8,show_title:true,allow_resize:true,allow_expand:true,default_width:500,default_height:344,min_width:800,counter_separator_label:"/",theme:"pp_default",horizontal_padding:20,hideflash:false,wmode:"transparent",autoplay:true,modal:false,deeplinking:true,overlay_gallery:true,overlay_gallery_max:30,keyboard_shortcuts:false,changepicturecallback:function(){},callback:function(){},ie6_fallback:true,markup:'<div class="pp_pic_holder"> 									<div class="ppt">&nbsp;</div> 									<div class="pp_content_container"> 										<div class="pp_left"> 										<div class="pp_right"> 											<div class="pp_content"> 												<div class="pp_loaderIcon"></div> 												<div class="pp_fade"> 													<a href="#" class="pp_expand" title="Expand the image">Expand</a> 													<div id="pp_full_res"></div> 													<div class="pp_details"> 							                             <div class="fileInfo"> 							                                <div class="title">File Info:</div> 							                                <div class="fileSize">Size: <span></span></div> 						                                	<div class="syncStatus"> 							                                	<span class="rt_endpointsync_text added_next_sync hidden">Added At Next Sync</span> 							                                	<span class="rt_endpointsync_text removed_next_sync hidden">Removed At Next Sync</span> 							                                	<span class="rt_endpointsync_text on_phone hidden">On Phone</span> 							                                	<span class="rt_endpointsync_text web_only hidden">Web Only</span> 															</div> 							                             </div> 							                             <div class="mediaBorder"></div> 							                             <div class="mediaButtons"> 							                                <div class="mediaActionButtons"> 														      <div class="btn_addremove"></div> 							                                   <div class="btn_download"></div> 							                                   <div class="btn_delete"></div> 							                                   <div class="btn_mediaprev" onclick="$.prettyPhoto.changePage(\'previous\')"></div> 							                                   <div class="btn_medianext" onclick="$.prettyPhoto.changePage(\'next\')"></div> 							                                   <div class="clear"></div> 							                                </div> 							                                <div class="mediaButtonsClose"> 							                                  <div class="btn_mediaclose" onclick="$.prettyPhoto.close()"></div> 							                                </div> 							                             </div> 							                             <div class="clear"></div> 													</div> 												</div> 											</div> 										</div> 										</div> 									</div> 								</div> 								<div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> 									<a href="#" class="pp_arrow_previous">Previous</a> 									<div> 										<ul> 											{gallery} 										</ul> 									</div> 									<a href="#" class="pp_arrow_next">Next</a> 								</div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"/><param name="autoplay" value="{autoplay}"/><param name="type" value="video/quicktime"/><param name="wmode" value="{wmode}" /><embed src="{path}" height="{height}" width="{width}" wmode="{wmode}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:"",social_tools:'<div class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"><\/script></div><div class="facebook"><iframe src="//www.facebook.com/plugins/like.php?locale=en_US&href={location_href}&amp;layout=button_count&amp;show_faces=true&amp;width=500&amp;action=like&amp;font&amp;colorscheme=light&amp;height=23" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:500px; height:23px;" allowTransparency="true"></iframe></div>'},i)}var q=this,p=false,w,u,v,x,A,B,l=e(window).height(),E=e(window).width(),m;doresize=true,scroll_pos=C();e(window).unbind("resize.prettyphoto").bind("resize.prettyphoto",function(){t();z()});if(i.keyboard_shortcuts){e(document).unbind("keydown.prettyphoto").bind("keydown.prettyphoto",function(F){if(typeof $pp_pic_holder!="undefined"){if($pp_pic_holder.is(":visible")){switch(F.keyCode){case 37:e.prettyPhoto.changePage("previous");F.preventDefault();break;case 39:e.prettyPhoto.changePage("next");F.preventDefault();break;case 27:if(!settings.modal){e.prettyPhoto.close()}F.preventDefault();break}}}})}e.prettyPhoto.initialize=function(){settings=i;if(settings.theme=="pp_default"){settings.horizontal_padding=16}theRel=e(this).attr(settings.hook);galleryRegExp=/\[(?:.*)\]/;isSet=(galleryRegExp.exec(theRel))?true:false;pp_images=(isSet)?jQuery.map(q,function(G,F){if(e(G).attr(settings.hook).indexOf(theRel)!=-1){return e(G).attr("href")}}):e.makeArray(e(this).attr("href"));pp_titles=(isSet)?jQuery.map(q,function(G,F){if(e(G).attr(settings.hook).indexOf(theRel)!=-1){return(e(G).find("img").attr("alt"))?e(G).find("img").attr("alt"):""}}):e.makeArray(e(this).find("img").attr("alt"));pp_descriptions=(isSet)?jQuery.map(q,function(G,F){if(e(G).attr(settings.hook).indexOf(theRel)!=-1){return(e(G).attr("title"))?e(G).attr("title"):""}}):e.makeArray(e(this).attr("title"));if(pp_images.length>settings.overlay_gallery_max){settings.overlay_gallery=false}set_position=jQuery.inArray(e(this).attr("href"),pp_images);rel_index=(isSet)?set_position:e("a["+settings.hook+"^='"+theRel+"']").index(e(this));k(this);if(settings.allow_resize){e(window).bind("scroll.prettyphoto",function(){t()})}e.prettyPhoto.open();return false};if(AMA.config.useLegacyApi){e.prettyPhoto.open=function(H){if(typeof settings=="undefined"){settings=i;pp_images=e.makeArray(arguments[0]);syncstatus=e.makeArray(arguments[4]);pp_titles=(arguments[1])?e.makeArray(arguments[1]):e.makeArray("");pp_descriptions=(arguments[2])?e.makeArray(arguments[2]):e.makeArray("");isSet=(pp_images.length>1)?true:false;set_position=(arguments[3])?arguments[3]:0;uidArray=e.makeArray(arguments[5]);k(H.target)}if(settings.hideflash){e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","hidden")}o(e(pp_images).size());e(".pp_loaderIcon").show();if(settings.deeplinking){b()}if(settings.social_tools){facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href));$pp_pic_holder.find(".pp_social").html(facebook_like_link)}if($ppt.is(":hidden")){$ppt.css("opacity",0).show()}$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity);$pp_pic_holder.find(".currentTextHolder").text((set_position+1)+settings.counter_separator_label+e(pp_images).size());if(typeof pp_descriptions[set_position]!="undefined"&&pp_descriptions[set_position]!=""){$pp_pic_holder.find(".pp_description").show().html(unescape(pp_descriptions[set_position]))}else{$pp_pic_holder.find(".pp_description").hide()}movie_width=(parseFloat(a("width",pp_images[set_position])))?a("width",pp_images[set_position]):settings.default_width.toString();movie_height=(parseFloat(a("height",pp_images[set_position])))?a("height",pp_images[set_position]):settings.default_height.toString();p=false;if(movie_height.indexOf("%")!=-1){movie_height=parseFloat((e(window).height()*parseFloat(movie_height)/100)-150);p=true}if(movie_width.indexOf("%")!=-1){movie_width=parseFloat((e(window).width()*parseFloat(movie_width)/100)-150);p=true}$pp_pic_holder.fadeIn(function(){(settings.show_title&&pp_titles[set_position]!=""&&typeof pp_titles[set_position]!="undefined")?$ppt.html(unescape(pp_titles[set_position])):$ppt.html("&nbsp;");imgPreloader="";skipInjection=false;switch(D(pp_images[set_position])){case"image":e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_addremove","btn_addtophone");e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_delete","btn_deletephoto");e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_download","btn_downloadphoto");e(".pp_pic_holder .btn_addremove.btn_addtophone").on("click",function(){Backbone.globalEvent.trigger("performActionOnPhoto",{type:"addToPhone",id:uidArray[set_position]})});e(".pp_pic_holder .btn_delete.btn_deletephoto").on("click",function(){Backbone.globalEvent.trigger("performActionOnPhoto",{type:"delete",id:uidArray[set_position]})});imgPreloader=new Image();nextImage=new Image();if(isSet&&set_position<e(pp_images).size()-1){nextImage.src=pp_images[set_position+1]}prevImage=new Image();if(isSet&&pp_images[set_position-1]){prevImage.src=pp_images[set_position-1]}$pp_pic_holder.find("#pp_full_res")[0].innerHTML=settings.image_markup.replace(/{path}/g,pp_images[set_position]);imgPreloader.onload=function(){w=r(imgPreloader.width,imgPreloader.height);n()};imgPreloader.onerror=function(){alert("Image cannot be loaded. Make sure the path is correct and image exist.");e.prettyPhoto.close()};imgPreloader.src=pp_images[set_position];break;case"youtube":w=r(movie_width,movie_height);movie_id=a("v",pp_images[set_position]);if(movie_id==""){movie_id=pp_images[set_position].split("youtu.be/");movie_id=movie_id[1];if(movie_id.indexOf("?")>0){movie_id=movie_id.substr(0,movie_id.indexOf("?"))}if(movie_id.indexOf("&")>0){movie_id=movie_id.substr(0,movie_id.indexOf("&"))}}movie="http://www.youtube.com/embed/"+movie_id;(a("rel",pp_images[set_position]))?movie+="?rel="+a("rel",pp_images[set_position]):movie+="?rel=1";if(settings.autoplay){movie+="&autoplay=1"}toInject=settings.iframe_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,movie);break;case"vimeo":w=r(movie_width,movie_height);movie_id=pp_images[set_position];var K=/http(s?):\/\/(www\.)?vimeo.com\/(\d+)/;var J=movie_id.match(K);movie="http://player.vimeo.com/video/"+J[3]+"?title=0&amp;byline=0&amp;portrait=0";if(settings.autoplay){movie+="&autoplay=1;"}vimeo_width=w.width+"/embed/?moog_width="+w.width;toInject=settings.iframe_markup.replace(/{width}/g,vimeo_width).replace(/{height}/g,w.height).replace(/{path}/g,movie);break;case"quicktime":w=r(movie_width,movie_height);w.height+=15;w.contentHeight+=15;w.containerHeight+=15;toInject=settings.quicktime_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,pp_images[set_position]).replace(/{autoplay}/g,settings.autoplay);e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_addremove","btn_addtophone");e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_delete","btn_deletevideo");e.prettyPhoto.setButtonClass(".pp_pic_holder .btn_download","btn_downloadvideo");e(".pp_pic_holder .btn_addremove.btn_addtophone").on("click",function(){Backbone.globalEvent.trigger("performActionOnVideo",{type:"addToPhone",id:uidArray[set_position]})});e(".pp_pic_holder .btn_delete.btn_deletevideo").on("click",function(){Backbone.globalEvent.trigger("performActionOnVideo",{type:"delete",id:uidArray[set_position]})});break;case"flash":w=r(movie_width,movie_height);flash_vars=pp_images[set_position];flash_vars=flash_vars.substring(pp_images[set_position].indexOf("flashvars")+10,pp_images[set_position].length);filename=pp_images[set_position];filename=filename.substring(0,filename.indexOf("?"));toInject=settings.flash_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,filename+"?"+flash_vars);break;case"iframe":w=r(movie_width,movie_height);frame_url=pp_images[set_position];frame_url=frame_url.substr(0,frame_url.indexOf("iframe")-1);toInject=settings.iframe_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{path}/g,frame_url);break;case"ajax":doresize=false;w=r(movie_width,movie_height);doresize=true;skipInjection=true;e.get(pp_images[set_position],function(L){toInject=settings.inline_markup.replace(/{content}/g,L);$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;n()});break;case"custom":w=r(movie_width,movie_height);toInject=settings.custom_markup;break;case"inline":myClone=e(pp_images[set_position]).clone().append('<br clear="all" />').css({width:settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo(e("body")).show();doresize=false;w=r(e(myClone).width(),e(myClone).height());doresize=true;e(myClone).remove();toInject=settings.inline_markup.replace(/{content}/g,e(pp_images[set_position]).html());break}if(!imgPreloader&&!skipInjection){$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;n()}});var F=pp_descriptions[set_position];var G=syncstatus[set_position];var I=pp_images[set_position];e(".pp_pic_holder .download_link").attr("href",I.replace("content","download"));e(".pp_pic_holder .syncStatus").html(G);e(".pp_pic_holder .fileSize span").html(F);return false}}else{e.prettyPhoto.open=function(){var F=null;if(typeof settings=="undefined"){mediaType=arguments[0];fromTrashView=(arguments[4]===true)?true:false;settings=i;pp_images=[];imageIds=e.makeArray(arguments[1]);pp_descriptions=[];pp_addRemove=[];pp_mediaStatus=[];isSet=(arguments[1].length>1)?true:false;set_position=arguments[2]?arguments[2]:0;k(arguments[3])}if(pp_images[set_position]){f()}else{if(AMA.Util.useXdr()){F=AMA.Util.createCORSRequest("GET",AMA.config.apiHostUrl+"/files/"+imageIds[set_position]+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType="+mediaType);F.onload=function(){try{var G=JSON.parse(this.responseText)}catch(H){AMA.error("GET /files - Pretty Photo - response not JSON: "+this.responseText)}if(G){pp_images[set_position]=G.mediaUrl+"&fileName="+G.fileName;pp_descriptions[set_position]=AMA.Util.bytesToSize(G.fileSizeInBytes);if(G.pendingDelete){pp_mediaStatus[set_position]="remove"}else{if(G.pendingCreate){pp_mediaStatus[set_position]="add"}else{if(G.onPhone){pp_mediaStatus[set_position]="onphone"}else{pp_mediaStatus[set_position]="webonly"}}}f()}};F.onerror=function(){AMA.error("Request failed: GET /files")};F.onprogress=function(){};F.ontimeout=function(){};F.timeout=100000;F.send()}else{e.ajax({url:AMA.config.apiHostUrl+"/files/"+imageIds[set_position]+"?devId="+AMA.config.devId+"&authToken="+AMA.config.authToken+"&endpointId="+AMA.config.endpointId+"&fileType="+mediaType}).done(function(G){pp_images[set_position]=G.mediaUrl+"&fileName="+G.fileName;pp_descriptions[set_position]=AMA.Util.bytesToSize(G.fileSizeInBytes);if(G.pendingDelete&&G.onPhone){pp_mediaStatus[set_position]="remove"}else{if(G.pendingCreate){pp_mediaStatus[set_position]="add"}else{if(G.onPhone){pp_mediaStatus[set_position]="onphone"}else{pp_mediaStatus[set_position]="webonly"}}}f()})}}}}e.prettyPhoto.setButtonClass=function(G,F){e(G).removeClass("btn_removefromphone");e(G).removeClass("btn_addtophone");e(G).removeClass("btn_deletephoto");e(G).removeClass("btn_deletevideo");e(G).removeClass("btn_downloadphoto");e(G).removeClass("btn_downloadvideo");e(G).removeClass("btn_restorephoto");e(G).removeClass("btn_permadeletephoto");e(G).removeClass("btn_restorevideo");e(G).removeClass("btn_permadeletevideo");e(G).addClass(F)};if(AMA.config.useLegacyApi){e.prettyPhoto.changePage=function(F){currentGalleryPage=0;if(F=="previous"){set_position--;if(set_position<0){set_position=e(pp_images).size()-1}}else{if(F=="next"){set_position++;if(set_position>e(pp_images).size()-1){set_position=0}}else{set_position=F}}rel_index=set_position;if(!doresize){doresize=true}if(settings.allow_expand){e(".pp_contract").removeClass("pp_contract").addClass("pp_expand")}s(function(){e.prettyPhoto.open()})}}else{e.prettyPhoto.changePage=function(F){currentGalleryPage=0;if(F=="previous"){set_position--;if(set_position<0){set_position=e(imageIds).size()-1}}else{if(F=="next"){set_position++;if(set_position>e(imageIds).size()-1){set_position=0}}else{set_position=F}}rel_index=set_position;if(!doresize){doresize=true}if(settings.allow_expand){e(".pp_contract").removeClass("pp_contract").addClass("pp_expand")}s(function(){e.prettyPhoto.open()})}}e.prettyPhoto.changeGalleryPage=function(F){if(F=="next"){currentGalleryPage++;if(currentGalleryPage>totalPage){currentGalleryPage=0}}else{if(F=="previous"){currentGalleryPage--;if(currentGalleryPage<0){currentGalleryPage=totalPage}}else{currentGalleryPage=F}}slide_speed=(F=="next"||F=="previous")?settings.animation_speed:0;slide_to=currentGalleryPage*(itemsPerPage*itemWidth);$pp_gallery.find("ul").animate({left:-slide_to},slide_speed)};e.prettyPhoto.startSlideshow=function(){if(typeof m=="undefined"){$pp_pic_holder.find(".pp_play").unbind("click").removeClass("pp_play").addClass("pp_pause").click(function(){e.prettyPhoto.stopSlideshow();return false});m=setInterval(e.prettyPhoto.startSlideshow,settings.slideshow)}else{e.prettyPhoto.changePage("next")}};e.prettyPhoto.stopSlideshow=function(){$pp_pic_holder.find(".pp_pause").unbind("click").removeClass("pp_pause").addClass("pp_play").click(function(){e.prettyPhoto.startSlideshow();return false});clearInterval(m);m=undefined};if(AMA.config.useLegacyApi){e.prettyPhoto.close=function(){if($pp_overlay.is(":animated")){return}e.prettyPhoto.stopSlideshow();$pp_pic_holder.stop().find("object,embed").css("visibility","hidden");e("div.pp_pic_holder,div.ppt,.pp_fade").fadeOut(settings.animation_speed,function(){e(this).remove()});$pp_overlay.fadeOut(settings.animation_speed,function(){if(settings.hideflash){e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","visible")}e(this).remove();e(window).unbind("scroll.prettyphoto");c();settings.callback();doresize=true;u=false;delete settings})}}else{e.prettyPhoto.close=function(){if($pp_overlay.is(":animated")){return}e.prettyPhoto.stopSlideshow();$pp_pic_holder.stop().find("object,embed").css("visibility","hidden");e("div.pp_pic_holder,div.ppt,.pp_fade").fadeOut("fast",function(){e(this).remove()});$pp_overlay.fadeOut(settings.animation_speed,function(){if(settings.hideflash){e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","visible")}e(this).remove();e(window).unbind("scroll.prettyphoto");c();settings.callback();doresize=true;u=false;delete settings})}}function f(){if(settings.hideflash){e("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","hidden")}o(set_position);h(fromTrashView);e(".pp_loaderIcon").show();if(AMA.Util.isIPhone()){$pp_pic_holder.addClass("ios")}$pp_pic_holder.find(".pp_content_container").removeClass("webonly").removeClass("onphone").addClass(pp_mediaStatus[set_position]);if(settings.deeplinking){b()}if(settings.social_tools){facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href));$pp_pic_holder.find(".pp_social").html(facebook_like_link)}if($ppt.is(":hidden")){$ppt.css("opacity",0).show()}$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity);$pp_pic_holder.find(".currentTextHolder").text((set_position+1)+settings.counter_separator_label+e(pp_images).size());movie_width=(parseFloat(a("width",pp_images[set_position])))?a("width",pp_images[set_position]):settings.default_width.toString();movie_height=(parseFloat(a("height",pp_images[set_position])))?a("height",pp_images[set_position]):settings.default_height.toString();p=false;if(movie_height.indexOf("%")!=-1){movie_height=parseFloat((e(window).height()*parseFloat(movie_height)/100)-150);p=true}if(movie_width.indexOf("%")!=-1){movie_width=parseFloat((e(window).width()*parseFloat(movie_width)/100)-150);p=true}$pp_pic_holder.fadeIn(function(){(settings.show_title&&pp_titles[set_position]!=""&&typeof pp_titles[set_position]!="undefined")?$ppt.html(unescape(pp_titles[set_position])):$ppt.html("&nbsp;");imgPreloader="";skipInjection=false;switch(D(pp_images[set_position])){case"image":imgPreloader=new Image();$pp_pic_holder.find(".btn_addremove").removeClass().addClass("btn_addremove");if(fromTrashView){$pp_pic_holder.find(".btn_addremove").addClass("btn_restorephoto");$pp_pic_holder.find(".btn_delete").removeClass().addClass("btn_delete btn_permadeletephoto")}else{$pp_pic_holder.find(".rt_endpointsync_text").addClass("hidden");switch(pp_mediaStatus[set_position]){case"add":$pp_pic_holder.find(".btn_addremove").addClass("btn_removefromphone");$pp_pic_holder.find(".rt_endpointsync_text.added_next_sync").removeClass("hidden");break;case"webonly":$pp_pic_holder.find(".btn_addremove").addClass("btn_addtophone");$pp_pic_holder.find(".rt_endpointsync_text.web_only").removeClass("hidden");break;case"remove":$pp_pic_holder.find(".btn_addremove").addClass("btn_addtophone");$pp_pic_holder.find(".rt_endpointsync_text.removed_next_sync").removeClass("hidden");break;case"onphone":$pp_pic_holder.find(".btn_addremove").addClass("btn_removefromphone");$pp_pic_holder.find(".rt_endpointsync_text.on_phone").removeClass("hidden");break}$pp_pic_holder.find(".btn_delete").removeClass("btn_deletevideo").addClass("btn_deletephoto")}$pp_pic_holder.find(".btn_download").removeClass("btn_downloadvideo").addClass("btn_downloadphoto");$pp_pic_holder.find(".btn_addremove").off("click").on("click",function(){var K=e(this),J=e("#msg_loadingdialog").html(),I={};AMA.page.standardDialogs.loading(J);if(K.hasClass("btn_restorephoto")){if(AMA.config.enableReporting){I={};I.ActionPerformed="Restore Photo - Trash Details Pane";AMA.debug("Reporting: Logging event for restore photo to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.restoreimage,I)}AMA.models.trash.restore([imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();AMA.models.trash.invalidate();AMA.models.photos.invalidate();e.prettyPhoto.close()})}else{if(AMA.config.enableReporting){I={};if(K.hasClass("btn_addtophone")){I.ActionPerformed="Add Photo To Phone";AMA.debug("Reporting: Logging event for photo added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.addphototophone,I)}else{I.ActionPerformed="Remove Photo From Phone";AMA.debug("Reporting: Logging event for photo removed from phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removephotofrmphone,I)}}AMA.models.photos.addRemove($pp_pic_holder.find(".btn_addremove").hasClass("btn_addtophone")?"add":"remove","photos",[imageIds[set_position]],function(L,N){var M=N.list[0];AMA.page.standardDialogs.hideloading();if(L){if(K.hasClass("btn_addtophone")){K.removeClass("btn_addtophone").addClass("btn_removefromphone")}else{K.removeClass("btn_removefromphone").addClass("btn_addtophone")}$pp_pic_holder.find(".rt_endpointsync_text").addClass("hidden");if(M.pendingCreate){$pp_pic_holder.find(".rt_endpointsync_text.added_next_sync").removeClass("hidden")}else{if(M.pendingDelete&&M.onPhone){$pp_pic_holder.find(".rt_endpointsync_text.removed_next_sync").removeClass("hidden")}else{if(M.onPhone){$pp_pic_holder.find(".rt_endpointsync_text.on_phone").removeClass("hidden")}else{$pp_pic_holder.find(".rt_endpointsync_text.web_only").removeClass("hidden")}}}AMA.models.photos.invalidate()}})}});$pp_pic_holder.find(".btn_downloadphoto").off("click").on("click",function(){AMA.models.photos.downloadFile("image",imageIds[set_position],function(K){var J=K.mediaUrl.replace("content?","download?")+"&fileName="+K.fileName;AMA.Util.downloadFile(J)});if(AMA.config.enableReporting){var I={};I.ActionPerformed="Download Photo";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.downloadPhoto,I)}});$pp_pic_holder.find(".btn_deletephoto").on("click",function(){var I=e("#msg_confirm_delete_photo").html();AMA.page.standardDialogs.confirm(I,function(){AMA.page.standardDialogs.hide();var K=e("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(K);AMA.models.photos.trash("image",[imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();e.prettyPhoto.close();if(L){AMA.models.photos.invalidate()}AMA.models.trash.invalidate()});if(AMA.config.enableReporting){var J={};J.ActionPerformed="Delete Photo";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deletePhoto,J)}})});$pp_pic_holder.find(".btn_permadeletephoto").on("click",function(){var I=e("#msg_confirm_delete_photo").html();AMA.page.standardDialogs.confirm(I,function(){AMA.page.standardDialogs.hide();var K=e("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(K);AMA.models.trash.trash([imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();e.prettyPhoto.close();AMA.models.trash.invalidate()});if(AMA.config.enableReporting){var J={};J.ActionPerformed="Permanant Delete photo - Trash Details Pane";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deleterecordstrash,J)}})});nextImage=new Image();if(isSet&&set_position<e(pp_images).size()-1){nextImage.src=pp_images[set_position+1]}prevImage=new Image();if(isSet&&pp_images[set_position-1]){prevImage.src=pp_images[set_position-1]}$pp_pic_holder.find("#pp_full_res")[0].innerHTML=settings.image_markup.replace(/{path}/g,pp_images[set_position]);imgPreloader.onload=function(){w=r(imgPreloader.width,imgPreloader.height);n()};imgPreloader.onerror=function(){alert("Image cannot be loaded. Make sure the path is correct and image exist.");e.prettyPhoto.close()};imgPreloader.src=pp_images[set_position];break;case"youtube":w=r(movie_width,movie_height);movie_id=a("v",pp_images[set_position]);if(movie_id==""){movie_id=pp_images[set_position].split("youtu.be/");movie_id=movie_id[1];if(movie_id.indexOf("?")>0){movie_id=movie_id.substr(0,movie_id.indexOf("?"))}if(movie_id.indexOf("&")>0){movie_id=movie_id.substr(0,movie_id.indexOf("&"))}}movie="http://www.youtube.com/embed/"+movie_id;(a("rel",pp_images[set_position]))?movie+="?rel="+a("rel",pp_images[set_position]):movie+="?rel=1";if(settings.autoplay){movie+="&autoplay=1"}toInject=settings.iframe_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,movie);break;case"vimeo":w=r(movie_width,movie_height);movie_id=pp_images[set_position];var H=/http(s?):\/\/(www\.)?vimeo.com\/(\d+)/;var G=movie_id.match(H);movie="http://player.vimeo.com/video/"+G[3]+"?title=0&amp;byline=0&amp;portrait=0";if(settings.autoplay){movie+="&autoplay=1;"}vimeo_width=w.width+"/embed/?moog_width="+w.width;toInject=settings.iframe_markup.replace(/{width}/g,vimeo_width).replace(/{height}/g,w.height).replace(/{path}/g,movie);break;case"quicktime":if(fromTrashView){$pp_pic_holder.find(".btn_addremove").removeClass().addClass("btn_addremove");$pp_pic_holder.find(".btn_addremove").addClass("btn_restorevideo");$pp_pic_holder.find(".btn_delete").removeClass().addClass("btn_delete btn_permadeletevideo")}$pp_pic_holder.find(".rt_endpointsync_text").addClass("hidden");switch(pp_mediaStatus[set_position]){case"add":$pp_pic_holder.find(".btn_addremove").addClass("btn_removefromphone");$pp_pic_holder.find(".rt_endpointsync_text.added_next_sync").removeClass("hidden");break;case"webonly":$pp_pic_holder.find(".btn_addremove").addClass("btn_addtophone");$pp_pic_holder.find(".rt_endpointsync_text.web_only").removeClass("hidden");break;case"remove":$pp_pic_holder.find(".btn_addremove").addClass("btn_addtophone");$pp_pic_holder.find(".rt_endpointsync_text.removed_next_sync").removeClass("hidden");break;case"onphone":$pp_pic_holder.find(".btn_addremove").addClass("btn_removefromphone");$pp_pic_holder.find(".rt_endpointsync_text.on_phone").removeClass("hidden");break}$pp_pic_holder.find(".btn_delete").removeClass("btn_deletephoto").addClass("btn_deletevideo");$pp_pic_holder.find(".btn_download").removeClass("btn_downloadphoto").addClass("btn_downloadvideo");$pp_pic_holder.find(".btn_addremove").off("click").on("click",function(){var K=e(this),J=e("#msg_loadingdialog").html(),I={};AMA.page.standardDialogs.loading(J);if(K.hasClass("btn_restorevideo")){if(AMA.config.enableReporting){I={};I.ActionPerformed="Restore Video - Trash Details Pane";AMA.debug("Reporting: Logging event for restore video to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.restorevideo,I)}AMA.models.trash.restore([imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();AMA.models.trash.invalidate();AMA.models.videos.invalidate();e.prettyPhoto.close()})}else{if(AMA.config.enableReporting){if(K.hasClass("btn_addtophone")){I.ActionPerformed="Add Video To Phone";AMA.debug("Reporting: Logging event for video added to phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.addvideotophone,I)}else{I.ActionPerformed="Remove Video From Phone";AMA.debug("Reporting: Logging event for video removed from phone");AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.removevideofrmphone,I)}}AMA.models.videos.addRemove($pp_pic_holder.find(".btn_addremove").hasClass("btn_addtophone")?"add":"remove","videos",[imageIds[set_position]],function(L,N){var M=N.list[0];AMA.page.standardDialogs.hideloading();if(L){if(K.hasClass("btn_addtophone")){K.removeClass("btn_addtophone").addClass("btn_removefromphone")}else{K.removeClass("btn_removefromphone").addClass("btn_addtophone")}$pp_pic_holder.find(".rt_endpointsync_text").addClass("hidden");if(M.pendingCreate){$pp_pic_holder.find(".rt_endpointsync_text.added_next_sync").removeClass("hidden")}else{if(M.pendingDelete&&M.onPhone){$pp_pic_holder.find(".rt_endpointsync_text.removed_next_sync").removeClass("hidden")}else{if(M.onPhone){$pp_pic_holder.find(".rt_endpointsync_text.on_phone").removeClass("hidden")}else{$pp_pic_holder.find(".rt_endpointsync_text.web_only").removeClass("hidden")}}}AMA.models.videos.invalidate()}})}});$pp_pic_holder.find(".btn_downloadvideo").off("click").on("click",function(){AMA.models.videos.downloadFile("video",imageIds[set_position],function(K){var J=K.mediaUrl.replace("content?","download?")+"&fileName="+K.fileName;AMA.Util.downloadFile(J)});if(AMA.config.enableReporting){var I={};I.ActionPerformed="Download Video";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.downloadvideo,I)}});$pp_pic_holder.find(".btn_deletevideo").on("click",function(){var I=e("#msg_confirm_delete_video").html();AMA.page.standardDialogs.confirm(I,function(){AMA.page.standardDialogs.hide();var K=e("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(K);AMA.models.videos.trash("video",[imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();e.prettyPhoto.close();if(L){AMA.models.videos.invalidate()}AMA.models.trash.invalidate()});if(AMA.config.enableReporting){var J={};J.ActionPerformed="Delete Video";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deletevideo,J)}})});$pp_pic_holder.find(".btn_permadeletevideo").on("click",function(){var I=e("#msg_confirm_delete_photo").html();AMA.page.standardDialogs.confirm(I,function(){AMA.page.standardDialogs.hide();var K=e("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(K);AMA.models.trash.trash([imageIds[set_position]],function(L){AMA.page.standardDialogs.hideloading();e.prettyPhoto.close();AMA.models.trash.invalidate()});if(AMA.config.enableReporting){var J={};J.ActionPerformed="Permanant Delete video - Trash Details Pane";AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes.deleterecordstrash,J)}})});w=r(movie_width,movie_height);w.height+=15;w.contentHeight+=15;w.containerHeight+=15;toInject=settings.quicktime_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,pp_images[set_position]).replace(/{autoplay}/g,settings.autoplay);break;case"flash":w=r(movie_width,movie_height);flash_vars=pp_images[set_position];flash_vars=flash_vars.substring(pp_images[set_position].indexOf("flashvars")+10,pp_images[set_position].length);filename=pp_images[set_position];filename=filename.substring(0,filename.indexOf("?"));toInject=settings.flash_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,filename+"?"+flash_vars);break;case"iframe":w=r(movie_width,movie_height);frame_url=pp_images[set_position];frame_url=frame_url.substr(0,frame_url.indexOf("iframe")-1);toInject=settings.iframe_markup.replace(/{width}/g,w.width).replace(/{height}/g,w.height).replace(/{path}/g,frame_url);break;case"ajax":doresize=false;w=r(movie_width,movie_height);doresize=true;skipInjection=true;e.get(pp_images[set_position],function(I){toInject=settings.inline_markup.replace(/{content}/g,I);$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;n()});break;case"custom":w=r(movie_width,movie_height);toInject=settings.custom_markup;break;case"inline":myClone=e(pp_images[set_position]).clone().append('<br clear="all" />').css({width:settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo(e("body")).show();doresize=false;w=r(e(myClone).width(),e(myClone).height());doresize=true;e(myClone).remove();toInject=settings.inline_markup.replace(/{content}/g,e(pp_images[set_position]).html());break}if(!imgPreloader&&!skipInjection){$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject;n()}});var F=pp_descriptions[set_position];e(".pp_pic_holder .fileSize span").html(F);return false}function n(){e(".pp_loaderIcon").hide();projectedTop=scroll_pos.scrollTop+((l/2)-(w.containerHeight/2));if(projectedTop<0){projectedTop=0}$ppt.fadeTo(settings.animation_speed,1);$pp_pic_holder.find(".pp_content").animate({height:w.contentHeight,width:w.contentWidth},settings.animation_speed);$pp_pic_holder.animate({top:projectedTop,left:((E/2)-(w.containerWidth/2)<0)?0:(E/2)-(w.containerWidth/2),width:w.containerWidth},settings.animation_speed,function(){$pp_pic_holder.find(".pp_hoverContainer,#fullResImage").height(w.height).width(w.width);$pp_pic_holder.find(".pp_fade").fadeIn(settings.animation_speed);if(isSet&&D(pp_images[set_position])=="image"){$pp_pic_holder.find(".pp_hoverContainer").show()}else{$pp_pic_holder.find(".pp_hoverContainer").hide()}if(settings.allow_expand){if(w.resized){e("a.pp_expand,a.pp_contract").show()}else{e("a.pp_expand").hide()}}if(settings.autoplay_slideshow&&!m&&!u){e.prettyPhoto.startSlideshow()}settings.changepicturecallback();u=true});g();i.ajaxcallback()}function s(F){$pp_pic_holder.find("#pp_full_res object,#pp_full_res embed").css("visibility","hidden");$pp_pic_holder.find(".pp_fade").fadeOut(settings.animation_speed,function(){e(".pp_loaderIcon").show();F()})}function o(F){if(AMA.config.useLegacyApi){(F>1)?e(".pp_nav").show():e(".pp_nav").hide()}else{e(".btn_mediaprev").show();e(".btn_medianext").show();if((imageIds.length-1)<2){e(".btn_mediaprev").hide();e(".btn_medianext").hide()}else{if(F<=0){e(".btn_mediaprev").hide()}else{if(F>=imageIds.length-1){e(".btn_medianext").hide()}}}}}function h(F){e(".btn_addremove").show();e(".btn_download").show();e(".btn_delete").show()}function r(G,F){resized=false;y(G,F);imageWidth=G,imageHeight=F;if(((B>E)||(A>l))&&doresize&&settings.allow_resize&&!p){resized=true,fitting=false;while(!fitting){if((B>E)){imageWidth=(E-200);imageHeight=(F/G)*imageWidth}else{if((A>l)){imageHeight=(l-200);imageWidth=(G/F)*imageHeight}else{fitting=true}}A=imageHeight,B=imageWidth}if((B>E)||(A>l)){r(B,A)}y(imageWidth,imageHeight)}if(B<i.min_width){B=i.min_width}if(x<i.min_width){x=i.min_width}return{width:Math.floor(imageWidth),height:Math.floor(imageHeight),containerHeight:Math.floor(A),containerWidth:Math.floor(B)+(settings.horizontal_padding*2),contentHeight:Math.floor(v),contentWidth:Math.floor(x),resized:resized}}function y(G,F){G=parseFloat(G);F=parseFloat(F);$pp_details=$pp_pic_holder.find(".pp_details");$pp_details.width(G);if(G<i.min_width){$pp_details.width(i.min_width)}detailsHeight=parseFloat($pp_details.css("marginTop"))+parseFloat($pp_details.css("marginBottom"));$pp_details=$pp_details.clone().addClass(settings.theme).width(G).appendTo(e("body")).css({position:"absolute",top:-10000});detailsHeight+=$pp_details.height();detailsHeight=(detailsHeight<=34)?36:detailsHeight;$pp_details.remove();$pp_title=$pp_pic_holder.find(".ppt");$pp_title.width(G);titleHeight=parseFloat($pp_title.css("marginTop"))+parseFloat($pp_title.css("marginBottom"));$pp_title=$pp_title.clone().appendTo(e("body")).css({position:"absolute",top:-10000});titleHeight+=$pp_title.height();$pp_title.remove();v=F+detailsHeight;x=G;A=v+titleHeight+$pp_pic_holder.find(".pp_top").height()+$pp_pic_holder.find(".pp_bottom").height();B=G}function D(F){if(F.match(/youtube\.com\/watch/i)||F.match(/youtu\.be/i)){return"youtube"}else{if(F.match(/vimeo\.com/i)){return"vimeo"}else{if(F.match(/.mov\b/i)||F.match(/.mp4\b/i)||F.match(/.3gp\b/i)){return"quicktime"}else{if(F.match(/.swf\b/i)){return"flash"}else{if(F.match(/\biframe=true\b/i)){return"iframe"}else{if(F.match(/\bajax=true\b/i)){return"ajax"}else{if(F.match(/\bcustom=true\b/i)){return"custom"}else{if(F.substr(0,1)=="#"){return"inline"}else{return"image"}}}}}}}}}function t(){if(doresize&&typeof $pp_pic_holder!="undefined"){scroll_pos=C();contentHeight=$pp_pic_holder.height(),contentwidth=$pp_pic_holder.width();projectedTop=(l/2)+scroll_pos.scrollTop-(contentHeight/2);if(projectedTop<0){projectedTop=0}if(contentHeight>l){return}$pp_pic_holder.css({top:projectedTop,left:(E/2)+scroll_pos.scrollLeft-(contentwidth/2)})}}function C(){if(self.pageYOffset){return{scrollTop:self.pageYOffset,scrollLeft:self.pageXOffset}}else{if(document.documentElement&&document.documentElement.scrollTop){return{scrollTop:document.documentElement.scrollTop,scrollLeft:document.documentElement.scrollLeft}}else{if(document.body){return{scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft}}}}}function z(){l=e(window).height(),E=e(window).width();if(typeof $pp_overlay!="undefined"){$pp_overlay.height(e(document).height()).width(E)}}function g(){if(isSet&&settings.overlay_gallery&&D(pp_images[set_position])=="image"){itemWidth=52+5;navWidth=(settings.theme=="facebook"||settings.theme=="pp_default")?50:30;itemsPerPage=Math.floor((w.containerWidth-100-navWidth)/itemWidth);itemsPerPage=(itemsPerPage<pp_images.length)?itemsPerPage:pp_images.length;totalPage=Math.ceil(pp_images.length/itemsPerPage)-1;if(totalPage==0){navWidth=0;$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").hide()}else{$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").show()}galleryWidth=itemsPerPage*itemWidth;fullGalleryWidth=pp_images.length*itemWidth;$pp_gallery.css("margin-left",-((galleryWidth/2)+(navWidth/2))).find("div:first").width(galleryWidth+5).find("ul").width(fullGalleryWidth).find("li.selected").removeClass("selected");goToPage=(Math.floor(set_position/itemsPerPage)<totalPage)?Math.floor(set_position/itemsPerPage):totalPage;e.prettyPhoto.changeGalleryPage(goToPage);$pp_gallery_li.filter(":eq("+set_position+")").addClass("selected")}else{$pp_pic_holder.find(".pp_content").unbind("mouseenter mouseleave")}}function k(F){if(settings.social_tools){facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href))}settings.markup=settings.markup.replace("{pp_social}","");e("body").append(settings.markup);$pp_pic_holder=e(".pp_pic_holder"),$ppt=e(".ppt"),$pp_overlay=e("div.pp_overlay");if(isSet&&settings.overlay_gallery){currentGalleryPage=0;toInject="";for(var G=0;G<pp_images.length;G++){if(!pp_images[G].match(/\b(jpg|jpeg|png|gif)\b/gi)){classname="default";img_src=""}else{classname="";img_src=pp_images[G]}toInject+="<li class='"+classname+"'><a href='#'><img src='"+img_src+"' width='50' alt='' /></a></li>"}toInject=settings.gallery_markup.replace(/{gallery}/g,toInject);$pp_pic_holder.find("#pp_full_res").after(toInject);$pp_gallery=e(".pp_pic_holder .pp_gallery"),$pp_gallery_li=$pp_gallery.find("li");$pp_gallery.find(".pp_arrow_next").click(function(){e.prettyPhoto.changeGalleryPage("next");e.prettyPhoto.stopSlideshow();return false});$pp_gallery.find(".pp_arrow_previous").click(function(){e.prettyPhoto.changeGalleryPage("previous");e.prettyPhoto.stopSlideshow();return false});itemWidth=52+5;$pp_gallery_li.each(function(H){e(this).find("a").click(function(){e.prettyPhoto.changePage(H);e.prettyPhoto.stopSlideshow();return false})})}if(settings.slideshow){$pp_pic_holder.find(".pp_nav").prepend('<a href="#" class="pp_play">Play</a>');$pp_pic_holder.find(".pp_nav .pp_play").click(function(){e.prettyPhoto.startSlideshow();return false})}$pp_pic_holder.attr("class","pp_pic_holder "+settings.theme);$pp_overlay.css({opacity:0,height:e(document).height(),width:e(window).width()}).bind("click",function(){if(!settings.modal){e.prettyPhoto.close()}});e("a.pp_close").bind("click",function(){e.prettyPhoto.close();return false});if(settings.allow_expand){e("a.pp_expand").bind("click",function(H){if(e(this).hasClass("pp_expand")){e(this).removeClass("pp_expand").addClass("pp_contract");doresize=false}else{e(this).removeClass("pp_contract").addClass("pp_expand");doresize=true}s(function(){e.prettyPhoto.open()});return false})}$pp_pic_holder.find(".pp_previous, .pp_nav .pp_arrow_previous").bind("click",function(){e.prettyPhoto.changePage("previous");e.prettyPhoto.stopSlideshow();return false});$pp_pic_holder.find(".pp_next, .pp_nav .pp_arrow_next").bind("click",function(){e.prettyPhoto.changePage("next");e.prettyPhoto.stopSlideshow();return false});t()}if(!pp_alreadyInitialized&&d()){pp_alreadyInitialized=true;hashIndex=d();hashRel=hashIndex;hashIndex=hashIndex.substring(hashIndex.indexOf("/")+1,hashIndex.length-1);hashRel=hashRel.substring(0,hashRel.indexOf("/"));setTimeout(function(){e("a["+i.hook+"^='"+hashRel+"']:eq("+hashIndex+")").trigger("click")},50)}return this.unbind("click.prettyphoto").bind("click.prettyphoto",e.prettyPhoto.initialize)};function d(){var f=location.href;hashtag=(f.indexOf("#prettyPhoto")!==-1)?decodeURI(f.substring(f.indexOf("#prettyPhoto")+1,f.length)):false;return hashtag}function b(){if(typeof theRel=="undefined"){return}location.hash=theRel+"/"+rel_index+"/"}function c(){if(location.href.indexOf("#prettyPhoto")!==-1){location.hash="prettyPhoto"}}function a(h,g){h=h.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var f="[\\?&]"+h+"=([^&#]*)";var k=new RegExp(f);var i=k.exec(g);return(i==null)?"":i[1]}})(jQuery);var pp_alreadyInitialized=false;
/*! TableMaker */
(function(){TableMaker=function(c,b){var a=arguments.callee;if(!(this instanceof a)){return new a(c,b)}this.__init__(c,b)};TableMaker.prototype={__class__:TableMaker,__init__:function(b,a){this.columns=b;this.elements=0;this.options=$.extend({},{columnClass:"tm_td",rowClass:"tm_tr",tableClass:"tm_table"},a||{});this.html="<table class='"+this.options.tableClass+"'>"},add:function(a){if(this.elements%this.columns==0){this.html+="<tr class='"+this.options.rowClass+"'>"}this.html+="<td class='"+this.options.columnClass+"'>";this.html+=a;this.html+="<td>";this.elements++;if(this.elements%this.columns==0){this.html+="</tr>"}},close:function(){this.html+="</tr>";this.html+="</table>";return this.html}}})();
/*! Endpoints */
(function(){AMA.namespace("model");var a=AMA.model.Endpoints=AMA.model.BaseData.extend();a.RESOURCE="device_info";a.MODEL=AMA.model.BaseData.MODEL.extend({defaults:{announceSupported:"",contactsSupported:"",endpointid:0,fileStorageLimit:"",interactiveGuideUrls:"",locationCheckSupported:"",lostPhoneSupported:"",maxchars:{},name:"",platform:"",platformfriendlyname:"",pollingSupported:"",premiumBackupSupported:"",recoverySupported:"",retry:{},safeBrowsingSupported:"",securityActionPendingSupported:"",syncAndOrWipeSupported:"",synctimes:[],version:"",wakeupSupported:""}});AMA.augment(a.prototype,{_configureFetchOptions:function(b){},_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/devices/"+AMA.config.endpointId+"?"+$.param({devId:AMA.config.devId,authToken:AMA.config.authToken})},parse:function(c){var b=this.constructor.MODEL.prototype.defaults;b.announceSupported=c.applicationVersion.announce;b.contactsSupported=c.applicationVersion.contacts;b.endpointid=c.endpointId;b.name=c.displayName;b.platform=c.platformName;b.platformfriendlyname="";b.premiumBackupSupported=c.applicationVersion.premiumBackup;b.recoverySupported=c.applicationVersion.recovery;b.safeBrowsingSupported=c.applicationVersion.safeBrowsing;b.securityActionPendingSupported=c.applicationVersion.securityActionsPending;b.syncAndOrWipeSupported=c.applicationVersion.syncAndOrWipe;b.version='{"feature-version": '+c.applicationVersion.featureVersion+',"device-os-version": '+c.applicationVersion.deviceOsVersion+',"app-version": '+c.applicationVersion.appVersion+"}";b.wakeupSupported=c.applicationVersion.noWakeup;return b}})})();
/*! DashboardData */
(function(){AMA.namespace("model");var a=AMA.model.DashboardData=AMA.model.BaseData.extend();a.RESOURCE="accountSettings";a.URL={ENDPOINT:"accounts",KEYWORDS:{ACCOUNT_PREFERENCES:"preferences",CHANGE_PASSWORD:"changePassword",SECURE_ACCOUNT_PREFERENCES:"secureAccountPreferences",UPDATE_EMAIL:"updateEmail"}};a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/"+a.URL.ENDPOINT+"/"+AMA.config.accountDetails.accountId+"/"+a.URL.KEYWORDS.ACCOUNT_PREFERENCES+"?"+$.param({devId:AMA.config.devId,authToken:AMA.config.authToken})},_buildUpdateUrl:function(b,d){var c=AMA.config.apiHostUrl+"/"+a.URL.ENDPOINT+"/"+AMA.config.accountDetails.accountId+"/"+b+"?"+$.param({devId:AMA.config.devId,authToken:AMA.config.authToken});if(d&&d.endpointId){c+="&"+$.param({endpointId:AMA.config.endpointId})}return c},fetch:function(c){if(this.isFetching){return}this.isFetching=true;c=c||{};c.reset=true;this._configureFetchOptions(c);var b=c.complete,d=this;c.complete=_.bind(function(){this.isLoaded=true;this.isFetching=false;if(c.callback&&typeof c.callback=="function"){c.callback()}if(b){b.apply(arguments)}},this);c.success=function(){d.isLoaded=true;d.isFetching=false;if(c.callback&&typeof c.callback=="function"){c.callback()}if(b){b.apply(arguments)}};Backbone.Collection.prototype.fetch.call(this,c)},saveAccountInfo:function(c,d){var b={};b.cache=false;b.complete=function(h){try{var f=JSON.parse(h.responseText)}catch(g){f=h.responseText||h}d(f)};b.contentType="application/json;charset=UTF-8";b.data=JSON.stringify(c);b.error=function(){AMA.error("Request returned an error")};b.url=this._buildUpdateUrl(a.URL.KEYWORDS.UPDATE_EMAIL);this.sync("update",this,b)},saveNewPassword:function(d,e){var b={},c={endpointId:true};b.cache=false;b.complete=function(g){var f=g.responseText||g;e(JSON.parse(f)||f)};b.contentType="application/json;charset=UTF-8";b.data=JSON.stringify(d);b.error=function(){var f={error:"Invalid Password"};e(f)};b.url=this._buildUpdateUrl(a.URL.KEYWORDS.CHANGE_PASSWORD,c);this.sync("update",this,b)},saveSecurityQA:function(c,d){var b={};b.cache=false;b.callback=d;b.complete=function(e){d(true,e.responseText===AMA.config.accountDetails.accountId?e.responseText:JSON.parse(e.responseText))};b.success=function(){d(true,this.responseText===AMA.config.accountDetails.accountId?this.responseText:JSON.parse(this.responseText))};b.contentType="application/json;charset=UTF-8";b.data=JSON.stringify(c);b.error=function(){AMA.error("Request returned an error")};b.url=this._buildUpdateUrl(a.URL.KEYWORDS.SECURE_ACCOUNT_PREFERENCES);this.sync("update",this,b)}})})();
/*! DeviceSettings */
(function(){AMA.namespace("model");var a=AMA.model.DeviceSettings=AMA.model.BaseData.extend();a.RESOURCE="device_info";a.MODEL=AMA.model.BaseData.MODEL.extend({defaults:{_meta:{},android_device_admin:0,current_lockstatus:0,data_wiped:0,id:"",locationcheck_on:0,smsDisabled:false,visibility:"",href:"",active:false}});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/devices/"+AMA.config.endpointId+"/state?"+$.param({devId:AMA.config.devId,authToken:AMA.config.authToken})},parse:function(c){var b=this.constructor.MODEL.prototype.defaults;b.id=c.endpointId;b.android_device_admin=c.situation.deviceAdminEnabled?1:0;b.current_lockstatus=c.situation.screenLocked?1:0;b.data_wiped=c.situation.dataWiped?1:0;b.locationcheck_on=c.situation.locationCheckEnabled?1:0;b.smsDisabled=c.smsDisabled;b.visibility=c.visibility;b.href=c.href;b.active=c.active;return b}})})();(function(){var n={sync:function(w,s,r){var v={type:"POST",dataType:"json"};_.defaults(r||(r={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});if(!r.url){v.url=_.result(s,"url")||urlError()}if(r.data==null&&s&&(w==="create"||w==="update"||w==="patch")){v.contentType="application/json";v.data=JSON.stringify(r.attrs||s.toJSON(r))}if(r.emulateJSON){v.contentType="application/x-www-form-urlencoded";v.data=v.data?{model:v.data}:{}}if(r.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){v.type="POST";if(r.emulateJSON){v.data._method=type}var t=r.beforeSend;r.beforeSend=function(x){x.setRequestHeader("X-HTTP-Method-Override",type);if(t){return t.apply(this,arguments)}}}if(v.type==="PATCH"&&window.ActiveXObject&&!(window.external&&window.external.msActiveXFilteringEnabled)){v.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var u=r.xhr=Backbone.ajax(_.extend(v,r));s.trigger("request",s,u,r);return u},parse:function(s){var y=[],v,t,A=null,u=null,r=null,z="",x=this.constructor.LEGACY_RECORD_TYPE.fields;function w(C){var B;for(B in x){if(C.indexOf(x[B])==0){return B}}return false}for(v=0;v<s.length;v++){A=s[v];if(A.rt!==this.constructor.LEGACY_RECORD_TYPE.id){continue}r={};if(A.ri){r.id=A.ri}u=A.dt;if(u&&typeof u==="object"){for(t in u){z=w(t);if(z){if(r[z]){if(r[z+"2"]){r[z+"3"]=u[t]}else{r[z+"2"]=u[t]}}else{r[z]=u[t]}}}}r._meta={};for(t in A){if(t==="ri"){continue}r._meta[t]=A[t]}y.push(r)}return y},_configureUrl:function(){this.url=AMA.config.legacyApiBaseUrl+"/records.poo?"},_configureFetchOptions:function(r){r.data={method:"retrieve",recordtype:this.constructor.LEGACY_RECORD_TYPE.id,csrfvalue:AMA.config.csrfToken}}};var p=AMA.model.UserData;if(p){p.actionMethods={UPDATE_VISIBILITY:"setEnabledDataInAccount",ADD_TO_DEVICE:"addToEndpoint",REMOVE_FROM_DEVICE:"deleteFromEndpoint",addToGroup:"addToGroup",removeFromGroup:"removeFromGroup"};var q={};_.extend(q,n,{sync:function(x,s,r){var u={};if(x==="update"){var w=s.toJSON();var t=[];var v=this;_.each(w,function(z,y){var A={dt:{},vi:parseInt(z.status),ri:z.id,se:z._meta.se,sh:z._meta.sh,io:z._meta.io,vo:z.onPhone?[AMA.currentEndpoint]:[],pd:z.pendingDelete?[AMA.currentEndpoint]:[],ic:z.isCurrent,dg:z._meta.dg,cp:z._meta.cp,pc:z.pendingCreate?[AMA.currentEndpoint]:[],oai:z._meta.oai,pu:z.pendingUpdate?[AMA.currentEndpoint]:[],rt:z._meta.rt};t.push(v._prepareData(z,A,s.statusUpdated))});var u={url:this.url+"?"+$.param(this._getParams(s,{csrfvalue:AMA.config.csrfToken})),wait:true,cache:false,contentType:"application/json; charset=utf-8",data:s.statusUpdated?JSON.stringify(t):encodeURIComponent(JSON.stringify(t)),dataType:"json"};r=r||{};r.success=r.success||function(B,D,C){if(D!=null&&!D.failures){var A=v.parse(B),z=_.find(B,function(E){return E.rt===AMA.config.legacyRecordTypes.PHOTO.id}),y=_.find(B,function(E){return E.rt===AMA.config.legacyRecordTypes.VIDEO.id});v.set(A,{remove:false});if(z){AMA.models.photos.invalidate()}if(y){AMA.models.videos.invalidate()}v.trigger("collect")}};r.error=r.error||function(y){s.trigger("error",s,y,r)};s.statusUpdated=false;s.mustAddToPhone=false;s.mustRemoveFromPhone=false}_.extend(u,r);return n.sync.call(this,x,s,u||{})},parse:function(u){var r=AMA.config,t=AMA.currentEndpoint;var s=n.parse.call(this,u);s=_.reject(s,function(v){return v._meta[r.legacyMetaFields.visibility]===p.Status.PURGED});_.each(s,function(w,v){w.isCurrent=w._meta[r.legacyMetaFields.isCurrent];w.status=w._meta[r.legacyMetaFields.visibility];w.onPhone=_.contains(w._meta[r.legacyMetaFields.visible],t);w.pendingCreate=_.contains(w._meta[r.legacyMetaFields.pendingCreate],t);w.pendingDelete=_.contains(w._meta[r.legacyMetaFields.pendingDelete],t);w.pendingUpdate=_.contains(w._meta[r.legacyMetaFields.pendingUpdate],t)});return s},trash:function(r){this.get(r).set("status",p.Status.TRASHED,{silent:true});this.statusUpdated=true},restore:function(r){this.get(r).set("status",p.Status.ENABLED,{silent:true});this.statusUpdated=true},purge:function(r){this.get(r).set("status",p.Status.PURGED,{silent:true});this.statusUpdated=true},addToPhone:function(s){var r=this.get(s);if(r.get("onPhone")){r.set("pendingDelete",false,{silent:true})}r.set("pendingCreate",true,{silent:true});this.mustAddToPhone=true},removeFromPhone:function(s){var r=this.get(s);r.set("pendingDelete",true,{silent:true});this.mustRemoveFromPhone=true},_getParams:function(r,s){s=s||{};if(r.statusUpdated){s.method=p.actionMethods.UPDATE_VISIBILITY}else{if(r.mustAddToPhone){s.endpointid=AMA.currentEndpoint;s.method=p.actionMethods.ADD_TO_DEVICE}else{if(r.mustRemoveFromPhone){s.endpointid=AMA.currentEndpoint;s.method=p.actionMethods.REMOVE_FROM_DEVICE}else{s.method="updateInAccount"}}}return s},_prepareData:function(u,t){var s=t;var r=AMA.config.legacyRecordTypes.CONTACT.fields;if(u._meta.rt==AMA.config.legacyRecordTypes.PHOTO.id){r=AMA.config.legacyRecordTypes.PHOTO.fields}else{if(u._meta.rt==AMA.config.legacyRecordTypes.VIDEO.id){r=AMA.config.legacyRecordTypes.VIDEO.fields}}_.each(u,function(y,w){var v=r[w];if(typeof v!=="undefined"){var x=v.split("-");if(y!==""){if(x.length==2){s.dt[v+"-0-0"]=y}else{s.dt[v]=y}}}});return s}})}var c=AMA.model&&AMA.model.BaseData;AMA.assert(c,"LegacyApiSupport requires AMA.model.BaseData class to be defined.");var k=AMA.config&&AMA.config.legacyModels;if(!k){return}var g=AMA.model.Endpoints;if(g&&_.contains(k,"Endpoints")){_.extend(g.prototype,n);_.extend(g.prototype,{fetch:function(){var s=this,r={url:AMA.config.legacyApiBaseUrl+"/account.poo?method=retrieveEndpoints&csrfvalue="+AMA.config.csrfToken,success:function(t){s.parse(t)}};return c.prototype.fetch.call(this,r)},parse:function(v){var u=v[0];if(u){var r=AMA.config.legacyRecordTypes.CONTACT.fields;function t(x){var w;for(w in r){if(x.indexOf(r[w])==0){return w}}return false}var s={};_.each(u.maxchars,function(x,w,z){var y=t(w);if(y){if(s[y]){if(s[y+"2"]){s[y+"3"]=u.maxchars[w]}else{s[y+"2"]=u.maxchars[w]}}else{s[y]=u.maxchars[w]}}});u.maxchars=s}return v},_configureFetchOptions:function(r){}})}var o=AMA.model.DashboardData;if(o&&_.contains(k,"DashboardData")){_.extend(o.prototype,n);_.extend(o.prototype,{fetch:function(){var s=this,r={url:AMA.config.legacyApiBaseUrl+"/webapi.poo?method=getAccountInfo&csrfvalue="+AMA.config.csrfToken,success:function(t){s.parse(t)}};return c.prototype.fetch.call(this,r)},parse:function(r){return r},_configureFetchOptions:function(r){}})}var l=AMA.model.Contacts;if(l&&_.contains(k,"Contacts")){_.extend(l.prototype,q);_.extend(l.prototype,{add:function(t,s){if(t.attributes){var r=[t.attributes[0]];t=this.parse(r)}return c.prototype.add.call(this,t,s)},create:function(v,t){var x=this,s={method:"createInAccount",csrfvalue:AMA.config.csrfToken},w={url:this.url+"?"+$.param(s),wait:true,contentType:"application/json; charset=utf-8",dataType:"json",emulateHTTP:true},u={dt:{},cp:{},rt:33620224,pc:v.pendingCreate?[AMA.currentEndpoint]:[]},r=this._prepareData(v,u);_.extend(w,t);return c.prototype.create.call(this,r,w)},_prepareData:function(u,t,s){var r=t;function v(x,w){if(!u||!u._meta){return false}for(field in u._meta.dt){if(field.indexOf(x)>-1){w--;if(w==0){return field}}}return false}_.each(u,function(B,y){var x=AMA.config.legacyRecordTypes.CONTACT.fields[y];var A={cellPhone:1,cellPhone2:2,cellPhone3:3,workPhone:1,workPhone2:2,workPhone3:3,email:1,email2:2,email3:3,im:1,im2:2,im3:3};if(A[y]){var w=v(x,A[y]);if(w){x=w}else{if(r.dt[x+"-0-0"]){if(r.dt[x+"-0-1"]){x=x+"-0-2"}else{x=x+"-0-1"}}else{x=x+"-0-0"}}}if(typeof x!=="undefined"){var z=x.split("-");if(B!==""){if(z.length==2){r.dt[x+"-0-0"]=B;if(!s){if(r.cp){r.cp[x+"-0-0"]={}}if(r.se){r.se[x+"-0-0"]=[0]}}}else{r.dt[x]=B;if(!s){if(r.cp){r.cp[x]={}}if(r.se){r.se[x]=[0]}}}}}});return r}});l.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.CONTACT}var d=AMA.model.Photos;if(d&&_.contains(k,"Photos")){d.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.PHOTO;_.extend(d.prototype,q);_.extend(d.prototype,{parse:function(y){var s,r,x,w=[],v=null,t=null;function u(A,B){var z;for(z in d.LEGACY_RECORD_TYPE.fields){if(B==d.LEGACY_RECORD_TYPE.fields[z]){return z}else{if(A[B].toString().indexOf(d.LEGACY_RECORD_TYPE.fields[z])>-1){return z}}}return false}for(s=0;s<y.length;s++){t=y[s];if(t.rt!==this.constructor.LEGACY_RECORD_TYPE.id){continue}x={};if(t.ri){x.id=t.ri}v=t.dt;if(v&&typeof v==="object"){for(r in v){key=u(v,r);if(key){x[key]=v[r]}}}x._meta={};for(r in t){if(r==="ri"){continue}x._meta[r]=t[r]}w.push(x)}_.each(w,function(B,z){var A=AMA.config,C=AMA.currentEndpoint;B.isCurrent=B._meta[A.legacyMetaFields.isCurrent];B.status=B._meta[A.legacyMetaFields.visibility];B.onPhone=_.contains(B._meta[A.legacyMetaFields.visible],C);B.pendingCreate=_.contains(B._meta[A.legacyMetaFields.pendingCreate],C);B.pendingDelete=_.contains(B._meta[A.legacyMetaFields.pendingDelete],C);B.pendingUpdate=_.contains(B._meta[A.legacyMetaFields.pendingUpdate],C)});return w}})}var i=AMA.model.Videos;if(i&&_.contains(k,"Videos")){i.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.VIDEO;_.extend(i.prototype,q);_.extend(i.prototype,{parse:function(y){var s,r,x,w=[],v=null,t=null;function u(A,B){var z;for(z in i.LEGACY_RECORD_TYPE.fields){if(B==i.LEGACY_RECORD_TYPE.fields[z]){return z}else{if(A[B].toString().indexOf(i.LEGACY_RECORD_TYPE.fields[z])>-1){return z}}}return false}for(s=0;s<y.length;s++){t=y[s];if(t.rt!==this.constructor.LEGACY_RECORD_TYPE.id){continue}x={};if(t.ri){x.id=t.ri}v=t.dt;if(v&&typeof v==="object"){for(r in v){key=u(v,r);if(key&&!x[key]){x[key]=v[r]}}}x._meta={};for(r in t){if(r==="ri"){continue}x._meta[r]=t[r]}w.push(x)}_.each(w,function(B,z){var A=AMA.config,C=AMA.currentEndpoint;B.isCurrent=B._meta[A.legacyMetaFields.isCurrent];B.status=B._meta[A.legacyMetaFields.visibility];B.onPhone=_.contains(B._meta[A.legacyMetaFields.visible],C);B.pendingCreate=_.contains(B._meta[A.legacyMetaFields.pendingCreate],C);B.pendingDelete=_.contains(B._meta[A.legacyMetaFields.pendingDelete],C);B.pendingUpdate=_.contains(B._meta[A.legacyMetaFields.pendingUpdate],C)});return w}})}var h=AMA.model.Trash;if(h&&_.contains(k,"Trash")){h.LEGACY_RECORD_TYPE={};_.extend(h.prototype,q);_.extend(h.prototype,{trashedContacts:[],trashedPhotos:[],trashedVideos:[],initialize:function(){h.__super__.initialize.apply(this,arguments);var r=this;if(AMA.models.contacts){AMA.models.contacts.on("reset",function(){r._collectContacts.call(r)});AMA.models.contacts.on("collect",function(){r._collectContacts.call(r)})}if(AMA.models.photos){AMA.models.photos.on("reset",function(){r._collectPhotos.call(r)});AMA.models.photos.on("collect",function(){r._collectPhotos.call(r)})}if(AMA.models.videos){AMA.models.videos.on("reset",function(){r._collectVideos.call(r)});AMA.models.videos.on("collect",function(){r._collectVideos.call(r)})}},sync:function(w,u,r){var t=[],v=[],s=[];_.each(u.models,function(x){if(x.constructor===AMA.model.Contacts.MODEL){t.push(x)}else{if(x.constructor===AMA.model.Photos.MODEL){v.push(x)}else{if(x.constructor===AMA.model.Videos.MODEL){s.push(x)}}}});if(t.length>0){AMA.models.contacts.sync("update",new AMA.model.Contacts(t))}if(v.length>0){AMA.models.photos.sync("update",new AMA.model.Photos(v))}if(s.length>0){AMA.models.videos.sync("update",new AMA.model.Videos(s))}},fetch:function(){if(AMA.models.contacts&&!AMA.models.contacts.isLoaded){AMA.models.contacts.fetch()}if(AMA.models.photos&&!AMA.models.photos.isLoaded){AMA.models.photos.fetch()}if(AMA.models.videos&&!AMA.models.videos.isLoaded){AMA.models.videos.fetch()}},_collectContacts:function(){this.trashedContacts=[];this._collectTrashed(AMA.models.contacts,this.trashedContacts);this._checkIfAllTrashCollected()},_collectPhotos:function(){this.trashedPhotos=[];this._collectTrashed(AMA.models.photos,this.trashedPhotos);this._checkIfAllTrashCollected()},_collectVideos:function(){this.trashedVideos=[];this._collectTrashed(AMA.models.videos,this.trashedVideos);this._checkIfAllTrashCollected()},_collectTrashed:function(u,s){var r=[],t=false,v=u.models;_.each(v,function(x,w){if(x.get("status")===AMA.model.UserData.Status.TRASHED){r.push(x.get("id"))}else{if(this.get(x.get("id"))){this.remove(x,{silent:true});t=true}}},this);if(t){this.trigger("remove")}t=false;_.each(r,function(y,x){var w=u.get(y);if(w){s.push(w);u.remove(w,{silent:true});t=true}},this);if(t){u.trigger("remove")}},_checkIfAllTrashCollected:function(){var s=this.trashedContacts.concat(this.trashedPhotos).concat(this.trashedVideos);this.set(s,{remove:false,silent:true});this.trigger("change");var r=AMA.models.contacts.isLoaded&&AMA.models.photos.isLoaded&&AMA.models.videos.isLoaded;if(!r){return}this.trigger("reset")}})}var b=function(v,s,y){var w,t,r,A,B,u,z=[];function x(D){var C;for(C in y){if(u[D].indexOf(y[C])>-1){return C}}return false}for(w=0;w<s.length;w++){B=s[w];if(B.rt!==v.constructor.LEGACY_RECORD_TYPE.id){continue}r={};if(B.ri){r.id=B.ri}u=B.dt;if(u&&typeof u==="object"){for(t in u){A=x(t);if(A){if(r[A]){if(r[A+"2"]){r[A+"3"]=u[t]}else{r[A+"2"]=u[t]}}else{r[A]=u[t].substr(u[t].indexOf("=")+1)}}}}r._meta={};for(t in B){if(t==="ri"){continue}r._meta[t]=B[t]}z.push(r)}return z};var a=AMA.model.SyncSettings;if(a&&_.contains(k,"SyncSettings")){a.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS;_.extend(a.prototype,n);_.extend(a.prototype,{parse:function(v){var r=AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.syncSettingsFields;var u=[];var s=0;if(v.length>1){for(var t=0;t<v.length;t++){if(v[t].ic===true){s=t;AMA.debug("IC - is current, INDEX VALUE: "+s)}}}if(v[s]!==null&&v[s]!==undefined&&v[s]!==""){if(v[s].ri!==null&&v[s].ri!==undefined&&v[s].ri!==""){u=b(this,[v[s]],r)}}return u},sync:function(r,y,B){var t={};if(r==="update"){var x=[];var s=this;var z="2U-01";var A={};var w=[];syncSettingsFields=AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.syncSettingsFields;w=[syncSettingsFields.autobackup_frequency+"="+y.get("autobackup_frequency"),syncSettingsFields.autobackup_minimum_battery_level+"="+y.get("autobackup_minimum_battery_level"),syncSettingsFields.autobackup_pictures+"="+y.get("autobackup_pictures"),syncSettingsFields.autobackup_videos+"="+y.get("autobackup_videos"),syncSettingsFields.autobackup_contacts+"="+y.get("autobackup_contacts"),syncSettingsFields.autobackup_wifi+"="+y.get("autobackup_wifi"),syncSettingsFields.autobackup_carrier+"="+y.get("autobackup_carrier"),syncSettingsFields.autobackup_day+"="+y.get("autobackup_day"),syncSettingsFields.locationcheck_on+"="+y.get("locationcheck_on"),syncSettingsFields.gps_interval+"="+y.get("gps_interval"),syncSettingsFields.gps_battery+"="+y.get("gps_battery")];var u={};_.each(w,function(D,C){u[z+"-0-"+C]=D});var v={dt:u,vi:0,ri:s.models[0].get("id"),io:true,rt:AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.id};x.push(v);var t={url:this.url+"?"+$.param(this._getParams(y,{csrfvalue:AMA.config.csrfToken})),wait:true,cache:false,contentType:"application/json; charset=utf-8",data:y.statusUpdated?JSON.stringify(x):encodeURIComponent(JSON.stringify(x)),dataType:"json"};B=B||{};B.success=B.success||function(D,F,E){if(F!=null&&!F.failures){var C=s.parse(D)}};B.error=B.error||function(C){y.trigger("error",y,C,B)}}_.extend(t,B);return n.sync.call(this,r,y,t||{})},_getParams:function(r,s){s=s||{};s.method="updateInAccount";return s}})}var e=AMA.model.DeviceSettings;if(e&&_.contains(k,"DeviceSettings")){e.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS;_.extend(e.prototype,n);_.extend(e.prototype,{_configureUrl:function(){this.url=AMA.config.legacyApiBaseUrl+"/records.poo?"},parse:function(t){var r=AMA.config.legacyRecordTypes.ACCOUNT_SETTINGS.deviceSettingsFields,s=b(this,t,r);return s}})}var m=AMA.model.Locations;if(m&&_.contains(k,"Locations")){m.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.LOCATIONS;_.extend(m.prototype,n);_.extend(m.prototype,{parse:function(s){var u,y=[],B=null,r=null,t=null,w=this.constructor.LEGACY_RECORD_TYPE.fields;function v(D){var C;for(C in w){if(D.indexOf(w[C])==0){return C}}return false}for(u=0;u<s.length;u++){B=s[u];if(B.rt!==this.constructor.LEGACY_RECORD_TYPE.id||(AMA.config.locationConsolidation&&(s.length>1&&B.ri!=-2))||(!AMA.config.locationConsolidation&&(s.length>1&&u>0))){continue}r={};if(B.ri){r.id=B.ri}t=B.dt;if(t&&typeof t==="object"){for(j in t){var A=v(j);if(A){var z=j.split("-");var x=parseInt(z[3]);if(y[x]){y[x][A]=t[j]}else{y[x]={};y[x].id=x;y[x][A]=t[j]}}}}}return y.reverse()},clearDuplicateLocations:function(){var s;AMA.debug("clearDuplicateLocations - Locations.models.length: "+this.models.length);var u=[];for(var t=0;t<this.models.length;t++){var r=this.models[t];var x=r.get("coordinates");if(s){var w=s.get("coordinates");if(w==x){AMA.debug("clearDuplicateLocations - previousLatLong == currentLatLong: "+x);s.set("timeRange",r.get("time"),{silent:true});AMA.debug("clearDuplicateLocations - timeRange: "+s.get("timeRange"));AMA.debug("clearDuplicateLocations - time: "+s.get("time"));var v=r.get("accuracy");if(v<s.get("accuracy")){s.set("accuracy",v,{silent:true})}this.remove(r,{silent:true});t--;continue}}s=r}if(this.models.length<AMA.config.locationHistoryLimit){this.numberOfPoints=this.models.length}else{this.numberOfPoints=AMA.config.locationHistoryLimit}},removeAll:function(){},sync:function(w,v,r){r=r||{};var s={};if(w==="delete"){var u=$.param({method:"nuke",recordtype:this.constructor.LEGACY_RECORD_TYPE.id,csrfvalue:AMA.config.csrfToken});s={url:this.url+"?"+u,wait:true,cache:false,contentType:"application/json; charset=utf-8",dataType:"json"};var t=this;r.success=r.success||function(x,z,y){t.reset([])};r.error=r.error||function(x){t.trigger("error",model,x,r)}}_.extend(s,r);return n.sync.call(this,w,v,s||{})}})}var f=AMA.model.EndpointHistory;if(f&&_.contains(k,"EndpointHistory")){f.LEGACY_RECORD_TYPE=AMA.config.legacyRecordTypes.STATUS;_.extend(f.prototype,n);_.extend(f.prototype,{fetch:function(){var s=this,r={url:AMA.config.legacyApiBaseUrl+"/records.poo?method=retrieveEndpointHistory&endpointid="+AMA.currentEndpoint+"&recordtype="+AMA.config.legacyRecordTypes.STATUS.id+"&max=10&desc=true&csrfvalue="+AMA.config.csrfToken,remove:false,merge:false,success:function(u,t){return s.parse(t)}};return c.prototype.fetch.call(this,r)},parse:function(s){var y=[],v,t,A=null,u=null,r=null,z="",x=this.constructor.LEGACY_RECORD_TYPE.fields;function w(C){var B;for(B in x){if(C.indexOf(x[B])==0){return B}}return false}for(v=0;v<s.length;v++){A=s[v];if(A.rt!==this.constructor.LEGACY_RECORD_TYPE.id){continue}r={};if(A.ri){r.id=A.ri+""+v}u=A.dt;if(u&&typeof u==="object"){for(t in u){z=w(t);if(z){if(r[z]){if(r[z+"2"]){r[z+"3"]=u[t]}else{r[z+"2"]=u[t]}}else{r[z]=u[t]}}}}r._meta={};for(t in A){if(t==="ri"){continue}r._meta[t]=A[t]}y.push(r)}return y},_configureFetchOptions:function(r){}})}})();
/*! StorageInfo */
(function(){AMA.namespace("model");var a=AMA.model.StorageInfo=AMA.model.BaseData.extend();a.RESOURCE="storageInfo";a.URL="/storageInfo?";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureFetchOptions:function(b){},_configureUrl:function(){this.url=AMA.config.apiHostUrl+a.URL+"devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken}})})();
/*! ContactsSummary */
(function(){AMA.namespace("model");var a=AMA.model.ContactSummary=AMA.model.BaseData.extend();a.RESOURCE="contacts";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/"+a.RESOURCE+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken,status:AMA.model.UserData.Status.ENABLED,limit:0})}})})();
/*! PhotoSummary */
(function(){AMA.namespace("model");var a=AMA.model.PhotosSummary=AMA.model.BaseData.extend();a.RESOURCE="files";a.FILETYPE="image";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/files?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,fileType:a.FILETYPE,authToken:AMA.config.authToken,status:AMA.model.UserData.Status.ENABLED,limit:0})}})})();
/*! VideoSummary */
(function(){AMA.namespace("model");var a=AMA.model.VideosSummary=AMA.model.BaseData.extend();a.RESOURCE="files";a.FILETYPE="video";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+"/files?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,fileType:a.FILETYPE,authToken:AMA.config.authToken,status:AMA.model.UserData.Status.ENABLED,limit:0})}})})();
/*! LocateSettings */
(function(){AMA.namespace("model");var a=AMA.model.LocateSettings=AMA.model.BaseData.extend();a.URL="/eventSettings";a.RESOURCE="eventSettings";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+a.URL+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken}})})();
/*! SyncHistory */
(function(){AMA.namespace("model");var a=AMA.model.SyncHistory=AMA.model.BaseData.extend();a.URL="/syncHistory?";a.RESOURCE="syncHistory";a.MODEL=AMA.model.BaseData.MODEL.extend({});AMA.augment(a.prototype,{_configureUrl:function(){this.url=AMA.config.apiHostUrl+a.URL+"devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken},_configureFetchOptions:function(b){}})})();
/*! SyncSettings */
(function(){AMA.namespace("model");var a=AMA.model.SyncSettings=AMA.model.BaseData.extend();a.RESOURCE="mediaSettings";a.URL="/mediaSettings";a.MODEL=AMA.model.BaseData.MODEL.extend({});_.extend(a.prototype,{})})();
/*! ScanSettings */
(function(){AMA.namespace("model");var a=AMA.model.ScanSettings=AMA.model.BaseData.extend();a.RESOURCE="appSecuritySettings";a.URL="/appSecuritySettings";a.MODEL=AMA.model.BaseData.MODEL.extend({});_.extend(a.prototype,{})})();
/*! EndpointHistory */
(function(){AMA.namespace("model");var a=AMA.model.EndpointHistory=AMA.model.BaseData.extend();a.RESOURCE="eventActionHistory";a.MODEL=AMA.model.BaseData.MODEL.extend({});a.MAX_ITEMS=10;a.INCLUDED_ACTIONS=["sync","gpsrefresh","wipe","wipefactory","lock","soundalert","announce","security","startScan","scanHealthStart","GPS_BATTERY","GPS_INTERVAL","LOCATIONCHECK_ON"];AMA.augment(a.prototype,{_configureUrl:function(){a.__super__._configureUrl.apply(this,arguments);this.url+="&limit="+a.MAX_ITEMS},parse:function(d){var b=a.__super__.parse.apply(this,arguments),c=[];if(b.length){_.each(b,function(e){c.push(e)})}return c}})})();
/*! DashboardSupportView */
(function(){AMA.namespace("view");var a=AMA.view.DashboardSupportView=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_support_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{events:{"click .btn.scan_phone":"_onClickScanPhone"},_onClickScanPhone:function(){window.location.hash="#home/support"}})})();
/*! Dashboard */
(function(){AMA.namespace("view");var a=AMA.view.DashboardTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_tab_template";a.TEMPLATE_SRC="dashboard.tpl";a.TOOLBAR={DEFAULT:["endpoint","accountStatus"]};_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);var b={};b.pagevisited="Dashboard";AMA.ReportingManager.reportPageVisited(b,false)},render:function(){if(this.isRendered){return}a.__super__.render.apply(this);if(AMA.models.capabilities.canRead("storageInfo")){this.dashboardData=new AMA.view.DashboardData({parent:this,el:"#dashboard_backup",data:AMA.models.storageInfo});$("#dashboard_backup").removeClass("hide")}else{$("#dashboard_backup").addClass("hide")}if(AMA.models.capabilities.canRead("locationHistory")){this.dashboardLocation=new AMA.view.DashboardLocation({parent:this,el:"#dashboard_location",noAutoRefresh:true,data:AMA.models.locations});$("#dashboard_location").removeClass("hide")}else{$("#dashboard_location").addClass("hide")}if(AMA.models.capabilities.canRead("appSecuritySettings")){this.dashboardSecuritySettings=new AMA.view.DashboardSecuritySettings({parent:this,el:"#dashboard_security_settings",data:AMA.models.scansettings});$("#dashboard_security_settings").removeClass("hide")}else{$("#dashboard_security_settings").addClass("hide")}if(AMA.models.capabilities.canRead("appVulnerabilityScanResults")){this.dashboardSecurity=new AMA.view.DashboardSecurity({parent:this,el:"#dashboard_security .panel_left",data:AMA.models.threats});$("#dashboard_security").removeClass("hide")}else{$("#dashboard_security").addClass("hide")}if(AMA.models.capabilities.canRead("apphealthscanresults_id_resources")){this.dashboardSupport=new AMA.view.DashboardSupportView({parent:this,el:"#dashboard_support"});$("#dashboard_support").removeClass("hide")}else{$("#dashboard_support").addClass("hide")}}})})();
/*! DashboardLocation */
(function(){AMA.namespace("view");var a=AMA.view.DashboardLocation=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_location_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.data.on("reset",function(){if(AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.REFINING||AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.CONNECTING){return}this.populateAddress(this.data.toJSON()[0])},this);this.$el.addClass("dashboard_panel_loading");var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.LocateWorkflow,f=b.getWorkflow("locate");var e=this;f.on(c.EVENT.STATE_CHANGED,function(g){switch(g.state){case c.STATE.INITIALIZING:case d.STATE.CONNECTING:case d.STATE.REFINING:e.$el.find("#dashboard_btn_locate").addClass("hidden");e.$el.find("#dashboard_btn_locating").removeClass("hidden");break;case c.STATE.FINALIZING:case d.STATE.CANCELLED:e.$el.find("#dashboard_btn_locate").removeClass("hidden");e.$el.find("#dashboard_btn_locating").addClass("hidden");break;default:}},this)},populateAddress:function(d){if(!d){this.$el.find("#no_stored_location_info").removeClass("hidden");this.$el.find("#location_status_info").addClass("hidden");this.$el.find(".dashboard_locate_time").html("");this.$el.find(".dashboard_address").text("");this.$el.find(".dashboard_accuracy .accuracy_val").text("");return false}var b=d;b.time=AMA.Util.locationFormat(d.eventTime,d.eventTimeTo).split("-").join("<br/>");if(!b.address){var e="https://dev.virtualearth.net/REST/v1/Locations/"+b.coordinates;var g={output:"json",key:AMA.config.getBingMapsKey()};var f=this;var c=function(l,k,i,m){if(k&&k.resourceSets&&k.resourceSets.length>0&&k.resourceSets[0].resources&&k.resourceSets[0].resources.length>0){var h=f._getAddress(k.resourceSets[0].resources[0]);f.$el.find(".dashboard_locate_time").html(b.time);f.$el.find(".dashboard_address").text(h);f.$el.find(".dashboard_accuracy .accuracy_val").text(b.accuracy);f.$el.find("#no_stored_location_info").addClass("hidden");f.$el.find("#location_status_info").removeClass("hidden")}else{AMA.debug("Bing was unable to find an address for location: "+b.coordinates);AMA.ReportingManager.remoteLog("Bing was unable to find an address for location: "+b.coordinates,AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT)}};$.getJSON(e+"?jsonp=?",g,_.bind(c,this,0))}},refresh:function(){if(AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.REFINING||AMA.ActionManager.getWorkflow("locate")._state===AMA.workflow.LocateWorkflow.STATE.CONNECTING){return}setTimeout(a.__super__.refresh.apply(this),3000)},_processData:function(b){var c;if(b.time){c={time:AMA.Util.formatDateAndTime(b.time)||"",address:b.address||"",accuracy:b.accuracy||"",hasStatus:"",hasNoStatus:"hidden"}}else{c={time:"",address:"",accuracy:"",hasStatus:"hidden",hasNoStatus:""}}return c},render:function(){a.__super__.render.apply(this);this.locationMap=new AMA.view.LocationMapView({el:"#dashboard_map",parent:this,viewOnly:true,mapWidth:250,mapHeight:210,dataClass:AMA.model.Locations});this.locationMap.setData(AMA.models.locations)},_setupEvents:function(){this.$el.find(".btn_locate").on("click",function(){window.location.hash="home/location";AMA.ActionManager.start("locate")});if(this.locationMap){this.locationMap.on(AMA.view.LocationMapView.EVENT.MAP_INITIALIZED,function(){this.$el.find("#bing_map").css({width:250,height:210});this.locationMap.show()},this)}},_getAddress:function(c){var b="";b+=c.address.locality!=null?c.address.locality:"";b+=c.address.adminDistrict!=null?(b!=""?", ":"")+c.address.adminDistrict+" ":"";b+=c.address.postalCode!=null?(b!=""?" ":"")+c.address.postalCode:"";AMA.debug("getAddress: "+b);return b},_afterRender:function(){this.$el.removeClass("dashboard_panel_loading");this.$el.find("#bing_map_dialog").remove()}})})();
/*! DashboardData */
(function(){AMA.namespace("view");var a=AMA.view.DashboardData=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_backup_template";a.TEMPLATE_SRC="";a.EVENT=AMA.enums("EXTRA_DATA_LOADED","NEW_SYNC_DETAILS");a.CSS={CONTACTS_COUNT:"dashboard_onweb_count",PHOTOS_COUNT:"dashboard_imagesonweb_count",VIDEOS_COUNT:"dashboard_videosonweb_count",SYNC_CONTACTS:"btn_sync"};_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.$el.addClass("dashboard_panel_loading");AMA.models.syncHistory.on("reset",function(){this.trigger(a.EVENT.NEW_SYNC_DETAILS,{type:"newSyncDeatils"})},this);AMA.models.contactSummary.on("reset",function(){this.trigger(a.EVENT.EXTRA_DATA_LOADED,{type:"contactSummary"})},this);AMA.models.videosSummary.on("reset",function(){this.trigger(a.EVENT.EXTRA_DATA_LOADED,{type:"videosSummary"})},this);AMA.models.photosSummary.on("reset",function(){this.trigger(a.EVENT.EXTRA_DATA_LOADED,{type:"photosSummary"})},this)},loadExtraData:function(b){var c=this;AMA.models[b].fetch()},_processData:function(b){var c=b||{};c.storageLimit=parseInt(b.totalCapacity||2147483648);c.ImageSize=parseInt(b.photosUsedCapacity||0);c.VideoSize=parseInt(b.videosUsedCapacity||0);c.TrashSize=parseInt(b.trashUsedCapacity||0);c.ImageUse=(c.ImageSize*100)/c.storageLimit;c.VideoUse=(c.VideoSize*100)/c.storageLimit;c.TrashUse=(c.TrashSize*100)/c.storageLimit;c.totalUsed=c.ImageSize+c.VideoSize+c.TrashSize;return c},_setupEvents:function(){var b=this;this.on(a.EVENT.NEW_SYNC_DETAILS,function(){var d=AMA.models.syncHistory.toJSON();var f=d[d.length-1]||{};if(typeof f==="object"&&f.eventTime){var c=f.webContactCreate+f.webContactUpdate+f.webContactDelete+f.deviceContactCreate+f.deviceContactUpdate+f.deviceContactDelete;var e=f.deviceVideosDelete+f.deviceTransmitVideos+f.deviceVideosCreate;var g=f.devicePhotosDelete+f.deviceTransmitImages+f.devicePhotosCreate;b.$el.find("."+a.CSS.CONTACTS_COUNT).text(c);b.$el.find("."+a.CSS.VIDEOS_COUNT).text(e);b.$el.find("."+a.CSS.PHOTOS_COUNT).text(g);b.$el.find(".dashboard_sync_date.hasSynced").html(AMA.Util.formatDateAndTime(f.eventTime));AMA.Util.switchLabel(".dashboard_sync_date",".hasSynced",this.$el);b.$el.find(".dashboard_sync_msg.hasSynced").html(f.statusDetails);AMA.Util.switchLabel(".dashboard_sync_msg",".hasSynced",this.$el);b.$el.find(".dashboard_sync_msg").removeClass("hidden").siblings(".sync_status_message").addClass("hidden")}else{b.$el.find("."+a.CSS.CONTACTS_COUNT).text(0);b.$el.find("."+a.CSS.VIDEOS_COUNT).text(0);b.$el.find("."+a.CSS.PHOTOS_COUNT).text(0);AMA.Util.switchLabel(".dashboard_sync_date",".neverSynced",this.$el);AMA.Util.switchLabel(".dashboard_sync_msg",".hasSynced",this.$el);b.$el.find(".dashboard_sync_msg").removeClass("hidden").siblings(".sync_status_message").addClass("hidden");b.$el.find(".backup_summary").removeClass("loading").find("li").show()}if(f.statusDetails){if(this.checkStatusDetails(f.statusDetails)!=="NOT_MAPPED"){b.$el.find("."+this.checkStatusDetails(f.statusDetails)).removeClass("hidden").siblings(".sync_status_message").addClass("hidden");b.$el.find(".backup_summary").removeClass("loading").find("li").hide()}}else{b.$el.find(".dashboard_sync_msg").removeClass("hidden").siblings(".sync_status_message").addClass("hidden")}if(this.checkStatusDetails(f.statusDetails)==="NOT_MAPPED"){b.$el.find(".backup_summary").removeClass("loading").find("li").show()}},this);this.$el.find("."+a.CSS.SYNC_CONTACTS).on("click",function(){window.location.hash="home/data";Backbone.globalEvent.trigger("showSyncDialog",{type:"Dashboard"})});this.$el.find(".viewdetails").on("click",function(){window.location.hash="home/data"})},checkStatusDetails:function(b){if(!b){return}if(b.indexOf("USER_STOPPED")!==-1){return"USER_STOPPED"}else{if(b.indexOf("AIRPLANE_MODE")!==-1){return"AIRPLANE_MODE"}else{if(b.indexOf("FILE_NOT_FOUND")!==-1){return"FILE_NOT_FOUND"}else{if(b.indexOf("LOW_BATTERY")!==-1){return"LOW_BATTERY"}else{if(b.indexOf("NETWORK_ERROR")!==-1){return"NETWORK_ERROR"}else{if(b.indexOf("NETWORK_ROAMING_DETECTED")!==-1){return"NETWORK_ROAMING_DETECTED"}else{if(b.indexOf("NETWORK_SETTINGS_CONFLICT")!==-1){return"NETWORK_SETTINGS_CONFLICT"}else{if(b.indexOf("PHONE_STORAGE_EXCEEDED")!==-1){return"PHONE_STORAGE_EXCEEDED"}else{if(b.indexOf("SD_UNAVAILABLE")!==-1){return"SD_UNAVAILABLE"}else{if(b.indexOf("SYNC_FAILED")!==-1){return"SYNC_FAILED"}else{if(b.indexOf("SYSTEM_UNAVAILABLE")!==-1){return"SYSTEM_UNAVAILABLE"}else{if(b.indexOf("TIME_CONSUMING")!==-1){return"TIME_CONSUMING"}else{if(b.indexOf("WEB_STORAGE_EXCEEDED")!==-1){return"WEB_STORAGE_EXCEEDED"}else{if(b.indexOf("APPLICATION_RESET")!==-1){return"APPLICATION_RESET"}else{if(b.indexOf("USER_STOPPED_NETWORK_ERROR")!==-1){return"USER_STOPPED_NETWORK_ERROR"}}}}}}}}}}}}}}}return"NOT_MAPPED"},render:function(){a.__super__.render.apply(this);try{AMA.models.syncHistory.fetch()}catch(b){AMA.debug("can't fetch sync?")}finally{}},_afterRender:function(){this.$el.removeClass("dashboard_panel_loading").find(".backup_summary").addClass("loading").find("li").hide();if(AMA.models.endpoints.models[0].get("platform").indexOf("iPhone")>-1){this.$el.find(".btn_sync").hide()}}})})();
/*! DashboardSecurity */
(function(){AMA.namespace("view");var a=AMA.view.DashboardSecurity=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_security_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{events:{"click .btn.view_details":"_onClickViewDetails"},initialize:function(){a.__super__.initialize.apply(this,arguments);if(!AMA.view.ThreatProtectionView.POLLER){AMA.view.ThreatProtectionView.POLLER=setInterval(function(){AMA.models.threats.invalidate()},30000)}},_processData:function(d,c){var b=this.data.attributes;d.fileScanTotal=b.fileScanTotal;d.appScanTotal=b.appScanTotal;d.fileInfectedTotal=b.fileInfectedTotal+b.appInfectedTotal;d.filePlurality=b.fileScanTotal==1?"":"s";d.appPlurality=b.appScanTotal==1?"":"s";d.threatPlurality=b.fileInfectedTotal==1?"":"s";d.lastScanDate=b.eventTime?AMA.Util.formatDateAndTime(new Date(b.eventTime),AMA.config.dateAndTimeFormat):"Never";return d},_onClickViewDetails:function(){window.location.hash="#home/security"}})})();
/*! DashboardSecuritySettings */
(function(){AMA.namespace("view");var a=AMA.view.DashboardSecuritySettings=AMA.view.BaseView.extend();a.TEMPLATE_ID="dashboard_security_settings_template";a.TEMPLATE_SRC="";a.URL="/appSecuritySettings";_.extend(a.prototype,{events:{"change .autoThreatScanFrequency":"_settingOnChange","click .btn_white":"_saveSecuritySettings","click #edit_security_settings":"editSecuritySettings"},editSecuritySettings:function(){AMA.page.openSettings("security")},render:function(){var d=(this.data&&this.data.length>0)?this.data.toJSON()[0]:{},c="";var b=this._processData(d);c=_.template(this.template,b);this.$el.html(c);this._assignInitialValues(b)},_processData:function(d,c){this.settings=d;var b=this.originalSettings={};b.autoThreatScanFrequency=d.autoThreatScanFrequency?d.autoThreatScanFrequency.toUpperCase():"NEVER";b.dayOfWeek=b.autoThreatScanFrequency=="WEEKLY"?d.dayOfWeek.toUpperCase():"";b.timeOfDay=b.autoThreatScanFrequency=="NEVER"?"":d.timeOfDay.toUpperCase();return b},_assignInitialValues:function(c){var b=this.$el;var d=b.find("select");_.each(d,function(f,e){var g=b.find("select."+f.className);if(!c[f.name]){g.attr("disabled","disabled")}g.find("option[value="+c[f.name]+"]").attr("selected","selected")})},_settingOnChange:function(d){var b=$(d.currentTarget).val();var c=this.$el;c.find(".dayOfWeek, .timeOfDay").removeAttr("disabled");switch(b){case"WEEKLY":break;case"DAILY":c.find(".dayOfWeek").attr("disabled","disabled");break;case"NEVER":default:c.find(".dayOfWeek, .timeOfDay").attr("disabled","disabled")}},_saveSecuritySettings:function(g){var c=this.$el.find(".btn_white");var i=this.$el.find("select");var b=this.settings?this.settings:{};_.each(i,function(l,k){b[l.name]=l.disabled?"":l.value});if((b.autoThreatScanFrequency===this.originalSettings.autoThreatScanFrequency)&&(b.dayOfWeek===this.originalSettings.dayOfWeek)&&(b.timeOfDay===this.originalSettings.timeOfDay)){AMA.Util.switchLabel(".after_save_message",".no_changes",this.$el)}else{var e={url:AMA.config.apiHostUrl+this.constructor.URL+"?devId="+AMA.config.devId+"&endpointId="+AMA.config.endpointId+"&authToken="+AMA.config.authToken,beforeSend:function(){h.$el.find(".btn_white").hide().next(".loader").show()},error:_.bind(this._onAjaxError,this),success:function(){AMA.Util.switchLabel(".after_save_message",".success",h.$el);h.$el.find(".btn_white").show().next(".loader").hide()}},h=this;var d=b.autoThreatScanFrequency=="WEEKLY"&&(!b.dayOfWeek||!b.timeOfDay);var f=b.autoThreatScanFrequency=="DAILY"&&!b.timeOfDay;if(d||f){AMA.Util.switchLabel(".after_save_message",".blank_field",this.$el)}else{this.data.models[0].set(b);AMA.debug("Security Settings sync data:"+JSON.stringify(this.data.models[0]));this.data.sync("update",this.data.models[0],e)}}},_onAjaxError:function(c,b,d){AMA.ActionManager._onAjaxError(c,b,d)}})})();
/*! DownloadAppTab */
(function(){AMA.namespace("view");var a=AMA.view.DownloadAppTab=AMA.view.BaseView.extend();a.TEMPLATE_ID="download_app_template";a.TEMPLATE_SRC="get_started.tpl";a.TOOLBAR={DEFAULT:[],IPHONE:[]};_.extend(a.prototype,{_afterRender:function(){$("#download_tab").addClass("selected");$("#page_panes").css({border:0})}})})();
/*! SettingsView */
(function(){AMA.namespace("view");var a=AMA.view.Settings=AMA.view.BaseView.extend();a.TEMPLATE_ID="settings_template";a.TEMPLATE_SRC="settings.tpl";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.events=a.EVENT},render:function(){a.__super__.render.apply(this,arguments);var b=false,c=AMA.Util.isAndroid();if((c&&AMA.models.capabilities.canUpdate("mediaSettings"))||(!c&&AMA.models.capabilities.canRead("mediaSettings"))){b=true}this.settingsDialog=new AMA.view.SettingsDialog({el:"#settings_dialog",parent:this,settingsIntro:false,backupSettings:b,locationSettings:AMA.models.capabilities.canRead("eventSettings"),profileSettings:true,securitySettings:AMA.models.capabilities.canRead("appSecuritySettings"),safeBrowsingSettings:AMA.models.capabilities.canRead("browserSecuritySettings")}).plug(AMA.view.plugin.Switcher)},_setupEvents:function(){this.$el.find(".settings_nav_button").on("click",function(){$(this).find("a").get(0).click()});var b=this;this.$el.find("#myTabDrop1").dropdown()},show:function(c,b){if(b){this.settingsDialog._config.prevURL=b}if(!this.settingsDialog.isRendered){var d=this;this.settingsDialog.on(AMA.view.BaseView.EVENT.RENDERED,function(){d.openSettingsDialog(c)});return}this.openSettingsDialog(c)},openSettingsDialog:function(b){if(!this.settingsDialog.$el.is(":visible")){$("#account_settings_link").toggleClass("active");AMA.page.content.$el.toggleClass("hidden");this.settingsDialog.show()}this.settingsDialog.options.defaultTab=b;this.$el.find(".nav-tabs li").removeClass("active");switch(b){case"backup":if(this.settingsDialog.backupSettings){this.$el.find(".nav-tabs .settings_nav_button_backup").parent().addClass("active");this.settingsDialog.switchTo(this.settingsDialog.backupSettings)}break;case"location":if(this.settingsDialog.locationSettings){this.$el.find(".nav-tabs .settings_nav_button_location").parent().addClass("active");this.settingsDialog.switchTo(this.settingsDialog.locationSettings)}break;case"security":if(this.settingsDialog.securitySettings){this.$el.find(".nav-tabs .settings_nav_button_security").parent().addClass("active");this.settingsDialog.switchTo(this.settingsDialog.securitySettings)}break;default:if(this.settingsDialog.profileSettings){this.$el.find(".nav-tabs .settings_nav_button_profile").parent().addClass("active");this.settingsDialog.switchTo(this.settingsDialog.profileSettings)}break}}})})();
/*! SettingsDialogView */
(function(){AMA.namespace("view");var a=AMA.view.SettingsDialog=AMA.view.BaseView.extend();a.TEMPLATE_ID="";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.prevHash=""},render:function(){var b=0;this.$el.find(".settings_nav_button").hide();if(this.options.settingsIntro){this.$el.find("#settings_submit").hide();this.settingsIntro=new AMA.view.SettingsIntroView({el:"#settings_intro_tab",parent:this})}else{if(this.options.profileSettings){this.$el.find(".settings_nav_button_profile").parent().show();b++;this.profileSettings=new AMA.view.ProfileSettingsView({el:"#profile_settings_tab",data:AMA.models.dashboardData,parent:this})}if(this.options.backupSettings){this.$el.find(".settings_nav_button_backup").parent().show();b++;this.backupSettings=new AMA.view.BackupSettingsView({el:"#backup_settings_tab",data:AMA.models.syncsettings,parent:this})}if(this.options.locationSettings){this.$el.find(".settings_nav_button_location").parent().show();b++;this.locationSettings=new AMA.view.LocationSettingsView({el:"#location_settings_tab",data:AMA.models.locatesettings,parent:this})}if(this.options.securitySettings){this.$el.find(".settings_nav_button_security").parent().show();b++;this.securitySettings=new AMA.view.SecuritySettingsView({el:"#security_settings_tab",data:AMA.models.scansettings,parent:this})}}if(b==1){this.$el.find(".settings_nav").hide()}},hide:function(){a.__super__.hide.apply(this,arguments);$("#account_settings_link").toggleClass("active");AMA.page.content.$el.toggleClass("hidden");this.hideElements();this.updateValues()},show:function(){a.__super__.show.apply(this,arguments)},updateValues:function(){if(this.options.profileSettings){AMA.models.dashboardData.invalidate()}if(this.options.backupSettings){AMA.models.syncsettings.invalidate()}if(this.options.locationSettings){AMA.models.locatesettings.invalidate()}if(this.options.securitySettings){AMA.models.scansettings.invalidate()}},_setupEvents:function(){},hideElements:function(){this.$el.find(".settings .connecting").hide();this.$el.find(".settings .after_save_message").html("");this.$el.find(".settings_intro .intro_after_save_message").html("")},events:{"click li>.settings_nav_button_location":"openLocationsTab","click li>.settings_nav_button_backup":"openBackupTab","click li>.settings_nav_button_profile":"openAccountInfoTab","click li>.settings_nav_button_security":"openSecurityTab","click .rs_cancel":"hide"},openLocationsTab:function(){AMA.page.openSettings("location")},openBackupTab:function(){AMA.page.openSettings("backup")},openAccountInfoTab:function(){AMA.page.openSettings("account_info")},openSecurityTab:function(){AMA.page.openSettings("security")}})})();
/*! SettingsIntroView */
(function(){AMA.namespace("view");var a=AMA.view.SettingsIntroView=AMA.view.BaseView.extend();a.TEMPLATE_ID="settings_intro_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{})})();
/*! BackupSettingsView */
(function(){AMA.namespace("view");var a=AMA.view.BackupSettingsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="backup_settings_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{_processData:function(c){var d={},b="";d.frequency={NEVER:"",DAILY:"",WEEKLY:""};d.day={MONDAY:"",TUESDAY:"",WEDNESDAY:"",THURSDAY:"",FRIDAY:"",SATURDAY:"",SUNDAY:""};d.batteryLevelThreshold={"10":"","15":"","20":""};d.backupData={syncContacts:"",syncPhotos:"",syncVideos:""};d.backupConnection={WifiOnly:"",WifiOrMobileData:""};if(c.autosyncDay){b=c.autosyncDay.toUpperCase()}else{b=""}d.frequency[c.autosyncTime]="selected='selected'";d.day[b]="selected='selected'";d.batteryLevelThreshold[c.autosyncBatteryThreshold]="selected='selected'";if(c.syncContactsEnabled){d.backupData.syncContacts="checked";d.backupData.syncContactsActive="active"}if(c.syncPhotosEnabled){d.backupData.syncPhotos="checked";d.backupData.syncPhotosActive="active"}if(c.syncVideosEnabled){d.backupData.syncVideos="checked";d.backupData.syncVideosActive="active"}if(c.syncOnMobileData){d.backupConnection.WifiOrMobileData="selected='selected'"}else{d.backupConnection.WifiOnly="selected='selected'"}return d},changeSchedule:function(h){var g=this.$el.find("select[name=backupDay]"),e=g.get(0),c,b=this.$el.find("select[name=backupBatteryLevel]"),d=b.get(0),i,f=this.$el.find(".backupDataBreakdown input");if(h==="NEVER"){g.find("option").attr("selected",null);g.attr("disabled","disabled");b.find("option").attr("selected",null);b.attr("disabled","disabled");f.attr("disabled","disabled").attr("checked",null)}else{if(h==="DAILY"){g.find("option").attr("selected",null);g.attr("disabled","disabled")}else{c=this.data.models[0].get("autosyncDay");g.attr("disabled",null)}if(c){g.selectedIndex=this.setSelectedIndex(g,c.toUpperCase())}b.attr("disabled",null);f.attr("disabled",null);i=this.data.models[0].get("autosyncBatteryThreshold");if(i){b.selectedIndex=this.setSelectedIndex(b,i)}}},setSelectedIndex:function(d,e){var b=d.find("option"),c=0;_.each(b,function(g,f){if(g.value===e){c=f;$(g).attr("selected","selected")}});return c},render:function(){var b=this;a.__super__.render.apply(this,arguments)},_afterRender:function(){var b=this.$el.find("select[name=backupSchedule]");a.__super__._afterRender.apply(this,arguments);this.parent.hideElements();this.changeSchedule(b.val());if(AMA.models.capabilities.canUpdate("mediaSettings")){$("#backup_submit").removeClass("hide")}else{this.$el.find(".backupSchedule").addClass("hide");this.$el.find(".backupDay").addClass("hide");this.$el.find(".backupBatteryRow").addClass("hide");this.$el.find(".backupConnection").addClass("hide");this.$el.find(".backupDataBreakdown").addClass("hide");$("#backup_submit").addClass("hide");this.$el.find(".backupSchedule_"+this.$el.find("select[name=backupSchedule]").val()).removeClass("hidden").addClass("readonly");if(this.$el.find("select[name=backupSchedule]").val()!=="NEVER"){this.$el.find(".backupDay_"+this.$el.find("select[name=backupDay]").val()).removeClass("hidden").addClass("readonly");var c="backupDataBreakdown";if(this.$el.find("#backupDataBreakdownContacts").attr("checked")==="checked"){c+="_Contacts"}if(this.$el.find("#backupDataBreakdownImages").attr("checked")==="checked"){c+="_Photos"}if(this.$el.find("#backupDataBreakdownVideos").attr("checked")==="checked"){c+="_Videos"}this.$el.find("."+c).removeClass("hidden").addClass("readonly")}else{this.$el.find(".backupDayNote").addClass("hide");this.$el.find(".day_of_week").addClass("hide");this.$el.find(".backupDataBreakdowns").addClass("hide")}this.$el.find(".settings_note").show()}},events:{"click .btnBackupSync":"saveBackup"},_setupEvents:function(){var b=this,c=this.$el.find("select[name=backupSchedule]");c.on("change",function(){b.changeSchedule(this.value)})},saveBackup:function(){var b="backup";this.save(b)},save:function(g){$(".settings_intro .intro_after_save_message").html("");var b=[];var e={};var h={};var f=[];if($(".settings_content .backup_settings").is(":visible")){var c=this.saveBackupSettings(".settings_content");$.extend(h,c.profileData);$.extend(e,c.changes);var d=c.settingsChanged;b=c.validationErrors}if(b!=null&&b!=""){AMA.Util.switchLabel(".validation_text",b,this.$el);return}if(!d){AMA.Util.switchLabel(".validation_text",".no_changes",this.$el);return}$("#"+g+"_submit .connecting").show();var i=this.afterBackupSettingsSave;this.saveSettings(h,d,i.bind(this,h,e,g))},saveBackupSettings:function(b){var g="";var c="";var k="";var l="";var m="";var h="";var n="";var p="";var f=this.data.models[0];if(f){g=f.get("autosyncTime");if(f.get("autosyncDay")){c=f.get("autosyncDay").toUpperCase()}else{c=""}k=f.get("autosyncBatteryThreshold");l=""+f.get("syncContactsEnabled");m=""+f.get("syncPhotosEnabled");h=""+f.get("syncVideosEnabled");n=""+f.get("syncOnWifi");p=""+f.get("syncOnMobileData")}var i=false;var o={};var e={};e.frequency=$(b+" select[name='backupSchedule'] option:selected").val();if(e.frequency!==g){i=true;AMA.debug("Backup Settings Save - Change made to backup schedule... Saving to history")}if(e.frequency!=="NEVER"){e.day=$(b+" select[name='backupDay'] option:selected").val();AMA.debug("Backup Settings Save - backup frequency: "+e.frequency);if(c!==e.day){i=true;AMA.debug("Backup Settings Save - Change made to backup day... Saving to history")}}e.batteryLevelThreshold=$(b+" select[name='backupBatteryLevel'] option:selected").val();if(k!==e.batteryLevelThreshold){i=true;AMA.debug("Backup Settings Save - Change made to backup battery level... Saving to history")}e.syncContacts=""+$(b+" input[id='backupDataBreakdownContacts']").is(":checked");if(l!==e.syncContacts){i=true;AMA.debug("Backup Settings Save - Change made to contacts sync flag... Saving to history")}e.syncPhotos=""+$(b+" input[id='backupDataBreakdownImages']").is(":checked");if(m!==e.syncPhotos){i=true;AMA.debug("Backup Settings Save - Change made to photos sync... Saving to history")}e.syncVideos=""+$(b+" input[id='backupDataBreakdownVideos']").is(":checked");if(h!==e.syncVideos){i=true;AMA.debug("Backup Settings Save - Change made to videos sync... Saving to history")}var d=""+$(b+" select[name='backupConnection'] option:selected").val();e.wifi="true";e.mobileData="false";if(d==="wifiOrMobileNetwork"){e.mobileData="true"}if(n!==e.wifi){i=true;AMA.debug("Backup Settings Save - Change made to wifi connection... Saving to history")}if(p!==e.mobileData){i=true;AMA.debug("Backup Settings Save - Change made to wifi or mobile data connection... Saving to history")}var r=[];if((e.frequency==="WEEKLY")&&(e.day==="")){r.push(".blank_day");AMA.debug("Failed validation - Backup Settings - backup day")}if(e.frequency!=="NEVER"){if((e.syncContacts==="false")&&(e.syncPhotos==="false")&&(e.syncVideos==="false")){r.push(".blank_data");AMA.debug("Failed validation - Backup Settings - backup sync data")}}var q={};q.profileData=e;q.changes=o;q.settingsChanged=i;q.validationErrors=r;return q},saveSettings:function(d,c,e){if(c){this.data.models[0].set({autosyncTime:d.frequency,autosyncBatteryThreshold:d.batteryLevelThreshold,autosyncDay:d.day,syncContactsEnabled:(d.syncContacts==="true"),syncPhotosEnabled:(d.syncPhotos==="true"),syncVideosEnabled:(d.syncVideos==="true"),syncOnWifi:(d.wifi=="true"),syncOnMobileData:(d.mobileData=="true")});AMA.debug("Backup Settings sync data:"+JSON.stringify(this.data.models[0]));var b={url:AMA.models.syncsettings.url,success:e,callback:e,data:JSON.stringify(this.data.toJSON()[0])};this.data.sync("update",this.data.models[0],b)}},afterBackupSettingsSave:function(e,b,d,c){AMA.Util.switchLabel(".validation_text",".success",this.$el)}})})();
/*! LocationSettingsView */
(function(){AMA.namespace("view");var a=AMA.view.LocationSettingsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="location_settings_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{_processData:function(b){var c={};c.locationCheck={"true":"","false":""};c.frequencyMinutes={"1":"","3":"","6":""};c.batteryLevelThreshold={"10":"","20":"","30":"","40":"","50":"","60":""};c.locationCheck[(b.locationEnabled)?"true":"false"]="selected='selected'";c.frequencyMinutes[b.frequencyMinutes]="selected='selected'";c.batteryLevelThreshold[b.batteryLevelThreshold]="selected='selected'";return c},render:function(){a.__super__.render.apply(this,arguments)},_afterRender:function(){var b=this.$el.find("select[name=location_check]");a.__super__._afterRender.apply(this,arguments);this.parent.hideElements();this.changeLocationChecks(b.val());if(AMA.models.capabilities.canUpdate("eventSettings")){$("#locations_submit").removeClass("hide")}else{this.$el.find(".location_check").addClass("hide");this.$el.find(".frequencyMin").addClass("hide");this.$el.find(".battery_level").addClass("hide");this.$el.find(".locationbatterynote").addClass("hide");$("#locations_submit").addClass("hide");this.$el.find(".location_check_"+this.$el.find("select[name=location_check]").val()).removeClass("hidden").addClass("readonly");if(this.$el.find("select[name=location_check]").val()==="true"){this.$el.find(".frequency_"+this.$el.find("select[name=frequency]").val()).removeClass("hidden").addClass("readonly")}else{this.$el.find(".frequency").addClass("hide")}this.$el.find(".settings_note").show()}},_setupEvents:function(){var c=this,b=this.$el.find("select[name=location_check]");b.on("change",function(){c.changeLocationChecks(this.value)})},changeLocationChecks:function(h){var c=this.$el.find("select[name=frequency]"),g=c.get(0),e,f=this.$el.find("select[name=battery_level]"),b=f.get(0),d;if(h==="false"){c.find("option").attr("selected",null);c.attr("disabled","disabled");f.find("option").attr("selected",null);f.attr("disabled","disabled")}else{e=""+this.data.models[0].get("frequencyMinutes");c.attr("disabled",null);if(e){c.selectedIndex=this.setSelectedIndex(c,e)}d=this.data.models[0].get("batteryLevelThreshold");f.attr("disabled",null);if(d){f.selectedIndex=this.setSelectedIndex(f,d)}AMA.debug("changeLocationChecks, locationFrequencyValue: "+e+", locationBatteryLevelValue: "+d)}},setSelectedIndex:function(d,e){var b=d.find("option"),c=0;_.each(b,function(g,f){if(g.value===e){c=f;$(g).attr("selected","selected")}});return c},events:{"click .btnLocationSave":"saveLocation"},saveLocation:function(){var b="locations";this.save(b)},save:function(g){$(".settings_intro .intro_after_save_message").html("");var e="";var d={};var h={};var f=[];if($(".settings_content .location_settings").is(":visible")){var b=this.saveLocationSettings(".settings_content");$.extend(h,b.profileData);$.extend(d,b.changes);var c=b.settingsChanged;e=b.hasErrors}if(e){return}if(!c){AMA.Util.switchLabel(".validation_text",".noChanges",this.$el);this.$el.find(".after_save_message").removeClass("hidden");return}$("#"+g+"_submit .connecting").show();var i=this.afterBackupSettingsSave;this.saveSettings(h,c,i.bind(this,h,d,g))},saveLocationSettings:function(b){var e="",c="",d="",g=this.data.models[0];AMA.debug("Location Settings Save data:"+JSON.stringify(g));if(g){e=""+g.get("locationEnabled");c=""+g.get("frequencyMinutes");d=g.get("batteryLevelThreshold")}var h=false;var i={};var f={};f.locationCheck=$(b+" select[name='location_check'] option:selected").val();if(f.locationCheck!==e){h=true;AMA.debug("Location Settings Save - Change made to Location Check Changed... Saving to history")}if(f.locationCheck==="true"){f.frequency=$.trim($(b+" select[name='frequency'] option:selected").val());AMA.debug("Location Settings Save - Frequency: "+f.frequency);if(c!==f.frequency){h=true;AMA.debug("Location Settings Save - Change made to Frequency... Saving to history")}if($(b+" .battery_level").css("display")!=="none"){f.batteryLevel=$.trim($(b+" select[name='battery_level'] option:selected").val());AMA.debug("Location Settings Save - Battery Level: "+f.batteryLevel);if(d!==f.batteryLevel){h=true;AMA.debug("Location Settings Save - Change made to Battery Level... Saving to history")}}}var l=false;if(f.locationCheck==="true"){if(f.frequency===""&&f.batteryLevel===""){AMA.Util.switchLabel(".validation_text",".noFreqAndLevel",this.$el);this.$el.find(".after_save_message").removeClass("hidden");AMA.debug("Failed validation - location - frequency");AMA.debug("Failed validation - location - battery")}else{if(f.frequency===""){AMA.Util.switchLabel(".validation_text",".noFreq",this.$el);this.$el.find(".after_save_message").removeClass("hidden");AMA.debug("Failed validation - location - frequency")}else{if(f.batteryLevel===""){AMA.Util.switchLabel(".validation_text",".noBattLevel",this.$el);this.$el.find(".after_save_message").removeClass("hidden");AMA.debug("Failed validation - location - battery")}}}if(f.frequency===""||f.batteryLevel===""){l=true}}var k={};k.profileData=f;k.changes=i;k.settingsChanged=h;k.hasErrors=l;return k},saveSettings:function(d,c,e){if(c){this.data.models[0].set({locationEnabled:(d.locationCheck==="true"),frequencyMinutes:Number(d.frequency),batteryLevelThreshold:d.batteryLevel});AMA.debug("Location Settings sync data:"+JSON.stringify(this.data.models[0]));var b={url:AMA.models.locatesettings.url,success:e,callback:e,data:JSON.stringify(this.data.toJSON()[0])};this.data.sync("update",this.data.models[0],b)}},afterBackupSettingsSave:function(e,b,d,c){AMA.Util.switchLabel(".validation_text",".settingsSaved",this.$el);this.$el.find(".after_save_message").removeClass("hidden");AMA.models.endpointHistory.fetch();AMA.models.devicesettings.fetch()}})})();
/*! ProfilesettingsView */
(function(){AMA.namespace("view");var a=AMA.view.ProfileSettingsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="profile_settings_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{events:{"click .btnAccountInfoSave":"updateAccountInfo","click .btnChangePassword":"updatePassword","click .btnChangeSecurityInfo":"updateSecurityInfo","change select[name='securityquestion']":"clearSecurityAnswer","click #btnSubmitProfileSettings":"submitProfileSettings"},render:function(){a.__super__.render.apply(this,arguments);$("select[name='securityquestion']").val(AMA.Util.decodeHTMLEntityString(this.data.models[0].get("securityQuestion")))},_processData:function(b){name=b.phoneNumber;email=b.emailAddress;securityAnswer=b.securityAnswer},_afterRender:function(){a.__super__._afterRender.apply(this,arguments);this.parent.hideElements();this.parent.$el.find(".settings .connecting").hide();if(AMA.models.capabilities.canUpdate("accountSettings")){$("#account_info_submit").removeClass("hide");$("#password_submit").removeClass("hide");$("#securityQA_submit").removeClass("hide")}else{$("#account_info_submit").addClass("hide");$("#password_submit").addClass("hide");$("#securityQA_submit").addClass("hide")}},show:function(){a.__super__.show.apply(this,arguments)},updateAccountInfo:function(){var b=AMA.Util.decodeHTMLEntityString(this.data.models[0].get("emailAddress")),c=$.trim(this.$el.find("input[name='email']").get(0).value),e=true,d={},g=this,f=function(h){$("#account_info_submit .connecting").hide();if(typeof h=="object"&&h.error){AMA.Util.switchLabel(".validation_text",".email_taken",g.$el.find(".validation_accountinfo"));return}AMA.Util.switchLabel(".validation_text",".email_changed",g.$el.find(".validation_accountinfo"));AMA.page.logout()};if(c==""){AMA.Util.switchLabel(".validation_text",".email_empty",this.$el.find(".validation_accountinfo"));this.$el.find(".after_save_message").removeClass("hidden");e=false}else{if(!AMA.Util.validateEmail(c)){AMA.Util.switchLabel(".validation_text",".email_invalid",this.$el.find(".validation_accountinfo"));e=false}else{if(b===c){AMA.Util.switchLabel(".validation_text",".email_unchanged",this.$el.find(".validation_accountinfo"));e=false}}}if(!e){return}$("#account_info_submit .connecting").show();d.email=c;this.data.saveAccountInfo(d,f)},updatePassword:function(){var d=$.trim(this.$el.find("input[name='password']").get(0).value),g=$.trim(this.$el.find("input[name='newPin']").get(0).value),b=$.trim(this.$el.find("input[name='confirmPIN']").get(0).value),f=true,e=[],c=/^\s*[a-zA-Z0-9,\s]+\s*$/;if(d!==""||g!==""||b!==""){if(d===""){e.push(".current_password_empty");f=false}else{if(!c.test(d)){e.push(".current_password_has_special_chars");f=false}}if(g===""){e.push(".new_password_empty");f=false}else{if(this.validatePassword(g)){e.push(".new_password_length");f=false}else{if(!c.test(g)){e.push(".new_password_has_special_chars");f=false}}}if(b===""){e.push(".confirm_password_empty");f=false}if(b!==g){e.push(".confirm_password_mismatch");f=false}if(d!==""&&g!=""&&d===g){e.push(".password_unchanged");f=false}if(!f){AMA.Util.switchLabel(".validation_text",e,this.$el.find(".validation_password"));return}$("#password_submit .connecting").show();d=xssClean(d);g=xssClean(g);b=xssClean(b);this.encryptPassword(d,g,b)}},encryptPassword:function(c,g,b){var f=this,h=function(i){f._afterUpdatePassword(i)},e=function(n){if(!n){AMA.error("Expected response data is missing. Unable to perform password update");return}var i=n.secretKey,s=n.handle,p=n.initVector,r=CryptoJS.enc.Hex.parse(i),l=CryptoJS.enc.Hex.parse(p),k=CryptoJS.AES.encrypt(c,r,{iv:l}).toString(),m=CryptoJS.AES.encrypt(g,r,{iv:l}).toString(),o=CryptoJS.AES.encrypt(b,r,{iv:l}).toString(),q={oldPassword:k,newPassword:m,confirmPassword:o,secretHandle:s};f.data.saveNewPassword(q,h)},d=AMA.Util.getSecretPair(e)},_afterUpdatePassword:function(b){$("#password_submit .connecting").hide();if(typeof b=="object"&&b.error){if(b.error==="Invalid Password"){AMA.Util.switchLabel(".validation_text",".password_invalid",this.$el.find(".validation_password"))}else{AMA.Util.switchLabel(".validation_text",".password_update_error",this.$el.find(".validation_password"))}return}AMA.Util.switchLabel(".validation_text",".password_changed",this.$el.find(".validation_password"));AMA.page.logout()},updateSecurityInfo:function(){var b=AMA.Util.decodeHTMLEntityString(this.data.models[0].get("securityQuestion")),f=this.data.models[0].get("securityAnswer"),g=this.$el.find("select[name='securityquestion']").val(),c=$.trim(this.$el.find("input[name='securityanswer']").get(0).value),k=true,h={},d=this,e=function(){AMA.Util.switchLabel(".validation_text",".security_answer_changed",d.$el.find(".validation_securityqa"))},i=function(n,l){var m={callback:e};$("#securityQA_submit .connecting").hide();if(l===AMA.config.accountDetails.accountId){AMA.models.dashboardData.invalidate(m)}else{AMA.Util.switchLabel(".validation_text",".security_answer_update_error",d.$el.find(".validation_securityqa"))}};d.$el.find(".validation_securityqa .validation_text").hide();if(b!==g||(b===g&&f!==c&&c!=="")){if(c==""){AMA.Util.switchLabel(".validation_text",".security_answer_empty",this.$el.find(".validation_securityqa"));k=false}else{if(b===g&&f===c){AMA.Util.switchLabel(".validation_text",".security_answer_unchanged",this.$el.find(".validation_securityqa"));k=false}else{if(!this.validateSecurityAnswer(c)){AMA.Util.switchLabel(".validation_text",".security_answer_invalid",this.$el.find(".validation_securityqa"));k=false}}}if(!k){return}h.securityQuestion=g;h.securityAnswer=c;$("#securityQA_submit .connecting").show();this.data.saveSecurityQA(h,i)}},validateSecurityAnswer:function(b){return((b.length===4)&&!(isNaN(b)))},validatePassword:function(b){return(b.length<6||b.length>15)},clearSecurityAnswer:function(){AMA.Util.switchLabel(".validation_text","",this.$el.find(".validation_securityqa"));$("#profile_securityanswer").val("")},submitProfileSettings:function(){this.updateAccountInfo();this.updatePassword();this.updateSecurityInfo()}})})();
/*! SecuritySettingsView */
(function(){AMA.namespace("view");var a=AMA.view.SecuritySettingsView=AMA.view.BaseView.extend();a.TEMPLATE_ID="security_settings_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.safeBrowsingTab=AMA.models.safeBrowsing},_processData:function(c){var d={},b="";d.frequency={NEVER:"",DAILY:"",WEEKLY:""};d.day={MONDAY:"",TUESDAY:"",WEDNESDAY:"",THURSDAY:"",FRIDAY:"",SATURDAY:"",SUNDAY:""};d.range={AM12TO1:"",AM1TO2:"",AM2TO3:"",AM3TO4:"",AM4TO5:"",AM5TO6:"",AM6TO7:"",AM7TO8:"",AM8TO9:"",AM9TO10:"",AM10TO11:"",AM11TO12:"",PM12TO1:"",PM1TO2:"",PM2TO3:"",PM3TO4:"",PM4TO5:"",PM5TO6:"",PM6TO7:"",PM7TO8:"",PM8TO9:"",PM9TO10:"",PM10TO11:"",PM11TO12:""};d.realTimeScan={"true":"","false":""};d.mediaScan={"true":"","false":""};d.trayNotification={"true":"","false":""};d.cloudAv={"true":"","false":""};d.realTimeScanActive={"true":"","false":""};d.mediaScanActive={"true":"","false":""};d.trayNotificationActive={"true":"","false":""};d.cloudAvActive={"true":"","false":""};d.frequency[c.autoThreatScanFrequency]="selected='selected'";if(c.dayOfWeek){b=c.dayOfWeek.toUpperCase()}else{b=""}d.day[b]="selected='selected'";d.range[c.timeOfDay]="selected='selected'";d.realTimeScan[""+c.realTimeScanEnabled]="checked";d.mediaScan[""+c.mediaScanEnabled]="checked";d.trayNotification[""+c.trayNotificationEnabled]="checked";d.realTimeScanActive[""+c.realTimeScanEnabled]="active";d.mediaScanActive[""+c.mediaScanEnabled]="active";d.trayNotificationActive[""+c.trayNotificationEnabled]="active";d.cloudAv[""+c.cloudAvEnabled]="checked";d.cloudAvActive[""+c.cloudAvEnabled]="active";AMA.debug("SecuritySettingsView _processData item:"+JSON.stringify(c)+", data:"+JSON.stringify(d));return d},render:function(){var b=this;a.__super__.render.apply(this,arguments);if(AMA.models.capabilities.canUpdate("appSecuritySettings")){$("#security_submit").removeClass("hide")}else{$("#security_submit").addClass("hide")}this.safeBrowsingTab.fetch({silent:true,success:function(d){var c=d.models[0].get("safeBrowsingEnabled");if(c){$(b.$el).find(".safeBrowsingToggle .on").toggleClass("active").find("input").prop("checked",true)}else{$(b.$el).find(".safeBrowsingToggle .off").toggleClass("active").find("input").prop("checked",true)}}})},_afterRender:function(){var b=this.$el.find("select[name=scanSchedule]");a.__super__._afterRender.apply(this,arguments);this.parent.hideElements();this.changeSchedule(b.val())},_setupEvents:function(){var c=this,b=this.$el.find("select[name=scanSchedule]");b.on("change",function(){c.changeSchedule(this.value)});var d=this;$(this.$el).find(".btnSafeBrowsingSave").on("click",function(){d.saveSecurity()})},saveSafeBrowsingSetting:function(){AMA.page.standardDialogs.loading("");var b=("true"===$(this.el).find('input[name="safeBrowsing"]:checked').val());this.safeBrowsingTab.models[0].set({safeBrowsingEnabled:b});var c={url:this.safeBrowsingTab.url,success:$.proxy(this.saveSuccess,this),error:$.proxy(this.saveError,this),callback:$.proxy(this.successOrFailure,this),data:JSON.stringify(this.safeBrowsingTab.models[0].attributes)};this.safeBrowsingTab.sync("update",this.safeBrowsingTab.models[0],c)},changeSchedule:function(h){var g=this.$el.find("select[name=scanDay]"),e=g.get(0),f,d=this.$el.find("select[name=scanTime]"),b=d.get(0),c;AMA.debug("SecuritySettingsView changeSchedule, frequency: "+h);if(h==="NEVER"){g.find("option").attr("selected",null);g.attr("disabled","disabled");d.find("option").attr("selected",null);d.attr("disabled","disabled")}else{if(h==="DAILY"){g.find("option").attr("selected",null);g.attr("disabled","disabled")}else{f=this.data.models[0].get("dayOfWeek");g.attr("disabled",null)}if(f){g.selectedIndex=this.setSelectedIndex(g,f.toUpperCase())}c=this.data.models[0].get("timeOfDay");$(b).attr("disabled",null);if(c){d.selectedIndex=this.setSelectedIndex(d,c)}}},setSelectedIndex:function(d,e){var b=d.find("option"),c=0;_.each(b,function(g,f){if(g.value===e){c=f;$(g).attr("selected","selected")}});return c},events:{"click .btnSecuritySave":"saveSecurity"},saveSecurity:function(){var b="security";this.save(b)},save:function(i){$(".settings_intro .intro_after_save_message").html("");var m=[],h={},d={},g=[],e=AMA.models.safeBrowsing.models[0],f=""+e.get("safeBrowsingEnabled"),b=(f===$(this.$el).find('input[name="safeBrowsing"]:checked').val());if($(".settings_content .security_settings").is(":visible")){var k=this.saveSecuritySettings(".settings_content");$.extend(d,k.profileData);$.extend(h,k.changes);var c=k.settingsChanged;m=k.validationErrors}if(m!=null&&m!=""){AMA.Util.switchLabel(".validation_text",m,this.$el);this.$el.find(".after_save_message").removeClass("hidden");return}if(!c&&b){AMA.Util.switchLabel(".validation_text",".no_changes",this.$el);this.$el.find(".after_save_message").removeClass("hidden");return}if(!b){this.saveSafeBrowsingSetting()}$("#"+i+"_submit .connecting").show();var l=this.afterBackupSettingsSave;if(c){this.saveSettings(d,c,l.bind(this,d,h,i))}},saveSecuritySettings:function(b){var i="",f="",l="",e="",d="",c="",m="",h=this.data.models[0];AMA.debug("Security Settings Save data:"+JSON.stringify(h));if(h){i=h.get("autoThreatScanFrequency");if(h.get("dayOfWeek")){f=h.get("dayOfWeek").toUpperCase()}else{f=""}l=h.get("timeOfDay");e=""+h.get("realTimeScanEnabled");d=""+h.get("mediaScanEnabled");c=""+h.get("trayNotificationEnabled");m=""+h.get("cloudAvEnabled");airplaneModeLockValue=""+h.get("airplanModeLockEnabled")}var k=false;var n={};var g={};g.frequency=$(b+" select[name='scanSchedule'] option:selected").val();if(g.frequency!==i){k=true;AMA.debug("Security Settings Save - Change made to scan schedule... Saving to history")}if(g.frequency!=="NEVER"){if(g.frequency!=="DAILY"){g.day=$(b+" select[name='scanDay'] option:selected").val();AMA.debug("Security Settings Save - scan frequency: "+g.frequency);if(f!==g.day){k=true;AMA.debug("Security Settings Save - Change made to scan day... Saving to history")}}g.range=$(b+" select[name='scanTime'] option:selected").val();if(l!==g.range){k=true;AMA.debug("Security Settings Save - Change made to scan range... Saving to history")}}g.realTimeScan=$(b+" input[name='realTimeScan']:checked").val();if(e!==g.realTimeScan){k=true;AMA.debug("Security Settings Save - Change made to real time scan... Saving to history")}g.mediaScan=$(b+" input[name='autoMediaScan']:checked").val();if(d!==g.mediaScan){k=true;AMA.debug("Security Settings Save - Change made to media scan... Saving to history")}g.trayNotification=$(b+" input[name='trayNotify']:checked").val();if(c!==g.trayNotification){k=true;AMA.debug("Security Settings Save - Change made to tray notification... Saving to history")}g.cloudAv=$(b+" input[name='cloudAV']:checked").val();if(m!==g.cloudAv){k=true;AMA.debug("Security Settings Save - Change made to cloud AV... Saving to history")}g.airplaneModeLock=airplaneModeLockValue;var p=[];if(g.frequency!=="NEVER"){if(g.frequency==="WEEKLY"&&g.day===""){p.push(".blank_day");AMA.debug("Failed validation - Security - scan schedule")}if(g.range===""){p.push(".blank_range");AMA.debug("Failed validation - Security - scan range")}}var o={};o.profileData=g;o.changes=n;o.settingsChanged=k;o.validationErrors=p;return o},saveSettings:function(d,c,e){if(c){this.data.models[0].set({autoThreatScanFrequency:d.frequency,dayOfWeek:d.day,timeOfDay:d.range,realTimeScanEnabled:(d.realTimeScan==="true"),mediaScanEnabled:(d.mediaScan==="true"),trayNotificationEnabled:(d.trayNotification=="true"),cloudAvEnabled:(d.cloudAv=="true"),airplaneModeLockEnabled:(d.airplaneModeLock=="true")});AMA.debug("Security Settings sync data:"+JSON.stringify(this.data.models[0]));var b={url:AMA.models.scansettings.url,success:e,callback:e,data:JSON.stringify(this.data.toJSON()[0])};this.data.sync("update",this.data.models[0],b)}},afterBackupSettingsSave:function(e,b,d,c){AMA.page.standardDialogs.hideloading();AMA.Util.switchLabel(".validation_text",".settingsSaved",this.$el);this.$el.find(".after_save_message").removeClass("hidden")},saveSuccess:function(){AMA.page.standardDialogs.hideloading();AMA.Util.switchLabel(".validation_text",".settingsSaved",this.$el);this.$el.find(".after_save_message").removeClass("hidden")},saveError:function(){AMA.page.standardDialogs.hideloading();AMA.page.standardDialogs.error("Unable To Contact services");AMA.debug("Ajax completed with errors")},successOrFailure:function(b){AMA.page.standardDialogs.hideloading();if(b){AMA.Util.switchLabel(".validation_text",".settingsSaved",this.$el);this.$el.find(".after_save_message").removeClass("hidden")}else{AMA.page.standardDialogs.error("Unable To Contact services");AMA.debug("Ajax completed with errors")}}})})();(function(){AMA.namespace("view");var a=AMA.view.Feedback=AMA.view.BaseView.extend();a.TEMPLATE_ID="feedback_template";a.TEMPLATE_SRC="";AMA.augment(a.prototype,{render:function(){a.__super__.render.apply(this);this.appRatingDialog=new AMA.view.AppRatingDialog({el:"#app_rating_dialog",parent:this,showTitle:false,showClose:false,showOk:false,showCancel:false,width:370});this.shareFeedbackWizard=new AMA.view.ShareFeedbackWizard({el:"#share_feedback_dialog",parent:this,showTitle:false,showClose:false,showOk:false,showCancel:false,width:760,height:380});this.surveyDialog=new AMA.view.SurveyDialog({el:"#survey_dialog",parent:this,showTitle:false,showClose:false,showOk:false,showCancel:false,width:650})},show:function(){},openAppRating:function(d,b){if(!this.appRatingDialog.isRendered){var c=this;this.appRatingDialog.on(AMA.view.BaseView.EVENT.RENDERED,function(){c.appRatingDialog.show(d,b)});return}this.appRatingDialog.show(d,b)},openSurvey:function(c){if(!this.surveyDialog.isRendered){var b=this;this.surveyDialog.on(AMA.view.BaseView.EVENT.RENDERED,function(){b.surveyDialog.show(c)});return}this.surveyDialog.show(c)},openShareFeedback:function(){if(!this.shareFeedbackWizard.isRendered){var b=this;this.shareFeedbackWizard.on(AMA.view.BaseView.EVENT.RENDERED,function(){b.shareFeedbackWizard.show()});return}this.shareFeedbackWizard.show()}})})();
/*! AppRatingDialog */
(function(){AMA.namespace("view");var a=AMA.view.AppRatingDialog=AMA.view.Modal.extend();a.TEMPLATE_ID="app_rating_dialog_template";a.TEMPLATE_SRC="";a.COOKIE_EXPIRY=3650;a.SESSION_ID=AMA.Util.guid();_.extend(a.prototype,{events:{"click .close":"hideSurvey","click #app_rating_dialog_rate_later":"remindMeLater","click #app_rating_dialog_rate_never":"ratingNoThanks","click #app_rating_dialog_rate_now":"rateApp"},hideSurvey:function(){var b={surveyId:this._surveyId,webUserExperienceSurveySessionId:a.SESSION_ID,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,action:"close",timeStamp:new Date().getTime().toString()};AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webAppRatingCancel,b);this.hide()},remindMeLater:function(){var b={surveyId:this._surveyId,webUserExperienceSurveySessionId:a.SESSION_ID,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,action:"later",timeStamp:new Date().getTime().toString()};AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webAppRatingCancel,b);this.hide()},ratingNoThanks:function(){var b={surveyId:this._surveyId,webUserExperienceSurveySessionId:a.SESSION_ID,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,action:"never",timeStamp:new Date().getTime().toString()};AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webAppRatingCancel,b);if(this._surveyId==10||this._surveyId==11){AMA.Util.setCookie("dismissSurvey",true,a.COOKIE_EXPIRY)}this.hide()},rateApp:function(){if(this._surveyId==10||this._surveyId==11){AMA.Util.setCookie("dismissSurvey",true,a.COOKIE_EXPIRY)}var b={surveyId:this._surveyId,webUserExperienceSurveySessionId:a.SESSION_ID,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,timeStamp:new Date().getTime().toString()};AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webAppRatingGo,b);window.open(this._appRatingUrl,"_blank");this.hide()},show:function(d,b){this._surveyId=d;this._appRatingUrl=b;var c={surveyId:this._surveyId,webUserExperienceSurveySessionId:a.SESSION_ID,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,timeStamp:new Date().getTime().toString()};AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webAppRatingPrompt,c);a.__super__.show.apply(this,arguments)}})})();(function(){AMA.namespace("view");var a=AMA.view.ShareFeedbackWizard=AMA.view.Wizard.extend();a.TEMPLATE_ID="share_feedback_dialog_template";a.TEMPLATE_SRC="";a.ENDPOINT="userRatings";AMA.augment(a.prototype,{events:{"click .fb_radio_submit_btn":"_validateFeedback","click .fb_text_submit_btn":"_validateReason","click .close":"_reset","click .wizard_close":"_reset"},_validateFeedback:function(){var c=this.$el.find("#feedback_validation_error"),b=this.$el.find("input[name='fb_rate']:checked");c.addClass("hide");if(b.length>0){this._rating=b.val()}else{c.removeClass("hide");c.addClass("show");return}if(this._rating){this.$el.find(".wiz_step").removeClass("current");this.$el.find(".step2.wiz_step").addClass("current")}},_validateReason:function(){var c=this.$el.find("#feedback_reason_error"),b=$.trim(this.$el.find("textarea[name='fb_reason']").val());c.addClass("hide");if(b.length>0){this._ratingReason=b}else{c.removeClass("hide");c.addClass("show");return}if(this._ratingReason){this.hide();var d=$("#msg_loadingdialog").html();AMA.page.standardDialogs.loading(d);this._sendFeedback()}},_sendFeedback:function(){if(!AMA.models.capabilities.canCreate("sendFeedbackRate")){AMA.error("User has no capability to send Share Feedback data");this._reset();return}var b=AMA.config.apiHostUrl+"/"+a.ENDPOINT+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken}),d={name:AMA.models.dashboardData.models[0].get("emailAddress"),phoneNumber:AMA.models.dashboardData.models[0].get("phoneNumber"),platformName:AMA.models.endpoints.models[0].get("platformfriendlyname"),platformId:AMA.models.endpoints.models[0].get("platform"),rate:this._rating,reason:this._ratingReason},c=AMA.Util.createCORSRequest("POST",b),e=this;if(c){c.onload=function(){e._callbackForFeedback()};c.onerror=function(g,f,h){AMA.ActionManager._onAjaxError(g,f,h)};c.send(JSON.stringify(d))}},_callbackForFeedback:function(){this.$el.find(".wiz_step").removeClass("current");this.$el.find(".step3.wiz_step").addClass("current");AMA.page.standardDialogs.hideloading();this.show()},_reset:function(){this.$el.find("textarea[name='fb_reason']").val("");this.$el.find("input[name='fb_rate']").prop("checked",false);this.$el.find("label.btn").removeClass("active");this.$el.find(".wiz_step").removeClass("current");this.$el.find(".step1.wiz_step").addClass("current");this.$el.find("#feedback_validation_error").removeClass("show").addClass("hide");this.$el.find("#feedback_reason_error").removeClass("show").addClass("hide");this.hide()}})})();
/*! SurveyDialog */
(function(){AMA.namespace("view");var a=AMA.view.SurveyDialog=AMA.view.Modal.extend();a.TEMPLATE_ID="survey_dialog_template";a.TEMPLATE_SRC="";a.ENDPOINT="surveyQuestions";a.COOKIE_EXPIRY=3650;a.SESSION_ID=AMA.Util.guid();a.SYNC_EVENT_TYPES=["sync-manual-success","auto-sync-opt-out"];_.extend(a.prototype,{events:{"click #survey_close ":"hideSurvey","click #close":"hideSurvey","click .submit":"_submit","click .cancel":"_cancel","keyup #survey_text_textarea":"_checkCommentLength","click #survey_stars .ratingdiv span":"_setRatingValue"},show:function(b){if(!b){AMA.error("Survey: No survey type specified. Operation will be aborted.");return}else{this._surveyType=b;AMA.debug("Survey: Showing survey dialog of type: "+this._surveyType);$("#survey_step1").show();$("#survey_send_feedback").show();$("#survey_step2").hide();$("#sv_text_close_div").hide();this._fetchSurveyData()}},_fetchSurveyData:function(){if(!AMA.models.capabilities.canRead("surveyQuestions")){AMA.error("Survey: Account has no capability to retrieve survey questions");return}var b=AMA.config.apiHostUrl+"/"+a.ENDPOINT+"?"+$.param({devId:AMA.config.devId,endpointId:AMA.config.endpointId,authToken:AMA.config.authToken,surveyEvent:this._surveyType}),c=AMA.Util.createCORSRequest("GET",b),d=this;if(c){c.onload=function(){try{var f=JSON.parse(this.responseText)}catch(g){AMA.error("Survey: Response not JSON")}if(f){d._init(f)}};c.onerror=function(f,e,g){AMA.ActionManager._onAjaxError(f,e,g)};AMA.debug("Survey: Fetching survey of type: "+this._surveyType);c.send()}},_init:function(c){if(this._surveyType!=c.event){AMA.error("Survey: Response is not the expected for type "+this._surveyType);return}else{if($.inArray(this._surveyType,a.SYNC_EVENT_TYPES)>=0){this._promptSurvey(c)}else{var h=this._surveyType==="location-success"?"Locate":"HealthScan",d="firstTrigger"+h,b="counterOfSuccessful"+h,f=this._isCookieExisting("firstTrigger"+h),k=c.triggerConditionFirst,g=1,e=c.triggerConditionValue,i=parseInt(AMA.Util.getCookie(b));if(f){AMA.debug("Survey: Updating cookies for survey type: "+this._surveyType);k=parseInt(AMA.Util.getCookie(d));g=parseInt(AMA.Util.getCookie(b))+1}else{AMA.debug("Survey: Creating new cookies for survey type: "+this._surveyType);AMA.Util.setCookie(d,k,a.COOKIE_EXPIRY)}AMA.Util.setCookie(b,g,a.COOKIE_EXPIRY);if(!k&&!e){if(i>k){k=parseInt(AMA.Util.getCookie(d))+e;AMA.Util.setCookie(d,k,a.COOKIE_EXPIRY)}}if(g===k){AMA.debug("Survey: Validated trigger values. Launching the survey.");this._promptSurvey(c)}else{return false}}}},_promptSurvey:function(c){var e=false,b=false,f={};if(c&&!c.failures&&c.id){AMA.debug("Survey: Building survey id="+c.id);this._surveyId=c.id;this._questionList=c.questions;this._rating=null;$("#survey_stars").hide();$("#survey_text").hide();for(var d in this._questionList){switch(this._questionList[d].type){case"stars":this.$el.find("#survey_stars_rating1").removeClass("starratingselected").addClass("starrating");this.$el.find("#survey_stars_rating2").removeClass("starratingselected").addClass("starrating");this.$el.find("#survey_stars_rating3").removeClass("starratingselected").addClass("starrating");this.$el.find("#survey_stars_rating4").removeClass("starratingselected").addClass("starrating");this.$el.find("#survey_stars_rating5").removeClass("starratingselected").addClass("starrating");$("#survey_stars").show();$("#survey_stars .survey_error").hide();this.$el.find("#survey_stars .surveyquestion").html(this._questionList[d].label);break;case"text":$("#survey_text").show();$("#survey_text .survey_error").hide();this._textQuestionMinLength=this._questionList[d].minLength||1024;this._textQuestionMaxLength=this._questionList[d].maxLength||1024;this.$el.find("#survey_text .surveyquestion").html(this._questionList[d].label);break;case"appRating":e=true;this._appRatingUrl=this._questionList[d].label;break;default:}}if(this._getDismissSurvey("dismissSurvey")=="true"){b=true}if(e&&!b){this.parent.openAppRating(this._surveyId,this._appRatingUrl)}else{AMA.debug("Survey: Popup ready");f={surveyId:this._surveyId,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,webUserExperienceSurveySessionId:a.SESSION_ID,timestamp:new Date().getTime().toString()};AMA.debug("Survey-Reporting: Survey prompt to user, logging the reporting event.");AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webuserexperiencesurveyprompt,f)}}if(!e){a.__super__.show.apply(this,arguments)}},_getDismissSurvey:function(c){var e=document.cookie.split("; ");for(var b=0;b<e.length;b++){var d=e[b].split("=");if(d[0]===c){return d[1]}}return null},_setRatingValue:function(c){var d=c.target||c.srcElement,b=d.id.split("survey_stars_rating")[1];this._rating=b;this.$el.find("#survey_stars .starratingselected").removeClass("starratingselected").addClass("starrating");switch(b){case"5":this.$el.find("#survey_stars_rating5").removeClass("starrating").addClass("starratingselected");case"4":this.$el.find("#survey_stars_rating4").removeClass("starrating").addClass("starratingselected");case"3":this.$el.find("#survey_stars_rating3").removeClass("starrating").addClass("starratingselected");case"2":this.$el.find("#survey_stars_rating2").removeClass("starrating").addClass("starratingselected");case"1":this.$el.find("#survey_stars_rating1").removeClass("starrating").addClass("starratingselected");default:}},hideSurvey:function(){if(!this._isSubmitted){var b={surveyId:this._surveyId,sessionId:AMA.config.sessionId,endpointId:AMA.config.endpointId,webUserExperienceSurveySessionId:a.SESSION_ID,timestamp:new Date().getTime().toString()};AMA.debug("Survey-Reporting:  User canceled Survey, logging the reporting event."+this._surveyType);AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webuserexperiencesurveycancel,b)}this._isSubmitted=false;this.hide()},_cancel:function(){if(this._surveyId==10||this._surveyId==11){AMA.Util.setCookie("dismissSurvey",true,a.COOKIE_EXPIRY)}this.hideSurvey()},_submit:function(){if(!this._questionList){AMA.error("Survey: Cannot process submission as there is no question list");return}var f=false,c={},b={},e={},g=this;for(var d in this._questionList){c=this._questionList[d];switch(c.type){case"stars":if(c.required&&!this._rating){AMA.error("Survey: Rating required but none provided");f=true;$("#survey_stars .survey_error").show()}else{b[d]=this._rating}break;case"text":this._reason=$("#survey_text_textarea").val();if(c.required&&this._reason.length==0){AMA.error(" Survey: Comment required but none provided");$("#survey_text .survey_error_no_comment").show();f=true}else{if(c.required&&this._reason.length==0){if(this._reason.length<parseInt(c.minLength)){AMA.error("Survey: Comment length is short of minimum required.");$("#survey_text .survey_error_no_comment").show();$("#survey_text .survey_error_min_length").show();$("#survey_text .survey_text_min_chars").html(c.minLength);$("#survey_text .survey_text_min_chars").show()}else{b[d]=this._reason}}else{b[d]=this._reason}}break}}if(!f){AMA.debug("Survey: Response validation passed");if(this._surveyId==10||this._surveyId==11){AMA.Util.setCookie("dismissSurvey",true,a.COOKIE_EXPIRY)}if(AMA.models.capabilities.canCreate("reportEvents")){e={surveyId:this._surveyId,mdn:AMA.models.endpoints.toJSON()[0].name,webUserExperienceSurveySessionId:a.SESSION_ID,responses:b,timestamp:new Date().getTime().toString()};AMA.debug("Survey: Submitting survey responses");AMA.ReportingManager.reportEvent(AMA.config.reportingEventTypes.webuserexperiencesurveysubmit,e,g._confirmSubmission);this._isSubmitted=true}else{AMA.error("Survey: Account does not have permission to submit survey responses");return}}return false},_confirmSubmission:function(b){if(b){$("#survey_step1").hide();$("#survey_send_feedback").hide();$("#survey_step2").show();$("#sv_text_close_div").show()}else{this.hide()}},_isCookieExisting:function(f){var e=document.cookie,c=false,b=null;for(var d=0;d<(e.length-f.length);d++){b=e.substr(d,f.length);if(b===f){c=true;break}}return c},_checkCommentLength:function(){var b=this.$el.find("#survey_text_textarea"),c=b.val().length;if(c>this._textQuestionMaxLength){b.val(b.val().substr(this._textQuestionMinLength,this._textQuestionMaxLength))}}})})();
/*! accountStatusToolset */
(function(){AMA.namespace("view");var a=AMA.view.AccountStatusToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="account_status_toolset_template";a.TEMPLATE_SRC="";a.CHECKS=["redx","greentick"];a.LOCKS=["unlocked","locked"];a.ENABLED=["Disabled","Enabled"];_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments)},_processData:function(b){b.is_lock_enabled=a.ENABLED[b.current_lockstatus];b.is_locaction_enabled=a.ENABLED[b.locationcheck_on];b.is_admin_enabled=a.ENABLED[b.android_device_admin];b.android_device_admin=a.CHECKS[b.android_device_admin];b.locationcheck_on=a.CHECKS[b.locationcheck_on];b.current_lockstatus=a.LOCKS[b.current_lockstatus];return b},render:function(){a.__super__.render.apply(this)},_afterRender:function(){if(AMA.models.endpoints.models[0].get("platform").indexOf("iOS")>-1){this.$el.find(".android_device_admin").hide();this.$el.find(".current_lockstatus").hide();this.$el.find(".account_active").show();if(!AMA.models.capabilities.canRead("eventSettings")){this.$el.find(".locationcheck_on").hide()}}else{this.$el.find(".account_active").hide()}}})})();
/*! AlarmToolset */
(function(){AMA.namespace("view");var a=AMA.view.AlarmToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="alarm_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",SOUNDING:"sounding",UNSUCCESSFUL:"unsuccessful",SUCCESS:"success",NORMAL:"normal"};_.extend(a.prototype,{events:{"click .button_alarm":"alarm"},initialize:function(){a.__super__.initialize.apply(this,arguments);var c=AMA.ActionManager,d=AMA.workflow.BaseWorkflow,b=AMA.workflow.AlarmWorkflow;var f=new b();c.define("alarm",f);f.on(d.EVENT.STATE_CHANGED,function(g){switch(g.state){case d.STATE.INITIALIZING:AMA.debug("Alarm Toolset has switched the Alarm Button state to 'connecting'; countdown initialized");this.toggleDisplay(a.CSS.CONNECTING);break;case b.STATE.SOUNDING:AMA.debug("Alarm Toolset has switched the Alarm Button state to 'sounding'");this.toggleDisplay(a.CSS.SOUNDING);break;default:}},this);f.on(d.EVENT.FINISHED,function(g){switch(g.result){case d.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);break;default:this.toggleDisplay(a.CSS.UNSUCCESSFUL)}},this);var e=this;f.on(d.EVENT.COUNTDOWN_TICK,function(g){$(".alarm_toolset_countdown").html(g.remaining);e._timeRemaining=g.remaining},this)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_alarm").hide()},render:function(){a.__super__.render.apply(this)},alarm:function(){AMA.ActionManager.start("alarm")}})})();
/*! EndpointToolset */
(function(){AMA.namespace("view");var a=AMA.view.EndPointToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="endpoint_toolset_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{events:{"click .newphone a":"showNewPhonePopup"},initialize:function(){a.__super__.initialize.apply(this,arguments)},render:function(){a.__super__.render.apply(this);$(".lp_image_default").error(function(){$(this).attr("src","img/genericphone_small.png")})},_processData:function(c){var b=AMA.config.apiHostUrl+"/deviceImages?"+$.param({size:"small",platformName:c.platform,devId:AMA.config.devId});c.platformImage=c.platform?b:"img/genericphone_small.png";c.name=AMA.Util.formatPhone(c.name);return c},showNewPhonePopup:function(){var b={id:"newPhone",url:"/web/new_phone.html?title=newPhone",width:730,height:390};AMA.Util.openPopupWindow(b)}})})();
/*! LearnMore */
(function(){AMA.namespace("view");var a=AMA.view.LearnMore=AMA.view.Dialog.extend();a.TEMPLATE_ID="Learn_More_template";a.TEMPLATE_SRC="";a.WIDTH=650;a.HEIGHT="auto";_.extend(a.prototype,{initialize:function(){this.options.width=a.WIDTH;this.options.height=a.HEIGHT;a.__super__.initialize.apply(this,arguments)},show:function(){this.$el.find("."+arguments[0]).removeClass("hidden").siblings("div").addClass("hidden");a.__super__.show.apply(this,arguments)}})})();
/*! LocateToolset */
(function(){AMA.namespace("view");var a=AMA.view.LocateToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="locate_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",REFINING:"refining",UNSUCCESSFUL:"unsuccessful",SUCCESS:"success",NORMAL:"normal",CANCELLED:"cancelled"};_.extend(a.prototype,{events:{"click .button_locate.normal":"locate","click .button_locate.outcome.success":"locate","click .button_locate.outcome.unsuccessful":"locate","click .button_locate.outcome.cancelled":"locate"},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.LocateWorkflow;var f=new d();b.define("locate",f);f.on(c.EVENT.STATE_CHANGED,function(g){switch(g.state){case c.STATE.INITIALIZING:this.toggleDisplay(a.CSS.CONNECTING);break;case d.STATE.REFINING:this.toggleDisplay(a.CSS.REFINING);break;default:}AMA.debug("Locate Toolset has switched the Locate Button state to '"+f.getStateName(g.state)+"' state")},this);f.on(c.EVENT.FINISHED,function(g){switch(g.result){case c.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);if(AMA.config.enableSurveys){AMA.page.openSurvey("location-success")}break;case c.RESULT.FAILED:this.toggleDisplay(a.CSS.UNSUCCESSFUL);break;case c.RESULT.CANCELLED:this.toggleDisplay(a.CSS.CANCELLED);break;default:}$(".locate_toolset_countdown").html("03:00");AMA.debug("Locate toolset finished with result of '"+f.getResultName(g.result)+"'")},this);var e=this;f.on(c.EVENT.COUNTDOWN_TICK,function(g){$(".locate_toolset_countdown").html(g.remaining);e._timeRemaining=g.remaining},this)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_locate").hide()},render:function(){a.__super__.render.apply(this)},locate:function(b){b.stopPropagation();AMA.ActionManager.start("locate")},_afterRender:function(){if(AMA.models.endpoints.models[0].get("platform").indexOf("iOS")===0){this.$el.find("#button_locate_normal .tooltip").html(this.$el.find(".normal_iPhone_tooltip").html())}}})})();
/*! LockToolset */
(function(){AMA.namespace("view");var a=AMA.view.LockToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="lock_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",UNSUCCESSFUL:"unsuccessful",SUCCESS:"locked",NORMAL:"normal"};a.STATUS="";_.extend(a.prototype,{events:{"click .button_lock.normal, .button_lock.unsuccessful .tryagain":"lock"},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.LockWorkflow;var f=new d();b.define("lock",f);f.on(c.EVENT.STATE_CHANGED,function(g){switch(g.state){case c.STATE.INITIALIZING:AMA.debug("Lock Toolset has switched the Lock Button state to 'connecting'; countdown initialized");this.toggleDisplay(a.CSS.CONNECTING);break;default:break}},this);f.on(c.EVENT.FINISHED,function(g){switch(g.result){case c.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);break;default:this.toggleDisplay(a.CSS.UNSUCCESSFUL)}},this);var e=this;f.on(c.EVENT.COUNTDOWN_TICK,function(g){$("#lock_toolset_countdown").html(g.remaining);e._timeRemaining=g.remaining},this);Backbone.globalEvent.on("DeviceSettingChanged",function(){if(AMA.models.devicesettings.models.length>0&&AMA.models.devicesettings.models[0].get("current_lockstatus")){e.toggleDisplay(a.CSS.SUCCESS)}else{e.toggleDisplay(a.CSS.NORMAL)}})},_processData:function(b){this.STATUS=b.current_lockstatus;return b},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_lock").hide()},render:function(){a.__super__.render.apply(this);switch(this.STATUS){case 1:AMA.debug("Lock Toolset has switched the Lock Button state to 'locked'");this.toggleDisplay(a.CSS.SUCCESS);break;default:this.toggleDisplay(a.CSS.NORMAL)}},lock:function(){AMA.ActionManager.start("lock")}})})();
/*! SecurePhoneToolset */
(function(){AMA.namespace("view");var a=AMA.view.SecurePhoneToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="securephone_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",UNSUCCESSFUL:"unsuccessful",ANNOUNCING:"announcing",RETRYING:"retrying",NORMAL:"normal"};_.extend(a.prototype,{events:{"click .button_securephone.normal":"_showStep1Dialog","click .button_securephone.connecting, .button_securephone.announcing, .button_securephone.retrying":"_showStep2Dialog"},workflow:null,initialize:function(){a.__super__.initialize.apply(this);this.workflow=new AMA.workflow.SecurePhoneWorkflow();AMA.ActionManager.define("secure",this.workflow)},start:function(b){AMA.ActionManager.start("secure",b)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_securephone").hide()},render:function(){a.__super__.render.apply(this);this.securePhoneDialog=new AMA.view.SecurePhoneDialog({el:"#securephonedialog",width:670,parent:this,hidden:true,endpoint:AMA.models.endpoints})},_showStep1Dialog:function(){this.securePhoneDialog.show("step1")},_showStep2Dialog:function(){this.securePhoneDialog.show("step2")}})})();
/*! StorageCapacityToolset */
(function(){AMA.namespace("view");var a=AMA.view.StorageCapacityToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="storage_capacity_toolset_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);AMA.models.photos.on("reset",function(){this.data.fetch()},this);AMA.models.trash.on("reset",function(){this.data.fetch()},this);AMA.models.videos.on("reset",function(){this.data.fetch()},this)},_refetch:function(){this.data.fetch()},render:function(){a.__super__.render.apply(this)},_processData:function(b){var c=b||{};c.storageLimit=parseInt(b.totalCapacity||2147483648);c.ImageSize=parseInt(b.photosUsedCapacity||0);c.VideoSize=parseInt(b.videosUsedCapacity||0);c.TrashSize=parseInt(b.trashUsedCapacity||0);c.ImageUse=(c.ImageSize*100)/c.storageLimit;c.VideoUse=(c.VideoSize*100)/c.storageLimit;c.TrashUse=(c.TrashSize*100)/c.storageLimit;c.totalUsed=c.ImageSize+c.VideoSize+c.TrashSize;return c}})})();
/*! SyncDialog */
(function(){AMA.namespace("view");var a=AMA.view.SyncDialog=AMA.view.Modal.extend();a.TEMPLATE_ID="sync_dialog_template";a.TEMPLATE_SRC="";a.WIDTH=650;a.HEIGHT="auto";a.syncTriggeredFrom="";_.extend(a.prototype,{events:{"click .modal-footer .btn_sync ":"doSync","click .modal-footer .btn_cancel":"hide","click a.syncSettingsDialog":"openBackupTab"},initialize:function(){this.options.width=a.WIDTH;this.options.height=a.HEIGHT;a.syncTriggeredFrom="";a.__super__.initialize.apply(this,arguments)},_setupEvents:function(){},show:function(k){a.syncTriggeredFrom=k||a.syncTriggeredFrom;if(!AMA.models.contacts.isLoaded){AMA.models.contacts.fetch()}if(!AMA.models.photos.isLoaded){AMA.models.photos.fetch()}if(!AMA.models.videos.isLoaded){AMA.models.videos.fetch()}if(AMA.models.contacts.isFetching||AMA.models.photos.isFetching||AMA.models.videos.isFetching){AMA.debug("One of the models still fetching. Attempting to show dialog again");this._fetchTimeout=setTimeout(_.bind(this.show,this),500);return}else{this.$el.find("input.item_type").prop("checked",false);var c=this.$el.find(".contact_count"),f=this.$el.find(".photo_count"),e=this.$el.find(".video_count");AMA.debug("Get count of records pending sync for display on "+this.options.el);var i=AMA.models.contacts.attributes.totalPendingSync,d=AMA.models.photos.attributes.totalPendingSync,h=AMA.models.videos.attributes.totalPendingSync;c.html(i);AMA.debug(i+" contacts pending sync");f.html(d);AMA.debug(d+" photos pending sync");e.html(h);AMA.debug(h+" videos pending sync");var b=AMA.models.syncsettings.models[0];value=b.get("syncOnMobileData");if(!value){this.$el.find("#backupConnectionWifiOrMobileNetwork_syncdialog").hide();this.$el.find("#syncphonedialog_currentsync_both_label").hide();this.$el.find("#backupConnectionWifiOnly_syncdialog").show();this.$el.find("#syncphonedialog_currentsync_wifionly_label").show()}else{this.$el.find("#backupConnectionWifiOnly_syncdialog").hide();this.$el.find("#syncphonedialog_currentsync_wifionly_label").hide();this.$el.find("#backupConnectionWifiOrMobileNetwork_syncdialog").show();this.$el.find("#syncphonedialog_currentsync_both_label").show()}this.$el.find(".step1 .error").hide();a.__super__.show.apply(this,arguments);if(AMA.config.enableReporting){var l="";if(this.$el.find("#sync_dialog_contacts_checkbox").attr("checked")){l="contacts,"}if(this.$el.find("#sync_dialog_photos_checkbox").attr("checked")){l+="images,"}if(this.$el.find("#sync_dialog_videos_checkbox").attr("checked")){l+="videos,"}if(l.length!=0){l=l.substring(0,l.length-1)}var g={};g.Type="sync";g.DataType=l;AMA.ReportingManager.reportSyncEvent(AMA.config.reportingEventTypes.webSyncDialogShown,g)}}},doSync:function(){var e=this.$el.find("input.item_type:checked"),b="";if(e.length===0){AMA.debug("No item types selected in "+this.options.el+". Prompting the user");this.$el.find(".step1 .error.nothing_selected").show();return}_.each(e,function(k,h,i){b+=k.value;b+=(h<i.length-1)?", ":""},this);AMA.debug(this.options.el+" indicates that "+b+" will be included in the sync");this.hide();AMA.ActionManager.start("sync",{itemsToSync:b});if(AMA.config.enableReporting){var g={};var f="";var d=[];if(this.$el.find("#sync_dialog_contacts_checkbox").prop("checked")){f="contacts,";d.push("Contacts")}if(this.$el.find("#sync_dialog_photos_checkbox").prop("checked")){f+="images,";d.push("Photos")}if(this.$el.find("#sync_dialog_videos_checkbox").prop("checked")){f+="videos,";d.push("Videos")}f=f.substring(0,f.length-1);g.Type="sync";g.DataType=f;AMA.ReportingManager.reportSyncEvent(AMA.config.reportingEventTypes.webSyncTriggered,g);var c=0;for(c=0;c<d.length;c++){g={};g.Type="Sync "+d[c]+" "+a.syncTriggeredFrom;AMA.ReportingManager.reportUserAction(AMA.config.reportingEventTypes["websync"+d[c]+a.syncTriggeredFrom],g)}}},openBackupTab:function(){if(AMA.config.enableReporting){var b={};b.Type="sync";AMA.ReportingManager.reportSyncEvent(AMA.config.webSyncDialogCancelled,b)}AMA.page.openSettings("backup")}})})();
/*! SyncToolset */
(function(){AMA.namespace("view");var a=AMA.view.SyncToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="sync_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",SYNCING:"syncing",UNSUCCESSFUL:"unsuccessful",SUCCESS:"success",NORMAL:"normal"};_.extend(a.prototype,{events:{"click .button_sync.normal":"syncData","click .button_sync .tryagain":"syncData","click .viewdetails":"syncDetails","click .sync_settings_link":"syncSettings"},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.SyncWorkflow;var f=new d();b.define("sync",f);f.on(c.EVENT.STATE_CHANGED,function(i){switch(i.state){case c.STATE.INITIALIZING:AMA.debug("Sync Toolset has switched the Sync Button state to 'connecting'; countdown initialized");this.toggleDisplay(a.CSS.CONNECTING);break;case d.STATE.SYNCING:AMA.debug("Sync Toolset has switched the Sync Button state to 'syncing'");this.toggleDisplay(a.CSS.SYNCING);if(i.data){var r=$(".sync_detail_msg");var h={contacts:i.data.contacts,images:i.data.images,videos:i.data.videos};var k={syncing_of:r.find(".syncing_of").text(),waiting_to_sync:r.find(".waiting_to_sync").text(),pending:r.find(".pending").text(),no_change:r.find(".no_change").text(),syncing:r.find(".syncing").text()};var m=i.data.itemsBeingSynced.split(",");var s=".button_sync.outcome.syncing";for(var q in h){this.$el.find(s+" .tooltip ."+q).addClass("hide")}for(var p=0;p<m.length;p++){var o=m[p].trim();o=o==="pictures"?"images":o;var g=h[o];if(g){if(g.status==="syncing"){if(g.completed!==g.total){var l=parseInt(g.completed)/parseInt(g.total);var l=l*100;this.$el.find(s+" .tooltip ."+o+"_count").html(g.completed+k.syncing_of+g.total);this.$el.find(s+" .tooltip ."+o+"_progress").show();this.$el.find(s+" .tooltip ."+o+"_progress").progressbar({value:l});this.$el.find(s+" .tooltip ."+o+"_progress").addClass("sync_progress");this.$el.find(s+" .tooltip ."+o+"_text").find(".icon_checkmark").hide()}else{this.$el.find(s+" .tooltip ."+o+"_progress").hide();if(g.total!==0){this.$el.find(s+" .tooltip ."+o+"_text").find(".icon_checkmark").show();this.$el.find(s+" .tooltip ."+o+"_text").find(".icon_checkmark").addClass("sync_complete")}else{this.$el.find(s+" .tooltip ."+o+"_count").html(k[g.status]);this.$el.find(s+" .tooltip ."+o+"_text").find(".icon_checkmark").hide()}}}else{var n=g.status==="pending"?(g.pending+" "+k[g.status]):k[g.status];this.$el.find(s+" .tooltip ."+o+"_count").html(n);this.$el.find(s+" .tooltip ."+o+"_text").find(".icon_checkmark").hide();this.$el.find(s+" .tooltip ."+o+"_progress").hide()}}this.$el.find(s+" .tooltip ."+o+"_count").addClass("sync_"+o+"_count");this.$el.find(s+" .tooltip ."+o).removeClass("hide")}}break;default:}},this);f.on(c.EVENT.FINISHED,function(i){switch(i.result){case c.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);var l=i.data.deviceContactCreate+i.data.deviceContactUpdate+i.data.deviceContactDelete+i.data.webContactCreate+i.data.webContactUpdate+i.data.webContactDelete,k=i.data.devicePhotosCreate+i.data.devicePhotosUpdate+i.data.devicePhotosDelete+i.data.deviceTransmitImages,g=i.data.deviceVideosCreate+i.data.deviceVideosUpdate+i.data.deviceVideosDelete+i.data.deviceTransmitVideos;this._syncSuccessData=i.data;this.$el.find(".button_sync.outcome.success .syncsuccess_totalContacts").html(l);this.$el.find(".button_sync.outcome.success .syncsuccess_totalPhotos").html(k);this.$el.find(".button_sync.outcome.success .syncsuccess_totalVideos").html(g);if(AMA.config.enableSurveys){AMA.page.openSurvey("sync-manual-success")}this.$el.find(".button_sync.outcome.syncing .contacts .completed").html(0);this.$el.find(".button_sync.outcome.syncing .photos .completed").html(0);this.$el.find(".button_sync.outcome.syncing .videos .completed").html(0);this.$el.find(".button_sync.outcome.syncing .contacts .total").html(0);this.$el.find(".button_sync.outcome.syncing .photos .total").html(0);this.$el.find(".button_sync.outcome.syncing .videos .total").html(0);this.$el.find(".button_sync.outcome.syncing .contacts .ui-progressbar-value").width("0%");this.$el.find(".button_sync.outcome.syncing .photos .ui-progressbar-value").width("0%");this.$el.find(".button_sync.outcome.syncing .videos .ui-progressbar-value").width("0%");break;default:this.toggleDisplay(a.CSS.UNSUCCESSFUL);AMA.ReportingManager.remoteLog("Sync Failed [type:-sync][accountID:-"+AMA.config.accountDetails.accountId+"][MDN:-"+AMA.config.accountDetails.accountMdn+"][time remaining:-"+this._timeRemaining+"][details:-Failed]",AMA.config.JsonConstants.LOGLEVEL_STATES.AUDIT);if(i.data!=null){var h=AMA.Util.parseStatusDetails(i.data.statusDetails,"sync");if(h!==""){this.$el.find(".button_sync.outcome.unsuccessful .tooltip").html(h)}}}},this);var e=this;f.on(c.EVENT.COUNTDOWN_TICK,function(g){$("#sync_toolset_countdown").html(g.remaining);e._timeRemaining=g.remaining},this)},_setupEvents:function(){var b=this;Backbone.globalEvent.on("showSyncDialog",function(c){b.syncDialog.show(c.type)})},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_sync").hide()},render:function(){a.__super__.render.apply(this);this.syncDialog=new AMA.view.SyncDialog({el:"#sync_dialog",parent:this});this.SyncDetailsDialog=new AMA.view.SyncDetailsDialog({el:"#sync_successdetails",parent:this})},syncData:function(b){b.stopPropagation();this.syncDialog.show("Backup")},syncSettings:function(b){b.stopPropagation();AMA.page.openSettings("backup")},syncDetails:function(b){b.stopPropagation();this.SyncDetailsDialog.show(this._syncSuccessData);$(".button_sync.outcome.success").hide();$(".button_sync.normal").show()}})})();
/*! TransferDataToolset */
(function(){AMA.namespace("view");var a=AMA.view.TransferDataToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="transfer_data_toolset_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments)},render:function(){a.__super__.render.apply(this);this.transferDataWizard=new AMA.view.TransferDataWizard({el:"#transferdata_dialog",parent:this})},_setupEvents:function(){var c=this,b=c.$el;b.find(".button_transferdata").on("click",function(){c.transferDataWizard.show()})}})})();
/*! TransferDataWizard */
(function(){AMA.namespace("view");var a=AMA.view.TransferDataWizard=AMA.view.Wizard.extend();a.TEMPLATE_ID="transferdata_dialog_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){this.options.width=650;this.options.height=400;a.__super__.initialize.apply(this,arguments)},hide:function(){a.__super__.hide.apply(this,arguments);this.$el.find(".step1").addClass("current").siblings(".wiz_step").removeClass("current")},_setupEvents:function(){a.__super__._setupEvents.call(this,arguments);var c=this,b=c.$el;b.find(".close").on("click",function(d){d.stopPropagation();c.hide()})}})})();
/*! WipePhoneDialog */
(function(){AMA.namespace("view");var a=AMA.view.WipePhoneDialog=AMA.view.Wizard.extend();a.TEMPLATE_ID="wipephonedialog_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{events:{"click .close":"_hideDialog","click .btn_cancel":"_hideDialog","click .btn_factory_reset_device.sync":"_wipe","click .btn_factory_reset_device.nosync":"_wipeonly","click .btn_erase.sync":"_wipe","click .btn_erase.nosync":"_wipeonly","click .btn_erase_and_lock.sync":"_wipe","click .btn_erase_and_lock.nosync":"_wipeonly","click .btn_sync_then_wipe":"_wipe","click .btn_nosync_then_wipe":"_wipeonly","click .btn_sync_then_reset":"_wipe","click .btn_nosync_then_reset":"_wipeonly","click .btn_logout":"_factorySuccessLogout"},_setupEvents:function(){var b=this;this._setupSteps();this.$el.find(".next").on("click",function(){$(b.steps[b.steps.index(b.$el.find("."+AMA.view.Wizard.CSS.ACTIVE))]).removeClass(AMA.view.Wizard.CSS.ACTIVE).next().addClass(AMA.view.Wizard.CSS.ACTIVE);b.processDialogView()});this.$el.find(".previous").on("click",function(){$(b.steps[b.steps.index(b.$el.find("."+AMA.view.Wizard.CSS.ACTIVE))]).removeClass(AMA.view.Wizard.CSS.ACTIVE).prev().addClass(AMA.view.Wizard.CSS.ACTIVE);b.processDialogView()})},show:function(b){if(b==="resetsuccess"){this.$el.find(".close").hide()}a.__super__.show.call(this);this.processDialogView(b)},_hideDialog:function(){if(!this.$el.find(".step1").hasClass("current")){this.$el.find(".title").addClass("hidden");this.$el.find(".title.wipe").removeClass("hidden");this.$el.find(".wiz_step").removeClass("current");this.$el.find(".step1, .step1_buttons").addClass("current")}this.hide()},_wipe:function(){this._hideDialog();var b=this._createWipeWorkflow();if(this.$el.find("input#wipephone_reset:checked").length>0){AMA.ActionManager.define("wipefactoryonly",b);AMA.ActionManager.start("wipefactoryonly")}else{AMA.ActionManager.define("wipe",b);AMA.ActionManager.start("wipe")}},_wipeonly:function(){this._hideDialog();var b=this._createWipeWorkflow();if(this.$el.find("input#wipephone_reset:checked").length>0){AMA.ActionManager.define("wipefactoryonly",b);AMA.ActionManager.start("wipefactoryonly")}else{AMA.ActionManager.define("wipeonly",b);AMA.ActionManager.start("wipeonly")}},_createWipeWorkflow:function(){var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.WipeWorkflow,e=new d();e.on(c.EVENT.STATE_CHANGED,function(h){switch(h.state){case c.STATE.INITIALIZING:AMA.debug("Wipe Toolset has switched the Wipe Button state to 'connecting'; countdown initialized");this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.CONNECTING);break;case d.STATE.SYNCING:AMA.debug("Wipe Toolset has switched the Wipe Button state to 'syncing'");this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.SYNCING);break;case d.STATE.ERASING:AMA.debug("Wipe Toolset has switched the Wipe Button state to 'erasing'");this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.ERASING);var f=this.parent.$el.find(".button_wipe.outcome:not(.unsuccessful) .tooltip"),g=this._buildTotals(h.data);f.find(".total_erased_audio").html(g.audio||"0/0");f.find(".total_erased_mediafiles").html(g.file||"0/0");f.find(".total_erased_video").html(g.video||"0/0");f.find(".total_erased_photo").html(g.photo||"0/0");f.find(".total_erased_folder").html(g.folder||"0/0");f.find(".total_erased_sms").html(g.sms||"0/0");f.find(".total_erased_calllog").html(g.call_log||"0/0");f.find(".total_erased_calendar").html(g.calendar||"0/0");f.find(".total_erased_contact").html(g.contacts||"0/0");break;default:}},this);e.on(c.EVENT.FINISHED,function(h){switch(h.result){case c.RESULT.SUCCESSFUL:this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.SUCCESS);var f=this.parent.$el.find(".button_wipe.outcome:not(.unsuccessful) .tooltip"),g=this._buildTotals(h.data.split("\n"));f.find(".total_erased_audio").html(g.audio||"0/0");f.find(".total_erased_mediafiles").html(g.file||"0/0");f.find(".total_erased_video").html(g.video||"0/0");f.find(".total_erased_photo").html(g.photo||"0/0");f.find(".total_erased_folder").html(g.folder||"0/0");f.find(".total_erased_sms").html(g.sms||"0/0");f.find(".total_erased_calllog").html(g.call_log||"0/0");f.find(".total_erased_calendar").html(g.calendar||"0/0");f.find(".total_erased_contact").html(g.contacts||"0/0");AMA.models.contacts.invalidate();AMA.models.photos.invalidate();AMA.models.videos.invalidate();break;case d.RESULT.FACTORY_RESET_SUCCESSFUL:this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.NORMAL);this.show("resetsuccess");break;default:this.parent.toggleDisplay(AMA.view.WipeToolset.CSS.UNSUCCESSFUL)}},this);e.on(c.EVENT.COUNTDOWN_TICK,function(f){$("#wipe_toolset_countdown").html(f.remaining)},this);return e},processDialogView:function(e){var c=AMA.Util.isAndroid(this.options.endpoint.models[0].get("platformfriendlyname")),b=(this.data.models[0].get("android_device_admin")==="1"),d=(this.options.endpoint.models[0].get("syncAndOrWipeSupported")==="true");if(e){this.$el.find(".wiz_step").removeClass("current");this.$el.find("."+e+".wiz_step, ."+e+"_buttons").addClass("current")}if(this.$el.find(".step1").hasClass("current")){this.$el.find(".step1_buttons").addClass("current").removeClass("hidden");this.$el.find(".step1_buttons").siblings().removeClass("current").addClass("hidden");this.$el.find(".step1_buttons .btn-primary:not(.btn_cancel)").hide();if(!AMA.config.lockEnabled){this.$el.find(".step1 .no_lock, .step1_buttons .no_lock").hide()}if(c&&b){this.$el.find(".step1 .wipeonly").hide();this.$el.find(".step1 .wipesync").hide();this.$el.find(".step1 input#wipephone_wipe").prop("checked",true)}else{this.$el.find(".step1 .wipereset").hide();if(AMA.models.capabilities.canCreate("syncEvents")){this.$el.find(".step1 .wipeonly").hide()}else{this.$el.find(".step1 .wipesync").hide()}}if(b){this.$el.find(".step1_buttons .btn_next").show()}else{if(AMA.config.lockEnabled){this.$el.find(".step1_buttons .btn_erase_and_lock").show()}else{this.$el.find(".step1_buttons .btn_erase").show()}if(AMA.models.capabilities.canCreate("syncEvents")){console.log("1 - "+AMA.models.capabilities.canCreate("syncEvents"));this.$el.find(".step1_buttons .nosync").hide()}else{console.log("2 - "+AMA.models.capabilities.canCreate("syncEvents"));this.$el.find(".step1_buttons .sync").hide()}}}else{if(this.$el.find(".step2").hasClass("current")){this.$el.find(".step2 .warning").hide();this.$el.find(".step2_buttons").addClass("current").removeClass("hidden");this.$el.find(".step2_buttons").siblings().removeClass("current").addClass("hidden");this.$el.find(".step2_buttons .btn-primary:not(.btn_cancel)").hide();if(this.$el.find("#wipephone_wipe:checked").length>0){if(d){this.$el.find(".step2 .warning.optionalsync").show();this.$el.find(".step2_buttons .btn_sync_then_wipe").show();this.$el.find(".step2_buttons .btn_nosync_then_wipe").show();this.$el.find(".step2 .confirm .wipingorresetting_wiping").show();this.$el.find(".step2 .confirm .wipingorresetting_resetting").hide()}else{this.$el.find(".step2 .warning.erase").show();if(!AMA.config.lockEnabled){this.$el.find(".step2_buttons .btn_erase_and_lock").hide();this.$el.find(".step2_buttons .btn_erase").show()}else{this.$el.find(".step2_buttons .btn_erase_and_lock").show();this.$el.find(".step2_buttons .btn_erase").hide()}if(AMA.models.capabilities.canCreate("syncEvents")){this.$el.find(".step2_buttons .nosync").hide()}else{this.$el.find(".step2_buttons .sync").hide()}}}else{this.$el.find(".title").addClass("hidden");this.$el.find(".title.reset").removeClass("hidden");if(d){this.$el.find(".step2 .warning.optionalsync").show();this.$el.find(".step2_buttons .btn_sync_then_reset").show();this.$el.find(".step2_buttons .btn_nosync_then_reset").show();this.$el.find(".step2 .confirm .wipingorresetting_resetting").show();this.$el.find(".step2 .confirm .wipingorresetting_wiping").hide()}else{this.$el.find(".step2 .warning.factoryreset").show();this.$el.find(".step2_buttons .btn_factory_reset_device").show();if(AMA.models.capabilities.canCreate("syncEvents")){this.$el.find(".step2_buttons .nosync").hide()}else{this.$el.find(".step2_buttons .sync").hide()}}}}else{if(this.$el.find(".resetsuccess").hasClass("current")){this.$el.find(".title").addClass("hidden");this.$el.find(".title.resetsuccess").removeClass("hidden");this.$el.find(".resetsuccess_buttons").addClass("current").removeClass("hidden");this.$el.find(".resetsuccess_buttons").siblings().removeClass("current").addClass("hidden")}}}},_buildTotals:function(b){var c={audio:null,file:null,video:null,photo:null,folder:null,sms:null,call_log:null,calendar:null,contacts:null};_.each(b,function(d){if(d.indexOf("audios")==0){c.audio=d.substr(7)==="0/-1"?"0/0":d.substr(7)}else{if(d.indexOf("files")==0){c.file=d.substr(6)==="0/-1"?"0/0":d.substr(6)}else{if(d.indexOf("videos")==0){c.video=d.substr(7)==="0/-1"?"0/0":d.substr(7)}else{if(d.indexOf("pictures")==0){c.photo=d.substr(9)==="0/-1"?"0/0":d.substr(9)}else{if(d.indexOf("folders")==0){c.folder=d.substr(8)==="0/-1"?"0/0":d.substr(8)}else{if(d.indexOf("sms")==0){c.sms=d.substr(4)==="0/-1"?"0/0":d.substr(4)}else{if(d.indexOf("calllogs")==0){c.call_log=d.substr(9)==="0/-1"?"0/0":d.substr(9)}else{if(d.indexOf("calendar")==0){c.calendar=d.substr(9)==="0/-1"?"0/0":d.substr(9)}else{if(d.indexOf("contacts")==0){c.contacts=d.substr(9)==="0/-1"?"0/0":d.substr(9)}}}}}}}}}},c);return c},_factorySuccessLogout:function(){location="index.html#get_started"}})})();
/*! WipeToolset */
(function(){AMA.namespace("view");var a=AMA.view.WipeToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="wipe_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",SYNCING:"syncing",ERASING:"erasing",UNSUCCESSFUL:"unsuccessful",SUCCESS:"success",NORMAL:"normal"};_.extend(a.prototype,{events:{"click .button_wipe.normal":"_showDialog","click .button_wipe.unsuccessful":"_showDialog"},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_wipe").hide()},render:function(){a.__super__.render.apply(this);if(!this.wipePhoneDialog){this.wipePhoneDialog=new AMA.view.WipePhoneDialog({el:"#wipephonedialog",width:670,parent:this,hidden:true,data:AMA.models.devicesettings,endpoint:AMA.models.endpoints})}else{this.wipePhoneDialog.render()}if(AMA.models.capabilities.canCreate("syncEvents")){this.$el.find(".tooltip .wipe").removeClass("hidden")}else{this.$el.find(".tooltip .wipeonly").removeClass("hidden")}if(AMA.config.lockEnabled){this.$el.find(".tooltip .lockenabled").removeClass("hidden")}if(AMA.Util.isBB(AMA.models.endpoints.models[0].get("platformfriendlyname"))){this.$el.find(".tooltip").addClass("long");this.$el.find(".tooltip .isblackberry").removeClass("hidden")}},_processData:function(b){},_showDialog:function(){this.wipePhoneDialog.show()},_showRestoreSteps:function(){AMA.page.header.toolbar.toolsets.transferData.transferDataWizard.show()}})})();
/*! SecurePhoneDialog */
(function(){AMA.namespace("view");var a=AMA.view.SecurePhoneDialog=AMA.view.Wizard.extend();a.TEMPLATE_ID="securephone_dialog_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this);this._performAnnounce=false;this._performErase=false;this._locateSuccess=false;this._wipeSuccess=false;this._announceSuccess=false},events:{"click .close":"hide","click .btn_cancel":"hide","click .btn_submit":"_doSecurePhone","click #securephone_announce":"_toggleAnnounceTextarea"},_setupEvents:function(){this._setupSteps();var b=this;this.$el.find("#securephone_announce_message").on("keyup",function(){b.$el.find("#securephone_announce_charcount").html(b._countAnnounceTextareaChars())})},show:function(b){a.__super__.show.call(this);this.processDialogView(b);$("#securephone_announce_message").val($("#securephone_announce_default_message").html())},_doSecurePhone:function(){var b=AMA.ActionManager,d=AMA.workflow.BaseWorkflow,f=AMA.workflow.SecurePhoneWorkflow,e=null,c="gpsrefresh",h=this.parent.workflow,g=this;this._performAnnounce=$("#securephone_announce").is(":checked");this._performErase=$("#securephone_wipe").is(":checked");e=this._performAnnounce?$.trim(this.$el.find("#securephone_announce_message").val()):null;if(this._performAnnounce&&e.length==0){this.$el.find(".error").addClass("hidden");this.$el.find(".error.notext").removeClass("hidden");return}c+=this._performErase?"|wipe":"";c+=this._performAnnounce?"|announce":"";h.on(d.EVENT.STATE_CHANGED,function(i){switch(i.state){case d.STATE.INITIALIZING:AMA.debug("Secure Phone Toolset has switched the Secure Phone Button state to 'connecting'");this.parent.toggleDisplay(AMA.view.SecurePhoneToolset.CSS.CONNECTING);this.processDialogView("step2",i.state);break;case f.STATE.CONNECTING:AMA.debug("Secure Phone Toolset has switched the Secure Phone Button state to 'announcing'; countdown initialized");this.parent.toggleDisplay(AMA.view.SecurePhoneToolset.CSS.ANNOUNCING);this.processDialogView("step2",i.state);break;case f.STATE.ANNOUNCE_DISPLAYED:AMA.debug("Announce message has been viewed on the device by the user; proceeding to next action");this.processDialogView("step2",i.state);break;case f.STATE.CONTACTS_ERASED:AMA.debug("Contacts successfully erased; proceeding to next action");this.processDialogView("step2",i.state,null,null,null,i.contactsErased);break;case f.STATE.REFINING:AMA.debug("Contacts successfully erased; proceeding to next action");AMA.page.content.locationTab.locationMap.CurrentState=AMA.workflow.LocateWorkflow.STATE.REFINING;this.processDialogView("step2",i.state);break;case f.STATE.RETRYING:AMA.debug("Updating the Secure Phone dialog with retry information");this.parent.toggleDisplay(AMA.view.SecurePhoneToolset.CSS.RETRYING);this.processDialogView("step2",i.state,null,null,null,null,i.retryInformation);break;case d.STATE.FINALIZING:AMA.page.content.locationTab.locationMap.CurrentState=d.STATE.FINALIZING;this._locateSuccess=i.locateSuccess;this._wipeSuccess=i.wipeSuccess;this._announceSuccess=i.announceSuccess;break;default:}},this);h.on(d.EVENT.FINISHED,function(i){this.parent.toggleDisplay(AMA.view.SecurePhoneToolset.CSS.NORMAL);switch(i.result){case d.RESULT.SUCCESSFUL:this.processDialogView("step2",i.result,this._locateSuccess,this._wipeSuccess,this._announceSuccess);break;default:AMA.page.content.locationTab.locationMap.status="fail";this.processDialogView("step2",i.result)}},this);h.on(d.EVENT.COUNTDOWN_TICK,function(i){$(".securephone_toolset_countdown").html(i.remaining)},this);$.webpurify.check(e,function(i){if(i){g.$el.find(".error").addClass("hidden");g.$el.find(".error.containsprofanity").removeClass("hidden");return}else{g.parent.start({actionsString:c,announceMessage:e,performAnnounce:g._performAnnounce,performErase:g._performErase})}})},processDialogView:function(d,b,i,l,n,e,c){var p=this.$el;var m=(this.options.endpoint.models[0].get("announceSupported")===true);if(d){p.find(".wiz_step").removeClass("current");p.find("."+d+".wiz_step").addClass("current")}if(p.find(".step1").hasClass("current")){p.find(".title .securephone_retry").addClass("hidden");p.find(".step1 .announce, .step1 .wipe, .modal-footer").show();p.find("#securephone_announce").prop("checked",null);p.find("#securephone_wipe").prop("checked",null);if(!m){p.find("#securephone_announce").prop("disabled",true)}p.find(".error").addClass("hidden");this._toggleAnnounceTextarea()}else{if(p.find(".step2").hasClass("current")){var g=AMA.workflow.BaseWorkflow,h=AMA.workflow.SecurePhoneWorkflow,k=p.find("#securephone_announce").prop("checked"),f=p.find("#securephone_wipe").prop("checked");p.find(".announce.feature, .wipe.feature, .divider-announce, .divider-wipe, .modal-footer").hide();if(k){p.find(".announce.feature, .divider-announce").show()}if(f){p.find(".wipe.feature, .divider-wipe").show()}switch(b){case g.STATE.INITIALIZING:p.find(".countdown_text, .waiting").removeClass("hidden");p.find(".countdowndivider").hide();p.find(".success, .fail").addClass("hidden");break;case h.STATE.CONNECTING:p.find(".status.alarm").addClass("hidden");p.find(".status.alarm.success").removeClass("hidden");break;case h.STATE.ANNOUNCE_DISPLAYED:p.find(".status.announce").addClass("hidden");p.find(".status.announce.success").removeClass("hidden");break;case h.STATE.CONTACTS_ERASED:p.find(".status.wipe").addClass("hidden");p.find(".status.wipe.success").removeClass("hidden");p.find(".status.wipe.success .contact_count").html(e);break;case h.STATE.REFINING:p.find(".status.locate").addClass("hidden");p.find(".status.locate.success").removeClass("hidden");break;case h.STATE.RETRYING:p.find(".title .securephone_retry").removeClass("hidden");$(".securephone_retry_current").html(c.retryAttempt);$(".securephone_retry_total").html(c.retryTotal);break;case g.RESULT.SUCCESSFUL:p.find(".title .securephone_retry,.countdown_text,.description,.status.locate,.status.announce,.status.wipe").addClass("hidden");p.find(".securephone_toolset_countdown").html("");p.find(".countdowndivider").show();p.find(".description.success").removeClass("hidden");var o=!i?"fail":"success";p.find(".status.locate."+o).removeClass("hidden");o=this._performAnnounce&&!l?"fail":"success";p.find(".status.announce."+o).removeClass("hidden");o=this._performErase&&!n?"fail":"success";p.find(".status.wipe."+o).removeClass("hidden");AMA.page.content.locationTab.locationMap.render();break;case g.RESULT.FAILED:p.find(".title .securephone_retry,.countdown_text,.description,.status").addClass("hidden");p.find(".description.fail, .status.fail").removeClass("hidden");p.find(".securephone_toolset_countdown").html("");p.find(".countdowndivider").show();AMA.page.content.locationTab.locationMap.render();break;default:}}}},_toggleAnnounceTextarea:function(){var f=this.$el.find("#securephone_announce_message");var e=this.$el.find(".announce_edit,#securephone_announce_message,.charcounttext");if(this.$el.find("#securephone_announce").prop("checked")){var d=AMA.models.dashboardData.models[0].attributes.emailAddress;var c="";if(AMA.models.dashboardData&&!d){var b=f.html();c=f.html()+" "+d+".";f.val(c)}e.removeClass("hidden");f.prop("disabled",null);this.$el.find("#securephone_announce_charcount").html(this._countAnnounceTextareaChars())}else{e.addClass("hidden");f.prop("disabled",true);f.html($("#securephone_announce_default_message").html())}},_countAnnounceTextareaChars:function(){return this.$el.find("#securephone_announce_message").val().length}})})();
/*! SyncDetailsDialog */
(function(){AMA.namespace("view");var b=AMA.view.SyncDetailsDialog=AMA.view.Modal.extend();b.TEMPLATE_ID="syncSuccess_dialog_template";b.TEMPLATE_SRC="";b.WIDTH=650;b.HEIGHT="auto";var a={};_.extend(b.prototype,{events:{},initialize:function(){this.options.width=b.WIDTH;this.options.height=b.HEIGHT;b.__super__.initialize.apply(this,arguments)},render:function(d){var c=_.template(this.template,a);this.$el.html(c);if(d){this.populateData(d)}},_setupEvents:function(){},show:function(c){this.render(c);b.__super__.show.apply(this,arguments)},populateData:function(f){var e=f.deviceContactCreate+f.deviceContactUpdate+f.deviceContactDelete+f.webContactCreate+f.webContactUpdate+f.webContactDelete,d=f.devicePhotosCreate+f.devicePhotosUpdate+f.devicePhotosDelete+f.deviceTransmitImages,c=f.deviceVideosCreate+f.deviceVideosUpdate+f.deviceVideosDelete+f.deviceTransmitVideos;this.$el.find(".syncsuccess_totalContacts").html(e);this.$el.find(".syncsuccess_totalPhotos").html(d);this.$el.find(".syncsuccess_totalVideos").html(c);this.$el.find(".syncsuccess_deviceContactsAdded").html(f.deviceContactCreate);this.$el.find(".syncsuccess_deviceContactsEdited").html(f.deviceContactUpdate);this.$el.find(".syncsuccess_deviceContactsDeleted").html(f.deviceContactDelete);this.$el.find(".syncsuccess_devicePhotosAdded").html(f.devicePhotosCreate);this.$el.find(".syncsuccess_devicePhotosDeleted").html(f.devicePhotosDelete);this.$el.find(".syncsuccess_deviceVideosAdded").html(f.deviceVideosCreate);this.$el.find(".syncsuccess_deviceVideosDeleted").html(f.deviceVideosDelete);this.$el.find(".syncsuccess_webContactsAdded").html(f.webContactCreate);this.$el.find(".syncsuccess_webContactsEdited").html(f.webContactUpdate);this.$el.find(".syncsuccess_webContactsDeleted").html(f.webContactDelete);this.$el.find(".syncsuccess_webPhotosAdded").html(f.deviceTransmitImages);this.$el.find(".syncsuccess_webPhotosEdited").html(f.webPhotosDeleted);this.$el.find(".syncsuccess_webVideosAdded").html(f.deviceTransmitVideos);this.$el.find(".syncsuccess_webVideosEdited").html(f.webVideosDeleted)}})})();
/*! ScanToolset */
(function(){AMA.namespace("view");var a=AMA.view.ScanToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="scan_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",UNSUCCESSFUL:"unsuccessful",SUCCESS:"scanned",SCANNING:"scanning",NORMAL:"normal"};_.extend(a.prototype,{events:{"click #button_scan_normal, .button_security_scan .tryagain,#button_scan_ended":"scan","click #edit_security_settings":"editSecuritySettings"},editSecuritySettings:function(b){b.stopImmediatePropagation();AMA.page.openSettings("security","home/security")},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,d=AMA.workflow.BaseWorkflow,c=AMA.workflow.ScanWorkflow;var e=new c();b.define("scan",e);e.on(d.EVENT.STARTED,function(f){clearInterval(AMA.view.ThreatProtectionView.POLLER)},this);e.on(d.EVENT.STATE_CHANGED,function(f){switch(f.state){case d.STATE.INITIALIZING:AMA.debug("Scan Toolset has switched the Scan Button state to 'connecting'; countdown initialized");this.toggleDisplay(a.CSS.CONNECTING);break;case c.STATE.SCANNING:AMA.debug("Scan Toolset has switched the Scan Button state to 'scanning'");this.toggleDisplay(a.CSS.SCANNING);break;default:}},this);e.on(d.EVENT.FINISHED,function(f){AMA.view.ThreatProtectionView.POLLER=setInterval(function(){AMA.models.threats.invalidate()},30000);switch(f.result){case d.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);break;default:this.toggleDisplay(a.CSS.UNSUCCESSFUL)}},this);e.on(d.EVENT.COUNTDOWN_TICK,function(f){$(".scan_toolset_countdown").html(f.remaining)},this)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_security_scan").hide()},render:function(){a.__super__.render.apply(this)},scan:function(){AMA.ActionManager.start("scan")}})})();
/*! DiagnosticScanToolset */
(function(){AMA.namespace("view");var a=AMA.view.DiagnosticScanToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="diagnostic_scan_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",UNSUCCESSFUL:"unsuccessful",SUCCESS:"scanned",SCANNING:"scanning",NORMAL:"normal"};_.extend(a.prototype,{events:{"click #button_healthscan_normal, .button_healthscan.unsuccessful":"scan","click .button_healthscan.scanned":"showDiagnosticResults"},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.DiagnosticScanWorkflow;var e=new d();b.define("diagnosticScan",e);e.on(c.EVENT.STATE_CHANGED,function(f){switch(f.state){case c.STATE.INITIALIZING:AMA.debug("Diagnostic Scan Toolset has switched the Scan Button state to 'connecting'; countdown initialized");this.toggleDisplay(a.CSS.CONNECTING);break;case d.STATE.SCANNING:AMA.debug("Diagnostic Scan Toolset has switched the Scan Button state to 'scanning'");this.toggleDisplay(a.CSS.SCANNING);break;default:}},this);e.on(c.EVENT.FINISHED,function(f){switch(f.result){case c.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);if(AMA.config.enableSurveys){AMA.page.openSurvey("health-scan-success")}break;default:this.toggleDisplay(a.CSS.UNSUCCESSFUL);$(".diagnostic_toolset_countdown.countdown_amount").html("05:00");break}},this);e.on(c.EVENT.COUNTDOWN_TICK,function(f){$(".diagnostic_toolset_countdown").html(f.remaining)},this)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_healthscan").hide()},render:function(){a.__super__.render.apply(this)},scan:function(){AMA.ActionManager.start("diagnosticScan")},showDiagnosticResults:function(){this.toggleDisplay(a.CSS.NORMAL)}})})();
/*! Toolbar */
(function(){AMA.namespace("view");var a=AMA.view.Toolbar=AMA.view.BaseView.extend();a.TEMPLATE_ID="toolbar_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{initialize:function(){a.__super__.initialize.apply(this,arguments);this.toolsets={}},_setupEvents:function(){},render:function(){a.__super__.render.apply(this)},registerToolset:function(b,c){this.toolsets[b]=c;c.parent=this;this.children.push(c)},registerSwitcher:function(b){AMA.assert(b.SWITCH_VIEW_EVENT,"[Toolbar.registerSwitcher] View is not a switcher");var c=this;b.on(b.SWITCH_VIEW_EVENT,function(e){c._hideAllToolsets();function d(){if(AMA.Util.isIPhone(AMA.models.endpoints.models[0].get("platformfriendlyname"))&&e.to.constructor.TOOLBAR.IPHONE){_.each(e.to.constructor.TOOLBAR.IPHONE,function(f){if(typeof c.toolsets[f]!="undefined"){c.toolsets[f].show()}})}else{_.each(e.to.constructor.TOOLBAR.DEFAULT,function(f){if(typeof c.toolsets[f]!="undefined"){c.toolsets[f].show()}})}}if(c.isRendered){d()}else{c.once(AMA.view.BaseView.EVENT.RENDERED,d)}})},_hideAllToolsets:function(){_.each(this.toolsets,function(b){if(b){b.hide()}})}})})();
/*! AppAssistToolset */
(function(){AMA.namespace("view");var a=AMA.view.AppAssistToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="app_assist_toolset_template";a.TEMPLATE_SRC="";_.extend(a.prototype,{_processData:function(b){if(!this.data.attributes.total){this.data.attributes.total=this.data.length}return this.data.attributes}})})();
/*! TipsToRecover */
(function(){AMA.namespace("view");var a=AMA.view.TipsToRecover=AMA.view.Dialog.extend();a.TEMPLATE_ID="Tips_To_Recover";a.TEMPLATE_SRC="";a.WIDTH=650;a.HEIGHT="auto";_.extend(a.prototype,{initialize:function(){this.options.width=a.WIDTH;this.options.height=a.HEIGHT;a.__super__.initialize.apply(this,arguments)},show:function(){a.__super__.show.apply(this,arguments)}})})();