/*! RetrievePinView */
define(["jquery","underscore","backbone","text!tpl/prelogin/retrieve_pin.html"],function(c,a,e,b){var d=e.View.extend({el:"#body_container",template:a.template(b),initialize:function(){c("#index_li").siblings().removeAttr("class");var f=0;$el=this.$el;this.$el.on("submit","form[name=retrievePin]",function(j){j.preventDefault();var g=c(this).attr("action");var i=JSON.stringify({email:c(this).find("[name=email]").val()});AMA.debug("Sending AJAX request: "+g);var h=createCORSRequest.call(this,"POST",g);if(h){h.setRequestHeader("Content-type","application/json");h.onerror=function(l,k,m){AMA.debug("AJAX Request to "+g+" returns "+h.status);AMA.Util.switchLabel(".validation_text",".email_empty",this.$el.find(".validation_accountinfo2"))};h.onreadystatechange=function(){if(h.readyState===4&&h.status===200){window.location="#password_sent_email"}else{if(h.readyState===4&&h.status===500){var k=JSON.parse(h.responseText);$el.find(".pin_error").html(k.error);AMA.Util.switchLabel(".validation_text",".email_empty",$el.find(".validation_accountinfo2"))}}};h.send(i)}else{alert("test")}})},render:function(){var g=this;var f=AMA.config.apiHostUrl+"/accounts/passwordReset/send?"+c.param({devId:AMA.config.devId});this.$el.html(this.template);c("form[name=retrievePin]").attr("action",f);return this},events:{"click #triggerPinChange":"btn_submit"},btn_submit:function(g){var f=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,g=this.$el.find("[name=email]").val();if(!f.test(g)){AMA.Util.switchLabel(".validation_text",".email_empty",this.$el.find(".validation_accountinfo2"));return false}this.$el.find("form").submit()}});return d});