/*! LocateToolset */
(function(){AMA.namespace("view");var a=AMA.view.LocateToolset=AMA.view.BaseView.extend();a.TEMPLATE_ID="locate_toolset_template";a.TEMPLATE_SRC="";a.CSS={CONNECTING:"connecting",REFINING:"refining",UNSUCCESSFUL:"unsuccessful",SUCCESS:"success",NORMAL:"normal",CANCELLED:"cancelled"};_.extend(a.prototype,{events:{"click .button_locate.normal":"locate","click .button_locate.outcome.success":"locate","click .button_locate.outcome.unsuccessful":"locate","click .button_locate.outcome.cancelled":"locate"},initialize:function(){a.__super__.initialize.apply(this,arguments);var b=AMA.ActionManager,c=AMA.workflow.BaseWorkflow,d=AMA.workflow.LocateWorkflow;var f=new d();b.define("locate",f);f.on(c.EVENT.STATE_CHANGED,function(g){switch(g.state){case c.STATE.INITIALIZING:this.toggleDisplay(a.CSS.CONNECTING);break;case d.STATE.REFINING:this.toggleDisplay(a.CSS.REFINING);break;default:}AMA.debug("Locate Toolset has switched the Locate Button state to '"+f.getStateName(g.state)+"' state")},this);f.on(c.EVENT.FINISHED,function(g){switch(g.result){case c.RESULT.SUCCESSFUL:this.toggleDisplay(a.CSS.SUCCESS);if(AMA.config.enableSurveys){AMA.page.openSurvey("location-success")}break;case c.RESULT.FAILED:this.toggleDisplay(a.CSS.UNSUCCESSFUL);break;case c.RESULT.CANCELLED:this.toggleDisplay(a.CSS.CANCELLED);break;default:}$(".locate_toolset_countdown").html("03:00");AMA.debug("Locate toolset finished with result of '"+f.getResultName(g.result)+"'")},this);var e=this;f.on(c.EVENT.COUNTDOWN_TICK,function(g){$(".locate_toolset_countdown").html(g.remaining);e._timeRemaining=g.remaining},this)},toggleDisplay:function(b){this.$el.find("."+b).show().siblings(".button_locate").hide()},render:function(){a.__super__.render.apply(this)},locate:function(b){b.stopPropagation();AMA.ActionManager.start("locate")},_afterRender:function(){if(AMA.models.endpoints.models[0].get("platform").indexOf("iOS")===0){this.$el.find("#button_locate_normal .tooltip").html(this.$el.find(".normal_iPhone_tooltip").html())}}})})();